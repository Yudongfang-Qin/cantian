# ctctl<a name="ZH-CN_TOPIC_0000001788637360"></a>





## ctctl help<a name="ZH-CN_TOPIC_0000001835276893"></a>

**命令功能<a name="zh-cn_topic_0000001788626096_section39926938"></a>**

**ctctl help**命令用于查询CLI框架当前支持的所有命令的名称、描述和用法。

**命令格式<a name="zh-cn_topic_0000001788626096_section23798129"></a>**

**ctctl help**

**参数说明<a name="zh-cn_topic_0000001788626096_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001788626096_section1393162518177"></a>**

无。

**使用示例<a name="zh-cn_topic_0000001788626096_section63268730"></a>**

查询CLI框架当前支持的所有命令的名称、描述和用法。

```
[root@rto0-node0 ~]# ctctl help
The commands we support are as follows:
[commands]               	[description]            
help                     	executable command query: ctctl help
log query                	audit log query: this_command [format=json/table]
collection logs          	get logs of all modules as tar.gz: this_command [log_dir=/your_path] [type=recent/all]. example: ctctl collection logs log_dir=/root/log_saves/ type=all
logs progress query      	query the progress of log collection: this_command [format=json/table]
```

**输出说明<a name="zh-cn_topic_0000001788626096_section1412117293556"></a>**

无。

## ctctl log query<a name="ZH-CN_TOPIC_0000001788477716"></a>

**命令功能<a name="zh-cn_topic_0000001835265713_section39926938"></a>**

**ctctl log query**命令用于查询审计日志。支持查询CLI命令执行者的进程IP（pid），用户ID（uid），具体执行了哪条CLI命令，该条CLI命令执行的状态，以及该条CLI命令执行开始的时间。

**命令格式<a name="zh-cn_topic_0000001835265713_section1910114921215"></a>**

**ctctl log query**  \[format=_?_  \]

**参数说明<a name="zh-cn_topic_0000001835265713_section6395528141419"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|format=?|用于指定终端显示审计日志结果的展示格式。|取值为json或table。默认值为json。当取值为json时，将会以字符串的形式在终端展示查询的结果。当取值为table时，将会以表格的形式在终端展示查询的结果。|


**使用说明<a name="zh-cn_topic_0000001835265713_section1393162518177"></a>**

无。

**使用示例<a name="zh-cn_topic_0000001835265713_section155131536132112"></a>**

-   查询审计日志，不指定**format**参数值。

    ```
    [root@rto0-node0 ~]# ctctl log query
    {{"client_pid": "2809452", "client_uid": "6004", "command": "show cantian status", "running_status": "success", "begin_time": "2023-02-17 15:22:10"}, {"client_pid": "3256214", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:05:19"}, {"client_pid": "3278085", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:08:04"}, {"client_pid": "3280197", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:08:17"}, {"client_pid": "3294706", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:10:04"}, {"client_pid": "3303433", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:11:10"}, {"client_pid": "3337212", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:15:20"}, {"client_pid": "3347609", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:16:36"}, {"client_pid": "3365544", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:18:51"}, {"client_pid": "4164417", "client_uid": "6004", "command": "show cantian status", "running_status": "success", "begin_time": "2023-02-20 16:58:17"}, {"client_pid": "4165421", "client_uid": "6004", "command": "show cantian status", "running_status": "success", "begin_time": "2023-02-20 16:58:25"}, {"client_pid": "520274", "client_uid": "6004", "command": "log query", "running_status": "success", "begin_time": "2023-02-23 16:42:18"}}
    ```

-   查询审计日志，指定**format**参数值为“json“。

    ```
    [root@rto0-node0 ~]# ctctl log query format=json
    {{"client_pid": "2809452", "client_uid": "6004", "command": "show cantian status", "running_status": "success", "begin_time": "2023-02-17 15:22:10"}, {"client_pid": "3256214", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:05:19"}, {"client_pid": "3278085", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:08:04"}, {"client_pid": "3280197", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:08:17"}, {"client_pid": "3294706", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:10:04"}, {"client_pid": "3303433", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:11:10"}, {"client_pid": "3337212", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:15:20"}, {"client_pid": "3347609", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:16:36"}, {"client_pid": "3365544", "client_uid": "6004", "command": "collection logs", "running_status": "success", "begin_time": "2023-02-20 15:18:51"}, {"client_pid": "4164417", "client_uid": "6004", "command": "show cantian status", "running_status": "success", "begin_time": "2023-02-20 16:58:17"}, {"client_pid": "4165421", "client_uid": "6004", "command": "show cantian status", "running_status": "success", "begin_time": "2023-02-20 16:58:25"}, {"client_pid": "520274", "client_uid": "6004", "command": "log query", "running_status": "success", "begin_time": "2023-02-23 16:42:18"}, {"client_pid": "557310", "client_uid": "6004", "command": "log query", "running_status": "success", "begin_time": "2023-02-23 16:45:30"}}
    ```

-   查询审计日志，指定**format**参数值为“table“。

    ```
    [root@rto0-node0 ~]# ctctl log query format=table
    +-------------+-------------+----------------------+-----------------+----------------------+
    | client_pid  | client_uid  |       command        | running_status  |      begin_time      |
    +-------------+-------------+----------------------+-----------------+----------------------+
    |  2809452    |    6004     | show cantian status  |    success      | 2023-02-17 15:22:10  |
    |  3256214    |    6004     |   collection logs    |    success      | 2023-02-20 15:05:19  |
    |  3278085    |    6004     |   collection logs    |    success      | 2023-02-20 15:08:04  |
    |  3280197    |    6004     |   collection logs    |    success      | 2023-02-20 15:08:17  |
    |  3294706    |    6004     |   collection logs    |    success      | 2023-02-20 15:10:04  |
    |  3303433    |    6004     |   collection logs    |    success      | 2023-02-20 15:11:10  |
    |  3337212    |    6004     |   collection logs    |    success      | 2023-02-20 15:15:20  |
    |  3347609    |    6004     |   collection logs    |    success      | 2023-02-20 15:16:36  |
    |  3365544    |    6004     |   collection logs    |    success      | 2023-02-20 15:18:51  |
    |  4164417    |    6004     | show cantian status  |    success      | 2023-02-20 16:58:17  |
    |  4165421    |    6004     | show cantian status  |    success      | 2023-02-20 16:58:25  |
    |   520274    |    6004     |      log query       |    success      | 2023-02-23 16:42:18  |
    |   557310    |    6004     |      log query       |    success      | 2023-02-23 16:45:30  |
    |   573670    |    6004     |      log query       |    success      | 2023-02-23 16:46:42  |
    +-------------+-------------+----------------------+-----------------+----------------------+
    ```

**输出说明<a name="zh-cn_topic_0000001835265713_section1412117293556"></a>**

无。

## ctctl collection logs<a name="ZH-CN_TOPIC_0000001835236949"></a>

**命令功能<a name="zh-cn_topic_0000001788626220_section39926938"></a>**

**ctctl collection logs**命令用于一键式信息收集。

**命令格式<a name="zh-cn_topic_0000001788626220_section1910114921215"></a>**

**ctctl collection logs**  log\_dir=_?_  type=_?_

**参数说明<a name="zh-cn_topic_0000001788626220_section6395528141419"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|log_dir=?|必选参数，信息收集之后，该位置用于存放压缩包的目录。|以/开头，支持数字、大小写英文字符、_、-以及~等符合Linux目录规范的路径名。路径必须在/opt/cantian目录下并确保ctmgruser用户有权限创建该路径。以/opt/cantian/ct_om/logs_packing为例，执行**chown ctmgruser:ctmgruser /opt/cantian/ct_om/logs_packing**命令修改存放信息目录的权限。|
|type=?|必选参数，表示信息收集范围。|all和recent二选一。all：全量信息收集，即所有模块现有信息全部收集。recent：仅采集各模块近期生成的信息。信息收集模块配置表中的size字段用于限制收集近期信息的量，比如size值为30，则采集该模块最近30兆字节的信息。|


**使用说明<a name="zh-cn_topic_0000001788626220_section1393162518177"></a>**

无。

**使用示例<a name="zh-cn_topic_0000001788626220_section155131536132112"></a>**

-   执行一键式信息收集，指定信息收集完毕后存放目录为“/opt/cantian/ct\_om/logs\_packing“，指定信息收集范围为全量信息收集。

    ```
    [root@rto0-node0 ~]# ctctl collection logs log_dir=/opt/cantian/ct_om/logs_packing type=all
    start log collection successful, use [ctctl logs progress query] to get current collection progress
    ```

-   执行一键式信息收集，指定信息收集完毕后存放目录为“/opt/cantian/ct\_om/logs\_packing“，指定信息收集范围为近期信息收集。

    ```
    [root@rto0-node0 ~]# ctctl collection logs log_dir=/opt/cantian/ct_om/logs_packing type=recent
    start log collection successful, use [ctctl logs progress query] to get current collection progress
    ```

**输出说明<a name="zh-cn_topic_0000001788626220_section1412117293556"></a>**

无。

## ctctl logs progress query<a name="ZH-CN_TOPIC_0000001788637364"></a>

**命令功能<a name="zh-cn_topic_0000001788626248_section39926938"></a>**

**ctctl logs progress query**命令用于一键式查询信息收集进度。

**命令格式<a name="zh-cn_topic_0000001788626248_section1910114921215"></a>**

**ctctl logs progress query**  \[ format=? \]

**参数说明<a name="zh-cn_topic_0000001788626248_section6395528141419"></a>**

|参数|说明|取值|
|--|--|--|
|format=?|用于指定终端显示日志结果的展示格式。|取值为json或table。默认值为json。当取值为json时，将会以字符串的形式在终端展示查询的结果。当取值为table时，将会以表格的形式在终端展示查询的结果。|


**使用说明<a name="zh-cn_topic_0000001788626248_section1393162518177"></a>**

无。

**使用示例<a name="zh-cn_topic_0000001788626248_section155131536132112"></a>**

-   执行一键式信息收集进度查询，不指定**format**参数值。

    ```
    [root@rto0-node0 ~]# ctctl logs progress query
    [{'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'om_deploy.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '6.25%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'deploy.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '12.50%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'exporter.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '18.75%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'ctmgr_', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '25.00%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'install.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '31.25%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'uninstall.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '37.50%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'backup.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '43.75%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'update.log', 'generate_type': 'task generated', 'status': 'fail', 'err_type': 'source log file missing', 'percentage': '50.00%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'dsware_cantiand', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '56.25%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'cantian_install.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '62.50%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:41', 'module_name': 'cantiand.rlog', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '68.75%'}, {'start_time': '2023-02-23 16:56:41', 'end_time': '2023-02-23 16:56:41', 'module_name': 'cantianstatus.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '75.00%'}, {'start_time': '2023-02-23 16:56:41', 'end_time': '2023-02-23 16:56:41', 'module_name': 'cms_deploy.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '81.25%'}, {'start_time': '2023-02-23 16:56:41', 'end_time': '2023-02-23 16:56:41', 'module_name': 'CmsStatus.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '87.50%'}, {'start_time': '2023-02-23 16:56:41', 'end_time': '2023-02-23 16:56:51', 'module_name': 'cms_srv', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '93.75%'}, {'start_time': '2023-02-23 16:56:51', 'end_time': '2023-02-23 16:56:57', 'module_name': 'cms_adm', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '100.00%'}]
    ```

-   执行一键式信息收集进度查询，指定**format**参数值为“json“。

    ```
    [root@rto0-node0 ~]# ctctl logs progress query format=json
    [{'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'om_deploy.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '6.25%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'deploy.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '12.50%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'exporter.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '18.75%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'ctmgr_', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '25.00%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'install.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '31.25%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'uninstall.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '37.50%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'backup.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '43.75%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'update.log', 'generate_type': 'task generated', 'status': 'fail', 'err_type': 'source log file missing', 'percentage': '50.00%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'dsware_cantiand', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '56.25%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:28', 'module_name': 'cantian_install.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '62.50%'}, {'start_time': '2023-02-23 16:56:28', 'end_time': '2023-02-23 16:56:41', 'module_name': 'cantiand.rlog', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '68.75%'}, {'start_time': '2023-02-23 16:56:41', 'end_time': '2023-02-23 16:56:41', 'module_name': 'cantianstatus.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '75.00%'}, {'start_time': '2023-02-23 16:56:41', 'end_time': '2023-02-23 16:56:41', 'module_name': 'cms_deploy.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '81.25%'}, {'start_time': '2023-02-23 16:56:41', 'end_time': '2023-02-23 16:56:41', 'module_name': 'CmsStatus.log', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '87.50%'}, {'start_time': '2023-02-23 16:56:41', 'end_time': '2023-02-23 16:56:51', 'module_name': 'cms_srv', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '93.75%'}, {'start_time': '2023-02-23 16:56:51', 'end_time': '2023-02-23 16:56:57', 'module_name': 'cms_adm', 'generate_type': 'task generated', 'status': 'done', 'err_type': 'None', 'percentage': '100.00%'}]
    ```

-   执行一键式信息收集进度查询，指定**format**参数值为“table“。

    ```
    [root@rto0-node0 ~]# ctctl logs progress query format=table
    +----------------------+----------------------+----------------------+-----------------+---------+--------------------------+-------------+
    |      start_time      |       end_time       |     module_name      | generate_type   | status  |         err_type         | percentage  |
    +----------------------+----------------------+----------------------+-----------------+---------+--------------------------+-------------+
    | 2023-02-23 16:56:28  | 2023-02-23 16:56:28  |    om_deploy.log     | task generated  |  done   |           None           |   6.25%     |
    | 2023-02-23 16:56:28  | 2023-02-23 16:56:28  |      deploy.log      | task generated  |  done   |           None           |   12.50%    |
    | 2023-02-23 16:56:28  | 2023-02-23 16:56:28  |     exporter.log     | task generated  |  done   |           None           |   18.75%    |
    | 2023-02-23 16:56:28  | 2023-02-23 16:56:28  |        ctmgr_        | task generated  |  done   |           None           |   25.00%    |
    | 2023-02-23 16:56:28  | 2023-02-23 16:56:28  |     install.log      | task generated  |  done   |           None           |   31.25%    |
    | 2023-02-23 16:56:28  | 2023-02-23 16:56:28  |    uninstall.log     | task generated  |  done   |           None           |   37.50%    |
    | 2023-02-23 16:56:28  | 2023-02-23 16:56:28  |      backup.log      | task generated  |  done   |           None           |   43.75%    |
    | 2023-02-23 16:56:28  | 2023-02-23 16:56:28  |      update.log      | task generated  |  fail   | source log file missing  |   50.00%    |
    | 2023-02-23 16:56:28  | 2023-02-23 16:56:28  |   dsware_cantiand    | task generated  |  done   |           None           |   56.25%    |
    | 2023-02-23 16:56:28  | 2023-02-23 16:56:28  | cantian_install.log  | task generated  |  done   |           None           |   62.50%    |
    | 2023-02-23 16:56:28  | 2023-02-23 16:56:41  |    cantiand.rlog     | task generated  |  done   |           None           |   68.75%    |
    | 2023-02-23 16:56:41  | 2023-02-23 16:56:41  |  cantianstatus.log   | task generated  |  done   |           None           |   75.00%    |
    | 2023-02-23 16:56:41  | 2023-02-23 16:56:41  |    cms_deploy.log    | task generated  |  done   |           None           |   81.25%    |
    | 2023-02-23 16:56:41  | 2023-02-23 16:56:41  |    CmsStatus.log     | task generated  |  done   |           None           |   87.50%    |
    | 2023-02-23 16:56:41  | 2023-02-23 16:56:51  |       cms_srv        | task generated  |  done   |           None           |   93.75%    |
    | 2023-02-23 16:56:51  | 2023-02-23 16:56:57  |       cms_adm        | task generated  |  done   |           None           |  100.00%    |
    +----------------------+----------------------+----------------------+-----------------+---------+--------------------------+-------------+
    ```

**输出说明<a name="zh-cn_topic_0000001788626248_section1412117293556"></a>**

无。

# cms<a name="ZH-CN_TOPIC_0000001835276897"></a>

































## cms server -start<a name="ZH-CN_TOPIC_0000001788477720"></a>

**命令功能<a name="zh-cn_topic_0000001835265761_section39926938"></a>**

**cms server -start**命令用于启动CMS。

**命令格式<a name="zh-cn_topic_0000001835265761_section23798129"></a>**

**cms server -start**

**参数说明<a name="zh-cn_topic_0000001835265761_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001835265761_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835265761_section63268730"></a>**

启动cms。

```
$ cms server -start
NODE_ID     = 0
CMS_HOME    = /opt/cantian/cms
GCC_HOME    = /mnt/dbdata/remote/share_share_fs7173/gcc_home/gcc_file
GCC_TYPE    = FILE
VERSION     = Cantian xxx
cms startup...
MES: LSNR 192.168.86.1:14587
mes connect to channel peer 192.168.86.2:14587, success
```

**输出说明<a name="zh-cn_topic_0000001835265761_section1412117293556"></a>**

命令回显的部分字段含义如下。

|字段|含义|
|--|--|
|NODE ID|节点ID。|
|CMS_HOME|CMS相关数据存放的位置。|
|GCC_HOME|存放CMS持久化数据的位置。|
|GCC_TYPE|GCC持久化数据的存放格式。|
|VERSION|当前版本信息。|


## cms server -stop<a name="ZH-CN_TOPIC_0000001835236953"></a>

**命令功能<a name="zh-cn_topic_0000001788466528_section39926938"></a>**

**cms server -stop**命令用于停止CMS。

**命令格式<a name="zh-cn_topic_0000001788466528_section23798129"></a>**

**cms server -stop**

**参数说明<a name="zh-cn_topic_0000001788466528_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001788466528_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788466528_section63268730"></a>**

停止cms。

```
$ cms server -stop
stop cms server succeed.
```

**输出说明<a name="zh-cn_topic_0000001788466528_section1412117293556"></a>**

无。

## cms stat<a name="ZH-CN_TOPIC_0000001788637368"></a>

**命令功能<a name="zh-cn_topic_0000001835225825_section39926938"></a>**

**cms stat**命令用于查看集群状态。

**命令格式<a name="zh-cn_topic_0000001835225825_section23798129"></a>**

**cms stat**

**参数说明<a name="zh-cn_topic_0000001835225825_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001835225825_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225825_section63268730"></a>**

查看集群状态。

```
$ cms stat
NODE_ID  NAME      STAT    PRE_STAT    TARGET_STAT   WORK_STAT         
0          db        ONLINE   UNKNOWN     ONLINE                1
1          db        ONLINE   OFFLINE     ONLINE                1
SESSION_ID   INSTANCE_ID   ROLE         LAST_CHECK
0             0               REFORMER   2022-12-27 15:39:27.660
0             1                          2022-12-27 15:39:29.084
HB_TIME               STAT_CHANGE
2022-12-27 15:39:27.660   2022-12-27 15:34:21.875
2022-12-27 15:39:29.084   2022-12-27 15:38:51.235
```

**输出说明<a name="zh-cn_topic_0000001835225825_section1412117293556"></a>**

命令回显的部分字段含义如下。

|字符名称|字段含义|
|--|--|
|NODE_ID|节点ID。|
|NAME|Cantian引擎名称。|
|STAT|Cantian引擎的状态，分为：ONLINE：在线OFFLINE：离线UNKNOWN：状态未知|
|PRE_STAT|Cantian引擎的上一个状态。|
|TARGET_STAT|Cantian引擎的下一个目标状态。|
|WORK_STAT|Cantian引擎的工作状态，分为：RC_JOINING (0) ：正在加入集群RC_JOINED (1) ：已经加入集群RC_LEAVING (2) ：正在离开集群RC_LEFT (3) ：已经离开集群|
|SESSION_ID|Cantian引擎的ID。目前只有一个资源，因此ID为0，当资源离线时，为-1。|
|INSTANCE_ID|Cantian引擎的实例ID。目前只有一个资源，因此节点ID相同，当资源离线时，为-1。|
|ROLE|Cantian引擎的角色，包括reformer和非reformer两种角色，一类资源在一个集群中有且仅会存在1个reformer。|
|LAST_CHECK|上一次检查Cantian引擎的时间，等于HB_TIME，当Cantian引擎离线时时间为2000-01-01 00:00:00.000。|
|HB_TIME|上一次收到Cantian引擎心跳消息的时间，当Cantian引擎离线时时间为2000-01-01 00:00:00.000。|
|STAT_CHANGE|上一次Cantian引擎状态变化的时间。|


## cms stat -node<a name="ZH-CN_TOPIC_0000001835276901"></a>

**命令功能<a name="zh-cn_topic_0000001788626140_section39926938"></a>**

**cms stat -node**命令用于查看节点状态。

**命令格式<a name="zh-cn_topic_0000001788626140_section23798129"></a>**

-   **cms stat -node**
-   **cms stat -node** _NODE ID_

**参数说明<a name="zh-cn_topic_0000001788626140_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|NODE ID|节点ID。|-|


**使用说明<a name="zh-cn_topic_0000001788626140_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788626140_section63268730"></a>**

-   查看所有节点状态。

    ```
    $ cms stat -node
    NODE_ID   NODE_NAME       ROLE
    0     node0              server
    1     node1              agent
    ```

-   查看指定节点状态。

    ```
    $ cms stat -node 0
    NODE_ID   NODE_NAME       ROLE
    0     node0              server
    ```

**输出说明<a name="zh-cn_topic_0000001788626140_section1412117293556"></a>**

命令回显的部分字段含义如下。

|字符名称|字段含义|
|--|--|
|NODE_ID|节点ID。|
|NODE_NAME|节点名称。|
|ROLE|节点的类型：当节点CMS为Master时，该节点类型为server，CMS Master负责控制脑裂仲裁等流程。当节点CMS为非Master时，该节点类型为agent。|


## cms stat -res<a name="ZH-CN_TOPIC_0000001788477724"></a>

**命令功能<a name="zh-cn_topic_0000001835265745_section39926938"></a>**

**cms stat -res**命令用于查看资源状态。

**命令格式<a name="zh-cn_topic_0000001835265745_section23798129"></a>**

-   **cms stat -res**
-   **cms stat -res** _RESOURCE NAME_

**参数说明<a name="zh-cn_topic_0000001835265745_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|RESOURCE NAME|资源名称，当前仅有db一种资源。|-|


**使用说明<a name="zh-cn_topic_0000001835265745_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835265745_section63268730"></a>**

-   查看所有资源状态。

    ```
    $ cms stat -res
    NODE_ID  RESOURCE_NAME  STAT   PRE_STAT  TARGET_STAT  WORK_STAT                      
    0           db                ONLINE  UNKNOWN  ONLINE        1
    1           db                ONLINE  OFFLINE  ONLINE        1
    LAST_CHECK            STAT_CHANGE
    2022-12-27 15:42:23.682    2022-12-27 15:34:21.875
    2022-12-27 15:42:23.106    2022-12-27 15:38:51.235
    ```

-   查看指定资源状态。

    ```
    $ cms stat -res db
    NODE_ID  RESOURCE_NAME  STAT   PRE_STAT  TARGET_STAT  WORK_STAT
    0           db                ONLINE  UNKNOWN  ONLINE        1
    1           db                ONLINE  OFFLINE  ONLINE        1
    LAST_CHECK            STAT_CHANGE
    2022-12-27 15:42:50.185    2022-12-27 15:34:21.875
    2022-12-27 15:42:49.610    2022-12-27 15:38:51.235
    ```

**输出说明<a name="zh-cn_topic_0000001835265745_section1412117293556"></a>**

命令回显的部分字段含义如下。

|字符名称|字段含义|
|--|--|
|NODE_ID|节点ID。|
|RESOURCE_NAME|资源名称，当前仅有db一种资源。|
|STAT|资源的状态，分为：ONLINE：在线OFFLINE：离线UNKNOWN：状态未知|
|PRE_STAT|资源的上一个状态。|
|TARGET_STAT|资源的下一个目标状态。|
|WORK_STAT|资源的工作状态，分为：RC_JOINING (0) ：正在加入集群RC_JOINED (1) ：已经加入集群RC_LEAVING (2) ：正在离开集群RC_LEFT (3) ：已经离开集群|
|LAST_CHECK|上一次检查资源的时间，等于HB_TIME，当资源离线时时间为2000-01-01 00:00:00.000。|
|STAT_CHANGE|上一次资源状态变化的时间。|


## cms stat -server<a name="ZH-CN_TOPIC_0000001835236961"></a>

**命令功能<a name="zh-cn_topic_0000001788626228_section39926938"></a>**

**cms stat -server**命令用于查看CMS状态。

**命令格式<a name="zh-cn_topic_0000001788626228_section23798129"></a>**

-   **cms stat -server**
-   **cms stat -server** _NODE ID_

**参数说明<a name="zh-cn_topic_0000001788626228_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|NODE ID|节点ID|-|


**使用说明<a name="zh-cn_topic_0000001788626228_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788626228_section63268730"></a>**

-   查看所有CMS状态。

    ```
    $ cms stat -server
    NODE_ID  SRV_READY  SEND_QUE  RECV_QUE  TIME_GAP(ms)
    0          TRUE         0           0           0
    1          TRUE         0           0           1
    ```

-   查看指定节点CMS状态。

    ```
    $ cms stat -server 0
    NODE_ID  SRV_READY   SEND_QUE  RECV_QUE  TIME_GAP(ms)
    0          TRUE          0           0           0
    ```

**输出说明<a name="zh-cn_topic_0000001788626228_section1412117293556"></a>**

命令回显的部分字段含义如下。

|字符名称|字段含义|
|--|--|
|NODE ID|节点ID。|
|SRV_READY|节点CMS的工作状态：TRUE：表示CMS正常工作。FALSE：表示CMS为暂停工作。|
|SEND_QUE|CMS消息发送队列中消息的数目。|
|RECV_QUE|CMS消息接收队列中消息的数据。|
|TIME_GAP|该节点CMS与其他各节点CMS之间的时间跳变的最大值。|


## cms iostat<a name="ZH-CN_TOPIC_0000001788637372"></a>

**命令功能<a name="zh-cn_topic_0000001788626212_section39926938"></a>**

**cms iostat**命令用于获取CMS和Cantian引擎之间的消息处理统计信息。

**命令格式<a name="zh-cn_topic_0000001788626212_section23798129"></a>**

**cms iostat**

**参数说明<a name="zh-cn_topic_0000001788626212_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001788626212_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788626212_section63268730"></a>**

获取消息处理统计信息。

```
$ cms iostat
MSG_TYPE                                MSG_ALL  BACK_GOOD  BACK_BAD      AVG_US             MAX_US          MIN_US          TOTAL_US
CMS_CLI_MSG_REQ_GET_RES_STAT         1784          1784          0             964                   234567                410                   1720432
CMS_CLI_MSG_REQ_SET_RES_DATA         15            15            0             5428                  11038                 3907                  81420
CMS_CLI_MSG_REQ_GET_RES_DATA         889           889           0             4151                  1000937               1815                  3690934
CMS_CLI_MSG_REQ_HB                   889           888           0             64                    142                   51                    57023
CMS_CLI_MSG_RES_IOF_KICK             0             0             0             0                     0                     -1                    0
CMS_CLI_MSG_REQ_DIS_CONN             0             0             0             0                     0                     -1                    0
CMS_CLI_MSG_REQ_SET_WORK_STAT        2             2             0             5661                  6144                  5179                  11323
CMS_STATISTIC_TRY_BE_MASTER          1879          1879          0             9027                  8860580               1250                  16961835
CMS_STATISTIC_DETECT_DISK            1876          1876          0             9088                  8966337               1154                  17050794
CMS_STATISTIC_HB_AYNC_TIME_GAP       888           888           0             3569                  941295                897                   3169515
```

**输出说明<a name="zh-cn_topic_0000001788626212_section1412117293556"></a>**

命令回显的部分字段含义如下。

|字符名称|字段含义|
|--|--|
|MSG_TYPE|消息类型，包括：CMS_CLI_MSG_REQ_GET_RES_STAT：CMS获取资源状态的请求消息CMS_CLI_MSG_REQ_SET_RES_DATA：CMS设置资源数据的请求消息CMS_CLI_MSG_REQ_GET_RES_DATA：CMS获取资源数据的请求消息CMS_CLI_MSG_REQ_HB：CMS与Cantian引擎之间的心跳请求消息CMS_CLI_MSG_RES_IOF_KICK：Cantian引擎处理Iofence的结果消息CMS_CLI_MSG_REQ_DIS_CONN：CMS与Cantian引擎断开uds连接的请求消息CMS_CLI_MSG_REQ_SET_WORK_STAT：CMS设置资源工作状态的请求消息CMS_STATISTIC_TRY_BE_MASTER：统计CMS争取成为Master次数的消息CMS_STATISTIC_DETECT_DISK：统计CMS读取磁盘次数的消息CMS_STATISTIC_HB_AYNC_TIME_GAP：接收到心跳和心跳落盘的时间差|
|MSG_ALL|总共的消息数量。|
|BACK_GOOD|处理成功的消息数量。|
|BACK_BAD|处理失败的消息数量。|
|AVG_US|处理消息的平均时延。|
|MAX_US|处理消息的最大时延。|
|MIN_US|处理消息的最小时延。|
|TOTAL_US|处理消息的总时延。|


## cms iostat -reset<a name="ZH-CN_TOPIC_0000001835276905"></a>

**命令功能<a name="zh-cn_topic_0000001788626172_section39926938"></a>**

**cms iostat -reset**命令用于将CMS和Cantian引擎之间的消息处理统计信息清零。

**命令格式<a name="zh-cn_topic_0000001788626172_section23798129"></a>**

**cms iostat -reset**

**参数说明<a name="zh-cn_topic_0000001788626172_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001788626172_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788626172_section63268730"></a>**

消息处理统计信息清零。

```
$ cms iostat -reset
reset cms iostat success.
```

**输出说明<a name="zh-cn_topic_0000001788626172_section1412117293556"></a>**

无。

## cms res -list<a name="ZH-CN_TOPIC_0000001788477728"></a>

**命令功能<a name="zh-cn_topic_0000001835225681_section39926938"></a>**

**cms res -list**命令用于列出资源在gcc\_file中记录的参数和配置信息。

**命令格式<a name="zh-cn_topic_0000001835225681_section23798129"></a>**

**cms res -list**

**参数说明<a name="zh-cn_topic_0000001835225681_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001835225681_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225681_section63268730"></a>**

列出资源在gcc\_file中记录的参数和配置信息。

```
$ cms res -list
RESOURCE_NAME    RESOURCE_TYPE    RESOURCE_GROUP_NAME     START_TIMEOUT(ms)
db                   db                   default                        1000
STOP_TIMEOUT(ms)    CHECK_TIMEOUT(ms)   CHECK_INTERVAL(ms)  HB_TIMEOUT(ms)
1000                  1000                    1000                    10000
RESTART_TIMES       RESTART_INTERVAL    SCRIPT
0                      45000                   /opt/cantian/cms/service/bin/cluster.sh
```

**输出说明<a name="zh-cn_topic_0000001835225681_section1412117293556"></a>**

命令回显的部分字段含义如下。

|字段名称|含义|
|--|--|
|RESOURCE_NAME|资源名称，当前仅有db一种资源。|
|RESOURCE_TYPE|资源类型。|
|RESOURCE_GROUP_NAME|预留，当前版本暂不启用。|
|START_TIMEOUT(ms)|预留，当前版本暂不启用。|
|STOP_TIMEOUT(ms)|预留，当前版本暂不启用。|
|CHECK_TIMEOUT(ms)|预留，当前版本暂不启用。|
|CHECK_INTERVAL(ms)|预留，当前版本暂不启用。|
|HB_TIMEOUT(ms)|节点内资源与CMS的心跳异常阈值，在这个阈值时间内资源未成功向CMS发送过心跳信息，则CMS会下线资源，将其状态置为OFFLINE。|
|RESTART_TIMES|CMS主动重启资源的次数。例如当资源因某些异常原因退出，CMS会尝试主动重启资源。|
|RESTART_INTERVAL|重启资源间隔时间。例如当资源退出后，CMS尝试开始重启，当启动未成功时，间隔RESTART_INTERVAL后会再次尝试重启。|
|SCRIPT|CMS运行时调用的脚本。例如CMS启动资源时会调用该脚本。|


## cms res -edit<a name="ZH-CN_TOPIC_0000001835236965"></a>

**命令功能<a name="zh-cn_topic_0000001788626244_section39926938"></a>**

**cms res -edit**命令用于修改gcc\_file中资源的参数和配置。

**命令格式<a name="zh-cn_topic_0000001788626244_section23798129"></a>**

**cms res -edit** _RESOURCE NAME_ **-attr** _ATTRIBUTE PAIRS_

**参数说明<a name="zh-cn_topic_0000001788626244_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|RESOURCE NAME|资源名称。|-|
|ATTRIBUTE PAIRS|资源的属性。|属性列表参见cms res -list的各项字段。|


**使用说明<a name="zh-cn_topic_0000001788626244_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788626244_section63268730"></a>**

修改gcc\_file中资源的参数和配置。

```
$ cms res -edit db -attr CHECK_TIMEOUT=1000000000
modify resource succeed.
```

**输出说明<a name="zh-cn_topic_0000001788626244_section1412117293556"></a>**

无。

## cms res -start<a name="ZH-CN_TOPIC_0000001788637376"></a>

**命令功能<a name="zh-cn_topic_0000001835225705_section39926938"></a>**

**cms res -start**命令用于启动集群内的资源。

**命令格式<a name="zh-cn_topic_0000001835225705_section23798129"></a>**

-   **cms res -start** _RESOURCE NAME_
-   **cms res -start** _RESOURCE NAME_ **-node** _NODE\_ID_
-   **cms res -start** _RESOURCE NAME_ _TIMEOUT_

**参数说明<a name="zh-cn_topic_0000001835225705_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|RESOURCE NAME|资源名称。|-|
|NODE_ID|节点ID。|-|
|TIMEOUT|启动超时阈值（启动时间超过阈值会返回，否则会等待）|-|


**使用说明<a name="zh-cn_topic_0000001835225705_section1140684110560"></a>**

-   执行该命令前，检查待启动节点的CMS server是否存活（执行**ps -ef|grep 'cms server'**命令查看是否存在cms server进程来判断）。
-   需要切换到cantian用户下执行。

    >![](public_sys-resources/icon-note.gif) **说明：** 
    >启动指定节点的资源，等待时间为600秒，600秒仍未成功启动，该命令超时报错退出。

**使用示例<a name="zh-cn_topic_0000001835225705_section63268730"></a>**

-   启动集群内所有资源。

    ```
    $ cms res -start db
    start resource succeed.
    ```

-   启动指定节点资源。

    ```
    $ cms res -start db -node 0
    start resource succeed.
    ```

-   指定等待时间启动集群内所有资源。

    ```
    $ cms res -start db 120000
    start resource succeed.
    ```

**输出说明<a name="zh-cn_topic_0000001835225705_section1412117293556"></a>**

无。

## cms res -stop<a name="ZH-CN_TOPIC_0000001835276909"></a>

**命令功能<a name="zh-cn_topic_0000001835225853_section39926938"></a>**

**cms res -stop**命令用于停止集群内的资源。

**命令格式<a name="zh-cn_topic_0000001835225853_section23798129"></a>**

-   **cms res -stop** _RESOURCE NAME_
-   **cms res -stop** _RESOURCE NAME_ **-node** _NODE\_ID_

**参数说明<a name="zh-cn_topic_0000001835225853_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|RESOURCE NAME|资源名称。|-|
|NODE_ID|节点ID。|-|


**使用说明<a name="zh-cn_topic_0000001835225853_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225853_section63268730"></a>**

-   停止集群内所有资源。

    ```
    $ cms res -stop db
    stop resource succeed.
    ```

-   停止指定节点资源。

    ```
    $ cms res -stop db -node 0
    stop resource succeed.
    ```

**输出说明<a name="zh-cn_topic_0000001835225853_section1412117293556"></a>**

无。

## cms res -add<a name="ZH-CN_TOPIC_0000001788477732"></a>

**命令功能<a name="zh-cn_topic_0000001835225769_section39926938"></a>**

**cms res -add**命令用于向CMS的gcc\_file中写入新的资源信息。

**命令格式<a name="zh-cn_topic_0000001835225769_section23798129"></a>**

-   **cms res -add** _RESOURCE NAME_ **-type** _RESOURCE TYPE_
-   **cms res -add** _RESOURCE NAME_ **-type** _RESOURCE TYPE_ **-attr**  "_ATTRIBUTE PAIRS_=_?_"

**参数说明<a name="zh-cn_topic_0000001835225769_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|RESOURCE NAME|资源名称。|-|
|RESOURCE TYPE|资源类型。|-|
|ATTRIBUTE PAIRS|资源的其他属性。|必须选择当前已有的属性，不区分大小写。属性列表参见cms res -list的各项字段。|


**使用说明<a name="zh-cn_topic_0000001835225769_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225769_section63268730"></a>**

-   向CMS的gcc\_file中写入名称为test\_name，类型为test\_type的资源信息。

    ```
    $ cms res -add test_name -type test_type
    add resource succeed.
    ```

-   向CMS的gcc\_file中写入名称为db\_test，类型为db\_test的资源信息，并指定脚本为test.sh。

    ```
    $ cms res -add db_test -type db_test -attr "script=test.sh"
    add resource succeed.
    ```

**输出说明<a name="zh-cn_topic_0000001835225769_section1412117293556"></a>**

无。

## cms res -del<a name="ZH-CN_TOPIC_0000001835236969"></a>

**命令功能<a name="zh-cn_topic_0000001788626208_section39926938"></a>**

**cms res -del**命令用于删除gcc\_file中指定资源的所有信息。

**命令格式<a name="zh-cn_topic_0000001788626208_section23798129"></a>**

**cms res -del** _RESOURCE NAME_

**参数说明<a name="zh-cn_topic_0000001788626208_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|RESOURCE NAME|资源名称。|-|


**使用说明<a name="zh-cn_topic_0000001788626208_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788626208_section63268730"></a>**

删除gcc\_file中test\_name资源的所有信息。

```
$ cms res -del test_name
delete resource succeed.
```

**输出说明<a name="zh-cn_topic_0000001788626208_section1412117293556"></a>**

无。

## cms gcc -list<a name="ZH-CN_TOPIC_0000001788637380"></a>

**命令功能<a name="zh-cn_topic_0000001788466536_section39926938"></a>**

**cms gcc -list**命令用于查看gcc\_file的路径。

**命令格式<a name="zh-cn_topic_0000001788466536_section23798129"></a>**

**cms gcc -list**

**参数说明<a name="zh-cn_topic_0000001788466536_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001788466536_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788466536_section63268730"></a>**

查看gcc\_file的路径。

```
[cantian@k8snode0 run]$ cms gcc -list
gcc:/mnt/dbdata/remote/share_6971_share_fs/gcc_home/gcc_file
```

**输出说明<a name="zh-cn_topic_0000001788466536_section1412117293556"></a>**

无。

## cms gcc -reset<a name="ZH-CN_TOPIC_0000001835276913"></a>

**命令功能<a name="zh-cn_topic_0000001835225673_section39926938"></a>**

**cms gcc -reset**命令用于重置gcc\_file的静态数据信息。

**命令格式<a name="zh-cn_topic_0000001835225673_section23798129"></a>**

**cms gcc -reset**

**参数说明<a name="zh-cn_topic_0000001835225673_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001835225673_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225673_section63268730"></a>**

重置gcc\_file的静态数据信息。

```
[cantian@a12e76db3893 gcc_backup]$ cms gcc -reset
The operation will reset all data on gcc, are you sure?(y/n)
y
reset gcc succeed.
```

**输出说明<a name="zh-cn_topic_0000001835225673_section1412117293556"></a>**

无。

## cms gcc -reset -f<a name="ZH-CN_TOPIC_0000001788477736"></a>

**命令功能<a name="zh-cn_topic_0000001788466620_section39926938"></a>**

**cms gcc -reset -f**命令用于强制重置gcc\_file的静态数据信息。

**命令格式<a name="zh-cn_topic_0000001788466620_section23798129"></a>**

**cms gcc -reset -f**

**参数说明<a name="zh-cn_topic_0000001788466620_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001788466620_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788466620_section63268730"></a>**

强制重置gcc\_file的静态数据信息。

```
[cantian@a12e76db3893 gcc_backup]$ cms gcc -reset -f
reset gcc succeed.
```

**输出说明<a name="zh-cn_topic_0000001788466620_section1412117293556"></a>**

无。

## cms gcc -exp<a name="ZH-CN_TOPIC_0000001835236973"></a>

**命令功能<a name="zh-cn_topic_0000001835225697_section39926938"></a>**

**cms gcc -exp**命令用于将gcc\_file静态数据信息导出到指定文件。

**命令格式<a name="zh-cn_topic_0000001835225697_section23798129"></a>**

**cms gcc -exp** _OUTPUT FILE PATH_

**参数说明<a name="zh-cn_topic_0000001835225697_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|OUTPUT FILE PATH|导出文件路径。导出路径需存在且cantian用户对该文件有读写权限。|-|


**使用说明<a name="zh-cn_topic_0000001835225697_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225697_section63268730"></a>**

将gcc\_file静态数据信息导出到指定文件。

```
[cantian@a12e76db3893 gcc_backup]$ cms gcc -exp /opt/cantian/cms/gcc_backup/gcc_exp
export gcc succeed.
```

**输出说明<a name="zh-cn_topic_0000001835225697_section1412117293556"></a>**

无。

## cms gcc -imp<a name="ZH-CN_TOPIC_0000001788637384"></a>

**命令功能<a name="zh-cn_topic_0000001788466524_section39926938"></a>**

**cms gcc -imp**命令用于将gcc\_file静态数据信息从指定格式化文件导入至存储系统。

**命令格式<a name="zh-cn_topic_0000001788466524_section23798129"></a>**

**cms gcc -imp** _INPUT FILE PATH_

**参数说明<a name="zh-cn_topic_0000001788466524_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|INPUT FILE PATH|导入文件路径。导入路径需存在可导入文件且cantian用户对该文件有读写权限。|-|


**使用说明<a name="zh-cn_topic_0000001788466524_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788466524_section63268730"></a>**

将gcc\_file静态数据信息从指定格式化文件导入至存储系统。

```
[cantian@a12e76db3893 gcc_backup]$ cms gcc -imp /opt/cantian/cms/gcc_backup/gcc_exp
The operation will replace all data on gcc and can not rollback, are you sure?(y/n)
y
import gcc succeed.
```

**输出说明<a name="zh-cn_topic_0000001788466524_section1412117293556"></a>**

无。

## cms gcc -backup<a name="ZH-CN_TOPIC_0000001835276917"></a>

**命令功能<a name="zh-cn_topic_0000001835265573_section39926938"></a>**

**cms gcc -backup**命令用于备份当前gcc\_file的静态数据信息。

**命令格式<a name="zh-cn_topic_0000001835265573_section23798129"></a>**

**cms gcc -backup**

**参数说明<a name="zh-cn_topic_0000001835265573_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001835265573_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835265573_section63268730"></a>**

备份gcc\_file的静态数据信息。

```
[cantian@a12e76db3893 gcc_backup]$ cms gcc -backup
backup gcc succeed.
[cantian@a12e76db3893 gcc_backup]$ ls
bak_20221227211546  bak_20221227211546.exp
```

**输出说明<a name="zh-cn_topic_0000001835265573_section1412117293556"></a>**

无。

## cms gcc -restore<a name="ZH-CN_TOPIC_0000001788477740"></a>

**命令功能<a name="zh-cn_topic_0000001835265737_section39926938"></a>**

**cms gcc -restore**命令用于将备份的gcc\_file静态数据恢复到存储系统。

**命令格式<a name="zh-cn_topic_0000001835265737_section23798129"></a>**

**cms gcc -restore** _BACKUP FILE PATH_

**参数说明<a name="zh-cn_topic_0000001835265737_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|BACKUP FILE PATH|备份文件所在路径。需存在可恢复文件且cantian用户对该文件有读写权限。|-|


**使用说明<a name="zh-cn_topic_0000001835265737_section1393162518177"></a>**

1.  需要切换到cantian用户下执行。
2.  需要先停止Cantian引擎。依次在所有节点执行以下命令停止Cantian引擎。

    其中，以Cantian引擎安装包的安装路径为/ctdb/cantian\_install为例说明。

    ```
    sh /ctdb/cantian_install/cantian_connector/action/appctl.sh stop
    ```

**使用示例<a name="zh-cn_topic_0000001835265737_section63268730"></a>**

将备份的gcc\_file静态数据恢复到存储系统。

```
[cantian@a12e76db3893 gcc_backup]$ cms gcc -restore /opt/cantian/cms/gcc_backup/bak_20221227211546
The operation will replace all data on gcc and can not rollback, are you sure?(y/n)
y
restore gcc succeed.
```

**输出说明<a name="zh-cn_topic_0000001835265737_section1412117293556"></a>**

无。

## cms node -add<a name="ZH-CN_TOPIC_0000001835236977"></a>

**命令功能<a name="zh-cn_topic_0000001835265701_section39926938"></a>**

**cms node -add**命令用于向CMS的gcc\_file中写入新的节点信息。

**命令格式<a name="zh-cn_topic_0000001835265701_section23798129"></a>**

-   **cms node -add** _NAME_ _IP_ _PORT_
-   **cms node -add** _NODE\_ID_ _NAME_ _IP_ _PORT_

**参数说明<a name="zh-cn_topic_0000001835265701_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|NAME|节点名称。|-|
|IP|节点IP。|-|
|PORT|端口。|-|
|NODE_ID|节点ID。|-|


**使用说明<a name="zh-cn_topic_0000001835265701_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835265701_section63268730"></a>**

-   添加节点配置信息到gcc\_file，自动生成node\_id。

    ```
    [cantian@a12e76db3893 gcc_backup]$ cms node -add node0 192.168.86.1 14587
    add node succeed.
    ```

-   添加节点配置信息到gcc\_file，手动指定node\_id。

    ```
    [cantian@a12e76db3893 gcc_backup]$ cms node -add 0 node0 192.168.86.1 14587
    add node succeed.
    ```

**输出说明<a name="zh-cn_topic_0000001835265701_section1412117293556"></a>**

无。

## cms node -del<a name="ZH-CN_TOPIC_0000001788637388"></a>

**命令功能<a name="zh-cn_topic_0000001788626216_section39926938"></a>**

**cms node -del**命令用于删除节点信息。

**命令格式<a name="zh-cn_topic_0000001788626216_section23798129"></a>**

**cms node -del** _NODE\_ID_

**参数说明<a name="zh-cn_topic_0000001788626216_section12856577"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|NODE_ID|节点ID。|-|


**使用说明<a name="zh-cn_topic_0000001788626216_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788626216_section63268730"></a>**

删除节点0的信息。

```
[cantian@a12e76db3893 gcc_backup]$ cms node -del 0
delete node succeed.
```

**输出说明<a name="zh-cn_topic_0000001788626216_section1412117293556"></a>**

无。

## cms node -list<a name="ZH-CN_TOPIC_0000001835276921"></a>

**命令功能<a name="zh-cn_topic_0000001835225781_section39926938"></a>**

**cms node -list**命令用于查看集群所有节点的配置信息。

**命令格式<a name="zh-cn_topic_0000001835225781_section23798129"></a>**

**cms node -list**

**参数说明<a name="zh-cn_topic_0000001835225781_section12856577"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001835225781_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225781_section63268730"></a>**

查看集群所有节点的配置信息。

```
[cantian@a12e76db3893 gcc_backup]$ cms node -list
NODE_ID     NODE NAME            IP                PORT
0           node0                192.168.86.1      14587
1           node1                192.168.86.2      14587
```

**输出说明<a name="zh-cn_topic_0000001835225781_section1412117293556"></a>**

命令回显的部分字段含义如下。

|字符名称|字段含义|
|--|--|
|NODE_ID|节点ID。|
|NODE NAME|节点名称。|
|IP|节点IP地址。|
|PORT|端口。|


## cms node -connected<a name="ZH-CN_TOPIC_0000001788477744"></a>

**命令功能<a name="zh-cn_topic_0000001835225813_section1467151510217"></a>**

**cms node -connected**命令用于查询集群中所有存活的节点。

**命令格式<a name="zh-cn_topic_0000001835225813_section1367171512110"></a>**

**cms node -connected**

**参数说明<a name="zh-cn_topic_0000001835225813_section667120156215"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001835225813_section5671141514211"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225813_section8875169162517"></a>**

查询集群所有存活节点的信息。

```
[cantian@a12e76db3893 gcc_backup]$ cms node -connected
NODE_ID     NODE_NAME             IP                                      PORT        VOTING
      0     node0                 192.168.86.1                            14587       FALSE
      1     node1                 192.168.86.2                            14587       FALSE
```

**输出说明<a name="zh-cn_topic_0000001835225813_section621214555243"></a>**

命令回显的部分字段含义如下。

|字符名称|字段含义|
|--|--|
|NODE_ID|节点ID。|
|NODE NAME|节点名称。|
|IP|节点IP地址。|
|PORT|端口。|
|VOTING|节点是否正处于投票状态。|


## cms resgrp -list<a name="ZH-CN_TOPIC_0000001835236981"></a>

**命令功能<a name="zh-cn_topic_0000001835265705_section25971691516"></a>**

**cms resgrp -list**命令用于列出在gcc\_file中记录的资源组名称。

**命令格式<a name="zh-cn_topic_0000001835265705_section959116111520"></a>**

**cms resgrp -list**

**参数说明<a name="zh-cn_topic_0000001835265705_section135921681511"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001835265705_section85919162156"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835265705_section359141611153"></a>**

查看在gcc\_file中记录的资源组名称。

```
[cantian@a12e76db3893 gcc_backup]$ cms resgrp -list
RESOURCE_GROUP
default
```

**输出说明<a name="zh-cn_topic_0000001835265705_section1060616181519"></a>**

命令回显的部分字段含义如下。

|字符名称|字段含义|
|--|--|
|RESOURCE_GROUP|gcc中记录的资源组名称。|


## cms resgrp -add<a name="ZH-CN_TOPIC_0000001788637392"></a>

**命令功能<a name="zh-cn_topic_0000001788626200_section17993291240"></a>**

**cms resgrp -add**命令用于向集群中添加一个资源组。

**命令格式<a name="zh-cn_topic_0000001788626200_section179937912411"></a>**

**cms resgrp -add** _RESOURCE GROUP NAME_

**参数说明<a name="zh-cn_topic_0000001788626200_section109931494247"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|RESOURCE GROUP NAME|添加的资源组名称。|-|


**使用说明<a name="zh-cn_topic_0000001788626200_section189931698248"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788626200_section1599319172411"></a>**

向集群中添加一个资源组。

```
[cantian@a12e76db3893 gcc_backup]$ cms resgrp -add GRP_0001
add resource group succeed.
```

**输出说明<a name="zh-cn_topic_0000001788626200_section999318972411"></a>**

无。

## cms resgrp -del<a name="ZH-CN_TOPIC_0000001835276925"></a>

**命令功能<a name="zh-cn_topic_0000001788466568_section138339216334"></a>**

**cms resgrp -del**命令用于删除集群中的资源组。

**命令格式<a name="zh-cn_topic_0000001788466568_section1583311215331"></a>**

-   删除资源组名称

    **cms resgrp -del** _RESOURCE GROUP NAME_

-   删除资源组名称及对应的资源。

    **cms resgrp -del** **-r**_ RESOURCE GROUP NAME_

**参数说明<a name="zh-cn_topic_0000001788466568_section13833622336"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|RESOURCE GROUP NAME|资源组名称。|-|


**使用说明<a name="zh-cn_topic_0000001788466568_section78336283319"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788466568_section58335210334"></a>**

删除集群中的资源组。

```
[cantian@a12e76db3893 gcc_backup]$ cms resgrp -del GRP_0001
delete resource group succeed.
```

**输出说明<a name="zh-cn_topic_0000001788466568_section7833028335"></a>**

无。

## cms diskiostat<a name="ZH-CN_TOPIC_0000001788477748"></a>

**命令功能<a name="zh-cn_topic_0000001788466532_section206372054567"></a>**

**cms diskiostat**命令用于显示CMS运行日志落盘时间超过5s的条目总数的平均时延。

**命令格式<a name="zh-cn_topic_0000001788466532_section56371454665"></a>**

**cms diskiostat**

**参数说明<a name="zh-cn_topic_0000001788466532_section10227201911717"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001788466532_section195381311374"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788466532_section56691259101"></a>**

查看CMS运行日志落盘时间超过5s的条目总数的平均时延。

```
[cantian@a12e76db3893 gcc_backup]$ cms diskiostat
0
```

**输出说明<a name="zh-cn_topic_0000001788466532_section186696551011"></a>**

无。

## cms version<a name="ZH-CN_TOPIC_0000001835236985"></a>

**命令功能<a name="zh-cn_topic_0000001788466556_section12299163821117"></a>**

**cms version**命令用于获取当前环境的集群版本信息。

**命令格式<a name="zh-cn_topic_0000001788466556_section1929910380112"></a>**

**cms version**

**参数说明<a name="zh-cn_topic_0000001788466556_section18299153821114"></a>**

无。

**使用说明<a name="zh-cn_topic_0000001788466556_section13299153861115"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788466556_section1429933819112"></a>**

查看集群当前环境的版本信息。

```
[cantian@a12e76db3893 gcc_backup]$ cms version
mem version:3.0.0.
gcc version:3.0.0.
```

**输出说明<a name="zh-cn_topic_0000001788466556_section17299103851116"></a>**

命令回显的部分字段含义如下。

|字符名称|字段含义|
|--|--|
|mem version|内存中的集群版本信息。|
|gcc version|gcc文件中的集群版本信息。|


## cms upgrade<a name="ZH-CN_TOPIC_0000001788637396"></a>

**命令功能<a name="zh-cn_topic_0000001835225809_section1046317182200"></a>**

**cms upgrade**命令用于提升集群的版本信息。

**命令格式<a name="zh-cn_topic_0000001835225809_section446371819207"></a>**

**cms upgrade -version** _MAIN MAJOR REVISION_

**参数说明<a name="zh-cn_topic_0000001835225809_section84631018162013"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|MAIN|升级到的集群目标主版本号。|-|
|MAJOR|升级到的集群目标次版本号。|-|
|REVISION|升级到的集群目标特性版本号。|-|


**使用说明<a name="zh-cn_topic_0000001835225809_section7463131802016"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225809_section114638186209"></a>**

抬升集群的版本信息。

```
[cantian@a12e76db3893 gcc_backup]$ cms upgrade -version 3 3 3
cms upgrade succeed, main_ver=3, major_ver=3, revision=3, inner=2.
[cantian@a12e76db3893 gcc_backup]$ cms version
mem version:3.3.3.
gcc version:3.3.3.
```

**输出说明<a name="zh-cn_topic_0000001835225809_section84631118102020"></a>**

无。

## cms degrade<a name="ZH-CN_TOPIC_0000001835276929"></a>

**命令功能<a name="zh-cn_topic_0000001835225849_section1412710389346"></a>**

**cms degrade**命令用于强制回退集群版本信息。

**命令格式<a name="zh-cn_topic_0000001835225849_section412733817344"></a>**

**cms degrade -version** **-force** _MAIN MAJOR REVISION_

**参数说明<a name="zh-cn_topic_0000001835225849_section9640192117499"></a>**

|**参数**|**说明**|**取值**|
|--|--|--|
|MAIN|集群的主版本号。|-|
|MAJOR|集群的次版本号。|-|
|REVISION|集群的特性版本号。|-|


**使用说明<a name="zh-cn_topic_0000001835225849_section31271238103411"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225849_section181273389347"></a>**

强制回退集群版本信息。

```
[cantian@a12e76db3893 gcc_backup]$ cms degrade -version -force 3 0 0
cms degrade succeed, main_ver=3, major_ver=0, revision=0, inner=2.
```

**输出说明<a name="zh-cn_topic_0000001835225849_section1212783823418"></a>**

无。

# ctbackup<a name="ZH-CN_TOPIC_0000001788477752"></a>











## ctbackup --backup<a name="ZH-CN_TOPIC_0000001835236989"></a>

**命令功能<a name="zh-cn_topic_0000001788626176_section39926938"></a>**

**ctbackup --backup**命令用于对数据库和Cantian引擎相关数据执行全量备份。

**命令格式<a name="zh-cn_topic_0000001788626176_section23798129"></a>**

**ctbackup --backup --target-dir=**_?_ _ _\[**--datadir=**_?_  \] \[**--user=**_?_** **\] \[**--password=**_?_**_ _**\]_ _\[**--host=**_?_** **\] \[**--port=**_?_  \] \[**--defaults-file=**_?_  \] \[**--parallel=**_?_  \] \[**--compress**=_?_\] \[**--skip-badblock**\]

**参数说明<a name="zh-cn_topic_0000001788626176_section12856577"></a>**

|参数|说明|取值|
|--|--|--|
|target-dir|自定义备份数据的存放路径。**cantian**用户需对该路径有读写权限。|-|
|datadir|MySQL元数据路径。|-|
|user|登录MySQL数据库的用户。|-|
|password|登录MySQL数据库用户名的密码。|-|
|host|MySQL监听地址。|默认为XtraBackup中配置的MySQL监听地址。|
|port|MySQL监听端口。|默认为XtraBackup中配置的MySQL监听端口。|
|defaults-file|MySQL配置文件路径。|默认为XtraBackup中配置的MySQL配置文件路径。|
|parallel|备份并发线程数。|默认值：4取值范围1~16。|
|compress|备份数据时使用的压缩算法。|当前仅支持配置为lz4，如果未配置则表示不对备份数据进行压缩。|
|skip-badblock|备份时跳过数据坏块。|未设置时，遇到坏块备份任务将失败。|


**使用说明<a name="zh-cn_topic_0000001788626176_section1393162518177"></a>**

-   需要切换到cantian用户下执行。
-   执行前已正确安装备份恢复工具XtraBackup。
-   Cantian引擎已开启归档。

**使用示例<a name="zh-cn_topic_0000001788626176_section63268730"></a>**

执行全量备份。

```
$ ctbackup --backup --user=myuser --password=mypass --host=192.168.163.101 --port=3306  --target-dir=/home/lyz/backup/base1 --parallel=4
……
[ctbackup]cantian backup execute success and exit with: 0
[ctbackup]cantian data files backup success
[ctbackup]unlock instance success!
```

**输出说明<a name="zh-cn_topic_0000001788626176_section1412117293556"></a>**

无。

## ctbackup --backup --incremental<a name="ZH-CN_TOPIC_0000001788637404"></a>

**命令功能<a name="zh-cn_topic_0000001835265721_section39926938"></a>**

**ctbackup --backup --incremental**命令用于对数据库和Cantian引擎相关数据执行增量备份。

**命令格式<a name="zh-cn_topic_0000001835265721_section23798129"></a>**

**ctbackup --backup --incremental --target-dir=**_?_** **_ _\[**--datadir=**_?_\] \[**--user=**_?_\]** **\[**--password=**_?_\]**_ _**\[**--host=**_?_\]** **\[**--port=**_?_\] \[**--defaults-file=**_?_\] \[**--compress**=_?_\] \[**--skip-badblock**\] \[**--cumulative**\]

**参数说明<a name="zh-cn_topic_0000001835265721_section12856577"></a>**

|参数|说明|取值|
|--|--|--|
|incremental|执行增量备份。|-|
|target-dir|自定义备份数据的存放路径。**cantian**用户需对该路径有读写权限。|-|
|datadir|MySQL元数据路径。|-|
|user|登录MySQL数据库的用户。|-|
|password|登录MySQL数据库用户名的密码。|-|
|host|MySQL监听地址。|默认为XtraBackup中配置的MySQL监听地址。|
|port|MySQL监听端口。|默认为XtraBackup中配置的MySQL监听端口。|
|defaults-file|MySQL配置文件路径。|默认为XtraBackup中配置的MySQL配置文件路径。|
|parallel|备份并发线程数。|默认值：4取值范围1~16。|
|compress|备份数据时使用的压缩算法。|当前仅支持配置为lz4，如果未配置则表示不对备份数据进行压缩。|
|skip-badblock|备份时跳过数据坏块。|未设置时，遇到坏块备份任务将失败。|
|cumulative|执行累积增量备份。|未配置时，默认执行差异增量备份。|


**使用说明<a name="zh-cn_topic_0000001835265721_section1393162518177"></a>**

-   需要切换到cantian用户下执行。
-   增量备份在全量备份的基础上进行，需要创建新的增量备份集路径。
-   累积增量备份和差异增量备份不能混用。

**使用示例<a name="zh-cn_topic_0000001835265721_section63268730"></a>**

执行差异增量备份。

```
$ ctbackup --backup --incremental --user=myuser --password=mypass --host=192.168.163.101 --port=3306 --target-dir=/home/lyz/backup/inc1 --parallel=4
……
[ctbackup]cantian backup execute success and exit with: 0
[ctbackup]cantian data files backup success
[ctbackup]unlock instance success!
```

**输出说明<a name="zh-cn_topic_0000001835265721_section1412117293556"></a>**

无。

## ctbackup --prepare --restore --recover<a name="ZH-CN_TOPIC_0000001835276933"></a>

**命令功能<a name="zh-cn_topic_0000001835225713_section39926938"></a>**

**ctbackup --prepare --restore --recover**命令用于执行普通恢复。

**命令格式<a name="zh-cn_topic_0000001835225713_section23798129"></a>**

**ctbackup --prepare --restore --recover** **--target-dir=**_? _**\[--parallel=**_?_  \] \[**--repair-type=**_?_\] \[**--decompress**\]

**参数说明<a name="zh-cn_topic_0000001835225713_section12856577"></a>**

|参数|说明|取值|
|--|--|--|
|target-dir|备份集路径。|-|
|parallel|恢复并发线程数。|默认值：4取值范围1~16。|
|repair-type|坏块修复类型。|取值范围：return_error：遇到坏块时，恢复任务将失败。replace_checksum：计算并替换坏块的checksum，继续恢复任务。discard_badblock：跳过当前坏块，继续恢复任务。未配置时，默认值为return_error。|
|decompress|恢复时解压备份数据。|当备份命令中指定了compress参数，则需要配置decompress参数。|


**使用说明<a name="zh-cn_topic_0000001835225713_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225713_section63268730"></a>**

执行普通恢复。

```
$ ctbackup --prepare --restore --recover --target-dir=/home/lyz/backup/inc1 --parallel=4
……
[ctbackup]stop cantiand server finished!
```

**输出说明<a name="zh-cn_topic_0000001835225713_section1412117293556"></a>**

无。

## ctbackup --prepare --restore --recover --pitr-time<a name="ZH-CN_TOPIC_0000001788477756"></a>

**命令功能<a name="zh-cn_topic_0000001788626232_section39926938"></a>**

**ctbackup --prepare --restore --recover --pitr-time='**_xxx_**'**命令用于指定时间点恢复。

**命令格式<a name="zh-cn_topic_0000001788626232_section23798129"></a>**

**ctbackup --prepare --restore --recover --target-dir=**_? _\[**--parallel=**_?_  \] \[**--pitr-time='**_?_**' **\] \[**--repair\_type=**_?_\] \[**--decompress**\]

**参数说明<a name="zh-cn_topic_0000001788626232_section12856577"></a>**

|参数|说明|取值|
|--|--|--|
|target-dir|备份集路径。|-|
|parallel|恢复并发线程数。|默认值：4取值范围1~16。|
|pitr-time|指定恢复到的时间点。|参数格式：xxxx-xx-xx xx:xx:xx如：2022-11-07 11:46:00|
|repair-type|坏块修复类型。|取值范围：return_error：遇到坏块时，恢复任务将失败。replace_checksum：计算并替换坏块的checksum，继续恢复任务。discard_badblock：跳过当前坏块，继续恢复任务。未配置时，默认值为return_error。|
|decompress|恢复时解压备份数据。|当备份命令中指定了compress参数，则需要配置decompress参数。|


**使用说明<a name="zh-cn_topic_0000001788626232_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001788626232_section63268730"></a>**

执行PITR指定时间恢复。

```
$ ctbackup --prepare --restore --recover --target-dir=/home/lyz/backup/inc1 --parallel=4 --pitr-time='2023-08-31 20:18:00'
……
[ctbackup]stop cantiand server finished!
```

**输出说明<a name="zh-cn_topic_0000001788626232_section1412117293556"></a>**

无。

## ctbackup --prepare --restore --recover  --pitr-scn<a name="ZH-CN_TOPIC_0000001835236993"></a>

**命令功能<a name="zh-cn_topic_0000001835265681_section39926938"></a>**

**ctbackup --prepare --restore --recover --pitr-scn='**_xxx'_命令用于指定SCN恢复。

**命令格式<a name="zh-cn_topic_0000001835265681_section23798129"></a>**

**ctbackup --prepare --restore --recover --target-dir=**_? _\[**--parallel=**_?_  \] \[**--pitr-scn=**_'?'_** **\] \[**--repair\_type=**_?_\] \[**--decompress**\]

**参数说明<a name="zh-cn_topic_0000001835265681_section12856577"></a>**

|参数|说明|取值|
|--|--|--|
|target-dir|备份集路径。|-|
|parallel|恢复并发线程数。|默认值：4取值范围1~16。|
|pitr-scn|指定恢复到的SCN。|-|
|repair-type|坏块修复类型。|取值范围：return_error：遇到坏块时，恢复任务将失败。replace_checksum：计算并替换坏块的checksum，继续恢复任务。discard_badblock：跳过当前坏块，继续恢复任务。未配置时，默认值为return_error。|
|decompress|恢复时解压备份数据。|当备份命令中指定了compress参数，则需要配置decompress参数。|


**使用说明<a name="zh-cn_topic_0000001835265681_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835265681_section63268730"></a>**

执行PITR指定SCN恢复。

```
$ ctbackup --prepare --restore --recover --target-dir=/home/lyz/backup/inc1 --parallel=4 --pitr-scn='75619131392001'
……
[ctbackup]stop cantiand server finished!
```

**输出说明<a name="zh-cn_topic_0000001835265681_section1412117293556"></a>**

无。

## ctbackup --copy-back<a name="ZH-CN_TOPIC_0000001788637408"></a>

**命令功能<a name="zh-cn_topic_0000001835225777_section39926938"></a>**

**ctbackup --copy-back**命令用于执行恢复MySQL元数据。

**命令格式<a name="zh-cn_topic_0000001835225777_section23798129"></a>**

**ctbackup --copy-back --target-dir=**_?_  \[**--datadir=**_?_  \] \[**--parallel=**_?_  \]

**参数说明<a name="zh-cn_topic_0000001835225777_section12856577"></a>**

|参数|参数说明|取值|
|--|--|--|
|target-dir|备份集路径。|-|
|datadir|MySQL元数据路径|-|
|parallel|恢复并发线程数。|默认值：4取值范围1~16。|


**使用说明<a name="zh-cn_topic_0000001835225777_section1393162518177"></a>**

-   需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225777_section63268730"></a>**

恢复MySQL元数据。

```
$ ctbackup --copy-back --target-dir=/home/lyz/backup/inc1 --parallel=4
……
[ctbackup]mysql copyback execute success and exit with: 0
[ctbackup]xtrabackup execute copyback for mysql success!
```

恢复完成后需要修改Mysql元数据属组为deploy\_user，以ctdba为例：

```
chown ctdba:ctdba -hR /mnt/dbdata/remote/metadata_metadata_fs_101_103/node0
```

**输出说明<a name="zh-cn_topic_0000001835225777_section1412117293556"></a>**

无。

## ctbackup --reconciel-mysql<a name="ZH-CN_TOPIC_0000001835276937"></a>

**命令功能<a name="zh-cn_topic_0000001835265625_section39926938"></a>**

**ctbackup --reconciel-mysql**命令用于回放DDL**。**

**命令格式<a name="zh-cn_topic_0000001835265625_section23798129"></a>**

**ctbackup --reconciel-mysql **\[**--user=**_?_  \] \[_ _**--password=**_'?' _\] \[**--host=**_?_  \] \[**--port=**_?_  \]

**参数说明<a name="zh-cn_topic_0000001835265625_section12856577"></a>**

|参数|说明|取值|
|--|--|--|
|user|登录MySQL数据库的用户。|-|
|password|登录MySQL数据库用户名的密码。|-|
|host|MySQL监听地址。|默认为XtraBackup中配置的MySQL监听地址。|
|port|MySQL监听端口。|默认为XtraBackup中配置的MySQL监听端口。|


**使用说明<a name="zh-cn_topic_0000001835265625_section1393162518177"></a>**

-   需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835265625_section63268730"></a>**

回放DDL。

```
$ ctbackup --reconciel-mysql --user=myuser --password=mypass --host=8.40.163.101 --port=3306
[ctbackup]ready to execute reconciel_mysql for mysql!
[ctbackup]get path for mysql succeed!
mysql: [Warning] Using a password on the command line interface can be insecure.
[ctbackup]ctbackup execute reconciel_mysql for mysql success!
```

**输出说明<a name="zh-cn_topic_0000001835265625_section1412117293556"></a>**

无。

## ctbackup --query-incremental-mode<a name="ZH-CN_TOPIC_0000001788477760"></a>

**命令功能<a name="zh-cn_topic_0000001835225729_section39926938"></a>**

**ctbackup --query-incremental-mode**命令用于查询备份集的备份模式。

**命令格式<a name="zh-cn_topic_0000001835225729_section23798129"></a>**

**ctbackup --query-incremental-mode --target-dir=**_?_

**参数说明<a name="zh-cn_topic_0000001835225729_section12856577"></a>**

|字符名称|字段含义|
|--|--|
|**target-dir**|备份集路径。|


**使用说明<a name="zh-cn_topic_0000001835225729_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225729_section63268730"></a>**

查询备份集备份模式

```
$ ctbackup --query-incremental-mode --target-dir=/home/lyz/backup/inc1
[ctbackup]Incrementalmode：[difference].
[ctbackup]cantian query_incremental_mode success.
```

**输出说明<a name="zh-cn_topic_0000001835225729_section1412117293556"></a>**

-   Incrementalmode：difference，差异增量备份
-   Incrementalmode：cumulative，累积增量备份
-   full backup，全量备份

## ctbackup --purge-logs<a name="ZH-CN_TOPIC_0000001835236997"></a>

**命令功能<a name="zh-cn_topic_0000001788466508_section39926938"></a>**

**ctbackup --purge-logs**命令用于清理残留归档日志。

**命令格式<a name="zh-cn_topic_0000001788466508_section23798129"></a>**

**ctbackup --purge-logs**

**参数说明<a name="zh-cn_topic_0000001788466508_section12856577"></a>**

无

**使用说明<a name="zh-cn_topic_0000001788466508_section1393162518177"></a>**

-   需要切换到cantian用户下执行。
-   执行该命令后，使用历史备份集执行PITR恢复命令会导致恢复后的数据不完整。

**使用示例<a name="zh-cn_topic_0000001788466508_section63268730"></a>**

清理残留归档日志。

```
$ ctbackup --purge-logs
[ctbackup]ready to purge logs for cantian!
KmcCheckKmcCtx WSEC_SUCCESS
KmcCheckKmcCtx WSEC_SUCCESS
KmcCheckKmcCtx WSEC_SUCCESS

connected.


SQL> 
Succeed.
Warning:
[ARCH_REMOVE] there exists arch_log with dbid = 0.
remove 3 arch_log in /mnt/dbdata/remote/archive_archive_fs_101_103, lists:
arch_0_0_1_0_1fa0a9c.arc
arch_1_0_1_0_1fa0a9d.arc
arch_0_0_2_1fa0a9c_1fa0aa8.arc


[ctbackup]cantian purge logs execute success and exit with: 0
[ctbackup]cantian purge logs success
```

**输出说明<a name="zh-cn_topic_0000001788466508_section1412117293556"></a>**

执行该命令后将显示被清理的归档日志文件。

若回显中存在“there exists arch\_log with dbid = 0.”，说明存在dbid=0的归档日志，该归档日志需用户自行判断并手动清理。

## ctbackup --archivelog<a name="ZH-CN_TOPIC_0000001788637412"></a>

**命令功能<a name="zh-cn_topic_0000001835225733_section39926938"></a>**

**ctbackup --archivelog**命令用于强制归档。

**命令格式<a name="zh-cn_topic_0000001835225733_section23798129"></a>**

**ctbackup --archivelog**

**参数说明<a name="zh-cn_topic_0000001835225733_section12856577"></a>**

无

**使用说明<a name="zh-cn_topic_0000001835225733_section1393162518177"></a>**

需要切换到cantian用户下执行。

**使用示例<a name="zh-cn_topic_0000001835225733_section63268730"></a>**

强制归档。

```
$ ctbackup --archivelog
[ctbackup]ready to archive log for cantian!
KmcCheckKmcCtx WSEC_SUCCESS
KmcCheckKmcCtx WSEC_SUCCESS
KmcCheckKmcCtx WSEC_SUCCESS

connected.


SQL> 
Succeed.

[ctbackup]cantian archive log execute success and exit with: 0
[ctbackup]cantian archive log success
```

**输出说明<a name="zh-cn_topic_0000001835225733_section1412117293556"></a>**

无。

