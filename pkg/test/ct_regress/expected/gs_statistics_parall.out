

SQL> alter system set STATS_ENABLE_PARALL = TRUE;

Succeed.

SQL> drop table if exists test_statistics_1;

Succeed.

SQL> 
SQL> create table test_statistics_1 (a int);

Succeed.

SQL> 
SQL> insert into test_statistics_1 values(1);

1 rows affected.

SQL> insert into test_statistics_1 (a) select a + 1 from test_statistics_1;

1 rows affected.

SQL> insert into test_statistics_1 (a) select a + 2 from test_statistics_1;

2 rows affected.

SQL> insert into test_statistics_1 (a) select a + 4 from test_statistics_1;

4 rows affected.

SQL> insert into test_statistics_1 (a) select a + 8 from test_statistics_1;

8 rows affected.

SQL> insert into test_statistics_1 (a) select a + 16 from test_statistics_1;

16 rows affected.

SQL> insert into test_statistics_1 (a) select a + 32 from test_statistics_1;

32 rows affected.

SQL> insert into test_statistics_1 (a) select a + 64 from test_statistics_1;

64 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> analyze table test_statistics_1 compute statistics;

Succeed.

SQL> select NUM_DISTINCT, NUM_NULLS, HISTOGRAM from dba_tab_columns where TABLE_NAME = 'TEST_STATISTICS_1';

NUM_DISTINCT NUM_NULLS    HISTOGRAM                                                       
------------ ------------ ----------------------------------------------------------------
128          0            FREQUENCY                                                       

1 rows fetched.

SQL> 
SQL> insert into test_statistics_1 (a) select a + 128 from test_statistics_1;

128 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> analyze table test_statistics_1 compute statistics;

Succeed.

SQL> select NUM_DISTINCT, NUM_NULLS, HISTOGRAM from dba_tab_columns where TABLE_NAME = 'TEST_STATISTICS_1';

NUM_DISTINCT NUM_NULLS    HISTOGRAM                                                       
------------ ------------ ----------------------------------------------------------------
256          0            HEIGHT BALANCED                                                 

1 rows fetched.

SQL> 
SQL> create user hzy_analy identified by Cantian_234;

Succeed.

SQL> GRANT CREATE SESSION TO hzy_analy;

Succeed.

SQL> grant dba to hzy_analy;

Succeed.

SQL> grant create table to hzy_analy;

Succeed.

SQL> 
SQL> create table hzy_analy.t0(a int, b clob);

Succeed.

SQL> create table hzy_analy.t1(a int, b clob);

Succeed.

SQL> create table hzy_analy.t2(a int, b clob);

Succeed.

SQL> create table hzy_analy.t3(a int, b clob);

Succeed.

SQL> create table hzy_analy.t4(a int, b clob);

Succeed.

SQL> create table hzy_analy.t5(a int, b clob);

Succeed.

SQL> create table hzy_analy.t6(a int, b clob);

Succeed.

SQL> create table hzy_analy.t7(a int, b clob);

Succeed.

SQL> create table hzy_analy.t8(a int, b clob);

Succeed.

SQL> create table hzy_analy.t9(a int, b clob);

Succeed.

SQL> create table hzy_analy.t10(a int, b clob);

Succeed.

SQL> create table hzy_analy.t11(a int, b clob);

Succeed.

SQL> create table hzy_analy.t12(a int, b clob);

Succeed.

SQL> create table hzy_analy.t13(a int, b clob);

Succeed.

SQL> create table hzy_analy.t14(a int, b clob);

Succeed.

SQL> create table hzy_analy.t15(a int, b clob);

Succeed.

SQL> create table hzy_analy.t16(a int, b clob);

Succeed.

SQL> create table hzy_analy.t17(a int, b clob);

Succeed.

SQL> create table hzy_analy.t18(a int, b clob);

Succeed.

SQL> create table hzy_analy.t19(a int, b clob);

Succeed.

SQL> create table hzy_analy.t20(a int, b clob);

Succeed.

SQL> create table hzy_analy.t21(a int, b clob);

Succeed.

SQL> create table hzy_analy.t22(a int, b clob);

Succeed.

SQL> create table hzy_analy.t23(a int, b clob);

Succeed.

SQL> create table hzy_analy.t24(a int, b clob);

Succeed.

SQL> create table hzy_analy.t25(a int, b clob);

Succeed.

SQL> create table hzy_analy.t26(a int, b clob);

Succeed.

SQL> create table hzy_analy.t27(a int, b clob);

Succeed.

SQL> create table hzy_analy.t28(a int, b clob);

Succeed.

SQL> create table hzy_analy.t29(a int, b clob);

Succeed.

SQL> create table hzy_analy.t30(a int, b clob);

Succeed.

SQL> create table hzy_analy.t31(a int, b clob);

Succeed.

SQL> create table hzy_analy.t32(a int, b clob);

Succeed.

SQL> create table hzy_analy.t33(a int, b clob);

Succeed.

SQL> create table hzy_analy.t34(a int, b clob);

Succeed.

SQL> exec DBE_STATS.COLLECT_SCHEMA_STATS('hzy_analy');

PL/SQL procedure successfully completed.

SQL> 
SQL> insert into  hzy_analy.t0 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t1 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t2 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t3 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t4 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t4 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t5 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t6 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t7 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t8 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t9 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t10 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t11 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t12 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t13 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t14 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t15 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t16 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t17 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t18 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t19 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t20 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t21 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t22 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t23 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t24 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t25 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t26 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t27 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t28 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t29 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t30 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t31 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t32 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t33 values(1,'a');

1 rows affected.

SQL> insert into  hzy_analy.t34 values(1,'a');

1 rows affected.

SQL> exec DBE_STATS.COLLECT_SCHEMA_STATS('hzy_analy');

PL/SQL procedure successfully completed.

SQL> drop user hzy_analy cascade;

Succeed.

SQL> 
SQL> analyze table dba_tables compute statistics;

CT-00130, Operation analyze table is not supported on VIEW
SQL> 
SQL> drop table if exists temp_table1;

Succeed.

SQL> create global temporary table temp_table1(a int);

Succeed.

SQL> analyze table temp_table1 compute statistics;

Succeed.

SQL> analyze table SYS_TABLES compute statistics;

Succeed.

SQL> 
SQL> alter system set LOCAL_TEMPORARY_TABLE_ENABLED=TRUE;

Succeed.

SQL> create temporary table #analyze_temp_tab(a int);

Succeed.

SQL> analyze table #analyze_temp_tab compute statistics;

Succeed.

SQL> 
SQL> drop table if exists test_statistics_2;

Succeed.

SQL> create table test_statistics_2 (id int, name varchar(20));

Succeed.

SQL> create index idx_statistics_2 on test_statistics_2(id);

Succeed.

SQL> 
SQL> insert into test_statistics_2 values(0, 'it is a long string');

1 rows affected.

SQL> insert into test_statistics_2 select id + 1, name from test_statistics_2;

1 rows affected.

SQL> insert into test_statistics_2 select id + 2, name from test_statistics_2;

2 rows affected.

SQL> insert into test_statistics_2 select id + 4, name from test_statistics_2;

4 rows affected.

SQL> insert into test_statistics_2 select id + 8, name from test_statistics_2;

8 rows affected.

SQL> insert into test_statistics_2 select id + 16, name from test_statistics_2;

16 rows affected.

SQL> insert into test_statistics_2 select id + 32, name from test_statistics_2;

32 rows affected.

SQL> insert into test_statistics_2 select id + 64, name from test_statistics_2;

64 rows affected.

SQL> insert into test_statistics_2 select id + 128, name from test_statistics_2;

128 rows affected.

SQL> insert into test_statistics_2 select id + 256, name from test_statistics_2;

256 rows affected.

SQL> insert into test_statistics_2 select id + 512, name from test_statistics_2;

512 rows affected.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS','test_statistics_2', null, 80);

PL/SQL procedure successfully completed.

SQL> exec dbe_stats.collect_table_stats('SYS','test_statistics_2', null, 0.00001);

PL/SQL procedure successfully completed.

SQL> select count(*) from v$buffer_pool_statistics;

COUNT(*)            
--------------------
1                   

1 rows fetched.

SQL> alter system flush buffer;

Succeed.

SQL> select count(*) from v$buffer_pool_statistics;

COUNT(*)            
--------------------
1                   

1 rows fetched.

SQL> analyze index idx_statistics_2 on test_statistics_2 compute statistics;

Succeed.

SQL> select BLEVEL, LEVEL_BLOCKS, DISTINCT_KEYS, COMB_COLS_2_NDV, COMB_COLS_3_NDV, COMB_COLS_4_NDV from sys_indexes where name = upper('idx_statistics_2');

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- --------------- --------------- ---------------
2            3            1024          0               0               0              

1 rows fetched.

SQL> analyze index idx_statistics_2 on test_statistics_2 estimate statistics 80;

Succeed.

SQL> 
SQL> alter system set STATS_PARALL_THREADS = 4;

Succeed.

SQL> drop table if exists  LISTTABLE0020;

Succeed.

SQL> create table LISTTABLE0020(
  2 field1   integer,
  3 field2   bigint,
  4 field3   real,
  5 field4   decimal(10,2),
  6 field5   number(6),
  7 field6   char(10),
  8 field7   varchar(10),
  9 field8   varchar2(20),
 10 field9   CLOB,
 11 field10  BLOB,
 12 field11  BINARY(1024),
 13 field12 date,
 14 field13 timestamp,
 15 field14 INTERVAL DAY(3) TO SECOND(4),
 16 field15 timestamp with time zone,
 17 field16 timestamp,
 18 field17 boolean,
 19 field18  varbinary(1024),
 20 field19  raw(1027)
 21 )PARTITION BY LIST (field8)
 22 (PARTITION  PART_HZY1 VALUES ('guangdong'), 
 23  PARTITION  part_hzy2 VALUES ('shanghai'), 
 24  PARTITION  part_hzy3 VALUES ('nanjing') 
 25 );

Succeed.

SQL> 
SQL> declare
  2 i int:=0;
  3 begin
  4   loop
  5     i:=i+1;
  6 insert into LISTTABLE0020  values(256,10000000,123.3212,123456.123,123456,'abc','dgr',
  7 'guangdong',lpad('345abc',50,'abc'),lpad('345abc',50,'abc'),null,'2004-08-11 00:00:00',
  8 '2012-11-11 00:00:00',interval '2' day,'2016-12-11 00:00:00','2011-12-11 00:00:00','true',null,null);
  9 	exit when i= 100;
 10   end loop;
 11   dbe_output.print_line('111');
 12 end;
 13 /

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> declare
  2 i int:=0;
  3 begin
  4   loop
  5     i:=i+1;
  6 insert into LISTTABLE0020  values(256,10000000,123.3212,123456.123,123456,'abc','dgr',
  7 'shanghai',lpad('345abc',50,'abc'),lpad('345abc',50,'abc'),null,'2004-08-11 00:00:00',
  8 '2012-11-11 00:00:00',interval '2' day,'2016-12-11 00:00:00','2011-12-11 00:00:00','true',null,null);
  9 	exit when i= 100;
 10   end loop;
 11   dbe_output.print_line('111');
 12 end;
 13 /

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> declare
  2 i int:=0;
  3 begin
  4   loop
  5     i:=i+1;
  6 insert into LISTTABLE0020  values(256,10000000,123.3212,123456.123,123456,'abc','dgr',
  7 'nanjing',lpad('345abc',50,'abc'),lpad('345abc',50,'abc'),null,'2004-08-11 00:00:00',
  8 '2012-11-11 00:00:00',interval '2' day,'2016-12-11 00:00:00','2011-12-11 00:00:00','true',null,null);
  9 	exit when i= 100;
 10   end loop;
 11   dbe_output.print_line('111');
 12 end;
 13 /

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'LISTTABLE0020', 'PART_HZY1');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_HZY1' order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_HZY1                                                        100          4            0            236          100         

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'LISTTABLE0020') 
  2 and SPARE1 = 10 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            100          0            256                                                              256                                                              1            1                   
1            100          0            10000000                                                         10000000                                                         1            1                   
1            100          0            123.3212                                                         123.3212                                                         1            1                   
1            100          0            123456.12                                                        123456.12                                                        1            1                   
1            100          0            123456                                                           123456                                                           1            1                   
1            100          0            abc                                                              abc                                                              1            1                   
1            100          0            dgr                                                              dgr                                                              1            1                   
1            100          0            guangdong                                                        guangdong                                                        1            1                   
0            100          100                                                                                                                                            0            0                   
1            100          0            2004-08-11 00:00:00                                              2004-08-11 00:00:00                                              1            1                   
1            100          0            2012-11-11 00:00:00                                              2012-11-11 00:00:00                                              1            1                   
1            100          0            +02 00:00:00.000000                                              +02 00:00:00.000000                                              1            1                   
1            100          0            2016-12-11 00:00:00.000000                                       2016-12-11 00:00:00.000000                                       1            1                   
1            100          0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            100          0            TRUE                                                             TRUE                                                             1            1                   
0            100          100                                                                                                                                            0            0                   
0            100          100                                                                                                                                            0            0                   

17 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'LISTTABLE0020') and part# = 10 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
+02 00:00:00.000000                                              100         
10000000                                                         100         
123.3212                                                         100         
123456                                                           100         
123456.12                                                        100         
2004-08-11 00:00:00                                              100         
2011-12-11 00:00:00                                              100         
2012-11-11 00:00:00                                              100         
2016-12-11 00:00:00.000000                                       100         
256                                                              100         
TRUE                                                             100         
abc                                                              100         
dgr                                                              100         
guangdong                                                        100         

14 rows fetched.

SQL> 
SQL> exec DBE_STATS.DELETE_TABLE_STATS('SYS', 'LISTTABLE0020', 'PART_HZY1');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_HZY1';

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_HZY1                                                                                                                        

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'LISTTABLE0020') 
  2 and SPARE1 = 10 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'LISTTABLE0020') and part# = 10 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> exec DBE_STATS.DELETE_TABLE_STATS('SYS', 'LISTTABLE0020');

PL/SQL procedure successfully completed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'LISTTABLE0020');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_HZY1' order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_HZY1                                                        100          4            0            236          100         

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'LISTTABLE0020') 
  2 and SPARE1 = 10 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            100          0            256                                                              256                                                              1            1                   
1            100          0            10000000                                                         10000000                                                         1            1                   
1            100          0            123.3212                                                         123.3212                                                         1            1                   
1            100          0            123456.12                                                        123456.12                                                        1            1                   
1            100          0            123456                                                           123456                                                           1            1                   
1            100          0            abc                                                              abc                                                              1            1                   
1            100          0            dgr                                                              dgr                                                              1            1                   
1            100          0            guangdong                                                        guangdong                                                        1            1                   
0            100          100                                                                                                                                            0            0                   
1            100          0            2004-08-11 00:00:00                                              2004-08-11 00:00:00                                              1            1                   
1            100          0            2012-11-11 00:00:00                                              2012-11-11 00:00:00                                              1            1                   
1            100          0            +02 00:00:00.000000                                              +02 00:00:00.000000                                              1            1                   
1            100          0            2016-12-11 00:00:00.000000                                       2016-12-11 00:00:00.000000                                       1            1                   
1            100          0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            100          0            TRUE                                                             TRUE                                                             1            1                   
0            100          100                                                                                                                                            0            0                   
0            100          100                                                                                                                                            0            0                   

17 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'LISTTABLE0020') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            100          0            256                                                              256                                                              1            1                   
1            100          0            10000000                                                         10000000                                                         1            1                   
1            100          0            123.3212                                                         123.3212                                                         1            1                   
1            100          0            123456.12                                                        123456.12                                                        1            1                   
1            100          0            123456                                                           123456                                                           1            1                   
1            100          0            abc                                                              abc                                                              1            1                   
1            100          0            dgr                                                              dgr                                                              1            1                   
1            100          0            shanghai                                                         shanghai                                                         1            1                   
0            100          100                                                                                                                                            0            0                   
1            100          0            2004-08-11 00:00:00                                              2004-08-11 00:00:00                                              1            1                   
1            100          0            2012-11-11 00:00:00                                              2012-11-11 00:00:00                                              1            1                   
1            100          0            +02 00:00:00.000000                                              +02 00:00:00.000000                                              1            1                   
1            100          0            2016-12-11 00:00:00.000000                                       2016-12-11 00:00:00.000000                                       1            1                   
1            100          0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            100          0            TRUE                                                             TRUE                                                             1            1                   
0            100          100                                                                                                                                            0            0                   
0            100          100                                                                                                                                            0            0                   

17 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'LISTTABLE0020') 
  2 and SPARE1 = 30 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            100          0            256                                                              256                                                              1            1                   
1            100          0            10000000                                                         10000000                                                         1            1                   
1            100          0            123.3212                                                         123.3212                                                         1            1                   
1            100          0            123456.12                                                        123456.12                                                        1            1                   
1            100          0            123456                                                           123456                                                           1            1                   
1            100          0            abc                                                              abc                                                              1            1                   
1            100          0            dgr                                                              dgr                                                              1            1                   
1            100          0            nanjing                                                          nanjing                                                          1            1                   
0            100          100                                                                                                                                            0            0                   
1            100          0            2004-08-11 00:00:00                                              2004-08-11 00:00:00                                              1            1                   
1            100          0            2012-11-11 00:00:00                                              2012-11-11 00:00:00                                              1            1                   
1            100          0            +02 00:00:00.000000                                              +02 00:00:00.000000                                              1            1                   
1            100          0            2016-12-11 00:00:00.000000                                       2016-12-11 00:00:00.000000                                       1            1                   
1            100          0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            100          0            TRUE                                                             TRUE                                                             1            1                   
0            100          100                                                                                                                                            0            0                   
0            100          100                                                                                                                                            0            0                   

17 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'LISTTABLE0020') and part# = 10 and col# = 1 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
10000000                                                         100         

1 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'LISTTABLE0020') and part# = 10 and col# = 2 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
123.3212                                                         100         

1 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'LISTTABLE0020') and part# = 10 and col# = 3 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
123456.12                                                        100         

1 rows fetched.

SQL> exec DBE_STATS.DELETE_TABLE_STATS('SYS', 'LISTTABLE0020');

PL/SQL procedure successfully completed.

SQL> 
SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_HZY1' order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_HZY1                                                                                                                        

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'LISTTABLE0020') 
  2 and SPARE1 = 10 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'LISTTABLE0020') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'LISTTABLE0020') 
  2 and SPARE1 = 30 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> 
SQL> drop table if exists stats_interval1;

Succeed.

SQL> create table stats_interval1(f1 int, f2 int, f3 char(30))
  2 PARTITION BY RANGE(f2)
  3 INTERVAL(5)
  4 (
  5  PARTITION stats_interval1p1 values less than(10),
  6  PARTITION stats_interval1p2 values less than(20),
  7  PARTITION stats_interval1p3 values less than(30)
  8 );

Succeed.

SQL> insert into stats_interval1 values(1,5,'hzy');

1 rows affected.

SQL> insert into stats_interval1 values(2,15,'hzy1');

1 rows affected.

SQL> insert into stats_interval1 values(3,25,'hzy2');

1 rows affected.

SQL> insert into stats_interval1 values(4,35,'hzy3');

1 rows affected.

SQL> insert into stats_interval1 values(5,115,'hzy66');

1 rows affected.

SQL> insert into stats_interval1 values(6,55,'6hzy');

1 rows affected.

SQL> insert into stats_interval1 values(7,65,'hezy');

1 rows affected.

SQL> insert into stats_interval1 values(8,75,'hzfdy');

1 rows affected.

SQL> insert into stats_interval1 values(9,85,'hzyf');

1 rows affected.

SQL> insert into stats_interval1 values(10,95,'hzyd');

1 rows affected.

SQL> insert into stats_interval1 values(11,105,'hzy');

1 rows affected.

SQL> insert into stats_interval1 select * from stats_interval1;

11 rows affected.

SQL> insert into stats_interval1 select * from stats_interval1;

22 rows affected.

SQL> commit;

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'stats_interval1', 'STATS_INTERVAL1P2');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'STATS_INTERVAL1P2' order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
STATS_INTERVAL1P2                                                4            1            0            48           4           

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            4            0            2                                                                2                                                                1            1                   
1            4            0            15                                                               15                                                               1            1                   
1            4            0            hzy1                                                             hzy1                                                             1            1                   

3 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') and part# = 20 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
15                                                               4           
2                                                                4           
hzy1                                                             4           

3 rows fetched.

SQL> 
SQL> exec DBE_STATS.DELETE_TABLE_STATS('SYS', 'stats_interval1', 'STATS_INTERVAL1P2');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'STATS_INTERVAL1P2';

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
STATS_INTERVAL1P2                                                                                                                

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') and part# = 20 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> exec DBE_STATS.DELETE_TABLE_STATS('SYS', 'stats_interval1');

PL/SQL procedure successfully completed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'stats_interval1');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'STATS_INTERVAL1P2' order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
STATS_INTERVAL1P2                                                4            1            0            48           4           

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            4            0            2                                                                2                                                                1            1                   
1            4            0            15                                                               15                                                               1            1                   
1            4            0            hzy1                                                             hzy1                                                             1            1                   

3 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            4            0            2                                                                2                                                                1            1                   
1            4            0            15                                                               15                                                               1            1                   
1            4            0            hzy1                                                             hzy1                                                             1            1                   

3 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 30 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            4            0            3                                                                3                                                                1            1                   
1            4            0            25                                                               25                                                               1            1                   
1            4            0            hzy2                                                             hzy2                                                             1            1                   

3 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') and part# = 20 and col# = 0 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
2                                                                4           

1 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') and part# = 20 and col# = 1 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
15                                                               4           

1 rows fetched.

SQL> exec DBE_STATS.DELETE_TABLE_STATS('SYS', 'stats_interval1');

PL/SQL procedure successfully completed.

SQL> 
SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'STATS_INTERVAL1P2' order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
STATS_INTERVAL1P2                                                                                                                

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 30 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> 
SQL> insert into stats_interval1 values(12,45,'hzy');

1 rows affected.

SQL> insert into stats_interval1 values(13,85,'hzyf');

1 rows affected.

SQL> insert into stats_interval1 values(14,95,'hzyd');

1 rows affected.

SQL> insert into stats_interval1 values(15,1105,'hzy');

1 rows affected.

SQL> insert into stats_interval1 values(16,445,'hzy');

1 rows affected.

SQL> insert into stats_interval1 values(17,215,'hzyf');

1 rows affected.

SQL> insert into stats_interval1 values(18,95,'hzyd');

1 rows affected.

SQL> insert into stats_interval1 values(19,105,'hzy');

1 rows affected.

SQL> insert into stats_interval1 values(20,45,'hzy');

1 rows affected.

SQL> insert into stats_interval1 select * from stats_interval1;

53 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'STATS_INTERVAL1', 'STATS_INTERVAL1P2');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'STATS_INTERVAL1P2' order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
STATS_INTERVAL1P2                                                8            1            0            48           8           

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            8            0            2                                                                2                                                                1            1                   
1            8            0            15                                                               15                                                               1            1                   
1            8            0            hzy1                                                             hzy1                                                             1            1                   

3 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') and part# = 20 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
15                                                               8           
2                                                                8           
hzy1                                                             8           

3 rows fetched.

SQL> 
SQL> exec DBE_STATS.DELETE_TABLE_STATS('SYS', 'STATS_INTERVAL1', 'STATS_INTERVAL1P2');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'STATS_INTERVAL1P2';

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
STATS_INTERVAL1P2                                                                                                                

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') and part# = 20 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> exec DBE_STATS.DELETE_TABLE_STATS('SYS', 'STATS_INTERVAL1');

PL/SQL procedure successfully completed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'STATS_INTERVAL1');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'STATS_INTERVAL1P2' order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
STATS_INTERVAL1P2                                                8            1            0            48           8           

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            8            0            2                                                                2                                                                1            1                   
1            8            0            15                                                               15                                                               1            1                   
1            8            0            hzy1                                                             hzy1                                                             1            1                   

3 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            8            0            2                                                                2                                                                1            1                   
1            8            0            15                                                               15                                                               1            1                   
1            8            0            hzy1                                                             hzy1                                                             1            1                   

3 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 30 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            8            0            3                                                                3                                                                1            1                   
1            8            0            25                                                               25                                                               1            1                   
1            8            0            hzy2                                                             hzy2                                                             1            1                   

3 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') and part# = 20 and col# = 0 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
2                                                                8           

1 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') and part# = 20 and col# = 1 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
15                                                               8           

1 rows fetched.

SQL> exec DBE_STATS.DELETE_TABLE_STATS('SYS', 'STATS_INTERVAL1');

PL/SQL procedure successfully completed.

SQL> 
SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'STATS_INTERVAL1P2' order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
STATS_INTERVAL1P2                                                                                                                

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 20 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL1') 
  2 and SPARE1 = 30 order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> drop table if exists STATS_INTERVAL1;

Succeed.

SQL> 
SQL> drop user if exists hzy_pstats cascade;

Succeed.

SQL> create user hzy_pstats identified by Cantian_234;

Succeed.

SQL> 
SQL> create table hzy_pstats.STATS_INTERVAL2(
  2 c_id int,
  3 c_d_id int NOT NULL,
  4 c_w_id int NOT NULL,
  5 c_first varchar(50) NOT NULL,
  6 c_middle char(2),
  7 c_last varchar(16) NOT NULL,
  8 c_street_1 varchar(20) NOT NULL,
  9 c_street_2 varchar(20),
 10 c_city varchar(20) NOT NULL,
 11 c_state char(2) NOT NULL,
 12 c_zip char(9) NOT NULL,
 13 c_phone char(16) NOT NULL,
 14 c_since timestamp,
 15 c_credit char(2) NOT NULL,
 16 c_credit_lim numeric(12,2),
 17 c_discount numeric(4,4),
 18 c_balance numeric(12,2),
 19 c_ytd_payment real NOT NULL,
 20 c_payment_cnt number NOT NULL,
 21 c_delivery_cnt bool NOT NULL,
 22 c_end date NOT NULL,
 23 c_data varchar(1000),
 24 c_clob clob,
 25 c_text blob) 
 26 partition by range(c_id) 
 27 (
 28    partition PART_H1 values less than (10),
 29    partition PART_H2 values less than (20),
 30    partition PART_H3 values less than (30),
 31    partition PART_H4 values less than (40),
 32    partition PART_5 values less than (50),
 33    partition PART_6 values less than (60),
 34    partition PART_7 values less than (70),
 35    partition PART_8 values less than (80),
 36    partition PART_9 values less than (90),
 37    partition PART_H10 values less than (maxvalue)
 38 );

Succeed.

SQL> 
SQL> CREATE INDEX hzy_pstats.hzy_pstats_dml_range_indx_087 ON hzy_pstats.STATS_INTERVAL2(c_d_id,c_last) local;

Succeed.

SQL> CREATE INDEX hzy_pstats.hzy_pstats_dml_range_indx_088 ON hzy_pstats.STATS_INTERVAL2(c_w_id);

Succeed.

SQL> CREATE INDEX hzy_pstats.hzy_pstats_dml_range_indx_089 ON hzy_pstats.STATS_INTERVAL2(c_d_id, c_w_id, c_last);

Succeed.

SQL> 
SQL> CREATE or replace procedure hzy_pstats.lob_hzy_proc_1115(startnum int,endall int) is
  2 i INT :=1;
  3 j varchar(10);
  4 BEGIN
  5   FOR i IN startnum..endall LOOP
  6     select cast(i as varchar(10)) into j from dual;
  7     insert into  hzy_pstats.STATS_INTERVAL2 select i,i,i,'is'||j||'cmRDs'||j,'OE','BAR'||j||'Bar'||j,'bkili'||j||'fcrRGF'||j,'pmbwo'||j||'vhSDGj'||j,'dyf'||j||'rDa'||j,'uq',4801||j,940||j||215||j,'2011-12-11 00:00:00','GC',50000.0,0.4361328,-10.0,10.0,1,true,'2011-12-11 00:00:00','dasd'||j,'dasdsd'||j,'\x1234354587643123455213445656723123424554566776763221132454566768767433242323445453565654542323';
  8   END LOOP;
  9 END;
 10 /

Succeed.

SQL> call hzy_pstats.lob_hzy_proc_1115(1,20);

PL/SQL procedure successfully completed.

SQL> call hzy_pstats.lob_hzy_proc_1115(1,15);

PL/SQL procedure successfully completed.

SQL> call hzy_pstats.lob_hzy_proc_1115(10,30);

PL/SQL procedure successfully completed.

SQL> call hzy_pstats.lob_hzy_proc_1115(25,45);

PL/SQL procedure successfully completed.

SQL> call hzy_pstats.lob_hzy_proc_1115(50,100);

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('hzy_pstats', 'STATS_INTERVAL2', 'PART_H1');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_H1' AND USER# = ( SELECT ID FROM SYS_USERS WHERE NAME = 'HZY_PSTATS') order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_H1                                                          18           1            0            276          18          

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 and SPARE1 = 10 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            is1cmRDs1                                                        is9cmRDs9                                                        9            0.111111111111111   
1            18           0            OE                                                               OE                                                               1            1                   
9            18           0            BAR1Bar1                                                         BAR9Bar9                                                         9            0.111111111111111   
9            18           0            bkili1fcrRGF1                                                    bkili9fcrRGF9                                                    9            0.111111111111111   
9            18           0            pmbwo1vhSDGj1                                                    pmbwo9vhSDGj9                                                    9            0.111111111111111   
9            18           0            dyf1rDa1                                                         dyf9rDa9                                                         9            0.111111111111111   
1            18           0            uq                                                               uq                                                               1            1                   
9            18           0            48011                                                            48019                                                            9            0.111111111111111   
9            18           0            94012151                                                         94092159                                                         9            0.111111111111111   
1            18           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            18           0            GC                                                               GC                                                               1            1                   
1            18           0            50000                                                            50000                                                            1            1                   
1            18           0            .4361                                                            .4361                                                            1            1                   
1            18           0            -10                                                              -10                                                              1            1                   
1            18           0            10                                                               10                                                               1            1                   
1            18           0            1                                                                1                                                                1            1                   
1            18           0            TRUE                                                             TRUE                                                             1            1                   
1            18           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
9            18           0            dasd1                                                            dasd9                                                            9            0.111111111111111   

22 rows fetched.

SQL> 
SQL> exec DBE_STATS.DELETE_TABLE_STATS('hzy_pstats', 'STATS_INTERVAL2', 'PART_H1');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_H1' AND USER# = ( SELECT ID FROM SYS_USERS WHERE NAME = 'HZY_PSTATS');

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_H1                                                                                                                          

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 and SPARE1 = 10 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') and part# = 10 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> exec DBE_STATS.DELETE_TABLE_STATS('hzy_pstats', 'STATS_INTERVAL2');

PL/SQL procedure successfully completed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('hzy_pstats', 'STATS_INTERVAL2');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_H1' AND USER# = ( SELECT ID FROM SYS_USERS WHERE NAME = 'HZY_PSTATS') order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_H1                                                          18           1            0            276          18          

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 and SPARE1 = 10 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            is1cmRDs1                                                        is9cmRDs9                                                        9            0.111111111111111   
1            18           0            OE                                                               OE                                                               1            1                   
9            18           0            BAR1Bar1                                                         BAR9Bar9                                                         9            0.111111111111111   
9            18           0            bkili1fcrRGF1                                                    bkili9fcrRGF9                                                    9            0.111111111111111   
9            18           0            pmbwo1vhSDGj1                                                    pmbwo9vhSDGj9                                                    9            0.111111111111111   
9            18           0            dyf1rDa1                                                         dyf9rDa9                                                         9            0.111111111111111   
1            18           0            uq                                                               uq                                                               1            1                   
9            18           0            48011                                                            48019                                                            9            0.111111111111111   
9            18           0            94012151                                                         94092159                                                         9            0.111111111111111   
1            18           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            18           0            GC                                                               GC                                                               1            1                   
1            18           0            50000                                                            50000                                                            1            1                   
1            18           0            .4361                                                            .4361                                                            1            1                   
1            18           0            -10                                                              -10                                                              1            1                   
1            18           0            10                                                               10                                                               1            1                   
1            18           0            1                                                                1                                                                1            1                   
1            18           0            TRUE                                                             TRUE                                                             1            1                   
1            18           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
9            18           0            dasd1                                                            dasd9                                                            9            0.111111111111111   

22 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 and SPARE1 = 20 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
10           26           0            10                                                               19                                                               10           0.1                 
10           26           0            10                                                               19                                                               10           0.1                 
10           26           0            10                                                               19                                                               10           0.1                 
10           26           0            is10cmRDs10                                                      is19cmRDs19                                                      10           0.1                 
1            26           0            OE                                                               OE                                                               1            1                   
10           26           0            BAR10Bar10                                                       BAR19Bar19                                                       10           0.1                 
10           26           0            bkili10fcrRGF10                                                  bkili19fcrRGF19                                                  10           0.1                 
10           26           0            pmbwo10vhSDGj10                                                  pmbwo19vhSDGj19                                                  10           0.1                 
10           26           0            dyf10rDa10                                                       dyf19rDa19                                                       10           0.1                 
1            26           0            uq                                                               uq                                                               1            1                   
10           26           0            480110                                                           480119                                                           10           0.1                 
10           26           0            9401021510                                                       9401921519                                                       10           0.1                 
1            26           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            26           0            GC                                                               GC                                                               1            1                   
1            26           0            50000                                                            50000                                                            1            1                   
1            26           0            .4361                                                            .4361                                                            1            1                   
1            26           0            -10                                                              -10                                                              1            1                   
1            26           0            10                                                               10                                                               1            1                   
1            26           0            1                                                                1                                                                1            1                   
1            26           0            TRUE                                                             TRUE                                                             1            1                   
1            26           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
10           26           0            dasd10                                                           dasd19                                                           10           0.1                 

22 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 and SPARE1 = 30 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
10           16           0            20                                                               29                                                               10           0.1                 
10           16           0            20                                                               29                                                               10           0.1                 
10           16           0            20                                                               29                                                               10           0.1                 
10           16           0            is20cmRDs20                                                      is29cmRDs29                                                      10           0.1                 
1            16           0            OE                                                               OE                                                               1            1                   
10           16           0            BAR20Bar20                                                       BAR29Bar29                                                       10           0.1                 
10           16           0            bkili20fcrRGF20                                                  bkili29fcrRGF29                                                  10           0.1                 
10           16           0            pmbwo20vhSDGj20                                                  pmbwo29vhSDGj29                                                  10           0.1                 
10           16           0            dyf20rDa20                                                       dyf29rDa29                                                       10           0.1                 
1            16           0            uq                                                               uq                                                               1            1                   
10           16           0            480120                                                           480129                                                           10           0.1                 
10           16           0            9402021520                                                       9402921529                                                       10           0.1                 
1            16           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            16           0            GC                                                               GC                                                               1            1                   
1            16           0            50000                                                            50000                                                            1            1                   
1            16           0            .4361                                                            .4361                                                            1            1                   
1            16           0            -10                                                              -10                                                              1            1                   
1            16           0            10                                                               10                                                               1            1                   
1            16           0            1                                                                1                                                                1            1                   
1            16           0            TRUE                                                             TRUE                                                             1            1                   
1            16           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
10           16           0            dasd20                                                           dasd29                                                           10           0.1                 

22 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') and part# = 20 and col# = 0 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
10                                                               3           
11                                                               6           
12                                                               9           
13                                                               12          
14                                                               15          
15                                                               18          
16                                                               20          
17                                                               22          
18                                                               24          
19                                                               26          

10 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') and part# = 20 and col# = 1 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
10                                                               3           
11                                                               6           
12                                                               9           
13                                                               12          
14                                                               15          
15                                                               18          
16                                                               20          
17                                                               22          
18                                                               24          
19                                                               26          

10 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') and part# = 20 and col# = 2 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
10                                                               3           
11                                                               6           
12                                                               9           
13                                                               12          
14                                                               15          
15                                                               18          
16                                                               20          
17                                                               22          
18                                                               24          
19                                                               26          

10 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') and part# = 20 and col# = 3 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
is10cmRDs10                                                      3           
is11cmRDs11                                                      6           
is12cmRDs12                                                      9           
is13cmRDs13                                                      12          
is14cmRDs14                                                      15          
is15cmRDs15                                                      18          
is16cmRDs16                                                      20          
is17cmRDs17                                                      22          
is18cmRDs18                                                      24          
is19cmRDs19                                                      26          

10 rows fetched.

SQL> exec DBE_STATS.DELETE_TABLE_STATS('hzy_pstats', 'STATS_INTERVAL2');

PL/SQL procedure successfully completed.

SQL> 
SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_H1' AND USER# = ( SELECT ID FROM SYS_USERS WHERE NAME = 'HZY_PSTATS') order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_H1                                                                                                                          

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 and SPARE1 = 10 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 and SPARE1 = 20 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 and SPARE1 = 30 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> 
SQL> 
SQL> exec dbe_stats.collect_table_stats('hzy_pstats', 'STATS_INTERVAL2');

PL/SQL procedure successfully completed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS') order by id;

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
0            0            0             0                       0                       0               0               0              
1            1            96            0.0104166666666667      0.0833333333333333      0               0               0              
1            1            96            0.0104166666666667      0.0833333333333333      96              96              0              

3 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS') and part# = 20 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
1            1            10           0.1                  0.8                  10              0               0              

1 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS') and part# = 30 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
1            1            10           0.1                  0.8                  10              0               0              

1 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS') and part# = 40 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
1            1            10           0.1                  0.8                  10              0               0              

1 rows fetched.

SQL> 
SQL> exec DBE_STATS.DELETE_TABLE_STATS('HZY_PSTATS', 'STATS_INTERVAL2');

PL/SQL procedure successfully completed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS') order by id;

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
                                                                                                                                       
                                                                                                                                       
                                                                                                                                       

3 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS') and part# = 20 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
                                                                                                                                

1 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS') and part# = 30 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
                                                                                                                                

1 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS') and part# = 40 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
                                                                                                                                

1 rows fetched.

SQL> 
SQL> analyze index hzy_pstats.hzy_pstats_dml_range_indx_087 ON hzy_pstats.STATS_INTERVAL2 compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL2')
  2 AND index# = (select id from sys_indexes where name = upper('hzy_pstats_dml_range_indx_087')) order by part#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
1            1            9            0.111111111111111    0.888888888888889    9               0               0              
1            1            10           0.1                  0.8                  10              0               0              
1            1            10           0.1                  0.8                  10              0               0              
1            1            10           0.1                  0.8                  10              0               0              
1            1            6            0.166666666666667    1.33333333333333     6               0               0              
1            1            10           0.1                  0.8                  10              0               0              
1            1            10           0.1                  0.8                  10              0               0              
1            1            10           0.1                  0.8                  10              0               0              
1            1            10           0.1                  0.8                  10              0               0              
1            1            11           0.0909090909090909   0.727272727272727    11              0               0              

10 rows fetched.

SQL> analyze index hzy_pstats.hzy_pstats_dml_range_indx_088 ON hzy_pstats.STATS_INTERVAL2 compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = upper('hzy_pstats_dml_range_indx_088');

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            96            0.0104166666666667      0.0833333333333333      0               0               0              

1 rows fetched.

SQL> analyze index hzy_pstats.hzy_pstats_dml_range_indx_089 ON hzy_pstats.STATS_INTERVAL2 compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = upper('hzy_pstats_dml_range_indx_089');

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            96            0.0104166666666667      0.0833333333333333      96              96              0              

1 rows fetched.

SQL> 
SQL> analyze index hzy_pstats.hzy_pstats_dml_range_indx_087 ON hzy_pstats.STATS_INTERVAL2 estimate statistics 60;

Succeed.

SQL> analyze index hzy_pstats.hzy_pstats_dml_range_indx_088 ON hzy_pstats.STATS_INTERVAL2 estimate statistics 70;

Succeed.

SQL> analyze index hzy_pstats.hzy_pstats_dml_range_indx_089 ON hzy_pstats.STATS_INTERVAL2 estimate statistics 80;

Succeed.

SQL> 
SQL> drop user if exists HZY_PSTATS cascade;

Succeed.

SQL> 
SQL> alter system set default_extents = 32;

Succeed.

SQL> drop table if exists STATS_SPC_HASH1;

Succeed.

SQL> drop tablespace spc_hzystats9 including contents and datafiles;

CT-00780, The tablespace SPC_HZYSTATS9 does not exist.
SQL> CREATE TABLESPACE spc_hzystats9 datafile 'hzy_stats_part9' size 32M;

Succeed.

SQL> drop table if exists STATS_SPC_HASH1;

Succeed.

SQL> 
SQL> create table STATS_SPC_HASH1 (
  2 c3 char(20) primary key,
  3 c4 number(8) not null
  4 )
  5 partition by hash(c3)
  6 (
  7 partition PART_0H1 tablespace spc_hzystats9,
  8 partition part_0h2 tablespace users,
  9 partition part_0h3 tablespace spc_hzystats9
 10 );

Succeed.

SQL> 
SQL> insert into STATS_SPC_HASH1 values('aaaa',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('bbbb',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('cccc',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('dddd',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('eeee',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('ffff',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('hhhh',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('iiii',111);

1 rows affected.

SQL> 
SQL> create index idx_hash_part_t2 on STATS_SPC_HASH1(c3,c4) local;

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'STATS_SPC_HASH1');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_0H1' order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_0H1                                                         2            1            0            36           2           

1 rows fetched.

SQL> exec dbe_stats.collect_table_stats('SYS', 'STATS_SPC_HASH1','PART_0H1');

PL/SQL procedure successfully completed.

SQL> analyze index idx_hash_part_t2 on STATS_SPC_HASH1 compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_SPC_HASH1')
  2 AND index# = (select id from sys_indexes where name = upper('idx_hash_part_t2')) order by part#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
1            1            2            0.5                  16                   2               0               0              
1            1            3            0.333333333333333    2.66666666666667     3               0               0              
1            1            3            0.333333333333333    10.6666666666667     3               0               0              

3 rows fetched.

SQL> analyze index idx_hash_part_t2 on STATS_SPC_HASH1 estimate statistics 20;

Succeed.

SQL> drop table if exists STATS_SPC_HASH1;

Succeed.

SQL> drop tablespace spc_hzystats9 including contents and datafiles;

Succeed.

SQL> alter system set default_extents = 8;

Succeed.

SQL> 
SQL> drop user if exists HZY_PSTATS1 cascade;

Succeed.

SQL> create user HZY_PSTATS1 identified by Cantian_234;

Succeed.

SQL> 
SQL> create table HZY_PSTATS1.STATS_INTERVAL_NEW_1(
  2 c_id int,
  3 c_d_id int NOT NULL,
  4 c_w_id int NOT NULL,
  5 c_first varchar(50) NOT NULL,
  6 c_middle char(2),
  7 c_last varchar(16) NOT NULL,
  8 c_street_1 varchar(20) NOT NULL,
  9 c_street_2 varchar(20),
 10 c_city varchar(20) NOT NULL,
 11 c_state char(2) NOT NULL,
 12 c_zip char(9) NOT NULL,
 13 c_phone char(16) NOT NULL,
 14 c_since timestamp,
 15 c_credit char(2) NOT NULL,
 16 c_credit_lim numeric(12,2),
 17 c_discount numeric(4,4),
 18 c_balance numeric(12,2),
 19 c_ytd_payment real NOT NULL,
 20 c_payment_cnt number NOT NULL,
 21 c_delivery_cnt bool NOT NULL,
 22 c_end date NOT NULL,
 23 c_data varchar(1000),
 24 c_clob clob,
 25 c_text blob) 
 26 partition by range(c_id)
 27 interval(20) 
 28 (
 29    partition PART_H1 values less than (10),
 30    partition PART_H2 values less than (20),
 31    partition PART_H3 values less than (30),
 32    partition PART_H4 values less than (40),
 33    partition PART_5 values less than (50),
 34    partition PART_6 values less than (60),
 35    partition PART_7 values less than (70),
 36    partition PART_8 values less than (80),
 37    partition PART_9 values less than (90)
 38 );

Succeed.

SQL> 
SQL> CREATE INDEX HZY_PSTATS1.HZY_PSTATS1_dml_range_indx_087 ON HZY_PSTATS1.STATS_INTERVAL_NEW_1(c_d_id,c_last) local;

Succeed.

SQL> CREATE INDEX HZY_PSTATS1.HZY_PSTATS1_dml_range_indx_088 ON HZY_PSTATS1.STATS_INTERVAL_NEW_1(c_w_id);

Succeed.

SQL> CREATE INDEX HZY_PSTATS1.HZY_PSTATS1_dml_range_indx_089 ON HZY_PSTATS1.STATS_INTERVAL_NEW_1(c_d_id, c_w_id, c_last);

Succeed.

SQL> 
SQL> CREATE or replace procedure HZY_PSTATS1.lob_hzy_proc_1115(startnum int,endall int) is
  2 i INT :=1;
  3 j varchar(10);
  4 BEGIN
  5   FOR i IN startnum..endall LOOP
  6     select cast(i as varchar(10)) into j from dual;
  7     insert into  HZY_PSTATS1.STATS_INTERVAL_NEW_1 select i,i,i,'is'||j||'cmRDs'||j,'OE','BAR'||j||'Bar'||j,'bkili'||j||'fcrRGF'||j,'pmbwo'||j||'vhSDGj'||j,'dyf'||j||'rDa'||j,'uq',4801||j,940||j||215||j,'2011-12-11 00:00:00','GC',50000.0,0.4361328,-10.0,10.0,1,true,'2011-12-11 00:00:00','dasd'||j,'dasdsd'||j,'\x1234354587643123455213445656723123424554566776763221132454566768767433242323445453565654542323';
  8   END LOOP;
  9 END;
 10 /

Succeed.

SQL> 
SQL> call HZY_PSTATS1.lob_hzy_proc_1115(1001,1120);

PL/SQL procedure successfully completed.

SQL> call HZY_PSTATS1.lob_hzy_proc_1115(1,20);

PL/SQL procedure successfully completed.

SQL> call HZY_PSTATS1.lob_hzy_proc_1115(1,15);

PL/SQL procedure successfully completed.

SQL> call HZY_PSTATS1.lob_hzy_proc_1115(10,30);

PL/SQL procedure successfully completed.

SQL> call HZY_PSTATS1.lob_hzy_proc_1115(25,45);

PL/SQL procedure successfully completed.

SQL> call HZY_PSTATS1.lob_hzy_proc_1115(50,100);

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1', 'STATS_INTERVAL_NEW_1', 'PART_H1');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_H1' AND USER# = ( SELECT ID FROM SYS_USERS WHERE NAME = 'HZY_PSTATS1') order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_H1                                                          18           1            0            276          18          

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 and SPARE1 = 10 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            is1cmRDs1                                                        is9cmRDs9                                                        9            0.111111111111111   
1            18           0            OE                                                               OE                                                               1            1                   
9            18           0            BAR1Bar1                                                         BAR9Bar9                                                         9            0.111111111111111   
9            18           0            bkili1fcrRGF1                                                    bkili9fcrRGF9                                                    9            0.111111111111111   
9            18           0            pmbwo1vhSDGj1                                                    pmbwo9vhSDGj9                                                    9            0.111111111111111   
9            18           0            dyf1rDa1                                                         dyf9rDa9                                                         9            0.111111111111111   
1            18           0            uq                                                               uq                                                               1            1                   
9            18           0            48011                                                            48019                                                            9            0.111111111111111   
9            18           0            94012151                                                         94092159                                                         9            0.111111111111111   
1            18           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            18           0            GC                                                               GC                                                               1            1                   
1            18           0            50000                                                            50000                                                            1            1                   
1            18           0            .4361                                                            .4361                                                            1            1                   
1            18           0            -10                                                              -10                                                              1            1                   
1            18           0            10                                                               10                                                               1            1                   
1            18           0            1                                                                1                                                                1            1                   
1            18           0            TRUE                                                             TRUE                                                             1            1                   
1            18           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
9            18           0            dasd1                                                            dasd9                                                            9            0.111111111111111   

22 rows fetched.

SQL> 
SQL> exec DBE_STATS.DELETE_TABLE_STATS('HZY_PSTATS1', 'STATS_INTERVAL_NEW_1', 'PART_H1');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_H1' AND USER# = ( SELECT ID FROM SYS_USERS WHERE NAME = 'HZY_PSTATS1');

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_H1                                                                                                                          

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 and SPARE1 = 10 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') and part# = 10 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> exec DBE_STATS.DELETE_TABLE_STATS('HZY_PSTATS1', 'STATS_INTERVAL_NEW_1');

PL/SQL procedure successfully completed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1', 'STATS_INTERVAL_NEW_1');

PL/SQL procedure successfully completed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_H1' AND USER# = ( SELECT ID FROM SYS_USERS WHERE NAME = 'HZY_PSTATS1') order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_H1                                                          18           1            0            276          18          

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 and SPARE1 = 10 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            1                                                                9                                                                9            0.111111111111111   
9            18           0            is1cmRDs1                                                        is9cmRDs9                                                        9            0.111111111111111   
1            18           0            OE                                                               OE                                                               1            1                   
9            18           0            BAR1Bar1                                                         BAR9Bar9                                                         9            0.111111111111111   
9            18           0            bkili1fcrRGF1                                                    bkili9fcrRGF9                                                    9            0.111111111111111   
9            18           0            pmbwo1vhSDGj1                                                    pmbwo9vhSDGj9                                                    9            0.111111111111111   
9            18           0            dyf1rDa1                                                         dyf9rDa9                                                         9            0.111111111111111   
1            18           0            uq                                                               uq                                                               1            1                   
9            18           0            48011                                                            48019                                                            9            0.111111111111111   
9            18           0            94012151                                                         94092159                                                         9            0.111111111111111   
1            18           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            18           0            GC                                                               GC                                                               1            1                   
1            18           0            50000                                                            50000                                                            1            1                   
1            18           0            .4361                                                            .4361                                                            1            1                   
1            18           0            -10                                                              -10                                                              1            1                   
1            18           0            10                                                               10                                                               1            1                   
1            18           0            1                                                                1                                                                1            1                   
1            18           0            TRUE                                                             TRUE                                                             1            1                   
1            18           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
9            18           0            dasd1                                                            dasd9                                                            9            0.111111111111111   

22 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 and SPARE1 = 20 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
10           26           0            10                                                               19                                                               10           0.1                 
10           26           0            10                                                               19                                                               10           0.1                 
10           26           0            10                                                               19                                                               10           0.1                 
10           26           0            is10cmRDs10                                                      is19cmRDs19                                                      10           0.1                 
1            26           0            OE                                                               OE                                                               1            1                   
10           26           0            BAR10Bar10                                                       BAR19Bar19                                                       10           0.1                 
10           26           0            bkili10fcrRGF10                                                  bkili19fcrRGF19                                                  10           0.1                 
10           26           0            pmbwo10vhSDGj10                                                  pmbwo19vhSDGj19                                                  10           0.1                 
10           26           0            dyf10rDa10                                                       dyf19rDa19                                                       10           0.1                 
1            26           0            uq                                                               uq                                                               1            1                   
10           26           0            480110                                                           480119                                                           10           0.1                 
10           26           0            9401021510                                                       9401921519                                                       10           0.1                 
1            26           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            26           0            GC                                                               GC                                                               1            1                   
1            26           0            50000                                                            50000                                                            1            1                   
1            26           0            .4361                                                            .4361                                                            1            1                   
1            26           0            -10                                                              -10                                                              1            1                   
1            26           0            10                                                               10                                                               1            1                   
1            26           0            1                                                                1                                                                1            1                   
1            26           0            TRUE                                                             TRUE                                                             1            1                   
1            26           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
10           26           0            dasd10                                                           dasd19                                                           10           0.1                 

22 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 and SPARE1 = 30 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
10           16           0            20                                                               29                                                               10           0.1                 
10           16           0            20                                                               29                                                               10           0.1                 
10           16           0            20                                                               29                                                               10           0.1                 
10           16           0            is20cmRDs20                                                      is29cmRDs29                                                      10           0.1                 
1            16           0            OE                                                               OE                                                               1            1                   
10           16           0            BAR20Bar20                                                       BAR29Bar29                                                       10           0.1                 
10           16           0            bkili20fcrRGF20                                                  bkili29fcrRGF29                                                  10           0.1                 
10           16           0            pmbwo20vhSDGj20                                                  pmbwo29vhSDGj29                                                  10           0.1                 
10           16           0            dyf20rDa20                                                       dyf29rDa29                                                       10           0.1                 
1            16           0            uq                                                               uq                                                               1            1                   
10           16           0            480120                                                           480129                                                           10           0.1                 
10           16           0            9402021520                                                       9402921529                                                       10           0.1                 
1            16           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
1            16           0            GC                                                               GC                                                               1            1                   
1            16           0            50000                                                            50000                                                            1            1                   
1            16           0            .4361                                                            .4361                                                            1            1                   
1            16           0            -10                                                              -10                                                              1            1                   
1            16           0            10                                                               10                                                               1            1                   
1            16           0            1                                                                1                                                                1            1                   
1            16           0            TRUE                                                             TRUE                                                             1            1                   
1            16           0            2011-12-11 00:00:00                                              2011-12-11 00:00:00                                              1            1                   
10           16           0            dasd20                                                           dasd29                                                           10           0.1                 

22 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') and part# = 20 and col# = 0 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
10                                                               3           
11                                                               6           
12                                                               9           
13                                                               12          
14                                                               15          
15                                                               18          
16                                                               20          
17                                                               22          
18                                                               24          
19                                                               26          

10 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') and part# = 20 and col# = 1 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
10                                                               3           
11                                                               6           
12                                                               9           
13                                                               12          
14                                                               15          
15                                                               18          
16                                                               20          
17                                                               22          
18                                                               24          
19                                                               26          

10 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') and part# = 20 and col# = 2 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
10                                                               3           
11                                                               6           
12                                                               9           
13                                                               12          
14                                                               15          
15                                                               18          
16                                                               20          
17                                                               22          
18                                                               24          
19                                                               26          

10 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') and part# = 20 and col# = 3 order by BUCKET;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
is10cmRDs10                                                      3           
is11cmRDs11                                                      6           
is12cmRDs12                                                      9           
is13cmRDs13                                                      12          
is14cmRDs14                                                      15          
is15cmRDs15                                                      18          
is16cmRDs16                                                      20          
is17cmRDs17                                                      22          
is18cmRDs18                                                      24          
is19cmRDs19                                                      26          

10 rows fetched.

SQL> exec DBE_STATS.DELETE_TABLE_STATS('HZY_PSTATS1', 'STATS_INTERVAL_NEW_1');

PL/SQL procedure successfully completed.

SQL> 
SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN,SAMPLESIZE from sys.SYS_TABLE_PARTS where name = 'PART_H1' AND USER# = ( SELECT ID FROM SYS_USERS WHERE NAME = 'HZY_PSTATS1') order by part#;

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN       SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------
PART_H1                                                                                                                          

1 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 and SPARE1 = 10 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 and SPARE1 = 20 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 and SPARE1 = 30 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') order by col#;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> 
SQL> 
SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1', 'STATS_INTERVAL_NEW_1');

PL/SQL procedure successfully completed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS1') order by id;

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
0            0            0             0                       0                       0               0               0              
1            1            216           0.00462962962962963     0.037037037037037       0               0               0              
2            2            216           0.00925925925925926     0.037037037037037       216             216             0              

3 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS1') and part# = 20 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
1            1            10           0.1                  0.8                  10              0               0              

1 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS1') and part# = 30 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
1            1            10           0.1                  0.8                  10              0               0              

1 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS1') and part# = 40 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
1            1            10           0.1                  0.8                  10              0               0              

1 rows fetched.

SQL> 
SQL> exec DBE_STATS.DELETE_TABLE_STATS('HZY_PSTATS1', 'STATS_INTERVAL_NEW_1');

PL/SQL procedure successfully completed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS1') order by id;

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
                                                                                                                                       
                                                                                                                                       
                                                                                                                                       

3 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS1') and part# = 20 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
                                                                                                                                

1 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS1') and part# = 30 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
                                                                                                                                

1 rows fetched.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW_1') 
  2 AND USER# = (select id from SYS_USERS where name = 'HZY_PSTATS1') and part# = 40 order by index#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- ---------------
                                                                                                                                

1 rows fetched.

SQL> 
SQL> create table HZY_PSTATS1.analyze_empty_table(a int, b int, c int, d int);

Succeed.

SQL> create index HZY_PSTATS1.analyze_empty_table_index on HZY_PSTATS1.analyze_empty_table(a, b ,c ,d);

Succeed.

SQL> insert into HZY_PSTATS1.analyze_empty_table values(1, 2, 3, 4);

1 rows affected.

SQL> 
SQL> declare
  2 i int:=0;
  3 begin
  4   loop
  5     i:=i+1;
  6     insert into HZY_PSTATS1.analyze_empty_table select a, b, c, d+1 from HZY_PSTATS1.analyze_empty_table;
  7 	exit when i= 15;
  8   end loop;
  9 end;
 10 /

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1','analyze_empty_table', null);

PL/SQL procedure successfully completed.

SQL> select DISTINCT_KEYS, COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV,blocks, SYS_INDEXES.NAME from SYS_INDEXES, SYS_TABLES where SYS_INDEXES.table# = SYS_TABLES.id and SYS_INDEXES.user# = SYS_TABLES.user# and SYS_INDEXES.name = 'ANALYZE_EMPTY_TABLE_INDEX';

DISTINCT_KEYS COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV BLOCKS       NAME                                                            
------------- --------------- --------------- --------------- ------------ ----------------------------------------------------------------
16            1               1               16              118          ANALYZE_EMPTY_TABLE_INDEX                                       

1 rows fetched.

SQL> 
SQL> delete from HZY_PSTATS1.analyze_empty_table;

32768 rows affected.

SQL> analyze table HZY_PSTATS1.analyze_empty_table compute statistics;

Succeed.

SQL> drop table HZY_PSTATS1.analyze_empty_table;

Succeed.

SQL> 
SQL> drop table if exists HZY_PSTATS1.dsz;

Succeed.

SQL> create table HZY_PSTATS1.dsz(a int,b char(10));

Succeed.

SQL> create index HZY_PSTATS1.dsa_idx on HZY_PSTATS1.dsz(b);

Succeed.

SQL> create index HZY_PSTATS1.dsa_idx1 on HZY_PSTATS1.dsz(a);

Succeed.

SQL> 
SQL> insert into HZY_PSTATS1.dsz values(2,5);

1 rows affected.

SQL> analyze table HZY_PSTATS1.dsz compute statistics;

Succeed.

SQL> select a.BLEVEL,a.LEVEL_BLOCKS,a.DISTINCT_KEYS,a.AVG_LEAF_BLOCKS_PER_KEY,a.AVG_DATA_BLOCKS_PER_KEY,a.EMPTY_LEAF_BLOCKS,a.CLUFAC,a.SAMPLESIZE from SYS_INDEXES a,SYS_TABLES b where A.TABLE#=b.ID AND A.USER# = b.USER# AND b.NAME='DSZ';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY EMPTY_LEAF_BLOCKS CLUFAC       SAMPLESIZE  
------------ ------------ ------------- ----------------------- ----------------------- ----------------- ------------ ------------
1            1            1             1                       8                       0                 1            1           
1            1            1             1                       8                       0                 1            1           

2 rows fetched.

SQL> 
SQL> drop user if exists HZY_PSTATS1 cascade;

Succeed.

SQL> 
SQL> drop table if exists hzy_test_comidx;

Succeed.

SQL> create table hzy_test_comidx(a int,b int,c int);

Succeed.

SQL> create index hzy_comidx1 on hzy_test_comidx(a);

Succeed.

SQL> create index hzy_comidx2 on hzy_test_comidx(a,b);

Succeed.

SQL> create index hzy_comidx3 on hzy_test_comidx(a,b,c);

Succeed.

SQL> insert into hzy_test_comidx values(1,2,3);

1 rows affected.

SQL> insert into hzy_test_comidx values(2,2,3);

1 rows affected.

SQL> insert into hzy_test_comidx values(3,2,3);

1 rows affected.

SQL> insert into hzy_test_comidx values(4,2,3);

1 rows affected.

SQL> insert into hzy_test_comidx values(6,2,3);

1 rows affected.

SQL> insert into hzy_test_comidx values(5,2,3);

1 rows affected.

SQL> insert into hzy_test_comidx values(7,2,3);

1 rows affected.

SQL> analyze table hzy_test_comidx compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV,samplesize from SYS_INDEXES where table# = (select id from SYS_TABLES where name = 'HZY_TEST_COMIDX') 
  2  order by id;

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV SAMPLESIZE  
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- --------------- ------------
1            1            7             0.142857142857143       1.14285714285714        0               0               0               7           
1            1            7             0.142857142857143       1.14285714285714        7               0               0               7           
1            1            7             0.142857142857143       1.14285714285714        7               7               0               7           

3 rows fetched.

SQL> analyze index hzy_comidx1 on hzy_test_comidx compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = 'HZY_COMIDX1';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            7             0.142857142857143       1.14285714285714        0               0               0              

1 rows fetched.

SQL> analyze index hzy_comidx2 on hzy_test_comidx compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = 'HZY_COMIDX2';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            7             0.142857142857143       1.14285714285714        7               0               0              

1 rows fetched.

SQL> analyze index hzy_comidx3 on hzy_test_comidx compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = 'HZY_COMIDX3';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            7             0.142857142857143       1.14285714285714        7               7               0              

1 rows fetched.

SQL> 
SQL> drop table if exists hzy_test_comidx;

Succeed.

SQL> create table hzy_test_comidx(a int,b int,c int);

Succeed.

SQL> create index hzy_comidx1 on hzy_test_comidx(a);

Succeed.

SQL> create index hzy_comidx2 on hzy_test_comidx(a,b);

Succeed.

SQL> create index hzy_comidx3 on hzy_test_comidx(a,b,c);

Succeed.

SQL> insert into hzy_test_comidx values(1,2,3);

1 rows affected.

SQL> insert into hzy_test_comidx values(2,3,4);

1 rows affected.

SQL> insert into hzy_test_comidx values(2,3,5);

1 rows affected.

SQL> insert into hzy_test_comidx values(2,3,6);

1 rows affected.

SQL> insert into hzy_test_comidx values(2,4,7);

1 rows affected.

SQL> insert into hzy_test_comidx values(5,5,8);

1 rows affected.

SQL> insert into hzy_test_comidx values(7,6,9);

1 rows affected.

SQL> analyze table hzy_test_comidx compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV,samplesize from SYS_INDEXES where table# = (select id from SYS_TABLES where name = 'HZY_TEST_COMIDX')
  2  order by id;

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV SAMPLESIZE  
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- --------------- ------------
1            1            4             0.25                    2                       0               0               0               7           
1            1            5             0.2                     1.6                     5               0               0               7           
1            1            7             0.142857142857143       1.14285714285714        5               7               0               7           

3 rows fetched.

SQL> 
SQL> 
SQL>  drop table if exists hzy_test_comidx;

Succeed.

SQL> create table hzy_test_comidx(a int,b int,c int, d int, e int);

Succeed.

SQL> create index hzy_comidx1 on hzy_test_comidx(a);

Succeed.

SQL> create index hzy_comidx2 on hzy_test_comidx(a,b);

Succeed.

SQL> create index hzy_comidx3 on hzy_test_comidx(a,b,c);

Succeed.

SQL> create index hzy_comidx4 on hzy_test_comidx(a,b,c,d);

Succeed.

SQL> create index hzy_comidx5 on hzy_test_comidx(a,b,c,d,e);

Succeed.

SQL> insert into hzy_test_comidx values(1,2,3,null,4);

1 rows affected.

SQL> insert into hzy_test_comidx values(2,3,4,4,7);

1 rows affected.

SQL> insert into hzy_test_comidx values(2,3,5,8,90);

1 rows affected.

SQL> insert into hzy_test_comidx values(2,3,6,4,4);

1 rows affected.

SQL> insert into hzy_test_comidx values(2,4,7,4,null);

1 rows affected.

SQL> insert into hzy_test_comidx values(2,4,7,4,null);

1 rows affected.

SQL> insert into hzy_test_comidx values(2,3,6,4,4);

1 rows affected.

SQL> analyze table hzy_test_comidx compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV,samplesize from SYS_INDEXES where table# = (select id from SYS_TABLES where name = 'HZY_TEST_COMIDX') 
  2  order by id;

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV SAMPLESIZE  
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- --------------- ------------
1            1            2             0.5                     4                       0               0               0               7           
1            1            3             0.333333333333333       2.66666666666667        3               0               0               7           
1            1            5             0.2                     1.6                     3               5               0               7           
1            1            5             0.2                     1.6                     3               5               5               7           
1            1            5             0.2                     1.6                     3               5               5               7           

5 rows fetched.

SQL> 
SQL> analyze index hzy_comidx1 on hzy_test_comidx compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = 'HZY_COMIDX1';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            2             0.5                     4                       0               0               0              

1 rows fetched.

SQL> analyze index hzy_comidx2 on hzy_test_comidx compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = 'HZY_COMIDX2';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            3             0.333333333333333       2.66666666666667        3               0               0              

1 rows fetched.

SQL> analyze index hzy_comidx3 on hzy_test_comidx compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = 'HZY_COMIDX3';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            5             0.2                     1.6                     3               5               0              

1 rows fetched.

SQL> analyze index hzy_comidx4 on hzy_test_comidx compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = 'HZY_COMIDX4';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            5             0.2                     1.6                     3               5               5              

1 rows fetched.

SQL> analyze index hzy_comidx5 on hzy_test_comidx compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = 'HZY_COMIDX5';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            5             0.2                     1.6                     3               5               5              

1 rows fetched.

SQL> 
SQL>  drop table if exists hzy_high_hist;

Succeed.

SQL> drop table if exists high_hist;

Succeed.

SQL> create table high_hist(a int);

Succeed.

SQL> insert into high_hist values(0);

1 rows affected.

SQL> create table hzy_high_hist(a int);

Succeed.

SQL> CREATE or replace procedure storage_proc_000(startnum int,endall int) is
  2 i INT :=1;
  3 j varchar(10);
  4 BEGIN
  5   FOR i IN startnum..endall LOOP
  6     insert into hzy_high_hist select a+i from high_hist;
  7   END LOOP;
  8 END;
  9 /

Succeed.

SQL> call storage_proc_000(1,1000);

PL/SQL procedure successfully completed.

SQL> call storage_proc_000(1,10);

PL/SQL procedure successfully completed.

SQL> call storage_proc_000(1,100);

PL/SQL procedure successfully completed.

SQL> call storage_proc_000(20,300);

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> analyze table hzy_high_hist compute statistics;

Succeed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
2                                                                1           
4                                                                2           
6                                                                3           
7                                                                4           
9                                                                5           
11                                                               6           
14                                                               7           
17                                                               8           
20                                                               9           
21                                                               10          
23                                                               11          
25                                                               12          
27                                                               13          
29                                                               14          
31                                                               15          
32                                                               16          
34                                                               17          
36                                                               18          
38                                                               19          
40                                                               20          
42                                                               21          
43                                                               22          
45                                                               23          
47                                                               24          
49                                                               25          
51                                                               26          
52                                                               27          
54                                                               28          
56                                                               29          
58                                                               30          
60                                                               31          
62                                                               32          
63                                                               33          
65                                                               34          
67                                                               35          
69                                                               36          
71                                                               37          
73                                                               38          
74                                                               39          
76                                                               40          
78                                                               41          
80                                                               42          
82                                                               43          
83                                                               44          
85                                                               45          
87                                                               46          
89                                                               47          
91                                                               48          
93                                                               49          
94                                                               50          
96                                                               51          
98                                                               52          
100                                                              53          
102                                                              54          
105                                                              55          
108                                                              56          
111                                                              57          
113                                                              58          
116                                                              59          
119                                                              60          
122                                                              61          
124                                                              62          
127                                                              63          
130                                                              64          
132                                                              65          
135                                                              66          
138                                                              67          
141                                                              68          
143                                                              69          
146                                                              70          
149                                                              71          
152                                                              72          
154                                                              73          
157                                                              74          
160                                                              75          
163                                                              76          
165                                                              77          
168                                                              78          
171                                                              79          
174                                                              80          
176                                                              81          
179                                                              82          
182                                                              83          
185                                                              84          
187                                                              85          
190                                                              86          
193                                                              87          
195                                                              88          
198                                                              89          
201                                                              90          
204                                                              91          
206                                                              92          
209                                                              93          
212                                                              94          
215                                                              95          
217                                                              96          
220                                                              97          
223                                                              98          
226                                                              99          
228                                                              100         
231                                                              101         
234                                                              102         
237                                                              103         
239                                                              104         
242                                                              105         
245                                                              106         
247                                                              107         
250                                                              108         
253                                                              109         
256                                                              110         
258                                                              111         
261                                                              112         
264                                                              113         
267                                                              114         
269                                                              115         
272                                                              116         
275                                                              117         
278                                                              118         
280                                                              119         
283                                                              120         
286                                                              121         
289                                                              122         
291                                                              123         
294                                                              124         
297                                                              125         
300                                                              126         
304                                                              127         
309                                                              128         
315                                                              129         
320                                                              130         
326                                                              131         
331                                                              132         
337                                                              133         
342                                                              134         
348                                                              135         
353                                                              136         
359                                                              137         
364                                                              138         
370                                                              139         
375                                                              140         
381                                                              141         
386                                                              142         
392                                                              143         
397                                                              144         
403                                                              145         
408                                                              146         
414                                                              147         
419                                                              148         
424                                                              149         
430                                                              150         
435                                                              151         
441                                                              152         
446                                                              153         
452                                                              154         
457                                                              155         
463                                                              156         
468                                                              157         
474                                                              158         
479                                                              159         
485                                                              160         
490                                                              161         
496                                                              162         
501                                                              163         
507                                                              164         
512                                                              165         
518                                                              166         
523                                                              167         
529                                                              168         
534                                                              169         
539                                                              170         
545                                                              171         
550                                                              172         
556                                                              173         
561                                                              174         
567                                                              175         
572                                                              176         
578                                                              177         
583                                                              178         
589                                                              179         
594                                                              180         
600                                                              181         
605                                                              182         
611                                                              183         
616                                                              184         
622                                                              185         
627                                                              186         
633                                                              187         
638                                                              188         
644                                                              189         
649                                                              190         
654                                                              191         
660                                                              192         
665                                                              193         
671                                                              194         
676                                                              195         
682                                                              196         
687                                                              197         
693                                                              198         
698                                                              199         
704                                                              200         
709                                                              201         
715                                                              202         
720                                                              203         
726                                                              204         
731                                                              205         
737                                                              206         
742                                                              207         
748                                                              208         
753                                                              209         
759                                                              210         
764                                                              211         
769                                                              212         
775                                                              213         
780                                                              214         
786                                                              215         
791                                                              216         
797                                                              217         
802                                                              218         
808                                                              219         
813                                                              220         
819                                                              221         
824                                                              222         
830                                                              223         
835                                                              224         
841                                                              225         
846                                                              226         
852                                                              227         
857                                                              228         
863                                                              229         
868                                                              230         
874                                                              231         
879                                                              232         
884                                                              233         
890                                                              234         
895                                                              235         
901                                                              236         
906                                                              237         
912                                                              238         
917                                                              239         
923                                                              240         
928                                                              241         
934                                                              242         
939                                                              243         
945                                                              244         
950                                                              245         
956                                                              246         
961                                                              247         
967                                                              248         
972                                                              249         
978                                                              250         
983                                                              251         
989                                                              252         
994                                                              253         
1000                                                             254         

254 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST');

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
254          1391         0            1                                                                1000                                                             1000         0.001               

1 rows fetched.

SQL> 
SQL> delete from hzy_high_hist where a < 800;

1190 rows affected.

SQL> commit;

Succeed.

SQL> analyze table hzy_high_hist compute statistics;

Succeed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
800                                                              1           
801                                                              2           
802                                                              3           
803                                                              4           
804                                                              5           
805                                                              6           
806                                                              7           
807                                                              8           
808                                                              9           
809                                                              10          
810                                                              11          
811                                                              12          
812                                                              13          
813                                                              14          
814                                                              15          
815                                                              16          
816                                                              17          
817                                                              18          
818                                                              19          
819                                                              20          
820                                                              21          
821                                                              22          
822                                                              23          
823                                                              24          
824                                                              25          
825                                                              26          
826                                                              27          
827                                                              28          
828                                                              29          
829                                                              30          
830                                                              31          
831                                                              32          
832                                                              33          
833                                                              34          
834                                                              35          
835                                                              36          
836                                                              37          
837                                                              38          
838                                                              39          
839                                                              40          
840                                                              41          
841                                                              42          
842                                                              43          
843                                                              44          
844                                                              45          
845                                                              46          
846                                                              47          
847                                                              48          
848                                                              49          
849                                                              50          
850                                                              51          
851                                                              52          
852                                                              53          
853                                                              54          
854                                                              55          
855                                                              56          
856                                                              57          
857                                                              58          
858                                                              59          
859                                                              60          
860                                                              61          
861                                                              62          
862                                                              63          
863                                                              64          
864                                                              65          
865                                                              66          
866                                                              67          
867                                                              68          
868                                                              69          
869                                                              70          
870                                                              71          
871                                                              72          
872                                                              73          
873                                                              74          
874                                                              75          
875                                                              76          
876                                                              77          
877                                                              78          
878                                                              79          
879                                                              80          
880                                                              81          
881                                                              82          
882                                                              83          
883                                                              84          
884                                                              85          
885                                                              86          
886                                                              87          
887                                                              88          
888                                                              89          
889                                                              90          
890                                                              91          
891                                                              92          
892                                                              93          
893                                                              94          
894                                                              95          
895                                                              96          
896                                                              97          
897                                                              98          
898                                                              99          
899                                                              100         
900                                                              101         
901                                                              102         
902                                                              103         
903                                                              104         
904                                                              105         
905                                                              106         
906                                                              107         
907                                                              108         
908                                                              109         
909                                                              110         
910                                                              111         
911                                                              112         
912                                                              113         
913                                                              114         
914                                                              115         
915                                                              116         
916                                                              117         
917                                                              118         
918                                                              119         
919                                                              120         
920                                                              121         
921                                                              122         
922                                                              123         
923                                                              124         
924                                                              125         
925                                                              126         
926                                                              127         
927                                                              128         
928                                                              129         
929                                                              130         
930                                                              131         
931                                                              132         
932                                                              133         
933                                                              134         
934                                                              135         
935                                                              136         
936                                                              137         
937                                                              138         
938                                                              139         
939                                                              140         
940                                                              141         
941                                                              142         
942                                                              143         
943                                                              144         
944                                                              145         
945                                                              146         
946                                                              147         
947                                                              148         
948                                                              149         
949                                                              150         
950                                                              151         
951                                                              152         
952                                                              153         
953                                                              154         
954                                                              155         
955                                                              156         
956                                                              157         
957                                                              158         
958                                                              159         
959                                                              160         
960                                                              161         
961                                                              162         
962                                                              163         
963                                                              164         
964                                                              165         
965                                                              166         
966                                                              167         
967                                                              168         
968                                                              169         
969                                                              170         
970                                                              171         
971                                                              172         
972                                                              173         
973                                                              174         
974                                                              175         
975                                                              176         
976                                                              177         
977                                                              178         
978                                                              179         
979                                                              180         
980                                                              181         
981                                                              182         
982                                                              183         
983                                                              184         
984                                                              185         
985                                                              186         
986                                                              187         
987                                                              188         
988                                                              189         
989                                                              190         
990                                                              191         
991                                                              192         
992                                                              193         
993                                                              194         
994                                                              195         
995                                                              196         
996                                                              197         
997                                                              198         
998                                                              199         
999                                                              200         
1000                                                             201         

201 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST');

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
201          201          0            800                                                              1000                                                             201          0.00497512437810945 

1 rows fetched.

SQL> 
SQL> call storage_proc_000(20,230);

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> analyze table hzy_high_hist compute statistics;

Succeed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
20                                                               1           
22                                                               2           
23                                                               3           
25                                                               4           
27                                                               5           
28                                                               6           
30                                                               7           
31                                                               8           
33                                                               9           
35                                                               10          
36                                                               11          
38                                                               12          
40                                                               13          
41                                                               14          
43                                                               15          
44                                                               16          
46                                                               17          
48                                                               18          
49                                                               19          
51                                                               20          
53                                                               21          
54                                                               22          
56                                                               23          
57                                                               24          
59                                                               25          
61                                                               26          
62                                                               27          
64                                                               28          
66                                                               29          
67                                                               30          
69                                                               31          
70                                                               32          
72                                                               33          
74                                                               34          
75                                                               35          
77                                                               36          
79                                                               37          
80                                                               38          
82                                                               39          
83                                                               40          
85                                                               41          
87                                                               42          
88                                                               43          
90                                                               44          
91                                                               45          
93                                                               46          
95                                                               47          
96                                                               48          
98                                                               49          
100                                                              50          
101                                                              51          
103                                                              52          
104                                                              53          
106                                                              54          
108                                                              55          
109                                                              56          
111                                                              57          
113                                                              58          
114                                                              59          
116                                                              60          
117                                                              61          
119                                                              62          
121                                                              63          
122                                                              64          
124                                                              65          
126                                                              66          
127                                                              67          
129                                                              68          
130                                                              69          
132                                                              70          
134                                                              71          
135                                                              72          
137                                                              73          
139                                                              74          
140                                                              75          
142                                                              76          
143                                                              77          
145                                                              78          
147                                                              79          
148                                                              80          
150                                                              81          
152                                                              82          
153                                                              83          
155                                                              84          
156                                                              85          
158                                                              86          
160                                                              87          
161                                                              88          
163                                                              89          
164                                                              90          
166                                                              91          
168                                                              92          
169                                                              93          
171                                                              94          
173                                                              95          
174                                                              96          
176                                                              97          
177                                                              98          
179                                                              99          
181                                                              100         
182                                                              101         
184                                                              102         
186                                                              103         
187                                                              104         
189                                                              105         
190                                                              106         
192                                                              107         
194                                                              108         
195                                                              109         
197                                                              110         
199                                                              111         
200                                                              112         
202                                                              113         
203                                                              114         
205                                                              115         
207                                                              116         
208                                                              117         
210                                                              118         
212                                                              119         
213                                                              120         
215                                                              121         
216                                                              122         
218                                                              123         
220                                                              124         
221                                                              125         
223                                                              126         
225                                                              127         
226                                                              128         
228                                                              129         
229                                                              130         
800                                                              131         
802                                                              132         
803                                                              133         
805                                                              134         
806                                                              135         
808                                                              136         
810                                                              137         
811                                                              138         
813                                                              139         
815                                                              140         
816                                                              141         
818                                                              142         
819                                                              143         
821                                                              144         
823                                                              145         
824                                                              146         
826                                                              147         
828                                                              148         
829                                                              149         
831                                                              150         
832                                                              151         
834                                                              152         
836                                                              153         
837                                                              154         
839                                                              155         
841                                                              156         
842                                                              157         
844                                                              158         
845                                                              159         
847                                                              160         
849                                                              161         
850                                                              162         
852                                                              163         
854                                                              164         
855                                                              165         
857                                                              166         
858                                                              167         
860                                                              168         
862                                                              169         
863                                                              170         
865                                                              171         
866                                                              172         
868                                                              173         
870                                                              174         
871                                                              175         
873                                                              176         
875                                                              177         
876                                                              178         
878                                                              179         
879                                                              180         
881                                                              181         
883                                                              182         
884                                                              183         
886                                                              184         
888                                                              185         
889                                                              186         
891                                                              187         
892                                                              188         
894                                                              189         
896                                                              190         
897                                                              191         
899                                                              192         
901                                                              193         
902                                                              194         
904                                                              195         
905                                                              196         
907                                                              197         
909                                                              198         
910                                                              199         
912                                                              200         
914                                                              201         
915                                                              202         
917                                                              203         
918                                                              204         
920                                                              205         
922                                                              206         
923                                                              207         
925                                                              208         
927                                                              209         
928                                                              210         
930                                                              211         
931                                                              212         
933                                                              213         
935                                                              214         
936                                                              215         
938                                                              216         
939                                                              217         
941                                                              218         
943                                                              219         
944                                                              220         
946                                                              221         
948                                                              222         
949                                                              223         
951                                                              224         
952                                                              225         
954                                                              226         
956                                                              227         
957                                                              228         
959                                                              229         
961                                                              230         
962                                                              231         
964                                                              232         
965                                                              233         
967                                                              234         
969                                                              235         
970                                                              236         
972                                                              237         
974                                                              238         
975                                                              239         
977                                                              240         
978                                                              241         
980                                                              242         
982                                                              243         
983                                                              244         
985                                                              245         
987                                                              246         
988                                                              247         
990                                                              248         
991                                                              249         
993                                                              250         
995                                                              251         
996                                                              252         
998                                                              253         
1000                                                             254         

254 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST');

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
254          412          0            20                                                               1000                                                             412          0.00242718446601942 

1 rows fetched.

SQL> 
SQL> call storage_proc_000(20,253);

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> analyze table hzy_high_hist compute statistics;

Succeed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
20                                                               1           
22                                                               2           
23                                                               3           
24                                                               4           
25                                                               5           
27                                                               6           
28                                                               7           
29                                                               8           
30                                                               9           
32                                                               10          
33                                                               11          
34                                                               12          
36                                                               13          
37                                                               14          
38                                                               15          
39                                                               16          
41                                                               17          
42                                                               18          
43                                                               19          
44                                                               20          
46                                                               21          
47                                                               22          
48                                                               23          
50                                                               24          
51                                                               25          
52                                                               26          
53                                                               27          
55                                                               28          
56                                                               29          
57                                                               30          
58                                                               31          
60                                                               32          
61                                                               33          
62                                                               34          
64                                                               35          
65                                                               36          
66                                                               37          
67                                                               38          
69                                                               39          
70                                                               40          
71                                                               41          
72                                                               42          
74                                                               43          
75                                                               44          
76                                                               45          
77                                                               46          
79                                                               47          
80                                                               48          
81                                                               49          
83                                                               50          
84                                                               51          
85                                                               52          
86                                                               53          
88                                                               54          
89                                                               55          
90                                                               56          
91                                                               57          
93                                                               58          
94                                                               59          
95                                                               60          
97                                                               61          
98                                                               62          
99                                                               63          
100                                                              64          
102                                                              65          
103                                                              66          
104                                                              67          
105                                                              68          
107                                                              69          
108                                                              70          
109                                                              71          
111                                                              72          
112                                                              73          
113                                                              74          
114                                                              75          
116                                                              76          
117                                                              77          
118                                                              78          
119                                                              79          
121                                                              80          
122                                                              81          
123                                                              82          
125                                                              83          
126                                                              84          
127                                                              85          
128                                                              86          
130                                                              87          
131                                                              88          
132                                                              89          
133                                                              90          
135                                                              91          
136                                                              92          
137                                                              93          
139                                                              94          
140                                                              95          
141                                                              96          
142                                                              97          
144                                                              98          
145                                                              99          
146                                                              100         
147                                                              101         
149                                                              102         
150                                                              103         
151                                                              104         
153                                                              105         
154                                                              106         
155                                                              107         
156                                                              108         
158                                                              109         
159                                                              110         
160                                                              111         
161                                                              112         
163                                                              113         
164                                                              114         
165                                                              115         
167                                                              116         
168                                                              117         
169                                                              118         
170                                                              119         
172                                                              120         
173                                                              121         
174                                                              122         
175                                                              123         
177                                                              124         
178                                                              125         
179                                                              126         
181                                                              127         
182                                                              128         
183                                                              129         
184                                                              130         
186                                                              131         
187                                                              132         
188                                                              133         
189                                                              134         
191                                                              135         
192                                                              136         
193                                                              137         
194                                                              138         
196                                                              139         
197                                                              140         
198                                                              141         
200                                                              142         
201                                                              143         
202                                                              144         
203                                                              145         
205                                                              146         
206                                                              147         
207                                                              148         
208                                                              149         
210                                                              150         
211                                                              151         
212                                                              152         
214                                                              153         
215                                                              154         
216                                                              155         
217                                                              156         
219                                                              157         
220                                                              158         
221                                                              159         
222                                                              160         
224                                                              161         
225                                                              162         
226                                                              163         
228                                                              164         
229                                                              165         
230                                                              166         
232                                                              167         
235                                                              168         
237                                                              169         
240                                                              170         
242                                                              171         
245                                                              172         
247                                                              173         
250                                                              174         
253                                                              175         
801                                                              176         
804                                                              177         
806                                                              178         
809                                                              179         
811                                                              180         
814                                                              181         
816                                                              182         
819                                                              183         
821                                                              184         
824                                                              185         
827                                                              186         
829                                                              187         
832                                                              188         
834                                                              189         
837                                                              190         
839                                                              191         
842                                                              192         
844                                                              193         
847                                                              194         
849                                                              195         
852                                                              196         
855                                                              197         
857                                                              198         
860                                                              199         
862                                                              200         
865                                                              201         
867                                                              202         
870                                                              203         
872                                                              204         
875                                                              205         
877                                                              206         
880                                                              207         
883                                                              208         
885                                                              209         
888                                                              210         
890                                                              211         
893                                                              212         
895                                                              213         
898                                                              214         
900                                                              215         
903                                                              216         
905                                                              217         
908                                                              218         
910                                                              219         
913                                                              220         
916                                                              221         
918                                                              222         
921                                                              223         
923                                                              224         
926                                                              225         
928                                                              226         
931                                                              227         
933                                                              228         
936                                                              229         
938                                                              230         
941                                                              231         
944                                                              232         
946                                                              233         
949                                                              234         
951                                                              235         
954                                                              236         
956                                                              237         
959                                                              238         
961                                                              239         
964                                                              240         
966                                                              241         
969                                                              242         
972                                                              243         
974                                                              244         
977                                                              245         
979                                                              246         
982                                                              247         
984                                                              248         
987                                                              249         
989                                                              250         
992                                                              251         
994                                                              252         
997                                                              253         
1000                                                             254         

254 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST');

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
254          646          0            20                                                               1000                                                             435          0.00229885057471264 

1 rows fetched.

SQL> 
SQL> call storage_proc_000(20,254);

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> analyze table hzy_high_hist compute statistics;

Succeed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
20                                                               1           
21                                                               2           
23                                                               3           
24                                                               4           
25                                                               5           
26                                                               6           
27                                                               7           
28                                                               8           
30                                                               9           
31                                                               10          
32                                                               11          
33                                                               12          
34                                                               13          
35                                                               14          
37                                                               15          
38                                                               16          
39                                                               17          
40                                                               18          
41                                                               19          
42                                                               20          
43                                                               21          
45                                                               22          
46                                                               23          
47                                                               24          
48                                                               25          
49                                                               26          
50                                                               27          
52                                                               28          
53                                                               29          
54                                                               30          
55                                                               31          
56                                                               32          
57                                                               33          
58                                                               34          
60                                                               35          
61                                                               36          
62                                                               37          
63                                                               38          
64                                                               39          
65                                                               40          
67                                                               41          
68                                                               42          
69                                                               43          
70                                                               44          
71                                                               45          
72                                                               46          
74                                                               47          
75                                                               48          
76                                                               49          
77                                                               50          
78                                                               51          
79                                                               52          
80                                                               53          
82                                                               54          
83                                                               55          
84                                                               56          
85                                                               57          
86                                                               58          
87                                                               59          
89                                                               60          
90                                                               61          
91                                                               62          
92                                                               63          
93                                                               64          
94                                                               65          
95                                                               66          
97                                                               67          
98                                                               68          
99                                                               69          
100                                                              70          
101                                                              71          
102                                                              72          
104                                                              73          
105                                                              74          
106                                                              75          
107                                                              76          
108                                                              77          
109                                                              78          
111                                                              79          
112                                                              80          
113                                                              81          
114                                                              82          
115                                                              83          
116                                                              84          
117                                                              85          
119                                                              86          
120                                                              87          
121                                                              88          
122                                                              89          
123                                                              90          
124                                                              91          
126                                                              92          
127                                                              93          
128                                                              94          
129                                                              95          
130                                                              96          
131                                                              97          
132                                                              98          
134                                                              99          
135                                                              100         
136                                                              101         
137                                                              102         
138                                                              103         
139                                                              104         
141                                                              105         
142                                                              106         
143                                                              107         
144                                                              108         
145                                                              109         
146                                                              110         
148                                                              111         
149                                                              112         
150                                                              113         
151                                                              114         
152                                                              115         
153                                                              116         
154                                                              117         
156                                                              118         
157                                                              119         
158                                                              120         
159                                                              121         
160                                                              122         
161                                                              123         
163                                                              124         
164                                                              125         
165                                                              126         
166                                                              127         
167                                                              128         
168                                                              129         
169                                                              130         
171                                                              131         
172                                                              132         
173                                                              133         
174                                                              134         
175                                                              135         
176                                                              136         
178                                                              137         
179                                                              138         
180                                                              139         
181                                                              140         
182                                                              141         
183                                                              142         
184                                                              143         
186                                                              144         
187                                                              145         
188                                                              146         
189                                                              147         
190                                                              148         
191                                                              149         
193                                                              150         
194                                                              151         
195                                                              152         
196                                                              153         
197                                                              154         
198                                                              155         
200                                                              156         
201                                                              157         
202                                                              158         
203                                                              159         
204                                                              160         
205                                                              161         
206                                                              162         
208                                                              163         
209                                                              164         
210                                                              165         
211                                                              166         
212                                                              167         
213                                                              168         
215                                                              169         
216                                                              170         
217                                                              171         
218                                                              172         
219                                                              173         
220                                                              174         
221                                                              175         
223                                                              176         
224                                                              177         
225                                                              178         
226                                                              179         
227                                                              180         
228                                                              181         
230                                                              182         
231                                                              183         
233                                                              184         
234                                                              185         
236                                                              186         
238                                                              187         
240                                                              188         
241                                                              189         
243                                                              190         
245                                                              191         
246                                                              192         
248                                                              193         
250                                                              194         
252                                                              195         
253                                                              196         
802                                                              197         
805                                                              198         
809                                                              199         
812                                                              200         
816                                                              201         
819                                                              202         
823                                                              203         
826                                                              204         
830                                                              205         
833                                                              206         
836                                                              207         
840                                                              208         
843                                                              209         
847                                                              210         
850                                                              211         
854                                                              212         
857                                                              213         
861                                                              214         
864                                                              215         
868                                                              216         
871                                                              217         
875                                                              218         
878                                                              219         
882                                                              220         
885                                                              221         
889                                                              222         
892                                                              223         
895                                                              224         
899                                                              225         
902                                                              226         
906                                                              227         
909                                                              228         
913                                                              229         
916                                                              230         
920                                                              231         
923                                                              232         
927                                                              233         
930                                                              234         
934                                                              235         
937                                                              236         
941                                                              237         
944                                                              238         
947                                                              239         
951                                                              240         
954                                                              241         
958                                                              242         
961                                                              243         
965                                                              244         
968                                                              245         
972                                                              246         
975                                                              247         
979                                                              248         
982                                                              249         
986                                                              250         
989                                                              251         
993                                                              252         
996                                                              253         
1000                                                             254         

254 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST');

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
254          881          0            20                                                               1000                                                             436          0.00229357798165138 

1 rows fetched.

SQL> 
SQL> delete from hzy_high_hist where a < 990;

870 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> analyze table hzy_high_hist compute statistics;

Succeed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
990                                                              1           
991                                                              2           
992                                                              3           
993                                                              4           
994                                                              5           
995                                                              6           
996                                                              7           
997                                                              8           
998                                                              9           
999                                                              10          
1000                                                             11          

11 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST');

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
11           11           0            990                                                              1000                                                             11           0.0909090909090909  

1 rows fetched.

SQL> 
SQL> delete from hzy_high_hist;

11 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> analyze table hzy_high_hist compute statistics;

Succeed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST');

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
0            0            0                                                                                                                                              0            0                   

1 rows fetched.

SQL> 
SQL> drop table if exists hzy_high_hist;

Succeed.

SQL> drop table if exists high_hist;

Succeed.

SQL> 
SQL> drop table if exists hzy_high_hist;

Succeed.

SQL> drop table if exists high_hist;

Succeed.

SQL> create table high_hist(a int);

Succeed.

SQL> insert into high_hist values(0);

1 rows affected.

SQL> create table hzy_high_hist(a int)
  2 partition by range(A)
  3 interval(258)
  4 (
  5    partition PART_H1 values less than (100),
  6    partition PART_H2 values less than (359),
  7    partition PART_H3 values less than (659)
  8 );

Succeed.

SQL> 
SQL> CREATE or replace procedure storage_proc_000(startnum int,endall int) is
  2 i INT :=1;
  3 j varchar(10);
  4 BEGIN
  5   FOR i IN startnum..endall LOOP
  6     insert into hzy_high_hist select a+i from high_hist;
  7   END LOOP;
  8 END;
  9 /

Succeed.

SQL> call storage_proc_000(1,1000);

PL/SQL procedure successfully completed.

SQL> call storage_proc_000(1,10);

PL/SQL procedure successfully completed.

SQL> call storage_proc_000(1,100);

PL/SQL procedure successfully completed.

SQL> call storage_proc_000(20,300);

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'HZY_HIGH_HIST');

PL/SQL procedure successfully completed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 10 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
1                                                                3           
2                                                                6           
3                                                                9           
4                                                                12          
5                                                                15          
6                                                                18          
7                                                                21          
8                                                                24          
9                                                                27          
10                                                               30          
11                                                               32          
12                                                               34          
13                                                               36          
14                                                               38          
15                                                               40          
16                                                               42          
17                                                               44          
18                                                               46          
19                                                               48          
20                                                               51          
21                                                               54          
22                                                               57          
23                                                               60          
24                                                               63          
25                                                               66          
26                                                               69          
27                                                               72          
28                                                               75          
29                                                               78          
30                                                               81          
31                                                               84          
32                                                               87          
33                                                               90          
34                                                               93          
35                                                               96          
36                                                               99          
37                                                               102         
38                                                               105         
39                                                               108         
40                                                               111         
41                                                               114         
42                                                               117         
43                                                               120         
44                                                               123         
45                                                               126         
46                                                               129         
47                                                               132         
48                                                               135         
49                                                               138         
50                                                               141         
51                                                               144         
52                                                               147         
53                                                               150         
54                                                               153         
55                                                               156         
56                                                               159         
57                                                               162         
58                                                               165         
59                                                               168         
60                                                               171         
61                                                               174         
62                                                               177         
63                                                               180         
64                                                               183         
65                                                               186         
66                                                               189         
67                                                               192         
68                                                               195         
69                                                               198         
70                                                               201         
71                                                               204         
72                                                               207         
73                                                               210         
74                                                               213         
75                                                               216         
76                                                               219         
77                                                               222         
78                                                               225         
79                                                               228         
80                                                               231         
81                                                               234         
82                                                               237         
83                                                               240         
84                                                               243         
85                                                               246         
86                                                               249         
87                                                               252         
88                                                               255         
89                                                               258         
90                                                               261         
91                                                               264         
92                                                               267         
93                                                               270         
94                                                               273         
95                                                               276         
96                                                               279         
97                                                               282         
98                                                               285         
99                                                               288         

99 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 20 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
100                                                              1           
100                                                              2           
101                                                              3           
102                                                              4           
103                                                              5           
104                                                              6           
105                                                              7           
106                                                              8           
107                                                              9           
108                                                              10          
108                                                              11          
109                                                              12          
110                                                              13          
111                                                              14          
112                                                              15          
113                                                              16          
114                                                              17          
115                                                              18          
116                                                              19          
117                                                              20          
118                                                              21          
118                                                              22          
119                                                              23          
120                                                              24          
121                                                              25          
122                                                              26          
123                                                              27          
124                                                              28          
125                                                              29          
126                                                              30          
127                                                              31          
128                                                              32          
128                                                              33          
129                                                              34          
130                                                              35          
131                                                              36          
132                                                              37          
133                                                              38          
134                                                              39          
135                                                              40          
136                                                              41          
137                                                              42          
138                                                              43          
138                                                              44          
139                                                              45          
140                                                              46          
141                                                              47          
142                                                              48          
143                                                              49          
144                                                              50          
145                                                              51          
146                                                              52          
147                                                              53          
148                                                              54          
148                                                              55          
149                                                              56          
150                                                              57          
151                                                              58          
152                                                              59          
153                                                              60          
154                                                              61          
155                                                              62          
156                                                              63          
157                                                              64          
157                                                              65          
158                                                              66          
159                                                              67          
160                                                              68          
161                                                              69          
162                                                              70          
163                                                              71          
164                                                              72          
165                                                              73          
166                                                              74          
167                                                              75          
167                                                              76          
168                                                              77          
169                                                              78          
170                                                              79          
171                                                              80          
172                                                              81          
173                                                              82          
174                                                              83          
175                                                              84          
176                                                              85          
177                                                              86          
177                                                              87          
178                                                              88          
179                                                              89          
180                                                              90          
181                                                              91          
182                                                              92          
183                                                              93          
184                                                              94          
185                                                              95          
186                                                              96          
187                                                              97          
187                                                              98          
188                                                              99          
189                                                              100         
190                                                              101         
191                                                              102         
192                                                              103         
193                                                              104         
194                                                              105         
195                                                              106         
196                                                              107         
197                                                              108         
197                                                              109         
198                                                              110         
199                                                              111         
200                                                              112         
201                                                              113         
202                                                              114         
203                                                              115         
204                                                              116         
205                                                              117         
206                                                              118         
206                                                              119         
207                                                              120         
208                                                              121         
209                                                              122         
210                                                              123         
211                                                              124         
212                                                              125         
213                                                              126         
214                                                              127         
215                                                              128         
216                                                              129         
216                                                              130         
217                                                              131         
218                                                              132         
219                                                              133         
220                                                              134         
221                                                              135         
222                                                              136         
223                                                              137         
224                                                              138         
225                                                              139         
226                                                              140         
226                                                              141         
227                                                              142         
228                                                              143         
229                                                              144         
230                                                              145         
231                                                              146         
232                                                              147         
233                                                              148         
234                                                              149         
235                                                              150         
236                                                              151         
236                                                              152         
237                                                              153         
238                                                              154         
239                                                              155         
240                                                              156         
241                                                              157         
242                                                              158         
243                                                              159         
244                                                              160         
245                                                              161         
246                                                              162         
246                                                              163         
247                                                              164         
248                                                              165         
249                                                              166         
250                                                              167         
251                                                              168         
252                                                              169         
253                                                              170         
254                                                              171         
255                                                              172         
255                                                              173         
256                                                              174         
257                                                              175         
258                                                              176         
259                                                              177         
260                                                              178         
261                                                              179         
262                                                              180         
263                                                              181         
264                                                              182         
265                                                              183         
265                                                              184         
266                                                              185         
267                                                              186         
268                                                              187         
269                                                              188         
270                                                              189         
271                                                              190         
272                                                              191         
273                                                              192         
274                                                              193         
275                                                              194         
275                                                              195         
276                                                              196         
277                                                              197         
278                                                              198         
279                                                              199         
280                                                              200         
281                                                              201         
282                                                              202         
283                                                              203         
284                                                              204         
285                                                              205         
285                                                              206         
286                                                              207         
287                                                              208         
288                                                              209         
289                                                              210         
290                                                              211         
291                                                              212         
292                                                              213         
293                                                              214         
294                                                              215         
295                                                              216         
295                                                              217         
296                                                              218         
297                                                              219         
298                                                              220         
299                                                              221         
300                                                              222         
301                                                              223         
303                                                              224         
305                                                              225         
307                                                              226         
308                                                              227         
310                                                              228         
312                                                              229         
314                                                              230         
316                                                              231         
318                                                              232         
319                                                              233         
321                                                              234         
323                                                              235         
325                                                              236         
327                                                              237         
328                                                              238         
330                                                              239         
332                                                              240         
334                                                              241         
336                                                              242         
338                                                              243         
339                                                              244         
341                                                              245         
343                                                              246         
345                                                              247         
347                                                              248         
348                                                              249         
350                                                              250         
352                                                              251         
354                                                              252         
356                                                              253         
358                                                              254         

254 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 30 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
359                                                              1           
360                                                              2           
361                                                              3           
362                                                              4           
363                                                              5           
365                                                              6           
366                                                              7           
367                                                              8           
368                                                              9           
369                                                              10          
370                                                              11          
372                                                              12          
373                                                              13          
374                                                              14          
375                                                              15          
376                                                              16          
378                                                              17          
379                                                              18          
380                                                              19          
381                                                              20          
382                                                              21          
383                                                              22          
385                                                              23          
386                                                              24          
387                                                              25          
388                                                              26          
389                                                              27          
391                                                              28          
392                                                              29          
393                                                              30          
394                                                              31          
395                                                              32          
396                                                              33          
398                                                              34          
399                                                              35          
400                                                              36          
401                                                              37          
402                                                              38          
404                                                              39          
405                                                              40          
406                                                              41          
407                                                              42          
408                                                              43          
409                                                              44          
411                                                              45          
412                                                              46          
413                                                              47          
414                                                              48          
415                                                              49          
417                                                              50          
418                                                              51          
419                                                              52          
420                                                              53          
421                                                              54          
422                                                              55          
424                                                              56          
425                                                              57          
426                                                              58          
427                                                              59          
428                                                              60          
430                                                              61          
431                                                              62          
432                                                              63          
433                                                              64          
434                                                              65          
435                                                              66          
437                                                              67          
438                                                              68          
439                                                              69          
440                                                              70          
441                                                              71          
443                                                              72          
444                                                              73          
445                                                              74          
446                                                              75          
447                                                              76          
448                                                              77          
450                                                              78          
451                                                              79          
452                                                              80          
453                                                              81          
454                                                              82          
456                                                              83          
457                                                              84          
458                                                              85          
459                                                              86          
460                                                              87          
461                                                              88          
463                                                              89          
464                                                              90          
465                                                              91          
466                                                              92          
467                                                              93          
469                                                              94          
470                                                              95          
471                                                              96          
472                                                              97          
473                                                              98          
474                                                              99          
476                                                              100         
477                                                              101         
478                                                              102         
479                                                              103         
480                                                              104         
482                                                              105         
483                                                              106         
484                                                              107         
485                                                              108         
486                                                              109         
487                                                              110         
489                                                              111         
490                                                              112         
491                                                              113         
492                                                              114         
493                                                              115         
495                                                              116         
496                                                              117         
497                                                              118         
498                                                              119         
499                                                              120         
500                                                              121         
502                                                              122         
503                                                              123         
504                                                              124         
505                                                              125         
506                                                              126         
508                                                              127         
509                                                              128         
510                                                              129         
511                                                              130         
512                                                              131         
513                                                              132         
515                                                              133         
516                                                              134         
517                                                              135         
518                                                              136         
519                                                              137         
520                                                              138         
522                                                              139         
523                                                              140         
524                                                              141         
525                                                              142         
526                                                              143         
528                                                              144         
529                                                              145         
530                                                              146         
531                                                              147         
532                                                              148         
533                                                              149         
535                                                              150         
536                                                              151         
537                                                              152         
538                                                              153         
539                                                              154         
541                                                              155         
542                                                              156         
543                                                              157         
544                                                              158         
545                                                              159         
546                                                              160         
548                                                              161         
549                                                              162         
550                                                              163         
551                                                              164         
552                                                              165         
554                                                              166         
555                                                              167         
556                                                              168         
557                                                              169         
558                                                              170         
559                                                              171         
561                                                              172         
562                                                              173         
563                                                              174         
564                                                              175         
565                                                              176         
567                                                              177         
568                                                              178         
569                                                              179         
570                                                              180         
571                                                              181         
572                                                              182         
574                                                              183         
575                                                              184         
576                                                              185         
577                                                              186         
578                                                              187         
580                                                              188         
581                                                              189         
582                                                              190         
583                                                              191         
584                                                              192         
585                                                              193         
587                                                              194         
588                                                              195         
589                                                              196         
590                                                              197         
591                                                              198         
593                                                              199         
594                                                              200         
595                                                              201         
596                                                              202         
597                                                              203         
598                                                              204         
600                                                              205         
601                                                              206         
602                                                              207         
603                                                              208         
604                                                              209         
606                                                              210         
607                                                              211         
608                                                              212         
609                                                              213         
610                                                              214         
611                                                              215         
613                                                              216         
614                                                              217         
615                                                              218         
616                                                              219         
617                                                              220         
619                                                              221         
620                                                              222         
621                                                              223         
622                                                              224         
623                                                              225         
624                                                              226         
626                                                              227         
627                                                              228         
628                                                              229         
629                                                              230         
630                                                              231         
632                                                              232         
633                                                              233         
634                                                              234         
635                                                              235         
636                                                              236         
637                                                              237         
639                                                              238         
640                                                              239         
641                                                              240         
642                                                              241         
643                                                              242         
645                                                              243         
646                                                              244         
647                                                              245         
648                                                              246         
649                                                              247         
650                                                              248         
652                                                              249         
653                                                              250         
654                                                              251         
655                                                              252         
656                                                              253         
658                                                              254         

254 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY,SPARE1 from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST')
  2 ORDER BY SPARE1;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY              SPARE1              
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ -------------------- --------------------
99           288          0            1                                                                99                                                               99           0.0101010101010101   10                  
254          461          0            100                                                              358                                                              259          0.00386100386100386  20                  
254          300          0            359                                                              658                                                              300          0.00333333333333333  30                  
254          258          0            659                                                              916                                                              258          0.00387596899224806  1073741824          
84           84           0            917                                                              1000                                                             84           0.0119047619047619   1073741825          
254          1391         0            1                                                                1000                                                             1000         0.001                4294967295          

6 rows fetched.

SQL> 
SQL> delete from hzy_high_hist where a < 800;

1190 rows affected.

SQL> commit;

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'HZY_HIGH_HIST');

PL/SQL procedure successfully completed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 10 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 20 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 30 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY,SPARE1 from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST')
  2 ORDER BY SPARE1;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY              SPARE1              
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ -------------------- --------------------
0            0            0                                                                                                                                              0            0                    10                  
0            0            0                                                                                                                                              0            0                    20                  
0            0            0                                                                                                                                              0            0                    30                  
117          117          0            800                                                              916                                                              117          0.00854700854700855  1073741824          
84           84           0            917                                                              1000                                                             84           0.0119047619047619   1073741825          
201          201          0            800                                                              1000                                                             201          0.00497512437810945  4294967295          

6 rows fetched.

SQL> 
SQL> 
SQL> call storage_proc_000(20,830);

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'HZY_HIGH_HIST', 'PART_H3');

PL/SQL procedure successfully completed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 10 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 20 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 30 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
359                                                              1           
360                                                              2           
361                                                              3           
362                                                              4           
363                                                              5           
365                                                              6           
366                                                              7           
367                                                              8           
368                                                              9           
369                                                              10          
370                                                              11          
372                                                              12          
373                                                              13          
374                                                              14          
375                                                              15          
376                                                              16          
378                                                              17          
379                                                              18          
380                                                              19          
381                                                              20          
382                                                              21          
383                                                              22          
385                                                              23          
386                                                              24          
387                                                              25          
388                                                              26          
389                                                              27          
391                                                              28          
392                                                              29          
393                                                              30          
394                                                              31          
395                                                              32          
396                                                              33          
398                                                              34          
399                                                              35          
400                                                              36          
401                                                              37          
402                                                              38          
404                                                              39          
405                                                              40          
406                                                              41          
407                                                              42          
408                                                              43          
409                                                              44          
411                                                              45          
412                                                              46          
413                                                              47          
414                                                              48          
415                                                              49          
417                                                              50          
418                                                              51          
419                                                              52          
420                                                              53          
421                                                              54          
422                                                              55          
424                                                              56          
425                                                              57          
426                                                              58          
427                                                              59          
428                                                              60          
430                                                              61          
431                                                              62          
432                                                              63          
433                                                              64          
434                                                              65          
435                                                              66          
437                                                              67          
438                                                              68          
439                                                              69          
440                                                              70          
441                                                              71          
443                                                              72          
444                                                              73          
445                                                              74          
446                                                              75          
447                                                              76          
448                                                              77          
450                                                              78          
451                                                              79          
452                                                              80          
453                                                              81          
454                                                              82          
456                                                              83          
457                                                              84          
458                                                              85          
459                                                              86          
460                                                              87          
461                                                              88          
463                                                              89          
464                                                              90          
465                                                              91          
466                                                              92          
467                                                              93          
469                                                              94          
470                                                              95          
471                                                              96          
472                                                              97          
473                                                              98          
474                                                              99          
476                                                              100         
477                                                              101         
478                                                              102         
479                                                              103         
480                                                              104         
482                                                              105         
483                                                              106         
484                                                              107         
485                                                              108         
486                                                              109         
487                                                              110         
489                                                              111         
490                                                              112         
491                                                              113         
492                                                              114         
493                                                              115         
495                                                              116         
496                                                              117         
497                                                              118         
498                                                              119         
499                                                              120         
500                                                              121         
502                                                              122         
503                                                              123         
504                                                              124         
505                                                              125         
506                                                              126         
508                                                              127         
509                                                              128         
510                                                              129         
511                                                              130         
512                                                              131         
513                                                              132         
515                                                              133         
516                                                              134         
517                                                              135         
518                                                              136         
519                                                              137         
520                                                              138         
522                                                              139         
523                                                              140         
524                                                              141         
525                                                              142         
526                                                              143         
528                                                              144         
529                                                              145         
530                                                              146         
531                                                              147         
532                                                              148         
533                                                              149         
535                                                              150         
536                                                              151         
537                                                              152         
538                                                              153         
539                                                              154         
541                                                              155         
542                                                              156         
543                                                              157         
544                                                              158         
545                                                              159         
546                                                              160         
548                                                              161         
549                                                              162         
550                                                              163         
551                                                              164         
552                                                              165         
554                                                              166         
555                                                              167         
556                                                              168         
557                                                              169         
558                                                              170         
559                                                              171         
561                                                              172         
562                                                              173         
563                                                              174         
564                                                              175         
565                                                              176         
567                                                              177         
568                                                              178         
569                                                              179         
570                                                              180         
571                                                              181         
572                                                              182         
574                                                              183         
575                                                              184         
576                                                              185         
577                                                              186         
578                                                              187         
580                                                              188         
581                                                              189         
582                                                              190         
583                                                              191         
584                                                              192         
585                                                              193         
587                                                              194         
588                                                              195         
589                                                              196         
590                                                              197         
591                                                              198         
593                                                              199         
594                                                              200         
595                                                              201         
596                                                              202         
597                                                              203         
598                                                              204         
600                                                              205         
601                                                              206         
602                                                              207         
603                                                              208         
604                                                              209         
606                                                              210         
607                                                              211         
608                                                              212         
609                                                              213         
610                                                              214         
611                                                              215         
613                                                              216         
614                                                              217         
615                                                              218         
616                                                              219         
617                                                              220         
619                                                              221         
620                                                              222         
621                                                              223         
622                                                              224         
623                                                              225         
624                                                              226         
626                                                              227         
627                                                              228         
628                                                              229         
629                                                              230         
630                                                              231         
632                                                              232         
633                                                              233         
634                                                              234         
635                                                              235         
636                                                              236         
637                                                              237         
639                                                              238         
640                                                              239         
641                                                              240         
642                                                              241         
643                                                              242         
645                                                              243         
646                                                              244         
647                                                              245         
648                                                              246         
649                                                              247         
650                                                              248         
652                                                              249         
653                                                              250         
654                                                              251         
655                                                              252         
656                                                              253         
658                                                              254         

254 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY,SPARE1 from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST')
  2 ORDER BY SPARE1;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY              SPARE1              
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ -------------------- --------------------
0            0            0                                                                                                                                              0            0                    10                  
0            0            0                                                                                                                                              0            0                    20                  
254          300          0            359                                                              658                                                              300          0.00333333333333333  30                  
117          117          0            800                                                              916                                                              117          0.00854700854700855  1073741824          
84           84           0            917                                                              1000                                                             84           0.0119047619047619   1073741825          
201          501          0            359                                                              1000                                                             501          0.00199600798403194  4294967295          

6 rows fetched.

SQL> 
SQL> delete from hzy_high_hist where a < 550;

530 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'HZY_HIGH_HIST', 'PART_H3');

PL/SQL procedure successfully completed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 10 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 20 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 30 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
550                                                              1           
551                                                              2           
552                                                              3           
553                                                              4           
554                                                              5           
555                                                              6           
556                                                              7           
557                                                              8           
558                                                              9           
559                                                              10          
560                                                              11          
561                                                              12          
562                                                              13          
563                                                              14          
564                                                              15          
565                                                              16          
566                                                              17          
567                                                              18          
568                                                              19          
569                                                              20          
570                                                              21          
571                                                              22          
572                                                              23          
573                                                              24          
574                                                              25          
575                                                              26          
576                                                              27          
577                                                              28          
578                                                              29          
579                                                              30          
580                                                              31          
581                                                              32          
582                                                              33          
583                                                              34          
584                                                              35          
585                                                              36          
586                                                              37          
587                                                              38          
588                                                              39          
589                                                              40          
590                                                              41          
591                                                              42          
592                                                              43          
593                                                              44          
594                                                              45          
595                                                              46          
596                                                              47          
597                                                              48          
598                                                              49          
599                                                              50          
600                                                              51          
601                                                              52          
602                                                              53          
603                                                              54          
604                                                              55          
605                                                              56          
606                                                              57          
607                                                              58          
608                                                              59          
609                                                              60          
610                                                              61          
611                                                              62          
612                                                              63          
613                                                              64          
614                                                              65          
615                                                              66          
616                                                              67          
617                                                              68          
618                                                              69          
619                                                              70          
620                                                              71          
621                                                              72          
622                                                              73          
623                                                              74          
624                                                              75          
625                                                              76          
626                                                              77          
627                                                              78          
628                                                              79          
629                                                              80          
630                                                              81          
631                                                              82          
632                                                              83          
633                                                              84          
634                                                              85          
635                                                              86          
636                                                              87          
637                                                              88          
638                                                              89          
639                                                              90          
640                                                              91          
641                                                              92          
642                                                              93          
643                                                              94          
644                                                              95          
645                                                              96          
646                                                              97          
647                                                              98          
648                                                              99          
649                                                              100         
650                                                              101         
651                                                              102         
652                                                              103         
653                                                              104         
654                                                              105         
655                                                              106         
656                                                              107         
657                                                              108         
658                                                              109         

109 rows fetched.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY,SPARE1 from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST')
  2 ORDER BY SPARE1;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY              SPARE1              
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ -------------------- --------------------
0            0            0                                                                                                                                              0            0                    10                  
0            0            0                                                                                                                                              0            0                    20                  
109          109          0            550                                                              658                                                              109          0.00917431192660551  30                  
117          117          0            800                                                              916                                                              117          0.00854700854700855  1073741824          
84           84           0            917                                                              1000                                                             84           0.0119047619047619   1073741825          
201          501          0            359                                                              1000                                                             501          0.00199600798403194  4294967295          

6 rows fetched.

SQL> 
SQL> 
SQL> delete from hzy_high_hist where a < 800;

250 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'HZY_HIGH_HIST', 'PART_H3');

PL/SQL procedure successfully completed.

SQL> select BUCKET,ENDPOINT  from SYS_HISTGRAM where table# = (select id from SYS_TABLES where name = 'HZY_HIGH_HIST') AND PART# = 30 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------

0 rows fetched.

SQL> 
SQL> drop table if exists hzy_high_hist;

Succeed.

SQL> drop table if exists high_hist;

Succeed.

SQL> 
SQL> drop table if exists FVT_PROC_1000_bingfa_Tab_000;

Succeed.

SQL> create table FVT_PROC_1000_bingfa_Tab_000(c_varchar varchar(100),c_int int,c_num number,c_clob clob,c_date date);

Succeed.

SQL> create index PROC_1000_bingfa_000_Idx_01 on FVT_PROC_1000_bingfa_Tab_000(c_int);

Succeed.

SQL> exec dbe_stats.collect_table_stats('sys','FVT_PROC_1000_BINGFA_TAB_000','partname',10,true);

CT-00932, [1:2] PL/SQL(SYS.ANONYMOUS BLOCK) terminated with execute errors
[1:2] PL/SQL(DBE_STATS.COLLECT_TABLE_STATS) terminated with execute errors
CT-00130, Operation analyze partition is not supported on FVT_PROC_1000_BINGFA_TAB_000

SQL> 
SQL> --- statistics for all  index columns ----
SQL> DROP TABLE IF EXISTS STATS_INTERVAL_NEW;

Succeed.

SQL> drop user if exists HZY_PSTATS1 cascade;

Succeed.

SQL> create user HZY_PSTATS1 identified by Cantian_234;

Succeed.

SQL> 
SQL> create table HZY_PSTATS1.STATS_INTERVAL_NEW(
  2 c_id int,
  3 c_d_id int NOT NULL,
  4 c_w_id int NOT NULL,
  5 c_first varchar(50) NOT NULL,
  6 c_middle char(2),
  7 c_last varchar(16) NOT NULL,
  8 c_street_1 varchar(20) NOT NULL,
  9 c_street_2 varchar(20),
 10 c_city varchar(20) NOT NULL,
 11 c_state char(2) NOT NULL,
 12 c_zip char(9) NOT NULL,
 13 c_phone char(16) NOT NULL,
 14 c_since timestamp,
 15 c_credit char(2) NOT NULL,
 16 c_credit_lim numeric(12,2),
 17 c_discount numeric(4,4),
 18 c_balance numeric(12,2),
 19 c_ytd_payment real NOT NULL,
 20 c_payment_cnt number NOT NULL,
 21 c_delivery_cnt bool NOT NULL,
 22 c_end date NOT NULL,
 23 c_data varchar(1000),
 24 c_clob clob,
 25 c_text blob) 
 26 partition by range(c_id)
 27 interval(100) 
 28 (
 29    partition PART_H1 values less than (10),
 30    partition PART_H2 values less than (20),
 31    partition PART_H3 values less than (30)
 32 );

Succeed.

SQL> 
SQL> 
SQL> CREATE or replace procedure HZY_PSTATS1.lob_hzy_proc_1115(startnum int,endall int) is
  2 i INT :=1;
  3 j varchar(10);
  4 BEGIN
  5   FOR i IN startnum..endall LOOP
  6     select cast(i as varchar(10)) into j from dual;
  7     insert into  HZY_PSTATS1.STATS_INTERVAL_NEW select i,i,i,'is'||j||'cmRDs'||j,'OE','BAR'||j||'Bar'||j,'bkili'||j||'fcrRGF'||j,'pmbwo'||j||'vhSDGj'||j,'dyf'||j||'rDa'||j,'uq',4801||j,940||j||215||j,'2011-12-11 00:00:00','GC',50000.0,0.4361328,-10.0,10.0,1,true,'2011-12-11 00:00:00','dasd'||j,'dasdsd'||j,'\x1234354587643123455213445656723123424554566776763221132454566768767433242323445453565654542323';
  8   END LOOP;
  9 END;
 10 /

Succeed.

SQL> 
SQL> call HZY_PSTATS1.lob_hzy_proc_1115(1001,1120);

PL/SQL procedure successfully completed.

SQL> call HZY_PSTATS1.lob_hzy_proc_1115(1,20);

PL/SQL procedure successfully completed.

SQL> call HZY_PSTATS1.lob_hzy_proc_1115(1,15);

PL/SQL procedure successfully completed.

SQL> call HZY_PSTATS1.lob_hzy_proc_1115(10,30);

PL/SQL procedure successfully completed.

SQL> call HZY_PSTATS1.lob_hzy_proc_1115(25,45);

PL/SQL procedure successfully completed.

SQL> call HZY_PSTATS1.lob_hzy_proc_1115(50,100);

PL/SQL procedure successfully completed.

SQL> commit; 

Succeed.

SQL> 
SQL> select count(*) from HZY_PSTATS1.STATS_INTERVAL_NEW;

COUNT(*)            
--------------------
248                 

1 rows fetched.

SQL> 
SQL> CREATE INDEX HZY_PSTATS1.HZY_PSTATS1_dml_range_indx_086 ON HZY_PSTATS1.STATS_INTERVAL_NEW(c_id);

Succeed.

SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1', 'STATS_INTERVAL_NEW', part_name=>NULL, sample_ratio => 100, method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select count(distinct col#)  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1');

COUNT(DISTINCT COL#)
--------------------
1                   

1 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 0 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
0            9            18           0            1                                                                9                                                                9            0.111111111111111   
0            10           26           0            10                                                               19                                                               10           0.1                 
0            10           16           0            20                                                               29                                                               10           0.1                 
0            67           68           0            30                                                               100                                                              67           0.0149253731343284  
0            29           29           0            1001                                                             1029                                                             29           0.0344827586206897  
0            91           91           0            1030                                                             1120                                                             91           0.010989010989011   
0            216          248          0            1                                                                1120                                                             216          0.00462962962962963 

7 rows fetched.

SQL> 
SQL> CREATE INDEX HZY_PSTATS1.HZY_PSTATS1_dml_range_indx_087 ON HZY_PSTATS1.STATS_INTERVAL_NEW(c_id, c_d_id,c_last) local;

Succeed.

SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1', 'STATS_INTERVAL_NEW', part_name=>NULL, sample_ratio => 100, method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select count(distinct col#)  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1');

COUNT(DISTINCT COL#)
--------------------
3                   

1 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 0 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
0            9            18           0            1                                                                9                                                                9            0.111111111111111   
0            10           26           0            10                                                               19                                                               10           0.1                 
0            10           16           0            20                                                               29                                                               10           0.1                 
0            67           68           0            30                                                               100                                                              67           0.0149253731343284  
0            29           29           0            1001                                                             1029                                                             29           0.0344827586206897  
0            91           91           0            1030                                                             1120                                                             91           0.010989010989011   
0            216          248          0            1                                                                1120                                                             216          0.00462962962962963 

7 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 1 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            9            18           0            1                                                                9                                                                9            0.111111111111111   
1            10           26           0            10                                                               19                                                               10           0.1                 
1            10           16           0            20                                                               29                                                               10           0.1                 
1            67           68           0            30                                                               100                                                              67           0.0149253731343284  
1            29           29           0            1001                                                             1029                                                             29           0.0344827586206897  
1            91           91           0            1030                                                             1120                                                             91           0.010989010989011   
1            216          248          0            1                                                                1120                                                             216          0.00462962962962963 

7 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 5 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
5            9            18           0            BAR1Bar1                                                         BAR9Bar9                                                         9            0.111111111111111   
5            10           26           0            BAR10Bar10                                                       BAR19Bar19                                                       10           0.1                 
5            10           16           0            BAR20Bar20                                                       BAR29Bar29                                                       10           0.1                 
5            67           68           0            BAR100Bar100                                                     BAR99Bar99                                                       67           0.0149253731343284  
5            29           29           0            BAR1001Bar1001                                                   BAR1029Bar1029                                                   29           0.0344827586206897  
5            91           91           0            BAR1030Bar1030                                                   BAR1120Bar1120                                                   91           0.010989010989011   
5            216          248          0            BAR1001Bar1001                                                   BAR9Bar9                                                         216          0.00462962962962963 

7 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 2 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 3 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> 
SQL> CREATE INDEX HZY_PSTATS1.HZY_PSTATS1_dml_range_indx_088 ON HZY_PSTATS1.STATS_INTERVAL_NEW(c_d_id,c_last) local;

Succeed.

SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1', 'STATS_INTERVAL_NEW', part_name=>NULL, sample_ratio => 100, method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select count(distinct col#)  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1');

COUNT(DISTINCT COL#)
--------------------
3                   

1 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 2 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 3 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> 
SQL> CREATE INDEX HZY_PSTATS1.HZY_PSTATS1_dml_range_indx_089 ON HZY_PSTATS1.STATS_INTERVAL_NEW(c_w_id, c_first);

Succeed.

SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1', 'STATS_INTERVAL_NEW', part_name=>NULL, sample_ratio => 100, method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select count(distinct col#)  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1');

COUNT(DISTINCT COL#)
--------------------
5                   

1 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 2 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
2            9            18           0            1                                                                9                                                                9            0.111111111111111   
2            10           26           0            10                                                               19                                                               10           0.1                 
2            10           16           0            20                                                               29                                                               10           0.1                 
2            67           68           0            30                                                               100                                                              67           0.0149253731343284  
2            29           29           0            1001                                                             1029                                                             29           0.0344827586206897  
2            91           91           0            1030                                                             1120                                                             91           0.010989010989011   
2            216          248          0            1                                                                1120                                                             216          0.00462962962962963 

7 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 3 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1')ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
3            9            18           0            is1cmRDs1                                                        is9cmRDs9                                                        9            0.111111111111111   
3            10           26           0            is10cmRDs10                                                      is19cmRDs19                                                      10           0.1                 
3            10           16           0            is20cmRDs20                                                      is29cmRDs29                                                      10           0.1                 
3            67           68           0            is100cmRDs100                                                    is99cmRDs99                                                      67           0.0149253731343284  
3            29           29           0            is1001cmRDs1001                                                  is1029cmRDs1029                                                  29           0.0344827586206897  
3            91           91           0            is1030cmRDs1030                                                  is1120cmRDs1120                                                  91           0.010989010989011   
3            216          248          0            is1001cmRDs1001                                                  is9cmRDs9                                                        216          0.00462962962962963 

7 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 4 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> 
SQL> CREATE INDEX HZY_PSTATS1.HZY_PSTATS1_dml_range_indx_090 ON HZY_PSTATS1.STATS_INTERVAL_NEW(c_d_id, c_w_id, c_last, c_middle);

Succeed.

SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1', 'STATS_INTERVAL_NEW', part_name=>NULL, sample_ratio => 100, method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select count(distinct col#)  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1');

COUNT(DISTINCT COL#)
--------------------
6                   

1 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 2 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
2            9            18           0            1                                                                9                                                                9            0.111111111111111   
2            10           26           0            10                                                               19                                                               10           0.1                 
2            10           16           0            20                                                               29                                                               10           0.1                 
2            67           68           0            30                                                               100                                                              67           0.0149253731343284  
2            29           29           0            1001                                                             1029                                                             29           0.0344827586206897  
2            91           91           0            1030                                                             1120                                                             91           0.010989010989011   
2            216          248          0            1                                                                1120                                                             216          0.00462962962962963 

7 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 3 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
3            9            18           0            is1cmRDs1                                                        is9cmRDs9                                                        9            0.111111111111111   
3            10           26           0            is10cmRDs10                                                      is19cmRDs19                                                      10           0.1                 
3            10           16           0            is20cmRDs20                                                      is29cmRDs29                                                      10           0.1                 
3            67           68           0            is100cmRDs100                                                    is99cmRDs99                                                      67           0.0149253731343284  
3            29           29           0            is1001cmRDs1001                                                  is1029cmRDs1029                                                  29           0.0344827586206897  
3            91           91           0            is1030cmRDs1030                                                  is1120cmRDs1120                                                  91           0.010989010989011   
3            216          248          0            is1001cmRDs1001                                                  is9cmRDs9                                                        216          0.00462962962962963 

7 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 4 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
4            1            18           0            OE                                                               OE                                                               1            1                   
4            1            26           0            OE                                                               OE                                                               1            1                   
4            1            16           0            OE                                                               OE                                                               1            1                   
4            1            68           0            OE                                                               OE                                                               1            1                   
4            1            29           0            OE                                                               OE                                                               1            1                   
4            1            91           0            OE                                                               OE                                                               1            1                   
4            1            248          0            OE                                                               OE                                                               1            1                   

7 rows fetched.

SQL> 
SQL> CREATE INDEX HZY_PSTATS1.HZY_PSTATS1_dml_range_indx_091 ON HZY_PSTATS1.STATS_INTERVAL_NEW(c_d_id, c_w_id, c_last);

Succeed.

SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1', 'STATS_INTERVAL_NEW', part_name=>NULL, sample_ratio => 100, method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select count(distinct col#)  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1');

COUNT(DISTINCT COL#)
--------------------
6                   

1 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 2 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
2            9            18           0            1                                                                9                                                                9            0.111111111111111   
2            10           26           0            10                                                               19                                                               10           0.1                 
2            10           16           0            20                                                               29                                                               10           0.1                 
2            67           68           0            30                                                               100                                                              67           0.0149253731343284  
2            29           29           0            1001                                                             1029                                                             29           0.0344827586206897  
2            91           91           0            1030                                                             1120                                                             91           0.010989010989011   
2            216          248          0            1                                                                1120                                                             216          0.00462962962962963 

7 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 3 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
3            9            18           0            is1cmRDs1                                                        is9cmRDs9                                                        9            0.111111111111111   
3            10           26           0            is10cmRDs10                                                      is19cmRDs19                                                      10           0.1                 
3            10           16           0            is20cmRDs20                                                      is29cmRDs29                                                      10           0.1                 
3            67           68           0            is100cmRDs100                                                    is99cmRDs99                                                      67           0.0149253731343284  
3            29           29           0            is1001cmRDs1001                                                  is1029cmRDs1029                                                  29           0.0344827586206897  
3            91           91           0            is1030cmRDs1030                                                  is1120cmRDs1120                                                  91           0.010989010989011   
3            216          248          0            is1001cmRDs1001                                                  is9cmRDs9                                                        216          0.00462962962962963 

7 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 4 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
4            1            18           0            OE                                                               OE                                                               1            1                   
4            1            26           0            OE                                                               OE                                                               1            1                   
4            1            16           0            OE                                                               OE                                                               1            1                   
4            1            68           0            OE                                                               OE                                                               1            1                   
4            1            29           0            OE                                                               OE                                                               1            1                   
4            1            91           0            OE                                                               OE                                                               1            1                   
4            1            248          0            OE                                                               OE                                                               1            1                   

7 rows fetched.

SQL> 
SQL> CREATE INDEX HZY_PSTATS1.HZY_PSTATS1_dml_range_indx_091 ON HZY_PSTATS1.STATS_INTERVAL_NEW(c_w_id, c_last);

CT-00753, The object index HZY_PSTATS1_DML_RANGE_INDX_091 already exists.
SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1', 'STATS_INTERVAL_NEW', part_name=>NULL, sample_ratio => 100, method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select count(distinct col#)  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1');

COUNT(DISTINCT COL#)
--------------------
6                   

1 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 2 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
2            9            18           0            1                                                                9                                                                9            0.111111111111111   
2            10           26           0            10                                                               19                                                               10           0.1                 
2            10           16           0            20                                                               29                                                               10           0.1                 
2            67           68           0            30                                                               100                                                              67           0.0149253731343284  
2            29           29           0            1001                                                             1029                                                             29           0.0344827586206897  
2            91           91           0            1030                                                             1120                                                             91           0.010989010989011   
2            216          248          0            1                                                                1120                                                             216          0.00462962962962963 

7 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 3 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
3            9            18           0            is1cmRDs1                                                        is9cmRDs9                                                        9            0.111111111111111   
3            10           26           0            is10cmRDs10                                                      is19cmRDs19                                                      10           0.1                 
3            10           16           0            is20cmRDs20                                                      is29cmRDs29                                                      10           0.1                 
3            67           68           0            is100cmRDs100                                                    is99cmRDs99                                                      67           0.0149253731343284  
3            29           29           0            is1001cmRDs1001                                                  is1029cmRDs1029                                                  29           0.0344827586206897  
3            91           91           0            is1030cmRDs1030                                                  is1120cmRDs1120                                                  91           0.010989010989011   
3            216          248          0            is1001cmRDs1001                                                  is9cmRDs9                                                        216          0.00462962962962963 

7 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 4 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
4            1            18           0            OE                                                               OE                                                               1            1                   
4            1            26           0            OE                                                               OE                                                               1            1                   
4            1            16           0            OE                                                               OE                                                               1            1                   
4            1            68           0            OE                                                               OE                                                               1            1                   
4            1            29           0            OE                                                               OE                                                               1            1                   
4            1            91           0            OE                                                               OE                                                               1            1                   
4            1            248          0            OE                                                               OE                                                               1            1                   

7 rows fetched.

SQL> 
SQL> exec DBE_STATS.DELETE_TABLE_STATS('HZY_PSTATS1', 'STATS_INTERVAL_NEW');

PL/SQL procedure successfully completed.

SQL> select count(distinct col#)  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1');

COUNT(DISTINCT COL#)
--------------------
0                   

1 rows fetched.

SQL> exec dbe_stats.collect_table_stats('HZY_PSTATS1', 'STATS_INTERVAL_NEW', part_name=>'PART_H1', sample_ratio => 100, method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select count(distinct col#)  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1');

COUNT(DISTINCT COL#)
--------------------
6                   

1 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 2 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
2            9            18           0            1                                                                9                                                                9            0.111111111111111   
2            216          248          0            1                                                                1120                                                             216          0.00462962962962963 

2 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 3 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
3            9            18           0            is1cmRDs1                                                        is9cmRDs9                                                        9            0.111111111111111   
3            216          248          0            is1001cmRDs1001                                                  is9cmRDs9                                                        216          0.00462962962962963 

2 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'STATS_INTERVAL_NEW') and col# = 4 and user# = (select id from SYS_USERS where name = 'HZY_PSTATS1') ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
4            1            18           0            OE                                                               OE                                                               1            1                   
4            1            248          0            OE                                                               OE                                                               1            1                   

2 rows fetched.

SQL> 
SQL> drop table if exists HZY_PSTATS1.STATS_INTERVAL_NEW;

Succeed.

SQL> drop user if exists HZY_PSTATS1 cascade;

Succeed.

SQL> 
SQL> drop table if exists hzy_dts;

Succeed.

SQL> create table hzy_dts(a int);

Succeed.

SQL> insert into hzy_dts values(1);

1 rows affected.

SQL> exec dbe_stats.collect_table_stats('SYS','HZY_DTS', null, 100);

PL/SQL procedure successfully completed.

SQL> exec DBE_STATS.DELETE_TABLE_STATS('SYS', 'HZY_DTS', 'PART_HZY1');

CT-00932, [1:2] PL/SQL(SYS.ANONYMOUS BLOCK) terminated with execute errors
[1:2] PL/SQL(DBE_STATS.DELETE_TABLE_STATS) terminated with execute errors
CT-00130, Operation delete partition statistics  is not supported on HZY_DTS

SQL> 
SQL> 
SQL> create tablespace spc1 datafile 'spc_1_file' size 32M autoextend on next 16M;

Succeed.

SQL> drop table if exists test;

Succeed.

SQL> create table test(a int, b int, c int) tablespace spc1;

Succeed.

SQL> 
SQL> insert into test values(1,1,1);

1 rows affected.

SQL> 
SQL> declare
  2 i int:=0;
  3 begin
  4   loop
  5     i:=i+1;
  6     insert into test select * from test;
  7 	exit when i= 16;
  8   end loop;
  9 end;
 10 /

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> create index idx_test on test(a, b, c);

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'TEST', NULL, 0);

PL/SQL procedure successfully completed.

SQL> select samplesize from SYS_TABLES where name = 'TEST' and SYS_TABLES.USER# = 0;

SAMPLESIZE  
------------
65536       

1 rows fetched.

SQL> select SYS_INDEXES.samplesize from SYS_INDEXES, SYS_TABLES where SYS_INDEXES.table# = SYS_TABLES.id and SYS_TABLES.name = 'TEST' and SYS_TABLES.USER# = 0;

SAMPLESIZE  
------------
65536       

1 rows fetched.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'TEST', NULL, 15);

PL/SQL procedure successfully completed.

SQL> drop tablespace spc1 including contents;

Succeed.

SQL> 
SQL> 
SQL> drop table if exists test_statistics_2;

Succeed.

SQL> create table test_statistics_2 (id int, name varchar(20));

Succeed.

SQL> insert into test_statistics_2 values(0, 'it is a long string');

1 rows affected.

SQL> insert into test_statistics_2 select id + 1, name from test_statistics_2;

1 rows affected.

SQL> insert into test_statistics_2 select id + 2, name from test_statistics_2;

2 rows affected.

SQL> insert into test_statistics_2 select id + 4, name from test_statistics_2;

4 rows affected.

SQL> insert into test_statistics_2 select id + 8, name from test_statistics_2;

8 rows affected.

SQL> insert into test_statistics_2 select id + 16, name from test_statistics_2;

16 rows affected.

SQL> insert into test_statistics_2 select id + 32, name from test_statistics_2;

32 rows affected.

SQL> insert into test_statistics_2 select id + 64, name from test_statistics_2;

64 rows affected.

SQL> insert into test_statistics_2 select id + 128, name from test_statistics_2;

128 rows affected.

SQL> insert into test_statistics_2 select id + 256, name from test_statistics_2;

256 rows affected.

SQL> insert into test_statistics_2 select id + 512, name from test_statistics_2;

512 rows affected.

SQL> insert into test_statistics_2 select id + 1024, name from test_statistics_2;

1024 rows affected.

SQL> insert into test_statistics_2 select id + 2048, name from test_statistics_2;

2048 rows affected.

SQL> insert into test_statistics_2 select id + 4096, name from test_statistics_2;

4096 rows affected.

SQL> insert into test_statistics_2 select id + 8192, name from test_statistics_2;

8192 rows affected.

SQL> insert into test_statistics_2 values(null, 'it is a long string');

1 rows affected.

SQL> insert into test_statistics_2 select * from test_statistics_2;

16385 rows affected.

SQL> commit;

Succeed.

SQL> analyze table test_statistics_2 compute statistics;

Succeed.

SQL> select count(distinct id) from test_statistics_2;

COUNT(DISTINCT ID)  
--------------------
16384               

1 rows fetched.

SQL> select NUM_DISTINCT, NUM_NULLS, HISTOGRAM from dba_tab_columns where TABLE_NAME = 'TEST_STATISTICS_2';

NUM_DISTINCT NUM_NULLS    HISTOGRAM                                                       
------------ ------------ ----------------------------------------------------------------
16384        2            HEIGHT BALANCED                                                 
1            0            FREQUENCY                                                       

2 rows fetched.

SQL> 
SQL> drop table if exists FVT_TABLE_ANALYSE_HYQ_001;

Succeed.

SQL> create or replace procedure FVT_PROC_ANALYSE_HYQ_001()
  2 is
  3 begin
  4     for i in 1..100 loop
  5         execute immediate 'insert into FVT_TABLE_ANALYSE_HYQ_001 values('||i*i||',
  6         ''*"%*%$3rfr'||i||'*656^5$34@%^&*()%'',to_date('''||(i+2015)||'-'||(i-i+1)||'-'||(i+10-i)||''',''yyyy-mm-dd''),
  7         '||(i+90-1.215784112-i*1)||','''||i||'@126.com'','||(i*i+57-i)||')';
  8     end loop;
  9     for i in 101..200 loop
 10        execute immediate 'insert into FVT_TABLE_ANALYSE_HYQ_001 values('''',''45'',to_date('''||(i+2015)||'-'||(i-i+5)||'-'||(i+15-i)||''',''yyyy-mm-dd''),'||(i*2.897654+i)||',''null'',null)';
 11     end loop;
 12     for i in 201..300 loop
 13         execute immediate 'insert into FVT_TABLE_ANALYSE_HYQ_001 values('||(-i)*i||','''',to_date('''||(i+2015)||'-'||(i-i+10)||'-'||(i+15-i)||''',''yyyy-mm-dd''),0,null,'||(i*i+57-i)||')';
 14     end loop;
 15     for i in 301..400 loop
 16     execute immediate 'insert into FVT_TABLE_ANALYSE_HYQ_001 values(0,null,to_date('''||2015||'-'||(i-i+2)||'-'||(i+20-i)||''',''yyyy-mm-dd''),'''',''%&*$iji@#4%^^&H'||i||'F$@WF'',0)';
 17         --null;
 18     end loop;
 19     for i in 401..500 loop
 20     execute immediate 'insert into FVT_TABLE_ANALYSE_HYQ_001 values('||i*i*i||',''null'',to_date(''2015-'||(i-i+1)||'-'||(i+10-i)||''',''yyyy-mm-dd''),'||(i+90.0987-1-i*1)||','''','||(i*i+57-i)||')';
 21     end loop;
 22 end;
 23 /

Succeed.

SQL> drop table if exists FVT_TABLE_ANALYSE_HYQ_001;

Succeed.

SQL> create table FVT_TABLE_ANALYSE_HYQ_001(
  2         c_id bigint,
  3         c_name varchar2(100),
  4         c_time date,
  5         c_num decimal(10,5),
  6         c_clob clob
  7         );

Succeed.

SQL> ALTER TABLE FVT_TABLE_ANALYSE_HYQ_001 ADD c_add INT;	

Succeed.

SQL> declare 
  2 begin 
  3 FVT_PROC_ANALYSE_HYQ_001(); 
  4 end;
  5 /

PL/SQL procedure successfully completed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'FVT_TABLE_ANALYSE_HYQ_001', part_name=>NULL,sample_ratio => 100,method_opt=>'for all columns');

PL/SQL procedure successfully completed.

SQL> select count(distinct c_id ),count(distinct c_name ),count(distinct c_time ),count(distinct c_num ),count(distinct c_add ) from FVT_TABLE_ANALYSE_HYQ_001;

COUNT(DISTINCT C_ID ) COUNT(DISTINCT C_NAME ) COUNT(DISTINCT C_TIME ) COUNT(DISTINCT C_NUM ) COUNT(DISTINCT C_ADD )
--------------------- ----------------------- ----------------------- ---------------------- ----------------------
301                   102                     302                     103                    301                   

1 rows fetched.

SQL> select t.name,hh.col#,hh.BUCKET_NUM,hh.ROW_NUM,hh.NULL_NUM,hh.MINVALUE,hh.MAXVALUE,hh.DIST_NUM from
  2 SYS_HISTGRAM_ABSTR hh,SYS_TABLES t where hh.tab#=t.id and t.name='FVT_TABLE_ANALYSE_HYQ_001' and hh.col# = 0;

NAME                                                             COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM    
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------
FVT_TABLE_ANALYSE_HYQ_001                                        0            254          500          100          -90000                                                           125000000                                                        301         

1 rows fetched.

SQL> select t.name,hh.col#,hh.BUCKET_NUM,hh.ROW_NUM,hh.NULL_NUM,hh.MINVALUE,hh.MAXVALUE,hh.DIST_NUM from
  2 SYS_HISTGRAM_ABSTR hh,SYS_TABLES t where hh.tab#=t.id and t.name='FVT_TABLE_ANALYSE_HYQ_001' and hh.col# = 1;

NAME                                                             COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM    
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------
FVT_TABLE_ANALYSE_HYQ_001                                        1            102          500          200          *"%*%$3rfr1*656^5$34@%^&*()%                                     null                                                             102         

1 rows fetched.

SQL> select t.name,hh.col#,hh.BUCKET_NUM,hh.ROW_NUM,hh.NULL_NUM,hh.MINVALUE,hh.MAXVALUE,hh.DIST_NUM from
  2 SYS_HISTGRAM_ABSTR hh,SYS_TABLES t where hh.tab#=t.id and t.name='FVT_TABLE_ANALYSE_HYQ_001' and hh.col# = 2;

NAME                                                             COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM    
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------
FVT_TABLE_ANALYSE_HYQ_001                                        2            254          500          0            2015-01-10 00:00:00                                              2315-10-15 00:00:00                                              302         

1 rows fetched.

SQL> select t.name,hh.col#,hh.BUCKET_NUM,hh.ROW_NUM,hh.NULL_NUM,hh.MINVALUE,hh.MAXVALUE,hh.DIST_NUM from
  2 SYS_HISTGRAM_ABSTR hh,SYS_TABLES t where hh.tab#=t.id and t.name='FVT_TABLE_ANALYSE_HYQ_001' and hh.col# = 3;

NAME                                                             COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM    
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------
FVT_TABLE_ANALYSE_HYQ_001                                        3            103          500          100          0                                                                779.5308                                                         103         

1 rows fetched.

SQL> select t.name,hh.col#,hh.BUCKET_NUM,hh.ROW_NUM,hh.NULL_NUM,hh.MINVALUE,hh.MAXVALUE,hh.DIST_NUM from
  2 SYS_HISTGRAM_ABSTR hh,SYS_TABLES t where hh.tab#=t.id and t.name='FVT_TABLE_ANALYSE_HYQ_001' and hh.col# = 4;

NAME                                                             COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM    
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------

0 rows fetched.

SQL> select count(*) from SYS_HISTGRAM,SYS_TABLES where SYS_TABLES.id=SYS_HISTGRAM.table# and SYS_TABLES.name='FVT_TABLE_ANALYSE_HYQ_001' and SYS_HISTGRAM.col# = 0;

COUNT(*)            
--------------------
254                 

1 rows fetched.

SQL> select count(*) from SYS_HISTGRAM,SYS_TABLES where SYS_TABLES.id=SYS_HISTGRAM.table# and SYS_TABLES.name='FVT_TABLE_ANALYSE_HYQ_001' and SYS_HISTGRAM.col# = 1;

COUNT(*)            
--------------------
102                 

1 rows fetched.

SQL> select count(*) from SYS_HISTGRAM,SYS_TABLES where SYS_TABLES.id=SYS_HISTGRAM.table# and SYS_TABLES.name='FVT_TABLE_ANALYSE_HYQ_001' and SYS_HISTGRAM.col# = 2;

COUNT(*)            
--------------------
254                 

1 rows fetched.

SQL> select count(*) from SYS_HISTGRAM,SYS_TABLES where SYS_TABLES.id=SYS_HISTGRAM.table# and SYS_TABLES.name='FVT_TABLE_ANALYSE_HYQ_001' and SYS_HISTGRAM.col# = 3;

COUNT(*)            
--------------------
103                 

1 rows fetched.

SQL> select count(*) from SYS_HISTGRAM,SYS_TABLES where SYS_TABLES.id=SYS_HISTGRAM.table# and SYS_TABLES.name='FVT_TABLE_ANALYSE_HYQ_001' and SYS_HISTGRAM.col# = 4;

COUNT(*)            
--------------------
0                   

1 rows fetched.

SQL> 
SQL> drop table if exists test_staffs_03;

Succeed.

SQL> CREATE TABLE test_staffs_03
  2 (
  3 staff_id NUMBER(6),
  4 first_name VARCHAR2(20),
  5 last_name VARCHAR2(25),
  6 email VARCHAR2(25),
  7 sex int
  8 )partition by range(staff_id)
  9 (partition p_050_before values less than (50),partition p_100 values less than (100),
 10 partition p_150 values less than (150),partition p_200 values less than (200),
 11 partition p_200_after values less than (maxvalue));

Succeed.

SQL> 
SQL> create or replace procedure insert_staff_03_01()
  2 is
  3 begin
  4 	for i in 1..99 loop
  5 		execute immediate 'insert into test_staffs_03 values('||i||',''john'','''||i||'king'','''||i||'@126.com'',1)';
  6 	end loop;
  7 	for i in 100..200 loop
  8 		execute immediate 'insert into test_staffs_03 values('||i||',''joe'','''||i||'queen'','''||i||'@126.com'',1)';
  9 	end loop;
 10 end;
 11 /

Succeed.

SQL> call insert_staff_03_01();

PL/SQL procedure successfully completed.

SQL> 
SQL> drop index if exists idx_staff_03_1 on test_staffs_03;

Succeed.

SQL> create index idx_staff_03_1 on test_staffs_03(to_char(staff_id));

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'TEST_STAFFS_03', part_name=>NULL,sample_ratio => 100,method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 0 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
0            49           49           0            1                                                                49                                                               49           0.0204081632653061  
0            50           50           0            50                                                               99                                                               50           0.02                
0            50           50           0            100                                                              149                                                              50           0.02                
0            50           50           0            150                                                              199                                                              50           0.02                
0            1            1            0            200                                                              200                                                              1            1                   
0            200          200          0            1                                                                200                                                              200          0.005               

6 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 1 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 2 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 3 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 4 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> 
SQL> drop index if exists idx_staff_03_2 on test_staffs_03;

Succeed.

SQL> create index idx_staff_03_2 on test_staffs_03(to_char(email));

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'TEST_STAFFS_03', part_name=>NULL,sample_ratio => 100,method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 0 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
0            49           49           0            1                                                                49                                                               49           0.0204081632653061  
0            50           50           0            50                                                               99                                                               50           0.02                
0            50           50           0            100                                                              149                                                              50           0.02                
0            50           50           0            150                                                              199                                                              50           0.02                
0            1            1            0            200                                                              200                                                              1            1                   
0            200          200          0            1                                                                200                                                              200          0.005               

6 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 1 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 2 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 3 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
3            49           49           0            10@126.com                                                       9@126.com                                                        49           0.0204081632653061  
3            50           50           0            50@126.com                                                       99@126.com                                                       50           0.02                
3            50           50           0            100@126.com                                                      149@126.com                                                      50           0.02                
3            50           50           0            150@126.com                                                      199@126.com                                                      50           0.02                
3            1            1            0            200@126.com                                                      200@126.com                                                      1            1                   
3            200          200          0            100@126.com                                                      9@126.com                                                        200          0.005               

6 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 4 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> 
SQL> drop index if exists idx_staff_03_3 on test_staffs_03;

Succeed.

SQL> create index idx_staff_03_3 on test_staffs_03(upper(first_name));

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'TEST_STAFFS_03', part_name=>NULL,sample_ratio => 100,method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 0 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
0            49           49           0            1                                                                49                                                               49           0.0204081632653061  
0            50           50           0            50                                                               99                                                               50           0.02                
0            50           50           0            100                                                              149                                                              50           0.02                
0            50           50           0            150                                                              199                                                              50           0.02                
0            1            1            0            200                                                              200                                                              1            1                   
0            200          200          0            1                                                                200                                                              200          0.005               

6 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 1 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            1            49           0            john                                                             john                                                             1            1                   
1            1            50           0            john                                                             john                                                             1            1                   
1            1            50           0            joe                                                              joe                                                              1            1                   
1            1            50           0            joe                                                              joe                                                              1            1                   
1            1            1            0            joe                                                              joe                                                              1            1                   
1            2            200          0            joe                                                              john                                                             2            0.5                 

6 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 2 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 3 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
3            49           49           0            10@126.com                                                       9@126.com                                                        49           0.0204081632653061  
3            50           50           0            50@126.com                                                       99@126.com                                                       50           0.02                
3            50           50           0            100@126.com                                                      149@126.com                                                      50           0.02                
3            50           50           0            150@126.com                                                      199@126.com                                                      50           0.02                
3            1            1            0            200@126.com                                                      200@126.com                                                      1            1                   
3            200          200          0            100@126.com                                                      9@126.com                                                        200          0.005               

6 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 4 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> 
SQL> drop index if exists idx_staff_03_4 on test_staffs_03;

Succeed.

SQL> create unique index idx_staff_03_4 on test_staffs_03(upper(last_name));

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'TEST_STAFFS_03', part_name=>NULL,sample_ratio => 100,method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 0 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
0            49           49           0            1                                                                49                                                               49           0.0204081632653061  
0            50           50           0            50                                                               99                                                               50           0.02                
0            50           50           0            100                                                              149                                                              50           0.02                
0            50           50           0            150                                                              199                                                              50           0.02                
0            1            1            0            200                                                              200                                                              1            1                   
0            200          200          0            1                                                                200                                                              200          0.005               

6 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 1 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
1            1            49           0            john                                                             john                                                             1            1                   
1            1            50           0            john                                                             john                                                             1            1                   
1            1            50           0            joe                                                              joe                                                              1            1                   
1            1            50           0            joe                                                              joe                                                              1            1                   
1            1            1            0            joe                                                              joe                                                              1            1                   
1            2            200          0            joe                                                              john                                                             2            0.5                 

6 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 2 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
2            49           49           0            10king                                                           9king                                                            49           0.0204081632653061  
2            50           50           0            50king                                                           99king                                                           50           0.02                
2            50           50           0            100queen                                                         149queen                                                         50           0.02                
2            50           50           0            150queen                                                         199queen                                                         50           0.02                
2            1            1            0            200queen                                                         200queen                                                         1            1                   
2            200          200          0            100queen                                                         9king                                                            200          0.005               

6 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 3 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
3            49           49           0            10@126.com                                                       9@126.com                                                        49           0.0204081632653061  
3            50           50           0            50@126.com                                                       99@126.com                                                       50           0.02                
3            50           50           0            100@126.com                                                      149@126.com                                                      50           0.02                
3            50           50           0            150@126.com                                                      199@126.com                                                      50           0.02                
3            1            1            0            200@126.com                                                      200@126.com                                                      1            1                   
3            200          200          0            100@126.com                                                      9@126.com                                                        200          0.005               

6 rows fetched.

SQL> select col#,BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY  from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'TEST_STAFFS_03') and col# = 4 ORDER BY SPARE1;

COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> 
SQL> analyze index idx_staff_03_1 on test_staffs_03 compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = upper('idx_staff_03_1');

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            200           0.005                   0.04                    0               0               0              

1 rows fetched.

SQL> analyze index idx_staff_03_2 on test_staffs_03 compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = upper('idx_staff_03_2');

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            200           0.005                   0.04                    0               0               0              

1 rows fetched.

SQL> analyze index idx_staff_03_3 on test_staffs_03 compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = upper('idx_staff_03_3');

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            2             0.5                     4                       0               0               0              

1 rows fetched.

SQL> analyze index idx_staff_03_4 on test_staffs_03 compute statistics;

Succeed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTINCT_KEYS,AVG_LEAF_BLOCKS_PER_KEY,AVG_DATA_BLOCKS_PER_KEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV from SYS_INDEXES where name = upper('idx_staff_03_4');

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV
------------ ------------ ------------- ----------------------- ----------------------- --------------- --------------- ---------------
1            1            200           0.005                   0.04                    0               0               0              

1 rows fetched.

SQL> 
SQL> drop table if exists stats_var;

Succeed.

SQL> create table stats_var(a varchar(8000));

Succeed.

SQL> insert into stats_var values(LPAD('12',1000,'1'));   

1 rows affected.

SQL> insert into stats_var values(LPAD('22',1000,'1'));

1 rows affected.

SQL> insert into stats_var values(LPAD('32',1000,'1'));

1 rows affected.

SQL> commit;

Succeed.

SQL> analyze table stats_var compute statistics; 

Succeed.

SQL> select bucket,endpoint from SYS_HISTGRAM,SYS_TABLES where SYS_TABLES.id=SYS_HISTGRAM.table# and SYS_TABLES.name=upper('stats_var') and SYS_HISTGRAM.col# = 0 
  2 order by endpoint;

BUCKET                                                           ENDPOINT    
---------------------------------------------------------------- ------------
1111111111111111111111111111111111111111111111111111111111111111 1           
1111111111111111111111111111111111111111111111111111111111111111 2           
1111111111111111111111111111111111111111111111111111111111111111 3           

3 rows fetched.

SQL> select count(distinct a) from stats_var;

COUNT(DISTINCT A)   
--------------------
3                   

1 rows fetched.

SQL> select a.column_name,a.num_distinct,a.num_buckets from DBA_TAB_COL_STATISTICS a where a.table_name=upper('stats_var');

COLUMN_NAME                                                      NUM_DISTINCT NUM_BUCKETS 
---------------------------------------------------------------- ------------ ------------
A                                                                3            3           

1 rows fetched.

SQL> insert into stats_var values(LPAD('12',8000,'1'));   

1 rows affected.

SQL> insert into stats_var values(LPAD('22',8000,'1'));

1 rows affected.

SQL> insert into stats_var values(LPAD('32',8000,'1'));

1 rows affected.

SQL> commit;

Succeed.

SQL> analyze table stats_var compute statistics;

Succeed.

SQL> select count(distinct a) from stats_var;

COUNT(DISTINCT A)   
--------------------
6                   

1 rows fetched.

SQL> select a.column_name,a.num_distinct,a.num_buckets from DBA_TAB_COL_STATISTICS a where a.table_name=upper('stats_var');

COLUMN_NAME                                                      NUM_DISTINCT NUM_BUCKETS 
---------------------------------------------------------------- ------------ ------------
A                                                                6            6           

1 rows fetched.

SQL> 
SQL> drop table if exists #stats_temp_table;

Succeed.

SQL> create temporary table #stats_temp_table(a int, b bigint, c varchar(10));

Succeed.

SQL> create index stats_temp_table_idx1 on #stats_temp_table(a);

Succeed.

SQL> create index stats_temp_table_idx2 on #stats_temp_table(a, b);

Succeed.

SQL> 
SQL> analyze index stats_temp_table_idx1 on #stats_temp_table compute statistics;

CT-00130, Operation analyze index is not supported on temp table's index
SQL> 
SQL> insert into #stats_temp_table values(1, 12345, '12345');

1 rows affected.

SQL> 
SQL> declare
  2 i int:=0;
  3 begin
  4   loop
  5     i:=i+1;
  6     insert into #stats_temp_table select * from #stats_temp_table;
  7 	exit when i= 15;
  8   end loop;
  9 end;
 10 /

PL/SQL procedure successfully completed.

SQL> 
SQL> analyze table #stats_temp_table compute statistics;

Succeed.

SQL> exec dbe_stats.collect_table_stats('sys', '#stats_temp_table', NULL, 10);

PL/SQL procedure successfully completed.

SQL> 
SQL> drop tablespace spc1 including contents;

CT-00780, The tablespace SPC1 does not exist.
SQL> create tablespace spc1 datafile 'spc_1_file' size 32M autoextend on next 16M;

Succeed.

SQL> drop table if exists test_statistics_2;

Succeed.

SQL> create table test_statistics_2 (id int, name varchar(20))tablespace spc1;

Succeed.

SQL> insert into test_statistics_2 values(0, 'it is a long string');

1 rows affected.

SQL> insert into test_statistics_2 select id + 1, name from test_statistics_2;

1 rows affected.

SQL> insert into test_statistics_2 select id + 2, name from test_statistics_2;

2 rows affected.

SQL> insert into test_statistics_2 select id + 4, name from test_statistics_2;

4 rows affected.

SQL> insert into test_statistics_2 select id + 8, name from test_statistics_2;

8 rows affected.

SQL> insert into test_statistics_2 select id + 16, name from test_statistics_2;

16 rows affected.

SQL> insert into test_statistics_2 select id + 32, name from test_statistics_2;

32 rows affected.

SQL> insert into test_statistics_2 select id + 64, name from test_statistics_2;

64 rows affected.

SQL> insert into test_statistics_2 select id + 120, name from test_statistics_2;

128 rows affected.

SQL> insert into test_statistics_2 select * from test_statistics_2;

256 rows affected.

SQL> insert into test_statistics_2 select * from test_statistics_2;

512 rows affected.

SQL> insert into test_statistics_2 select * from test_statistics_2;

1024 rows affected.

SQL> insert into test_statistics_2 select * from test_statistics_2;

2048 rows affected.

SQL> insert into test_statistics_2 select * from test_statistics_2;

4096 rows affected.

SQL> insert into test_statistics_2 select * from test_statistics_2;

8192 rows affected.

SQL> commit;

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'TEST_STATISTICS_2', part_name=>NULL,sample_ratio => 35,method_opt=>'for all columns');

PL/SQL procedure successfully completed.

SQL> drop tablespace spc1 including contents;

Succeed.

SQL> 
SQL> alter system set cbo=on;

Succeed.

SQL> alter system set LOCAL_TEMPORARY_TABLE_ENABLED=true;

Succeed.

SQL> drop table if exists FVT_STATISTICS_TAB_1;

Succeed.

SQL> drop table if exists #FVT_STATISTICS_TAB_2;

Succeed.

SQL> create table FVT_STATISTICS_TAB_1 
  2 (c_id number unique,
  3 c_sal number,
  4 c_name varchar2(64),
  5 c_time datetime,
  6 c_bol boolean
  7 );

Succeed.

SQL> create temporary table #FVT_STATISTICS_TAB_2
  2 (c_id number unique,
  3 c_int int,
  4 c_name varchar2(64),
  5 c_time datetime,
  6 c_bol boolean
  7 );

Succeed.

SQL> 
SQL> drop index if exists STATISTICS_IND_1 on FVT_STATISTICS_TAB_1;

Succeed.

SQL> drop index if exists STATISTICS_IND_2 on #FVT_STATISTICS_TAB_2;

Succeed.

SQL> create index STATISTICS_IND_1 on FVT_STATISTICS_TAB_1(c_sal);

Succeed.

SQL> create index STATISTICS_IND_2 on #FVT_STATISTICS_TAB_2(c_int);

Succeed.

SQL> 
SQL> 
SQL> insert into FVT_STATISTICS_TAB_1 values(1,'',null,'2019-01-17',false);

1 rows affected.

SQL> insert into FVT_STATISTICS_TAB_1 values(2,45,'sad@fds.13','2019-04-17',true);

1 rows affected.

SQL> insert into FVT_STATISTICS_TAB_1 values(3,60,'fsdaaaaadsafsdaffds','2019-05-17',null);

1 rows affected.

SQL> insert into FVT_STATISTICS_TAB_1 values(4,20,'','2019-05-17',false);

1 rows affected.

SQL> insert into FVT_STATISTICS_TAB_1 values(5,3.5,'Qds@#$dsa','',true);

1 rows affected.

SQL> insert into FVT_STATISTICS_TAB_1 values(null,-7,'xiaoming',null,'');

1 rows affected.

SQL> insert into FVT_STATISTICS_TAB_1 values(7,null,'a','2019-07-17',false);

1 rows affected.

SQL> insert into #FVT_STATISTICS_TAB_2 values(1,'',null,'2019-01-17',false);

1 rows affected.

SQL> insert into #FVT_STATISTICS_TAB_2 values(2,45,'sad@fds.13','2019-04-17',true);

1 rows affected.

SQL> insert into #FVT_STATISTICS_TAB_2 values(3,60,'fsdaaaaadsafsdaffds','2019-05-17',null);

1 rows affected.

SQL> select c_sal from FVT_STATISTICS_TAB_1 a,#FVT_STATISTICS_TAB_2 b where a.c_id=b.c_id;

C_SAL                                   
----------------------------------------
                                        
45                                      
60                                      

3 rows fetched.

SQL> 
SQL> select cols,indexes,partitioned,num_rows,empty_blocks,avg_row_len,samplesize from SYS_TABLES where name ='FVT_STATISTICS_TAB_1'order by 1,2,3,4;

COLS         INDEXES      PARTITIONED  NUM_ROWS     EMPTY_BLOCKS AVG_ROW_LEN          SAMPLESIZE  
------------ ------------ ------------ ------------ ------------ -------------------- ------------
5            2            0            7            0            32                   7           

1 rows fetched.

SQL> select a.histogram,a.precision,a.scale,a.num_distinct from SYS_COLUMNS a,SYS_TABLES b where b.name ='FVT_STATISTICS_TAB_1' and b.id=a.table# order by 1,2,3,4;

HISTOGRAM                                                        PRECISION    SCALE        NUM_DISTINCT
---------------------------------------------------------------- ------------ ------------ ------------
FREQUENCY                                                                                  5           
FREQUENCY                                                                                  6           
                                                                                                       
                                                                                                       
                                                                                                       

5 rows fetched.

SQL> select a.bucket_num,a.row_num,a.minvalue,a.maxvalue,a.dist_num from SYS_HISTGRAM_ABSTR a,SYS_TABLES b where a.tab#=b.id and b.name='FVT_STATISTICS_TAB_1'order by 1,2,3,4;

BUCKET_NUM   ROW_NUM      MINVALUE                                                         MAXVALUE                                                         DIST_NUM    
------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------
5            7            -7                                                               60                                                               5           
6            7            1                                                                7                                                                6           

2 rows fetched.

SQL> select a.bucket,a.endpoint,a.part# from SYS_HISTGRAM a,SYS_TABLES b where a.table#=b.id and b.name='FVT_STATISTICS_TAB_1'order by bucket;

BUCKET                                                           ENDPOINT     PART#       
---------------------------------------------------------------- ------------ ------------
-7                                                               1                        
1                                                                1                        
2                                                                2                        
20                                                               3                        
3                                                                3                        
3.5                                                              2                        
4                                                                4                        
45                                                               4                        
5                                                                5                        
60                                                               5                        
7                                                                6                        

11 rows fetched.

SQL> 
SQL> --建表
SQL> drop table if exists #FVT_OBJ_DEFINE_local_temp_table_002;

Succeed.

SQL> create TEMPORARY table #FVT_OBJ_DEFINE_local_temp_table_002(
  2 COL_1 bigint, COL_2 TIMESTAMP WITHOUT TIME ZONE, COL_3 bool,COL_4 decimal,COL_5 text ,COL_6 smallint ,COL_7 char(30),COL_8 double precision,COL_9 longtext,COL_10 character varying(30),
  3 COL_11 bool ,COL_12 bytea ,COL_13 real ,COL_14 numeric ,COL_15 blob ,COL_16 integer ,COL_17 int ,COL_18 TIMESTAMP WITH TIME ZONE ,COL_19 binary_integer ,COL_20 interval day to second ,
  4 COL_21 boolean, COL_22 nchar(30) ,COL_23 binary_bigint ,COL_24 nchar(100) ,COL_25 character(1000) , OL_26 text , COL_27 float ,COL_28 double ,COL_29 bigint ,COL_30  TIMESTAMP WITH LOCAL TIME ZONE ,
  5 COL_31 TIMESTAMP , COL_32 image ,COL_33 interval year to month, COL_34 character(30) ,COL_35 smallint ,COL_36 blob ,COL_37 char(300),COL_38 float ,COL_39 raw(100),COL_40 clob ,
  6 COL_41 binary_double ,COL_42 number(6,2) ,COL_43 decimal(6,2) ,COL_44 varchar2(50),COL_45 varchar(30) ,COL_46 nvarchar2(100), COL_47 numeric(12,6),COL_48 nvarchar(30),COL_49 date,COL_50 image ,
  7 COL_51 integer ,COL_52 binary_double ,COL_53 decimal(12,6),COL_54 raw(8000),COL_55 clob ,COL_56 varchar2(8000) ,COL_57 datetime ,COL_58 number(12,6),COL_59 nvarchar2(4000) ,COL_60 varbinary(2000) ,
  8 COL_61 binary(200) ,COL_62 datetime ,COL_63 binary(100) , COL_64 varchar(1000),COL_65 date
  9 
 10 );

Succeed.

SQL> 
SQL> --清空数据
SQL> truncate table #FVT_OBJ_DEFINE_local_temp_table_002;

Succeed.

SQL> 
SQL> --插入数据
SQL> insert into #FVT_OBJ_DEFINE_local_temp_table_002 values(
  2 32768,to_timestamp('2019-01-03 14:58:54.000000','YYYY-MM-DD HH24:MI:SS.FFFFFF'),true,3.1415926,lpad('abc','30','a@123&^%djgk'),987,'asjk&%$454',10011.456789445455,lpad('abc','50','a@123&^%djgk'),'字符串',
  3 false,'1001011',315454.1415926,99/4,'101101000111111101010',0,1,to_timestamp('2019-01-04 16:33:47.123456','YYYY-MM-DD HH24:MI:SS.FFFFFF'),'1',(INTERVAL '4 5:12:10.222' DAY TO SECOND(3)),
  4 0,rpad('abc','10','e'),353848,rpad('abc','10','exc'),lpad('abc','30','a@123&^%djgk'),lpad('abc','20','a@123&^%djgk'),9745.548,-99,3141.5,to_timestamp('2019-01-04 16:33:47.123456','YYYY-MM-DD HH24:MI:SS.FFFFFF'),
  5 to_timestamp('2019-01-03 14:58:54.000000','YYYY-MM-DD HH24:MI:SS.FFFFFF'),'a@123&^%djgk',(INTERVAL '12' YEAR),' ','0',lpad('10',50,'01010'),'这是一个字符串',1/2.15,'0FAADB9','a@123&^%djgk',
  6 1.0E+100,3.14,4445.25,rpad('abc','10','&'),lpad('abc','10','&'),'abc&GDsh',125563.141592,rpad('abc','10','e'),TIMESTAMPADD(DAY,52,'2019-01-03 14:14:12'),'a@123汉字&^%djgk',
  7 +2,-1.79E+100,98*0.99,'1010101001010','abca@123&^%djgk','abca@123&^%djgk',TIMESTAMPADD(SECOND,6,'2019-01-03 14:14:12'),25563.1415,'a字符串@123&^%djgk',lpad('10',20,'01010'),
  8 '1001010',TIMESTAMPADD(MONTH,20,'2019-01-03 14:14:12'),'010101111111100000000000000','abc&GDsh',TIMESTAMPADD(SECOND,9,'2019-01-03 15:19:00')
  9 );

1 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> --select复制数据,i的值可以修改
SQL> begin
  2         for i in 1..10 loop
  3         insert into #FVT_OBJ_DEFINE_local_temp_table_002 select * from #FVT_OBJ_DEFINE_local_temp_table_002;
  4     end loop;
  5 end;
  6 /

PL/SQL procedure successfully completed.

SQL> 
SQL> 
SQL> --创建索引
SQL> drop index if exists index_OBJ_DEFINE_001 on #FVT_OBJ_DEFINE_local_temp_table_002;

Succeed.

SQL> create index index_OBJ_DEFINE_001 on #FVT_OBJ_DEFINE_local_temp_table_002(COL_2,COL_7);

Succeed.

SQL> 
SQL> --创建视图
SQL> drop view if exists view_OBJ_DEFINE_001;

Succeed.

SQL> create view view_OBJ_DEFINE_001 as select COL_6,COL_45 from #FVT_OBJ_DEFINE_local_temp_table_002;

CT-00601, Sql syntax error: Prevent creating view of local temporary tables
SQL> 
SQL> --analyze
SQL> analyze table #FVT_OBJ_DEFINE_local_temp_table_002 COMPUTE STATISTICS;

Succeed.

SQL> 
SQL> create index index_OBJ_DEFINE_002 on #FVT_OBJ_DEFINE_local_temp_table_002(COL_1,COL_7);

Succeed.

SQL> analyze table #FVT_OBJ_DEFINE_local_temp_table_002 COMPUTE STATISTICS;

Succeed.

SQL> 
SQL> --- DTS2019051600545
SQL> drop user if exists STATS_INDEX_COL_004_Usr_01 cascade;

Succeed.

SQL> create user STATS_INDEX_COL_004_Usr_01 identified by Cantian_234;

Succeed.

SQL> grant dba to STATS_INDEX_COL_004_Usr_01;

Succeed.

SQL> GRANT SELECT ON SYS.SYS_TABLES TO STATS_INDEX_COL_004_Usr_01;

Succeed.

SQL> GRANT SELECT ON SYS.SYS_USERS TO STATS_INDEX_COL_004_Usr_01;

Succeed.

SQL> GRANT SELECT ON SYS.SYS_HISTGRAM_ABSTR TO STATS_INDEX_COL_004_Usr_01;

Succeed.

SQL> GRANT SELECT ON SYS.SYS_HISTGRAM TO STATS_INDEX_COL_004_Usr_01;

Succeed.

SQL> GRANT SELECT ON SYS.SYS_COLUMNS TO STATS_INDEX_COL_004_Usr_01;

Succeed.

SQL> conn STATS_INDEX_COL_004_Usr_01/Cantian_234@127.0.0.1:1611

connected.

SQL> drop table if exists STATS_INDEX_COL_004_Tab_01;

Succeed.

SQL> create table STATS_INDEX_COL_004_Tab_01(id int,name varchar(100),num number ,ctime datetime,c_clob clob);

Succeed.

SQL> drop index if exists STATS_INDEX_COL_004_Idx_01 on STATS_INDEX_COL_004_TAB_01;

Succeed.

SQL> drop index if exists STATS_INDEX_COL_004_Idx_02 on STATS_INDEX_COL_004_TAB_01;

Succeed.

SQL> create index STATS_INDEX_COL_004_Idx_01 on STATS_INDEX_COL_004_TAB_01(ctime);

Succeed.

SQL> create unique index STATS_INDEX_COL_004_Idx_02 on STATS_INDEX_COL_004_TAB_01(id,name,num,upper(name));

Succeed.

SQL> 
SQL> 
SQL> insert into STATS_INDEX_COL_004_Tab_01 values(1,'test_1',1000.11,to_date('2019-04-18 11:35:11'),'11111111111AAAA@!!@');

1 rows affected.

SQL> insert into STATS_INDEX_COL_004_Tab_01 values(2,'tes_1',100.11,to_date('2019-04-19 11:35:11'),'11111111111AAAA@!!@');

1 rows affected.

SQL> insert into STATS_INDEX_COL_004_Tab_01 values(10,'tst_1',10020.11,to_date('2019-04-10 11:35:11'),'11111111111AAAA@!!@');

1 rows affected.

SQL> insert into STATS_INDEX_COL_004_Tab_01 values(12,'est_1',200.11,to_date('2018-04-18 11:35:11'),'11111111111AAAA@!!@');

1 rows affected.

SQL> insert into STATS_INDEX_COL_004_Tab_01 values(17,'',80.11,to_date('2018-04-18 11:35:11'),'11111111111AAAA@!!@');

1 rows affected.

SQL> 
SQL> select NAME,COLS,INDEXES,NUM_ROWS,BLOCKS,EMPTY_BLOCKS,AVG_ROW_LEN,SAMPLESIZE from sys.SYS_TABLES where name = 'STATS_INDEX_COL_004_TAB_01';

NAME                                                             COLS         INDEXES      NUM_ROWS     BLOCKS       EMPTY_BLOCKS AVG_ROW_LEN          SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------ -------------------- ------------
STATS_INDEX_COL_004_TAB_01                                       5            2                                                                                    

1 rows fetched.

SQL> 
SQL> select t.name,hh.col#,hh.BUCKET_NUM,hh.ROW_NUM,hh.NULL_NUM,hh.MINVALUE,hh.MAXVALUE,hh.DIST_NUM,hh.DENSITY from sys.SYS_HISTGRAM_ABSTR hh,sys.SYS_USERS t3,sys.SYS_TABLES t
  2 where hh.tab#=t.id and hh.user# = t3.ID and t.name='STATS_INDEX_COL_004_TAB_01' and t3.NAME='STATS_INDEX_COL_004_USR_01' order by NAME, COL#;

NAME                                                             COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------

0 rows fetched.

SQL> select  COL# ,   BUCKET , ENDPOINT,PART# ,  EPVALUE from sys.SYS_HISTGRAM t1 ,sys.user_tables t2 ,sys.SYS_USERS t3
  2 where t1.TABLE# =t2.TABLE_ID and t1.user# = t3.ID and T2.TABLE_NAME='STATS_INDEX_COL_004_TAB_01' and t3.NAME='STATS_INDEX_COL_004_USR_01' order by COL# ,   BUCKET , ENDPOINT,PART# ,  EPVALUE;

COL#         BUCKET                                                           ENDPOINT     PART#        EPVALUE                                                         
------------ ---------------------------------------------------------------- ------------ ------------ ----------------------------------------------------------------

0 rows fetched.

SQL> 
SQL> select t1.NAME,DATATYPE,t1.BYTES,t1.PRECISION,t1.SCALE,t1.NULLABLE,t1.FLAGS,t1.DEFAULT_TEXT,t1.NUM_DISTINCT,t1.LOW_VALUE,t1.HIGH_VALUE,t1.HISTOGRAM from sys.SYS_COLUMNS t1 ,sys.user_tables t2 ,
  2 sys.SYS_USERS t3 where t1.TABLE# =t2.TABLE_ID and t1.user# = t3.ID and T2.TABLE_NAME='STATS_INDEX_COL_004_TAB_01' and t3.NAME='STATS_INDEX_COL_004_USR_01' order by t1.NAME,DATATYPE,t1.BYTES,t1.PRECISION,t1.SCALE,t1.NULLABLE,t1.FLAGS,t1.DEFAULT_TEXT,t1.NUM_DISTINCT,t1.LOW_VALUE,t1.HIGH_VALUE,t1.HISTOGRAM;

NAME                                                             DATATYPE     BYTES        PRECISION    SCALE        NULLABLE     FLAGS        DEFAULT_TEXT                                                     NUM_DISTINCT LOW_VALUE                                                        HIGH_VALUE                                                       HISTOGRAM                                                       
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------ ------------ ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
CTIME                                                            20006        8                                      1            0                                                                                                                                                                                                                                                                                            
C_CLOB                                                           20013        8000                                   1            0                                                                                                                                                                                                                                                                                            
ID                                                               20001        4                                      1            0                                                                                                                                                                                                                                                                                            
NAME                                                             20009        100                                    1            0                                                                                                                                                                                                                                                                                            
NUM                                                              20004        24                                     1            0                                                                                                                                                                                                                                                                                            
SYS_NC60000$_1                                                   20010        100                                    1            65           upper(name)                                                                                                                                                                                                                                                                     

6 rows fetched.

SQL> 
SQL> exec dbe_stats.collect_table_stats(schema=>'STATS_INDEX_COL_004_Usr_01',name=>'STATS_INDEX_COL_004_Tab_01',sample_ratio => 50,method_opt=>' for   all indexed columns',part_name=>NULL);

PL/SQL procedure successfully completed.

SQL> 
SQL> select NAME,COLS,INDEXES,NUM_ROWS,BLOCKS,EMPTY_BLOCKS,AVG_ROW_LEN,SAMPLESIZE from sys.SYS_TABLES where name = 'STATS_INDEX_COL_004_TAB_01';

NAME                                                             COLS         INDEXES      NUM_ROWS     BLOCKS       EMPTY_BLOCKS AVG_ROW_LEN          SAMPLESIZE  
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ------------ -------------------- ------------
STATS_INDEX_COL_004_TAB_01                                       5            2            5            1            0            70                   5           

1 rows fetched.

SQL> select t.name,hh.col#,hh.BUCKET_NUM,hh.ROW_NUM,hh.NULL_NUM,hh.MINVALUE,hh.MAXVALUE,hh.DIST_NUM,hh.DENSITY from sys.SYS_HISTGRAM_ABSTR hh,sys.SYS_USERS t3,sys.SYS_TABLES t
  2 where hh.tab#=t.id and hh.user# = t3.ID and t.name='STATS_INDEX_COL_004_TAB_01' and t3.NAME='STATS_INDEX_COL_004_USR_01' order by NAME, COL#;

NAME                                                             COL#         BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY             
---------------------------------------------------------------- ------------ ------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ --------------------
STATS_INDEX_COL_004_TAB_01                                       0            5            5            0            1                                                                17                                                               5            0.2                 
STATS_INDEX_COL_004_TAB_01                                       1            4            5            1            est_1                                                            tst_1                                                            4            0.25                
STATS_INDEX_COL_004_TAB_01                                       2            5            5            0            80.11                                                            10020.11                                                         5            0.2                 
STATS_INDEX_COL_004_TAB_01                                       3            4            5            0            2018-04-18 11:35:11                                              2019-04-19 11:35:11                                              4            0.25                

4 rows fetched.

SQL> select  COL# ,   BUCKET , ENDPOINT,PART# ,  EPVALUE from sys.SYS_HISTGRAM t1 ,sys.user_tables t2 ,sys.SYS_USERS t3
  2 where t1.TABLE# =t2.TABLE_ID and t1.user# = t3.ID and T2.TABLE_NAME='STATS_INDEX_COL_004_TAB_01' and t3.NAME='STATS_INDEX_COL_004_USR_01' order by COL# ,   BUCKET , ENDPOINT,PART# ,  EPVALUE;

COL#         BUCKET                                                           ENDPOINT     PART#        EPVALUE                                                         
------------ ---------------------------------------------------------------- ------------ ------------ ----------------------------------------------------------------
0            1                                                                1                                                                                         
0            10                                                               3                                                                                         
0            12                                                               4                                                                                         
0            17                                                               5                                                                                         
0            2                                                                2                                                                                         
1            est_1                                                            1                                                                                         
1            tes_1                                                            2                                                                                         
1            test_1                                                           3                                                                                         
1            tst_1                                                            4                                                                                         
2            100.11                                                           2                                                                                         
2            1000.11                                                          4                                                                                         
2            10020.11                                                         5                                                                                         
2            200.11                                                           3                                                                                         
2            80.11                                                            1                                                                                         
3            2018-04-18 11:35:11                                              2                                                                                         
3            2019-04-10 11:35:11                                              3                                                                                         
3            2019-04-18 11:35:11                                              4                                                                                         
3            2019-04-19 11:35:11                                              5                                                                                         

18 rows fetched.

SQL> 
SQL> drop table if exists STATS_SPC_HASH1;

Succeed.

SQL> drop tablespace spc_hzystats9 including contents and datafiles;

CT-00780, The tablespace SPC_HZYSTATS9 does not exist.
SQL> CREATE TABLESPACE spc_hzystats9 datafile 'hzy_stats_part9' size 32M;

Succeed.

SQL> drop table if exists STATS_SPC_HASH1;

Succeed.

SQL> 
SQL> create table STATS_SPC_HASH1 (
  2 c3 char(20) primary key,
  3 c4 number(8) not null
  4 )tablespace spc_hzystats9;

Succeed.

SQL> 
SQL> insert into STATS_SPC_HASH1 values('aaaa',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('bbbb',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('cccc',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('dddd',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('eeee',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('ffff',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('hhhh',111);

1 rows affected.

SQL> insert into STATS_SPC_HASH1 values('iiii',111);

1 rows affected.

SQL> commit;

Succeed.

SQL> exec dbe_stats.collect_table_stats('STATS_INDEX_COL_004_Usr_01', 'STATS_SPC_HASH1',null,10);

PL/SQL procedure successfully completed.

SQL> select num_rows from sys.SYS_TABLES where name = 'STATS_SPC_HASH1';

NUM_ROWS    
------------
8           

1 rows fetched.

SQL> exec dbe_stats.collect_table_stats('STATS_INDEX_COL_004_Usr_01', 'STATS_SPC_HASH1',null,30);

PL/SQL procedure successfully completed.

SQL> select num_rows from sys.SYS_TABLES where name = 'STATS_SPC_HASH1';

NUM_ROWS    
------------
8           

1 rows fetched.

SQL> exec dbe_stats.collect_table_stats('STATS_INDEX_COL_004_Usr_01', 'STATS_SPC_HASH1',null,90);

PL/SQL procedure successfully completed.

SQL> drop table if exists STATS_SPC_HASH1;

Succeed.

SQL> drop tablespace spc_hzystats9 including contents and datafiles;

Succeed.

SQL> --test sql reparse
SQL> drop table if exists H_ANR_U2L_SRB_STATUS_TMP_5;

Succeed.

SQL> drop table if exists H_ANR_U2L_SRB_STATUS_5;

Succeed.

SQL> create table H_ANR_U2L_SRB_STATUS_TMP_5(CREATETIME int, CGI VARCHAR(32) not null, SUBRESULT  varchar(1));

Succeed.

SQL> create table H_ANR_U2L_SRB_STATUS_5(CREATETIME int, CGI VARCHAR(32) not null, SUBRESULT  varchar(1));

Succeed.

SQL> 
SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33301-101',1562205029,'Y');        

1 rows affected.

SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33301-102',1562205029,'Y');        

1 rows affected.

SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33301-103',1562205029,'Y');        

1 rows affected.

SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33301-104',1562205029,'Y');        

1 rows affected.

SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33301-105',1562205029,'Y');        

1 rows affected.

SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33301-106',1562205029,'Y');        

1 rows affected.

SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33302-107',1562205029,'Y');        

1 rows affected.

SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33302-108',1562205029,'Y');        

1 rows affected.

SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33302-109',1562205029,'Y');        

1 rows affected.

SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33302-110',1562205029,'Y');        

1 rows affected.

SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33302-111',1562205029,'Y');        

1 rows affected.

SQL> insert into H_ANR_U2L_SRB_STATUS_5(CGI,CREATETIME,SUBRESULT)values('301-55-33302-112',1562205029,'Y'); 

1 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> create or replace procedure SP_TEMP_PROC 
  2 (
  3     v_in_OptiExecutePeriod in number ,
  4     v_in_OptiStatisticPeriod in number ,
  5     v_in_TaskStartTime in number ,
  6     v_in_StatEndTime in number ,
  7     v_in_AnrSecPerUnit in number  default 3600 )
  8 as 
  9 begin
 10 
 11     begin dbe_stats.collect_table_stats (schema=>user, name=>'H_ANR_U2L_SRB_STATUS_5'); end;
 12     insert into H_ANR_U2L_SRB_STATUS_TMP_5 (CREATETIME,SUBRESULT)
 13         select  floor(trunc((CREATETIME - v_in_TaskStartTime) / (v_in_OptiExecutePeriod * v_in_AnrSecPerUnit))),   
 14         count( 1 ) from H_ANR_U2L_SRB_STATUS_5 where CREATETIME between v_in_StatEndTime and v_in_StatEndTime and SUBRESULT = 
 15 'Y' group by  floor(trunc((CREATETIME - v_in_TaskStartTime) / (v_in_OptiExecutePeriod * v_in_AnrSecPerUnit)));          
 16 begin dbe_stats.collect_table_stats (schema=>user, name=>'H_ANR_U2L_SRB_STATUS_5'); end;
 17 	rollback;
 18 end;
 19 /

Succeed.
Warning:
PL/SQL(STATS_INDEX_COL_004_USR_01.SP_TEMP_PROC) terminated with compiling errors
[13:22] PLC-00609 Expression not in group list


SQL> exec SP_TEMP_PROC(1,1,1,9,1);

CT-00944, PL/SQL(STATS_INDEX_COL_004_USR_01.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00944 PL/SQL(STATS_INDEX_COL_004_USR_01.SP_TEMP_PROC) terminated with compiling errors
[12:22] PLC-00609 Expression not in group list


SQL> create or replace procedure SP_TEMP_PROC 
  2 (
  3     v_in_OptiExecutePeriod in number ,
  4     v_in_OptiStatisticPeriod in number ,
  5     v_in_TaskStartTime in number ,
  6     v_in_StatEndTime in number ,
  7     v_in_AnrSecPerUnit in number  default 3600 )
  8 as 
  9 begin
 10 
 11     begin dbe_stats.collect_table_stats (schema=>user, name=>'H_ANR_U2L_SRB_STATUS_5'); end;
 12 
 13     execute immediate 'insert into H_ANR_U2L_SRB_STATUS_TMP_5 (CREATETIME,SUBRESULT)
 14         select  floor(trunc((CREATETIME - :1) / (:2 * :3))),   
 15         count( 1 ) from H_ANR_U2L_SRB_STATUS_5 where CREATETIME between :4 and :5 and SUBRESULT = 
 16 ''Y'' group by  floor(trunc((CREATETIME -  :6) / (:7 * :8)))' using v_in_TaskStartTime, v_in_OptiExecutePeriod, v_in_AnrSecPerUnit, v_in_StatEndTime, v_in_StatEndTime, v_in_TaskStartTime, v_in_OptiExecutePeriod, v_in_AnrSecPerUnit;
 17 	rollback;
 18 end;
 19 /

Succeed.

SQL> 
SQL> exec SP_TEMP_PROC(1,1,1,9,1);

CT-00932, [1:2] PL/SQL(STATS_INDEX_COL_004_USR_01.ANONYMOUS BLOCK) terminated with execute errors
[12:5] PL/SQL(STATS_INDEX_COL_004_USR_01.SP_TEMP_PROC) terminated with execute errors
[2:30] CT-00609, Expression not in group list

SQL> 
SQL> create or replace procedure SP_TEMP_PROC 
  2 (
  3     v_in_OptiExecutePeriod in number ,
  4     v_in_OptiStatisticPeriod in number ,
  5     v_in_TaskStartTime in number ,
  6     v_in_StatEndTime in number ,
  7     v_in_AnrSecPerUnit in number  default 3600 )
  8 as 
  9 begin
 10 
 11     begin dbe_stats.collect_table_stats (schema=>user, name=>'H_ANR_U2L_SRB_STATUS_5'); end;
 12 
 13     execute immediate 'begin insert into H_ANR_U2L_SRB_STATUS_TMP_5 (CREATETIME,SUBRESULT)
 14         select  floor(trunc((CREATETIME - :1) / (:2 * :3))),   
 15         count( 1 ) from H_ANR_U2L_SRB_STATUS_5 where CREATETIME between :4 and :4 and SUBRESULT = 
 16 ''Y'' group by  floor(trunc((CREATETIME - :1) / (:2 * :3))); end;' using v_in_TaskStartTime, v_in_OptiExecutePeriod, v_in_AnrSecPerUnit, v_in_StatEndTime;
 17 	rollback;
 18 end;
 19 /

Succeed.

SQL> exec SP_TEMP_PROC(1,1,1,9,1);

CT-00932, [1:2] PL/SQL(STATS_INDEX_COL_004_USR_01.ANONYMOUS BLOCK) terminated with execute errors
[12:5] PL/SQL(STATS_INDEX_COL_004_USR_01.SP_TEMP_PROC) terminated with execute errors
[12:5] CT-00944, PL/SQL(STATS_INDEX_COL_004_USR_01.ANONYMOUS BLOCK) terminated with compiling errors
[2:22] PLC-00609 Expression not in group list


SQL> 
SQL> conn sys/Huawei@123@127.0.0.1:1611

connected.

SQL> drop table if exists hzy_llt_opt;

Succeed.

SQL> create table hzy_llt_opt(a int)
  2 partition by range(A)
  3 interval(258)
  4 (
  5    partition PART_H1 values less than (100),
  6    partition PART_H2 values less than (359),
  7    partition PART_H3 values less than (659)
  8 );

Succeed.

SQL> create index hzy_lklt_idx on hzy_llt_opt(a) local;

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'hzy_llt_opt', part_name=>'PART_H1',sample_ratio => 100,method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> exec DBE_STATS.PURGE_STATS(sysdate);

PL/SQL procedure successfully completed.

SQL> 
SQL> drop table if exists hzy_llt_opt1;

Succeed.

SQL> create table hzy_llt_opt1(a int)
  2 partition by range(A)
  3 interval(258)
  4 (
  5    partition PART_H1 values less than (100),
  6    partition PART_H2 values less than (359),
  7    partition PART_H3 values less than (659)
  8 );

Succeed.

SQL> create index hzy_lklt_idx1 on hzy_llt_opt1(a) local;

Succeed.

SQL> insert into hzy_llt_opt1 values(350);

1 rows affected.

SQL> insert into hzy_llt_opt1 values(600);

1 rows affected.

SQL> exec dbe_stats.collect_table_stats('SYS', 'hzy_llt_opt1', part_name=>NULL,sample_ratio => 100,method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select BLEVEL,LEVEL_BLOCKS,DISTKEY,LBLKKEY,DBLKKEY,COMB_COLS_2_NDV,COMB_COLS_3_NDV,COMB_COLS_4_NDV,samplesize from SYS_INDEX_PARTS where table# = (select id from SYS_TABLES where name = 'HZY_LLT_OPT1') and USER# = 0 order by PART#;

BLEVEL       LEVEL_BLOCKS DISTKEY      LBLKKEY              DBLKKEY              COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV SAMPLESIZE  
------------ ------------ ------------ -------------------- -------------------- --------------- --------------- --------------- ------------
0            0            0            0                    0                    0               0               0               0           
1            1            1            1                    8                    0               0               0               1           
1            1            1            1                    8                    0               0               0               1           

3 rows fetched.

SQL> 
SQL> 
SQL> alter system set local_temporary_table_enabled=true;

Succeed.

SQL> drop table if exists tbl_EventBuffer;

Succeed.

SQL> create table tbl_EventBuffer( Serial int,SerialContext int,TS int,EventID int,SenderProcID int,SenderProcHandle int);

Succeed.

SQL> insert into tbl_EventBuffer values(3,5,7,4,3,1);

1 rows affected.

SQL> drop table if exists tbl_ReceivedEvent;

Succeed.

SQL> create table tbl_ReceivedEvent(Serial int,RecvProcID int,RecvProcHandle int,RecvTaskMgrID int,v_newSerial int);

Succeed.

SQL> drop table if exists tbl_SubscribEvent;

Succeed.

SQL> create table tbl_SubscribEvent(EventID int,RecvProcID int,RecvProcHandle int,RecvTaskMgrID int,EventState int,EventType int);

Succeed.

SQL> drop table if exists tbl_SubscribEventBak;

Succeed.

SQL> create table tbl_SubscribEventBak(RecvProcID int,RecvProcHandle int,RecvTaskMgrID int,EventID int,EventState int,EventType int);

Succeed.

SQL> drop table if exists tbl_EventBufferContextData;

Succeed.

SQL> create table tbl_EventBufferContextData(Serial int,FirstPacketSN int);

Succeed.

SQL> drop sequence if exists YF_SEQ;

Succeed.

SQL> create sequence YF_SEQ start with 1 increment by 1;

Succeed.

SQL> 
SQL> 
SQL> create or replace procedure sp_ClearEventByRate(v_freeRate IN real,SWP_Ret_Value IN OUT NUMBER) as
  2    v_serial  NUMBER(18,0);
  3    v_newSerial  NUMBER(18,0);
  4 BEGIN
  5         execute immediate 'DROP TABLE if exists #tt_TMP_TBL_SUBSCRIBE';
  6 
  7 execute immediate 'CREATE TEMPORARY TABLE #tt_TMP_TBL_SUBSCRIBE
  8 (
  9    EventID         NUMBER(10,0) NOT NULL,
 10    RecvProcID  NUMBER(10,0) NOT NULL,
 11    RecvProcHandle  NUMBER(10,0) DEFAULT 0 NOT NULL,
 12    RecvTaskMgrID NUMBER(5,0),
 13    EventState      NUMBER(10,0) DEFAULT 0,
 14    EventType       NUMBER(5,0) DEFAULT 0 NOT NULL,
 15    primary key
 16 (EventID,
 17    RecvProcID,
 18    RecvProcHandle)
 19 )on commit preserve rows';
 20 
 21    if v_freeRate < 0.2 then
 22                 execute immediate 'drop table if exists #tt_TBL_SERIALTMP';
 23       execute immediate 'create TEMPORARY table #tt_TBL_SERIALTMP as SELECT  Serial,SerialContext from tbl_EventBuffer  where rownum<=5000  order by TS ';
 24       execute immediate 'select   max(Serial) from #tt_TBL_SERIALTMP' INTO v_serial ;
 25       execute immediate 'insert into tbl_EventBuffer(EventID, SenderProcID, SenderProcHandle, SerialContext) values(69662, 0, 0, 0)';
 26           select yf_seq.nextval into v_newSerial from dual;
 27       select yf_seq.currval into v_newSerial from dual;
 28       execute immediate 'insert into tbl_ReceivedEvent(Serial,RecvProcID,RecvProcHandle,RecvTaskMgrID) (select distinct '|| v_newSerial||', RecvProcID, RecvProcHandle, RecvTaskMgrID from tbl_ReceivedEvent where Serial <= '||v_serial||')';
 29 
 30       execute immediate 'insert into #tt_TMP_TBL_SUBSCRIBE(EventID,RecvProcID,RecvProcHandle,RecvTaskMgrID,EventState,EventType)(select distinct tbl_SubscribEvent.EventID,tbl_SubscribEvent.RecvProcID,tbl_SubscribEvent.RecvProcHandle,tbl_SubscribEvent.RecvTaskMgrID,tbl_SubscribEvent.EventState,tbl_SubscribEvent.EventType
 31          from tbl_SubscribEvent,tbl_ReceivedEvent
 32          where tbl_SubscribEvent.RecvProcID = tbl_ReceivedEvent.RecvProcID
 33          and tbl_SubscribEvent.RecvProcHandle = tbl_ReceivedEvent.RecvProcHandle
 34          and tbl_SubscribEvent.RecvTaskMgrID = tbl_ReceivedEvent.RecvTaskMgrID
 35          and tbl_ReceivedEvent.Serial in(select Serial from #tt_TBL_SERIALTMP))';
 36       execute immediate 'DELETE FROM tbl_SubscribEventBak WHERE ROWID IN(SELECT tbl_SubscribEventBak.ROWID from tbl_SubscribEventBak,#tt_TMP_TBL_SUBSCRIBE #tt_TMP_TBL_SUBSCRIBE where tbl_SubscribEventBak.RecvProcID = #tt_TMP_TBL_SUBSCRIBE.RecvProcID
 37       and tbl_SubscribEventBak.RecvProcHandle = #tt_TMP_TBL_SUBSCRIBE.RecvProcHandle
 38       and tbl_SubscribEventBak.RecvTaskMgrID = #tt_TMP_TBL_SUBSCRIBE.RecvTaskMgrID
 39       and tbl_SubscribEventBak.EventID = #tt_TMP_TBL_SUBSCRIBE.EventID)';
 40       execute immediate 'insert into tbl_SubscribEventBak(EventID,RecvProcID,RecvProcHandle,RecvTaskMgrID,EventState,EventType)(select distinct EventID,RecvProcID,RecvProcHandle,RecvTaskMgrID,EventState,EventType from #tt_TMP_TBL_SUBSCRIBE)';
 41       execute immediate 'DELETE FROM tbl_SubscribEvent WHERE ROWID IN(SELECT tbl_SubscribEvent.ROWID from tbl_SubscribEvent,#tt_TMP_TBL_SUBSCRIBE #tt_TMP_TBL_SUBSCRIBE where tbl_SubscribEvent.RecvProcID = #tt_TMP_TBL_SUBSCRIBE.RecvProcID
 42       and tbl_SubscribEvent.RecvProcHandle = #tt_TMP_TBL_SUBSCRIBE.RecvProcHandle
 43       and tbl_SubscribEvent.RecvTaskMgrID = #tt_TMP_TBL_SUBSCRIBE.RecvTaskMgrID
 44       and tbl_SubscribEvent.EventID = #tt_TMP_TBL_SUBSCRIBE.EventID)';
 45       EXECUTE IMMEDIATE ' TRUNCATE TABLE #tt_TMP_TBL_SUBSCRIBE ';
 46           execute immediate 'drop table #tt_TMP_TBL_SUBSCRIBE';
 47       execute immediate 'delete from tbl_EventBufferContextData where Serial in(select SerialContext from #tt_TBL_SERIALTMP)
 48       or FirstPacketSN in(select SerialContext from #tt_TBL_SERIALTMP)';
 49       execute immediate 'delete from tbl_EventBuffer where Serial in(select Serial from #tt_TBL_SERIALTMP)';
 50       execute immediate 'delete from tbl_ReceivedEvent where Serial in(select Serial from #tt_TBL_SERIALTMP)';
 51 
 52           execute immediate 'drop table if exists #tt_TBL_SERIALTMP';
 53       SWP_Ret_Value := 1;
 54       RETURN;
 55    end if;
 56    execute immediate 'drop table if exists #tt_TMP_TBL_SUBSCRIBE';
 57    SWP_Ret_Value := 0;
 58    RETURN;
 59 
 60 commit;
 61 end;
 62 /

Succeed.

SQL> declare
  2 a int;
  3 begin
  4 sp_ClearEventByRate(0,a);
  5 end;
  6 /

PL/SQL procedure successfully completed.

SQL> 
SQL> alter system set LOCAL_TEMPORARY_TABLE_ENABLED=true;

Succeed.

SQL> drop table if exists #fvt_table_job_012;

Succeed.

SQL> create TEMPORARY table #fvt_table_job_012(
  2 		c_id bigint,
  3 		c_clob blob,
  4 		c_time date,
  5 		c_num number(20,5),
  6 		c_name char(100),
  7 		c_boolean boolean
  8 		);

Succeed.

SQL> create or replace procedure fvt_proc_job_012()
  2 is
  3 begin
  4 	for i in 1..10000 loop
  5         execute immediate 'insert into #fvt_table_job_012 values('||i||',
  6 		''123'',to_date(''2015-5-5'',''yyyy-mm-dd''),
  7 		'||i||',''@126.com'',''true'')';
  8     end loop;
  9 end;
 10 /

Succeed.

SQL> call fvt_proc_job_012;

PL/SQL procedure successfully completed.

SQL> drop index if exists study_id_012 on #fvt_table_job_012;

Succeed.

SQL> create unique index study_id_012 on #fvt_table_job_012(c_id);

Succeed.

SQL> drop index if exists study_id1_012 on #fvt_table_job_012;

Succeed.

SQL> create unique index study_id1_012 on #fvt_table_job_012(c_id,c_num,c_name);

Succeed.

SQL> drop index if exists study_id2_012 ON #fvt_table_job_012;

Succeed.

SQL> CREATE INDEX study_id2_012 ON #fvt_table_job_012(upper(c_name));

CT-00130, Operation create function index is not supported on local temp table
SQL> drop index if exists study_id3_012 ON #fvt_table_job_012;

Succeed.

SQL> CREATE INDEX study_id3_012 ON #fvt_table_job_012(upper(c_id));

CT-00130, Operation create function index is not supported on local temp table
SQL> 
SQL> 
SQL> ANALYZE TABLE #fvt_table_job_012 COMPUTE STATISTICS;

Succeed.

SQL> 
SQL> drop table if exists tongep_temp_table_analyze_error;

Succeed.

SQL> create global temporary table tongep_temp_table_analyze_error(a int);

Succeed.

SQL> create index tongep_idx_temp on tongep_temp_table_analyze_error(a);

Succeed.

SQL> analyze index tongep_idx_temp on tongep_temp_table_analyze_error compute statistics;

CT-00130, Operation analyze index is not supported on temp table's index
SQL> drop table if exists tongep_temp_table_analyze_error;

Succeed.

SQL> 
SQL> drop table if exists tongep_empty_index;

Succeed.

SQL> drop index if exists tongep_idx_temp on tongep_temp_table_analyze_error;

Succeed.

SQL> create table tongep_empty_index(a int);

Succeed.

SQL> create index idx_empty_index on tongep_empty_index(a);

Succeed.

SQL> analyze index idx_empty_index on tongep_empty_index compute statistics;

Succeed.

SQL> select BLEVEL, LEVEL_BLOCKS, DISTINCT_KEYS, AVG_LEAF_BLOCKS_PER_KEY, AVG_DATA_BLOCKS_PER_KEY, EMPTY_LEAF_BLOCKS from sys_indexes where name = 'IDX_EMPTY_INDEX';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY EMPTY_LEAF_BLOCKS
------------ ------------ ------------- ----------------------- ----------------------- -----------------
0            0            0             0                       0                       0                

1 rows fetched.

SQL> insert into tongep_empty_index values(1);

1 rows affected.

SQL> delete from tongep_empty_index;

1 rows affected.

SQL> analyze index idx_empty_index on tongep_empty_index compute statistics;

Succeed.

SQL> select BLEVEL, LEVEL_BLOCKS, DISTINCT_KEYS, AVG_LEAF_BLOCKS_PER_KEY, AVG_DATA_BLOCKS_PER_KEY, EMPTY_LEAF_BLOCKS from sys_indexes where name = 'IDX_EMPTY_INDEX';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY EMPTY_LEAF_BLOCKS
------------ ------------ ------------- ----------------------- ----------------------- -----------------
1            1            0             0                       0                       1                

1 rows fetched.

SQL> drop table if exists tongep_empty_index;

Succeed.

SQL> drop table if exists tongep_part_empty_index;

Succeed.

SQL> create table tongep_part_empty_index(a int, b int) 
  2 partition by range(a)
  3 (
  4     partition part1 values less than(5),
  5     partition part2 values less than(10)
  6 );

Succeed.

SQL> create index idx_part_empty_index on tongep_part_empty_index(a) local;

Succeed.

SQL> create index idx_part_global_index on tongep_part_empty_index(b);

Succeed.

SQL> analyze index idx_part_empty_index on tongep_part_empty_index compute statistics;

Succeed.

SQL> select BLEVEL, LEVEL_BLOCKS, DISTINCT_KEYS, AVG_LEAF_BLOCKS_PER_KEY, AVG_DATA_BLOCKS_PER_KEY, EMPTY_LEAF_BLOCKS from sys_indexes where name = 'IDX_PART_EMPTY_INDEX';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY EMPTY_LEAF_BLOCKS
------------ ------------ ------------- ----------------------- ----------------------- -----------------
0            0            0             0                       0                       0                

1 rows fetched.

SQL> insert into tongep_part_empty_index values(1, 1);

1 rows affected.

SQL> insert into tongep_part_empty_index values(7, 7);

1 rows affected.

SQL> alter table tongep_part_empty_index drop partition part1;

Succeed.

SQL> analyze index idx_part_global_index on tongep_part_empty_index compute statistics;

CT-00830, Index SYS.IDX_PART_GLOBAL_INDEX does not exist
SQL> delete from tongep_part_empty_index;

1 rows affected.

SQL> analyze index idx_part_empty_index on tongep_part_empty_index compute statistics;

Succeed.

SQL> select BLEVEL, LEVEL_BLOCKS, DISTINCT_KEYS, AVG_LEAF_BLOCKS_PER_KEY, AVG_DATA_BLOCKS_PER_KEY, EMPTY_LEAF_BLOCKS from sys_indexes where name = 'IDX_PART_EMPTY_INDEX';

BLEVEL       LEVEL_BLOCKS DISTINCT_KEYS AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY EMPTY_LEAF_BLOCKS
------------ ------------ ------------- ----------------------- ----------------------- -----------------
0            0            0             0                       0                       0                

1 rows fetched.

SQL> exec DBE_STATS.PURGE_STATS(sysdate);

PL/SQL procedure successfully completed.

SQL> 
SQL> select VALUE from DV_PARAMETERS where name = 'STATS_MAX_BUCKET_SIZE';

VALUE                                                           
----------------------------------------------------------------
254                                                             

1 rows fetched.

SQL> alter system set STATS_MAX_BUCKET_SIZE = 0;

CT-00211, The value of parameter "STATS_MAX_BUCKET_SIZE" should be in [75, 254]
SQL> alter system set STATS_MAX_BUCKET_SIZE = 300;

CT-00211, The value of parameter "STATS_MAX_BUCKET_SIZE" should be in [75, 254]
SQL> drop table if exists test_statistics_1;

Succeed.

SQL> 
SQL> create table test_statistics_1 (a int);

Succeed.

SQL> 
SQL> insert into test_statistics_1 values(1);

1 rows affected.

SQL> insert into test_statistics_1 (a) select a + 1 from test_statistics_1;

1 rows affected.

SQL> insert into test_statistics_1 (a) select a + 2 from test_statistics_1;

2 rows affected.

SQL> insert into test_statistics_1 (a) select a + 4 from test_statistics_1;

4 rows affected.

SQL> insert into test_statistics_1 (a) select a + 8 from test_statistics_1;

8 rows affected.

SQL> insert into test_statistics_1 (a) select a + 16 from test_statistics_1;

16 rows affected.

SQL> insert into test_statistics_1 (a) select a + 32 from test_statistics_1;

32 rows affected.

SQL> insert into test_statistics_1 (a) select a + 64 from test_statistics_1;

64 rows affected.

SQL> insert into test_statistics_1 (a) select a + 64 from test_statistics_1;

128 rows affected.

SQL> commit;

Succeed.

SQL> alter system set STATS_MAX_BUCKET_SIZE = 75;

Succeed.

SQL> analyze table test_statistics_1 compute statistics;

Succeed.

SQL> select NUM_DISTINCT, NUM_NULLS, HISTOGRAM from dba_tab_columns where TABLE_NAME = 'TEST_STATISTICS_1';

NUM_DISTINCT NUM_NULLS    HISTOGRAM                                                       
------------ ------------ ----------------------------------------------------------------
192          0            HEIGHT BALANCED                                                 

1 rows fetched.

SQL> alter system set STATS_MAX_BUCKET_SIZE = 250;

Succeed.

SQL> analyze table test_statistics_1 compute statistics;

Succeed.

SQL> select NUM_DISTINCT, NUM_NULLS, HISTOGRAM from dba_tab_columns where TABLE_NAME = 'TEST_STATISTICS_1';

NUM_DISTINCT NUM_NULLS    HISTOGRAM                                                       
------------ ------------ ----------------------------------------------------------------
192          0            FREQUENCY                                                       

1 rows fetched.

SQL> alter system set STATS_MAX_BUCKET_SIZE = 254;

Succeed.

SQL> 
SQL> drop table if exists test_index_diskey;

Succeed.

SQL> create table test_index_diskey (name varchar(16));

Succeed.

SQL> create index idx_diskey on test_index_diskey(name);

Succeed.

SQL> insert into test_index_diskey values('is0');

1 rows affected.

SQL> begin
  2         for i in 1..250 loop
  3         insert into test_index_diskey values('is1');
  4     end loop;
  5 end;
  6 /

PL/SQL procedure successfully completed.

SQL> analyze index idx_diskey on test_index_diskey compute statistics;

Succeed.

SQL> select distinct_keys from sys_indexes where name = upper('idx_diskey');

DISTINCT_KEYS
-------------
2            

1 rows fetched.

SQL> drop table test_index_diskey;

Succeed.

SQL> 
SQL> drop table if exists fvt_gather_table_01;

Succeed.

SQL> create table fvt_gather_table_01
  2 (c_int int,c_num number(10,1),c_name varchar(80),c_clob clob,c_bllo boolean)
  3 partition by range(c_int)
  4 (partition p1 values less than (1),
  5 partition p2 values less than (11),
  6 partition p3 values less than (1011),
  7 partition p4 values less than (101011)
  8 );

Succeed.

SQL> 
SQL> begin
  2 for i in 0..101001
  3 loop
  4 insert into fvt_gather_table_01 values(i,i,'abs'||i,'clo'||i,'true') ;
  5 end loop;
  6 end;
  7 /

PL/SQL procedure successfully completed.

SQL> 
SQL> drop index if exists fvt_index_1 on fvt_gather_table_01;

Succeed.

SQL> create unique index fvt_index_1 on fvt_gather_table_01(c_int);

Succeed.

SQL> 
SQL> select bytes/1024/1024 from adm_segments where segment_name='FVT_GATHER_TABLE_01';

BYTES/1024/1024     
--------------------
0                   
0.0625              
6.625               
0.125               
0.0625              

5 rows fetched.

SQL> exec dbe_stats.collect_table_stats(
  2 schema =>'SYS',
  3 name =>'FVT_GATHER_TABLE_01',
  4 part_name =>'P4',
  5 sample_ratio =>10,
  6 method_opt =>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> drop table if exists fvt_gather_table_01;

Succeed.

SQL> create table fvt_gather_table_01
  2 (c_int int,c_num number(10,1),c_name varchar(80),c_clob clob,c_bllo boolean)
  3 partition by range(c_int)
  4 (partition p1 values less than (1),
  5 partition p2 values less than (11),
  6 partition p3 values less than (1011),
  7 partition p4 values less than (101011)
  8 );

Succeed.

SQL> 
SQL> 
SQL> begin
  2 for i in 0..101001
  3 loop
  4 insert into fvt_gather_table_01 values(i,i,'abs'||i,'clo'||i,'true') ;
  5 end loop;
  6 end;
  7 /

PL/SQL procedure successfully completed.

SQL> 
SQL> drop index if exists fvt_index_1 on fvt_gather_table_01;

Succeed.

SQL> create unique index fvt_index_1 on fvt_gather_table_01(c_int);

Succeed.

SQL> 
SQL> select bytes/1024/1024 from adm_segments where segment_name='FVT_GATHER_TABLE_01';

BYTES/1024/1024     
--------------------
0                   
0.0625              
6.625               
0.125               
0.0625              

5 rows fetched.

SQL> exec dbe_stats.collect_table_stats(
  2 schema =>'SYS',
  3 name =>'FVT_GATHER_TABLE_01',
  4 part_name =>'P4',
  5 sample_ratio =>10,
  6 method_opt =>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> select count(*) from fvt_gather_table_01;

COUNT(*)            
--------------------
101002              

1 rows fetched.

SQL> exec dbe_stats.collect_table_stats(
  2 schema =>'SYS',
  3 name =>'FVT_GATHER_TABLE_01',
  4 part_name =>'P2',
  5 sample_ratio =>50,
  6 method_opt =>'for all columns');

PL/SQL procedure successfully completed.

SQL> 
SQL> select a.COL#,a.bucket_num,a.row_num,a.minvalue,a.maxvalue,a.dist_num from sys.sys_histgram_abstr a,sys.sys_tables b where a.tab#=b.id and
  2 b.name=upper('fvt_gather_table_01')and a.USER#=b.USER# and b.user#=( select id from sys.SYS_USERS where name='SYS' ) and a.spare1 = 20 order by 1,2,3,4,5,6;

COL#         BUCKET_NUM   ROW_NUM      MINVALUE                                                         MAXVALUE                                                         DIST_NUM    
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------
0            10           10           1                                                                10                                                               10          
1            10           10           1                                                                10                                                               10          
2            10           10           abs1                                                             abs9                                                             10          
4            1            10           TRUE                                                             TRUE                                                             1           

4 rows fetched.

SQL> 
SQL> drop table if exists test_sample_size;

Succeed.

SQL> create table test_sample_size(a int);

Succeed.

SQL> create index idx_sample_size on test_sample_size(a);

Succeed.

SQL> insert into test_sample_size values(1);

1 rows affected.

SQL> analyze index idx_sample_size on test_sample_size compute statistics;

Succeed.

SQL> select samplesize from sys.sys_indexes where name = 'IDX_SAMPLE_SIZE';

SAMPLESIZE  
------------
1           

1 rows fetched.

SQL> 
SQL> drop table if exists hzy_high_ndv1;

Succeed.

SQL> drop table if exists hzy_ndv1;

Succeed.

SQL> create table hzy_ndv1(a int);

Succeed.

SQL> insert into hzy_ndv1 values(0);

1 rows affected.

SQL> create table hzy_high_ndv1(a int)
  2 partition by range(A)
  3 interval(250)
  4 (
  5    partition p_ndv1 values less than (100),
  6    partition p_ndv2 values less than (300),
  7    partition p_ndv3 values less than (600)
  8 );

Succeed.

SQL> 
SQL> CREATE or replace procedure storage_proc_000(startnum int,endall int) is
  2 i INT :=1;
  3 j varchar(10);
  4 BEGIN
  5   FOR i IN startnum..endall LOOP
  6     insert into hzy_high_ndv1 select a+i from hzy_ndv1;
  7   END LOOP;
  8 END;
  9 /

Succeed.

SQL> call storage_proc_000(1,1000);

PL/SQL procedure successfully completed.

SQL> call storage_proc_000(1,100);

PL/SQL procedure successfully completed.

SQL> call storage_proc_000(1,100);

PL/SQL procedure successfully completed.

SQL> call storage_proc_000(20,300);

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'hzy_high_ndv1', 'p_ndv3');

PL/SQL procedure successfully completed.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY,SPARE1 from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_NDV1')
  2 ORDER BY SPARE1;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY              SPARE1              
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ -------------------- --------------------
254          301          0            300                                                              599                                                              300          0.00333333333333333  30                  
254          1481         0            1                                                                1000                                                             1000         0.001                4294967295          

2 rows fetched.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'hzy_high_ndv1', 'p_ndv1');

PL/SQL procedure successfully completed.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY,SPARE1 from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_NDV1')
  2 ORDER BY SPARE1;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY              SPARE1              
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ -------------------- --------------------
99           377          0            1                                                                99                                                               99           0.0101010101010101   10                  
254          301          0            300                                                              599                                                              300          0.00333333333333333  30                  
254          1481         0            1                                                                1000                                                             1000         0.001                4294967295          

3 rows fetched.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'hzy_high_ndv1', 'p_ndv2');

PL/SQL procedure successfully completed.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY,SPARE1 from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_NDV1')
  2 ORDER BY SPARE1;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY              SPARE1              
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ -------------------- --------------------
99           377          0            1                                                                99                                                               99           0.0101010101010101   10                  
200          402          0            100                                                              299                                                              200          0.005                20                  
254          301          0            300                                                              599                                                              300          0.00333333333333333  30                  
254          1481         0            1                                                                1000                                                             1000         0.001                4294967295          

4 rows fetched.

SQL> 
SQL> delete from hzy_high_ndv1 where a < 600;

1080 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'hzy_high_ndv1', 'p_ndv3');

PL/SQL procedure successfully completed.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY,SPARE1 from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_NDV1')
  2 ORDER BY SPARE1;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY              SPARE1              
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ -------------------- --------------------
99           377          0            1                                                                99                                                               99           0.0101010101010101   10                  
200          402          0            100                                                              299                                                              200          0.005                20                  
0            0            0                                                                                                                                              0            0                    30                  
254          1481         0            1                                                                1000                                                             1000         0.001                4294967295          

4 rows fetched.

SQL> 
SQL> exec dbe_stats.collect_table_stats('SYS', 'hzy_high_ndv1');

PL/SQL procedure successfully completed.

SQL> select BUCKET_NUM,ROW_NUM,NULL_NUM,MINVALUE,MAXVALUE,DIST_NUM,DENSITY,SPARE1 from SYS_HISTGRAM_ABSTR where tab# = (select id from SYS_TABLES where name = 'HZY_HIGH_NDV1')
  2 ORDER BY SPARE1;

BUCKET_NUM   ROW_NUM      NULL_NUM     MINVALUE                                                         MAXVALUE                                                         DIST_NUM     DENSITY              SPARE1              
------------ ------------ ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ------------ -------------------- --------------------
0            0            0                                                                                                                                              0            0                    10                  
0            0            0                                                                                                                                              0            0                    20                  
0            0            0                                                                                                                                              0            0                    30                  
250          250          0            600                                                              849                                                              250          0.004                1073741824          
151          151          0            850                                                              1000                                                             151          0.00662251655629139  1073741825          
254          401          0            600                                                              1000                                                             401          0.00249376558603491  4294967295          

6 rows fetched.

SQL> 
SQL> drop table if exists test_statistics_2;

Succeed.

SQL> create tablespace maos_spc datafile 'hzybitmap_spc' size 32M autoextend on next 16M extent autoallocate ;

Succeed.

SQL> create table test_statistics_2 (id int, name varchar(20)) TABLESPACE maos_spc;

Succeed.

SQL> insert into test_statistics_2 values(0, 'it is a long string');

1 rows affected.

SQL> insert into test_statistics_2 select id + 1, name from test_statistics_2;

1 rows affected.

SQL> insert into test_statistics_2 select id + 2, name from test_statistics_2;

2 rows affected.

SQL> insert into test_statistics_2 select id + 4, name from test_statistics_2;

4 rows affected.

SQL> insert into test_statistics_2 select id + 8, name from test_statistics_2;

8 rows affected.

SQL> insert into test_statistics_2 select id + 16, name from test_statistics_2;

16 rows affected.

SQL> insert into test_statistics_2 select id + 32, name from test_statistics_2;

32 rows affected.

SQL> insert into test_statistics_2 select id + 64, name from test_statistics_2;

64 rows affected.

SQL> insert into test_statistics_2 select id + 120, name from test_statistics_2;

128 rows affected.

SQL> insert into test_statistics_2 select * from test_statistics_2;

256 rows affected.

SQL> insert into test_statistics_2 select * from test_statistics_2;

512 rows affected.

SQL> insert into test_statistics_2 select * from test_statistics_2;

1024 rows affected.

SQL> commit;

Succeed.

SQL> exec dbe_stats.collect_table_stats('SYS', 'TEST_STATISTICS_2', part_name=>NULL,sample_ratio => 90,method_opt=>'for all columns');

PL/SQL procedure successfully completed.

SQL> drop tablespace maos_spc including contents and datafiles;

Succeed.

SQL> 
SQL> drop table if exists test_stats_1;

Succeed.

SQL> create table test_stats_1 (a int);

Succeed.

SQL> insert into test_stats_1 values(1);

1 rows affected.

SQL> insert into test_stats_1 (a) select a + 1 from test_stats_1;

1 rows affected.

SQL> insert into test_stats_1 (a) select a + 2 from test_stats_1;

2 rows affected.

SQL> insert into test_stats_1 (a) select a + 4 from test_stats_1;

4 rows affected.

SQL> insert into test_stats_1 (a) select a + 8 from test_stats_1;

8 rows affected.

SQL> insert into test_stats_1 (a) select a + 16 from test_stats_1;

16 rows affected.

SQL> insert into test_stats_1 (a) select a + 32 from test_stats_1;

32 rows affected.

SQL> insert into test_stats_1 (a) select a + 64 from test_stats_1;

64 rows affected.

SQL> commit;

Succeed.

SQL> create index index1 on test_stats_1(a);

Succeed.

SQL> 
SQL> analyze table test_stats_1 compute statistics;

Succeed.

SQL> select NUM_ROWS, BLOCKS, AVG_ROW_LEN from sys_tables where name = 'TEST_STATS_1';

NUM_ROWS     BLOCKS       AVG_ROW_LEN         
------------ ------------ --------------------
128          1            16                  

1 rows fetched.

SQL> 
SQL> drop table if exists test_interval1;

Succeed.

SQL> create table test_interval1(f1 int, f2 int, f3 char(30))
  2 PARTITION BY RANGE(f2)
  3 INTERVAL(5)
  4 (
  5  PARTITION test_interval1p1 values less than(10),
  6  PARTITION test_interval1p2 values less than(20),
  7  PARTITION test_interval1p3 values less than(30)
  8 );

Succeed.

SQL> insert into test_interval1 values(1,5,'hzy');

1 rows affected.

SQL> insert into test_interval1 values(2,15,'hzy1');

1 rows affected.

SQL> insert into test_interval1 values(3,25,'hzy2');

1 rows affected.

SQL> insert into test_interval1 values(4,35,'hzy3');

1 rows affected.

SQL> insert into test_interval1 values(5,115,'hzy66');

1 rows affected.

SQL> insert into test_interval1 values(6,55,'6hzy');

1 rows affected.

SQL> insert into test_interval1 values(7,65,'hezy');

1 rows affected.

SQL> insert into test_interval1 values(8,75,'hzfdy');

1 rows affected.

SQL> insert into test_interval1 values(9,85,'hzyf');

1 rows affected.

SQL> insert into test_interval1 values(10,95,'hzyd');

1 rows affected.

SQL> insert into test_interval1 values(11,105,'hzy');

1 rows affected.

SQL> insert into test_interval1 select * from test_interval1;

11 rows affected.

SQL> insert into test_interval1 select * from test_interval1;

22 rows affected.

SQL> commit;

Succeed.

SQL> create index index2 on test_interval1(f1);

Succeed.

SQL> 
SQL> analyze table test_interval1 compute statistics;

Succeed.

SQL> select NAME,ROWCNT,BLKCNT,EMPCNT,AVGRLN from sys.SYS_TABLE_PARTS where name = 'TEST_INTERVAL1P1';

NAME                                                             ROWCNT       BLKCNT       EMPCNT       AVGRLN      
---------------------------------------------------------------- ------------ ------------ ------------ ------------
TEST_INTERVAL1P1                                                 4            1            0            48          

1 rows fetched.

SQL> 
SQL> --DTS2019121209311
SQL> drop table if exists fvt_partition_04;

Succeed.

SQL> create table fvt_partition_04(
  2                 c_id int PRIMARY KEY,
  3                 c_clob clob,
  4                 c_time timestamp,
  5                 c_num decimal(10,5),
  6                 c_name varchar(10)
  7                 ) PARTITION BY RANGE(c_id)
  8 (
  9 PARTITION p1 values less than(5),
 10 PARTITION p2 values less than(10),
 11 PARTITION p3 values less than(20),
 12 PARTITION p4 values less than(MAXVALUE)
 13 );

Succeed.

SQL> drop index if exists fvt_partition_index_04 on fvt_partition_04;

Succeed.

SQL> create unique index fvt_partition_index_04 on fvt_partition_04(c_num);

Succeed.

SQL> drop index if exists fvt_partition_index_4 on fvt_partition_04;

Succeed.

SQL> create index fvt_partition_index_4 on fvt_partition_04(c_time,c_name,c_num);

Succeed.

SQL> drop index if exists fvt_partition_index_004 on fvt_partition_04;

Succeed.

SQL> create index fvt_partition_index_004  on fvt_partition_04 (c_time,c_name) local (partition p1,partition p2,partition p3,partition p4);

Succeed.

SQL> declare
  2 a number;
  3 b number;
  4 c number;
  5 d number;
  6 begin
  7         for i in 1..30 loop
  8                 b:=i+2015;
  9                 c:=i-i+1;
 10                 d:=i+10-i;
 11         execute immediate 'insert into fvt_partition_04 values('||i*i||',
 12                 ''*"%*%$3rfr'||i||'*656^5$34@%^&*()%'',to_date('''||b||'-'||c||'-'||d||''',''yyyy-mm-dd''),
 13                 '||(-i)*i||','''||i||'qs'')';
 14     end loop;
 15 end;
 16 /

PL/SQL procedure successfully completed.

SQL> 
SQL> analyze table fvt_partition_04 compute statistics;

Succeed.

SQL> 
SQL> drop table if exists test_interval1;

Succeed.

SQL> create table test_interval1(f1 int, f2 int, f3 char(30))
  2 PARTITION BY RANGE(f2)
  3 INTERVAL(5)
  4 (
  5  PARTITION test_interval1p1 values less than(10),
  6  PARTITION test_interval1p2 values less than(20),
  7  PARTITION test_interval1p3 values less than(30)
  8 );

Succeed.

SQL> insert into test_interval1 values(1,5,'hzy');

1 rows affected.

SQL> insert into test_interval1 values(2,15,'hzy1');

1 rows affected.

SQL> insert into test_interval1 values(3,25,'hzy2');

1 rows affected.

SQL> insert into test_interval1 values(4,35,'hzy3');

1 rows affected.

SQL> insert into test_interval1 values(5,115,'hzy66');

1 rows affected.

SQL> insert into test_interval1 values(6,55,'6hzy');

1 rows affected.

SQL> insert into test_interval1 values(7,65,'hezy');

1 rows affected.

SQL> insert into test_interval1 values(8,75,'hzfdy');

1 rows affected.

SQL> insert into test_interval1 values(9,85,'hzyf');

1 rows affected.

SQL> insert into test_interval1 values(10,95,'hzyd');

1 rows affected.

SQL> insert into test_interval1 values(11,105,'hzy');

1 rows affected.

SQL> insert into test_interval1 select * from test_interval1;

11 rows affected.

SQL> insert into test_interval1 select * from test_interval1;

22 rows affected.

SQL> commit;

Succeed.

SQL> create index index2 on test_interval1(f1)local;

Succeed.

SQL> 
SQL> analyze table test_interval1 compute statistics;

Succeed.

SQL> 
SQL> --DTS2019121209172
SQL> drop table if exists fvt_partition_05;

Succeed.

SQL> create table fvt_partition_05(
  2                 c_id int PRIMARY KEY,
  3                 c_clob clob,
  4                 c_time timestamp,
  5                 c_num decimal(10,5),
  6                 c_name varchar(10 char)
  7                 ) PARTITION BY RANGE(c_id) interval (500)
  8 (
  9 PARTITION p1 values less than(100),
 10 PARTITION p2 values less than(200),
 11 PARTITION p3 values less than(300));

Succeed.

SQL> drop index if exists fvt_partition_index_05 on fvt_partition_05;

Succeed.

SQL> create unique index fvt_partition_index_05 on fvt_partition_05(c_num);

Succeed.

SQL> drop index if exists fvt_partition_index_5 on fvt_partition_05;

Succeed.

SQL> create index fvt_partition_index_5 on fvt_partition_05(c_time,c_name,c_num);

Succeed.

SQL> drop index if exists fvt_partition_index_005 on fvt_partition_05;

Succeed.

SQL> create index fvt_partition_index_005  on fvt_partition_05 (c_time,c_name) local (partition p1,partition p2,partition p3);

Succeed.

SQL> 
SQL> declare
  2 a number;
  3 b number;
  4 c number;
  5 d number;
  6 begin
  7         for i in 1..30 loop
  8                 b:=i+2015;
  9                 c:=i-i+1;
 10                 d:=i+10-i;
 11         execute immediate 'insert into fvt_partition_05 values('||i*i||',
 12                 ''*"%*%$3rfr'||i||'*656^5$34@%^&*()%'',to_date('''||b||'-'||c||'-'||d||''',''yyyy-mm-dd''),
 13                 '||(-i)*i||','''||i||'@.com'')';
 14     end loop;
 15 end;
 16 /

PL/SQL procedure successfully completed.

SQL> 
SQL> analyze table fvt_partition_05 compute statistics;

Succeed.

SQL> 
SQL> drop table if exists tbl_Result_1911816254_3;

Succeed.

SQL> create table tbl_Result_1911816254_3
  2 (StartTime int,ObjectNo int)
  3 PARTITION BY RANGE(StartTime)
  4 (
  5  PARTITION p1 values less than(100),
  6  PARTITION p2 values less than(200),
  7  PARTITION p3 values less than(300),
  8  PARTITION p4 values less than(maxvalue)
  9 );

Succeed.

SQL> 
SQL> begin
  2 for i in 0..10100
  3 loop
  4 insert into tbl_Result_1911816254_3 values(i,i) ;
  5 end loop;
  6 end;
  7 /

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> drop table if exists tmp_nic_61;

Succeed.

SQL> create table tmp_nic_61 (ObjectNo int);

Succeed.

SQL> 
SQL> begin
  2 for i in 0..100
  3 loop
  4 insert into tmp_nic_61 values(i) ;
  5 end loop;
  6 end;
  7 /

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> 
SQL> select a.StartTime , a.ObjectNo from tbl_Result_1911816254_3 a, tmp_nic_61 b where (a.StartTime >= 100 and a.StartTime < 200 and (a.ObjectNo = b.ObjectNo))  order by a.StartTime  ASC, a.ObjectNo;

STARTTIME    OBJECTNO    
------------ ------------
100          100         

1 rows fetched.

SQL> 
SQL> drop table if exists hzy_num_rows;

Succeed.

SQL> create table hzy_num_rows (C_ID INT) 
  2 partition by range(c_id) 
  3   ( partition part_1 values less than(10),
  4   partition part_2 values less than(20),
  5   partition part_3 values less than(31));

Succeed.

SQL> 
SQL> insert into hzy_num_rows values(0);  

1 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> CREATE or replace procedure hzy_num_rows_proc(startall int,endall int)  as
  2 i INT;
  3 BEGIN
  4   FOR i IN startall..endall LOOP
  5 		insert into hzy_num_rows (c_id) select c_id + i from  hzy_num_rows where c_id = 0;commit;
  6         END LOOP;
  7 END;
  8 /

Succeed.

SQL> call hzy_num_rows_proc(1,30);

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> select count(*) from hzy_num_rows;

COUNT(*)            
--------------------
31                  

1 rows fetched.

SQL> analyze table hzy_num_rows compute statistics;

Succeed.

SQL> select a.NUM_ROWS,a.PARTITIONED from table$ a where a.name='HZY_NUM_ROWS';

NUM_ROWS     PARTITIONED 
------------ ------------
31           1           

1 rows fetched.

SQL> delete from HZY_NUM_ROWS where c_id > 10 and c_id < 15;

4 rows affected.

SQL> call dbe_stats.collect_table_stats('SYS','HZY_NUM_ROWS','part_2');

PL/SQL procedure successfully completed.

SQL> select a.NUM_ROWS,a.PARTITIONED from table$ a where a.name='HZY_NUM_ROWS';

NUM_ROWS     PARTITIONED 
------------ ------------
27           1           

1 rows fetched.

SQL> 
SQL> drop table if exists test_result_1;

Succeed.

SQL> create table test_result_1 (
  2 StartTime date not null, 
  3 StartTimeDstOffset number(5) not null,
  4 SvrStartTime date not null,
  5 STSvrDstOffset number(5) not null,
  6 EndTime date not null,
  7 EndTimeDstOffset number(5) not null,
  8 SvrEndTime date not null,
  9 ETSvrDstOffset number(5) not null,
 10 InsertTime date,
 11 TimezoneOffset number(5) not null,
 12 ObjectNo number(10) not null,
 13 GranulityPeriod number(5), 
 14 ResultReliablityFlag number(5),
 15 Counter_1526728850 number(12, 3) null)
 16 PARTITION BY RANGE (StartTime) (
 17 PARTITION P20200213 VALUES LESS THAN (TO_DATE('2020-02-13 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 18 PARTITION P20200214 VALUES LESS THAN (TO_DATE('2020-02-14 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 19 PARTITION P20200215 VALUES LESS THAN (TO_DATE('2020-02-15 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 20 PARTITION P20200216 VALUES LESS THAN (TO_DATE('2020-02-16 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 21 PARTITION P20200217 VALUES LESS THAN (TO_DATE('2020-02-17 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 22 PARTITION P20200218 VALUES LESS THAN (TO_DATE('2020-02-18 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 23 PARTITION P20200219 VALUES LESS THAN (TO_DATE('2020-02-19 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 24 PARTITION P20200220 VALUES LESS THAN (TO_DATE('2020-02-20 00:00:00', 'YYYY-MM-DD HH24:MI:SS')));

Succeed.

SQL> 
SQL> create unique index ST_test_result_1 on test_result_1 (StartTime, ObjectNo, StartTimeDstOffset) local;

Succeed.

SQL> create index SS_test_result_1 on test_result_1 (SvrStartTime, ObjectNo, STSvrDstOffset) local;

Succeed.

SQL> create index IT_test_result_1 on test_result_1 (InsertTime) local;

Succeed.

SQL> insert into test_result_1 values('2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,2,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,3,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,4,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,5,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,6,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,7,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,8,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,9,60,1,1);

1 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> drop table if exists  chenlei_test;

Succeed.

SQL> create table chenlei_test(OBJECTNO int,OBJECTINDEX int);

Succeed.

SQL> insert into chenlei_test values(2,1);

1 rows affected.

SQL> insert into chenlei_test values(1,1);

1 rows affected.

SQL> insert into chenlei_test values(4,1);

1 rows affected.

SQL> insert into chenlei_test values(3,1);

1 rows affected.

SQL> insert into chenlei_test values(52,1);

1 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> select a.StartTime , a.ObjectNo, a.GranulityPeriod , a.ResultReliablityFlag , a.Counter_1526728850 
  2 from test_result_1 a, chenlei_test b where (a.StartTime >= to_date('2020-02-13 10:55:30','YYYY-MM-DD HH24:MI:SS') and a.StartTime < to_date('2020-02-14 10:55:30','YYYY-MM-DD HH24:MI:SS') and (a.ObjectNo = b.ObjectNo)) order by a.StartTime ASC, a.ObjectNo; 

STARTTIME              OBJECTNO                                 GRANULITYPERIOD                          RESULTRELIABLITYFLAG                     COUNTER_1526728850                      
---------------------- ---------------------------------------- ---------------------------------------- ---------------------------------------- ----------------------------------------
2020-02-14 00:04:00    2                                        60                                       1                                        1                                       
2020-02-14 00:04:00    3                                        60                                       1                                        1                                       
2020-02-14 00:04:00    4                                        60                                       1                                        1                                       

3 rows fetched.

SQL> drop table if exists test_result_1;

Succeed.

SQL> drop table if exists  chenlei_test;

Succeed.

SQL> 
SQL> drop table if exists test_result_1;

Succeed.

SQL> create table test_result_1 (
  2 StartTime date not null, 
  3 StartTimeDstOffset number(5) not null,
  4 SvrStartTime date not null,
  5 STSvrDstOffset number(5) not null,
  6 EndTime date not null,
  7 EndTimeDstOffset number(5) not null,
  8 SvrEndTime date not null,
  9 ETSvrDstOffset number(5) not null,
 10 InsertTime date,
 11 TimezoneOffset number(5) not null,
 12 ObjectNo number(10) not null,
 13 GranulityPeriod number(5), 
 14 ResultReliablityFlag number(5),
 15 Counter_1526728850 number(12, 3) null)
 16 PARTITION BY RANGE (StartTime) (
 17 PARTITION P20200213 VALUES LESS THAN (TO_DATE('2020-02-13 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 18 PARTITION P20200214 VALUES LESS THAN (TO_DATE('2020-02-14 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 19 PARTITION P20200215 VALUES LESS THAN (TO_DATE('2020-02-15 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 20 PARTITION P20200216 VALUES LESS THAN (TO_DATE('2020-02-16 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 21 PARTITION P20200217 VALUES LESS THAN (TO_DATE('2020-02-17 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 22 PARTITION P20200218 VALUES LESS THAN (TO_DATE('2020-02-18 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 23 PARTITION P20200219 VALUES LESS THAN (TO_DATE('2020-02-19 00:00:00', 'YYYY-MM-DD HH24:MI:SS')), 
 24 PARTITION P20200220 VALUES LESS THAN (TO_DATE('2020-02-20 00:00:00', 'YYYY-MM-DD HH24:MI:SS')));

Succeed.

SQL> 
SQL> create unique index ST_test_result_1 on test_result_1 (StartTime, StartTimeDstOffset) local;

Succeed.

SQL> create index SS_test_result_1 on test_result_1 (SvrStartTime, STSvrDstOffset) local;

Succeed.

SQL> create index IT_test_result_1 on test_result_1 (InsertTime) local;

Succeed.

SQL> insert into test_result_1 values('2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,2,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:01',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,3,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:02',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,4,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:03',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,5,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:04',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,6,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:05',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,7,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:06',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,8,60,1,1);

1 rows affected.

SQL> insert into test_result_1 values('2020-02-14 00:04:07',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,9,60,1,1);

1 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL>  exec  dbe_stats.collect_table_stats(
  2 schema => 'sys',
  3 name => 'test_result_1',
  4 sample_ratio => 50,
  5 method_opt=>'for all indexed columns');

PL/SQL procedure successfully completed.

SQL> 
SQL> drop table if exists  chenlei_test;

Succeed.

SQL> create table chenlei_test(OBJECTNO int,OBJECTINDEX int);

Succeed.

SQL> insert into chenlei_test values(2,1);

1 rows affected.

SQL> insert into chenlei_test values(1,1);

1 rows affected.

SQL> insert into chenlei_test values(4,1);

1 rows affected.

SQL> insert into chenlei_test values(3,1);

1 rows affected.

SQL> insert into chenlei_test values(52,1);

1 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> select a.StartTime , a.ObjectNo, a.GranulityPeriod , a.ResultReliablityFlag , a.Counter_1526728850 
  2 from test_result_1 a, chenlei_test b where (a.StartTime <= to_date('2020-02-14 00:00:00','YYYY-MM-DD HH24:MI:SS') and a.StartTime < to_date('2020-02-14 10:55:30','YYYY-MM-DD HH24:MI:SS') and (a.ObjectNo = b.ObjectNo)) order by a.StartTime ASC, a.ObjectNo; 

STARTTIME              OBJECTNO                                 GRANULITYPERIOD                          RESULTRELIABLITYFLAG                     COUNTER_1526728850                      
---------------------- ---------------------------------------- ---------------------------------------- ---------------------------------------- ----------------------------------------

0 rows fetched.

SQL> drop table if exists test_result_1;

Succeed.

SQL> drop table if exists  chenlei_test;

Succeed.

SQL> 
SQL> -- test trans gtt dynamic stats
SQL> drop temporary table if exists gtt1_tran;

Succeed.

SQL> create global temporary table gtt1_tran(a int, b bigint, c number, d date, e timestamp, f real, g char(10), h clob, i varchar(10));

Succeed.

SQL> create index idx1_gtt1_tran on gtt1_tran(a);

Succeed.

SQL> create index idx2_gtt1_tran on gtt1_tran(a, g);

Succeed.

SQL> create index idx3_gtt1_tran on gtt1_tran(a, b);

Succeed.

SQL> 
SQL> drop temporary table if exists gtt1_session;

Succeed.

SQL> create global temporary table gtt1_session(a int, b bigint, c number, d date, e timestamp, f real, g char(10), h clob, i varchar(10)) on commit preserve rows;

Succeed.

SQL> create index idx1_gtt1_session on gtt1_session(a);

Succeed.

SQL> create index idx2_gtt1_session on gtt1_session(a, g);

Succeed.

SQL> create index idx3_gtt1_session on gtt1_session(a, b);

Succeed.

SQL> 
SQL> analyze table gtt1_tran compute statistics;

Succeed.

SQL> select NAME,NUM_ROWS,BLOCKS,AVG_ROW_LEN from dv_temp_table_stats where name = 'GTT1_TRAN';

NAME                                                             NUM_ROWS     BLOCKS       AVG_ROW_LEN         
---------------------------------------------------------------- ------------ ------------ --------------------

0 rows fetched.

SQL> select tab.NAME, col.NAME, NUM_DISTINCT, LOW_VALUE, HIGH_VALUE, HISTOGRAM from dv_temp_column_stats col, dv_temp_table_stats tab where tab.user# = col.user# and tab.ID = col.TABLE# and tab.NAME = 'GTT1_TRAN';

NAME                                                             NAME                                                             NUM_DISTINCT LOW_VALUE                                                        HIGH_VALUE                                                       HISTOGRAM                                                       
---------------------------------------------------------------- ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------

0 rows fetched.

SQL> select idx.NAME, BLEVEL, LEVEL_BLOCKS, CLUFAC, DISTINCT_KEYS, COMB_COLS_2_NDV, COMB_COLS_3_NDV, COMB_COLS_4_NDV, AVG_LEAF_BLOCKS_PER_KEY, AVG_DATA_BLOCKS_PER_KEY from dv_temp_index_stats idx, dv_temp_table_stats tab where tab.user# = idx.user# and tab.ID = idx.TABLE# and tab.NAME = 'GTT1_TRAN';

NAME                                                             BLEVEL       LEVEL_BLOCKS CLUFAC       DISTINCT_KEYS COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY
---------------------------------------------------------------- ------------ ------------ ------------ ------------- --------------- --------------- --------------- ----------------------- -----------------------

0 rows fetched.

SQL> 
SQL> insert into gtt1_tran values(1,213545678100, 12312.122, '1990-11-30', '1992-02-09 15:12:36', 11272.264, 'aaaaaaaaaa','aaaaaaaaaaa','aaaaa');

1 rows affected.

SQL> insert into gtt1_tran values(2,213545678120, 22312.122, '1992-11-30', '1992-02-09 20:12:36', 21272.264, 'ccccaaaaaa','aaaaaaaaaaa','aaaaaaaa');

1 rows affected.

SQL> insert into gtt1_tran values(null,null,null,null,null,null,null,null,null);

1 rows affected.

SQL> 
SQL> insert into gtt1_session values(1,213545678100, 12312.122, '1990-11-30', '1992-02-09 15:12:36', 11272.264, 'aaaaaaaaaa','aaaaaaaaaaa','aaaaa');

1 rows affected.

SQL> insert into gtt1_session values(4,213545678140, 42312.122, '1994-11-30', '1993-02-09 15:12:38', 41272.264, 'fffffaaaaa','aaaaaaaaaaa','bbbbb');

1 rows affected.

SQL> 
SQL> -- trigger dynamic stats
SQL> select gtt1_tran.a from gtt1_tran, gtt1_session where gtt1_tran.a = gtt1_session.a;

A           
------------
1           

1 rows fetched.

SQL> select NAME,NUM_ROWS,BLOCKS,AVG_ROW_LEN from dv_temp_table_stats where name = 'GTT1_TRAN';

NAME                                                             NUM_ROWS     BLOCKS       AVG_ROW_LEN         
---------------------------------------------------------------- ------------ ------------ --------------------
GTT1_TRAN                                                        3            1            65                  

1 rows fetched.

SQL> select col.NAME, NUM_DISTINCT, LOW_VALUE, HIGH_VALUE, HISTOGRAM from dv_temp_column_stats col, dv_temp_table_stats tab where tab.user# = col.user# and tab.ID = col.TABLE# and tab.NAME = 'GTT1_TRAN';

NAME                                                             NUM_DISTINCT LOW_VALUE                                                        HIGH_VALUE                                                       HISTOGRAM                                                       
---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
A                                                                2            1                                                                2                                                                FREQUENCY                                                       
G                                                                2            aaaaaaaaaa                                                       ccccaaaaaa                                                       FREQUENCY                                                       
B                                                                2            213545678100                                                     213545678120                                                     FREQUENCY                                                       

3 rows fetched.

SQL> select idx.NAME, BLEVEL, LEVEL_BLOCKS, CLUFAC, DISTINCT_KEYS, COMB_COLS_2_NDV, COMB_COLS_3_NDV, COMB_COLS_4_NDV, AVG_LEAF_BLOCKS_PER_KEY, AVG_DATA_BLOCKS_PER_KEY from dv_temp_index_stats idx, dv_temp_table_stats tab where tab.user# = idx.user# and tab.ID = idx.TABLE# and tab.NAME = 'GTT1_TRAN';

NAME                                                             BLEVEL       LEVEL_BLOCKS CLUFAC       DISTINCT_KEYS COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY
---------------------------------------------------------------- ------------ ------------ ------------ ------------- --------------- --------------- --------------- ----------------------- -----------------------
IDX1_GTT1_TRAN                                                   1            1            1            3             0               0               0               0.333333333333333       1                      
IDX3_GTT1_TRAN                                                   1            1            1            3             3               0               0               0.333333333333333       1                      
IDX2_GTT1_TRAN                                                   1            1            1            3             3               0               0               0.333333333333333       1                      

3 rows fetched.

SQL> 
SQL> select NAME,NUM_ROWS,BLOCKS,AVG_ROW_LEN from dv_temp_table_stats where name = 'GTT1_SESSION';

NAME                                                             NUM_ROWS     BLOCKS       AVG_ROW_LEN         
---------------------------------------------------------------- ------------ ------------ --------------------
GTT1_SESSION                                                     2            1            88                  

1 rows fetched.

SQL> select col.NAME, NUM_DISTINCT, LOW_VALUE, HIGH_VALUE, HISTOGRAM from dv_temp_column_stats col, dv_temp_table_stats tab where tab.user# = col.user# and tab.ID = col.TABLE# and tab.NAME = 'GTT1_SESSION';

NAME                                                             NUM_DISTINCT LOW_VALUE                                                        HIGH_VALUE                                                       HISTOGRAM                                                       
---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
A                                                                2            1                                                                4                                                                FREQUENCY                                                       
G                                                                2            aaaaaaaaaa                                                       fffffaaaaa                                                       FREQUENCY                                                       
B                                                                2            213545678100                                                     213545678140                                                     FREQUENCY                                                       

3 rows fetched.

SQL> select idx.NAME, BLEVEL, LEVEL_BLOCKS, CLUFAC, DISTINCT_KEYS, COMB_COLS_2_NDV, COMB_COLS_3_NDV, COMB_COLS_4_NDV, AVG_LEAF_BLOCKS_PER_KEY, AVG_DATA_BLOCKS_PER_KEY from dv_temp_index_stats idx, dv_temp_table_stats tab where tab.user# = idx.user# and tab.ID = idx.TABLE# and tab.NAME = 'GTT1_SESSION';

NAME                                                             BLEVEL       LEVEL_BLOCKS CLUFAC       DISTINCT_KEYS COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY
---------------------------------------------------------------- ------------ ------------ ------------ ------------- --------------- --------------- --------------- ----------------------- -----------------------
IDX1_GTT1_SESSION                                                1            1            1            2             0               0               0               0.5                     1.5                    
IDX3_GTT1_SESSION                                                1            1            1            2             2               0               0               0.5                     1.5                    
IDX2_GTT1_SESSION                                                1            1            1            2             2               0               0               0.5                     1.5                    

3 rows fetched.

SQL> 
SQL> -- stats info don't save in sys tables triggered by dynamic stats
SQL> select name, num_rows, blocks from sys_tables where name = 'GTT1_TRAN';

NAME                                                             NUM_ROWS     BLOCKS      
---------------------------------------------------------------- ------------ ------------
GTT1_TRAN                                                                                 

1 rows fetched.

SQL> select name, num_rows, blocks from sys_tables where name = 'GTT1_SESSION';

NAME                                                             NUM_ROWS     BLOCKS      
---------------------------------------------------------------- ------------ ------------
GTT1_SESSION                                                                              

1 rows fetched.

SQL> 
SQL> -- modify table
SQL> insert into gtt1_tran values(4,213545678140, 42312.122, '1994-11-30', '1993-02-09 15:12:38', 41272.264, 'fffffaaaaa','aaaaaaaaaaa','bbbbb');

1 rows affected.

SQL> insert into gtt1_tran values(5,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> insert into gtt1_tran values(6,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'fgggaaaaaa','aaaaaaaaaaa','ccccc');

1 rows affected.

SQL> insert into gtt1_tran values(7,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','bbb');

1 rows affected.

SQL> insert into gtt1_tran values(8,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> insert into gtt1_tran values(9,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> insert into gtt1_tran values(10,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> insert into gtt1_tran values(10,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> 
SQL> insert into gtt1_session values(5,213545678150, 52312.122, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'fgggaaaaaa','aaaaaaaaaaa','ccccc');

1 rows affected.

SQL> insert into gtt1_session values(6,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','bbb');

1 rows affected.

SQL> insert into gtt1_session values(7,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> insert into gtt1_session values(8,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','bbb');

1 rows affected.

SQL> insert into gtt1_session values(9,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> insert into gtt1_session values(9,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> insert into gtt1_session values(9,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> insert into gtt1_session values(9,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> insert into gtt1_session values(9,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> insert into gtt1_session values(9,213545678150, 12312.722, '1995-02-09', '1995-02-09 15:12:40', 61272.264, 'cccccaaaaa','aaaaaaaaaaa','aaaaaa');

1 rows affected.

SQL> -- trigger dynamic stats again becaues of modify rate exceed 80%
SQL> select gtt1_tran.a from gtt1_tran, gtt1_session where gtt1_tran.a = gtt1_session.a;

A           
------------
1           
4           
5           
6           
7           
8           
9           
9           
9           
9           
9           
9           

12 rows fetched.

SQL> select NAME,NUM_ROWS,BLOCKS,AVG_ROW_LEN from dv_temp_table_stats where name = 'GTT1_TRAN';

NAME                                                             NUM_ROWS     BLOCKS       AVG_ROW_LEN         
---------------------------------------------------------------- ------------ ------------ --------------------
GTT1_TRAN                                                        11           1            81                  

1 rows fetched.

SQL> select NAME,NUM_ROWS,BLOCKS,AVG_ROW_LEN from dv_temp_table_stats where name = 'GTT1_SESSION';

NAME                                                             NUM_ROWS     BLOCKS       AVG_ROW_LEN         
---------------------------------------------------------------- ------------ ------------ --------------------
GTT1_SESSION                                                     12           1            88                  

1 rows fetched.

SQL> 
SQL> analyze table gtt1_tran compute statistics;

Succeed.

SQL> analyze table gtt1_session compute statistics;

Succeed.

SQL> 
SQL> -- analyze is ddl sql, will commit the trans.
SQL> select NAME,NUM_ROWS,BLOCKS,AVG_ROW_LEN from dv_temp_table_stats where name = 'GTT1_TRAN';

NAME                                                             NUM_ROWS     BLOCKS       AVG_ROW_LEN         
---------------------------------------------------------------- ------------ ------------ --------------------

0 rows fetched.

SQL> select col.NAME, NUM_DISTINCT, LOW_VALUE, HIGH_VALUE, HISTOGRAM from dv_temp_column_stats col, dv_temp_table_stats tab where tab.user# = col.user# and tab.ID = col.TABLE# and tab.NAME = 'GTT1_TRAN';

NAME                                                             NUM_DISTINCT LOW_VALUE                                                        HIGH_VALUE                                                       HISTOGRAM                                                       
---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------

0 rows fetched.

SQL> select idx.NAME, BLEVEL, LEVEL_BLOCKS, CLUFAC, DISTINCT_KEYS, COMB_COLS_2_NDV, COMB_COLS_3_NDV, COMB_COLS_4_NDV, AVG_LEAF_BLOCKS_PER_KEY, AVG_DATA_BLOCKS_PER_KEY from dv_temp_index_stats idx, dv_temp_table_stats tab where tab.user# = idx.user# and tab.ID = idx.TABLE# and tab.NAME = 'GTT1_TRAN';

NAME                                                             BLEVEL       LEVEL_BLOCKS CLUFAC       DISTINCT_KEYS COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY
---------------------------------------------------------------- ------------ ------------ ------------ ------------- --------------- --------------- --------------- ----------------------- -----------------------

0 rows fetched.

SQL> 
SQL> select NAME,NUM_ROWS,BLOCKS,AVG_ROW_LEN from dv_temp_table_stats where name = 'gtt1_session';

NAME                                                             NUM_ROWS     BLOCKS       AVG_ROW_LEN         
---------------------------------------------------------------- ------------ ------------ --------------------

0 rows fetched.

SQL> select col.NAME, NUM_DISTINCT, LOW_VALUE, HIGH_VALUE, HISTOGRAM from dv_temp_column_stats col, dv_temp_table_stats tab where tab.user# = col.user# and tab.ID = col.TABLE# and tab.NAME = 'gtt1_session';

NAME                                                             NUM_DISTINCT LOW_VALUE                                                        HIGH_VALUE                                                       HISTOGRAM                                                       
---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------

0 rows fetched.

SQL> select idx.NAME, BLEVEL, LEVEL_BLOCKS, CLUFAC, DISTINCT_KEYS, COMB_COLS_2_NDV, COMB_COLS_3_NDV, COMB_COLS_4_NDV, AVG_LEAF_BLOCKS_PER_KEY, AVG_DATA_BLOCKS_PER_KEY from dv_temp_index_stats idx, dv_temp_table_stats tab where tab.user# = idx.user# and tab.ID = idx.TABLE# and tab.NAME = 'gtt1_session';

NAME                                                             BLEVEL       LEVEL_BLOCKS CLUFAC       DISTINCT_KEYS COMB_COLS_2_NDV COMB_COLS_3_NDV COMB_COLS_4_NDV AVG_LEAF_BLOCKS_PER_KEY AVG_DATA_BLOCKS_PER_KEY
---------------------------------------------------------------- ------------ ------------ ------------ ------------- --------------- --------------- --------------- ----------------------- -----------------------

0 rows fetched.

SQL> -- manual stats info of session gtt will be saved in sys table session
SQL> select name, num_rows, blocks from sys_tables where name = 'GTT1_TRAN';

NAME                                                             NUM_ROWS     BLOCKS      
---------------------------------------------------------------- ------------ ------------
GTT1_TRAN                                                                                 

1 rows fetched.

SQL> select name, num_rows, blocks from sys_tables where name = 'GTT1_SESSION';

NAME                                                             NUM_ROWS     BLOCKS      
---------------------------------------------------------------- ------------ ------------
GTT1_SESSION                                                     12           1           

1 rows fetched.

SQL> 
SQL> delete from gtt1_session where a > 1;

11 rows affected.

SQL> select count(*) from gtt1_session;

COUNT(*)            
--------------------
1                   

1 rows fetched.

SQL> insert into gtt1_tran values(4,213545678140, 42312.122, '1994-11-30', '1993-02-09 15:12:38', 41272.264, 'fffffaaaaa','aaaaaaaaaaa','bbbbb');

1 rows affected.

SQL> -- trigger dynamic stats again, only gtt1_tran will be analyzed. Because manual stats info in sys table of GTT1_SESSION, so it will be not analyzed when triggering dynamic stats.
SQL> select gtt1_tran.a from gtt1_tran, gtt1_session where gtt1_tran.a = gtt1_session.a;

A           
------------

0 rows fetched.

SQL> select NAME,NUM_ROWS,BLOCKS,AVG_ROW_LEN from dv_temp_table_stats where name = 'GTT1_TRAN';

NAME                                                             NUM_ROWS     BLOCKS       AVG_ROW_LEN         
---------------------------------------------------------------- ------------ ------------ --------------------
GTT1_TRAN                                                        1            1            88                  

1 rows fetched.

SQL> select NAME,NUM_ROWS,BLOCKS,AVG_ROW_LEN from dv_temp_table_stats where name = 'GTT1_SESSION';
NAME                                                             NUM_ROWS     BLOCKS       AVG_ROW_LEN         
---------------------------------------------------------------- ------------ ------------ --------------------
GTT1_SESSION                                                     12           1            88                  

1 rows fetched.

SQL> 
SQL> drop table if exists hzy_parall_68;

Succeed.

SQL> create table hzy_parall_68 (
  2 StartTime date not null, 
  3 StartTimeDstOffset number(5) not null,
  4 SvrStartTime date not null,
  5 STSvrDstOffset number(5) not null,
  6 EndTime date not null,
  7 EndTimeDstOffset number(5) not null,
  8 SvrEndTime date not null,
  9 ETSvrDstOffset number(5) not null,
 10 InsertTime date,
 11 TimezoneOffset number(5) not null,
 12 ObjectNo number(10) not null,
 13 GranulityPeriod number(5), 
 14 ResultReliablityFlag number(5),
 15 Counter_1526728850 number(12, 3) null);

Succeed.

SQL> 
SQL> insert into hzy_parall_68 values('2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,2,60,1,1);

1 rows affected.

SQL> insert into hzy_parall_68 values('2020-02-14 00:04:01',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,3,60,1,1);

1 rows affected.

SQL> insert into hzy_parall_68 values('2020-02-14 00:04:02',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,4,60,1,1);

1 rows affected.

SQL> insert into hzy_parall_68 values('2020-02-14 00:04:03',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,5,60,1,1);

1 rows affected.

SQL> insert into hzy_parall_68 values('2020-02-14 00:04:04',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,6,60,1,1);

1 rows affected.

SQL> insert into hzy_parall_68 values('2020-02-14 00:04:05',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,7,60,1,1);

1 rows affected.

SQL> insert into hzy_parall_68 values('2020-02-14 00:04:06',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,8,60,1,1);

1 rows affected.

SQL> insert into hzy_parall_68 values('2020-02-14 00:04:07',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',0,'2020-02-14 00:04:00',480,9,60,1,1);

1 rows affected.

SQL> insert into hzy_parall_68 select * from hzy_parall_68;

8 rows affected.

SQL> insert into hzy_parall_68 select * from hzy_parall_68;

16 rows affected.

SQL> insert into hzy_parall_68 select * from hzy_parall_68;

32 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL>  exec  dbe_stats.collect_table_stats(
  2 schema => 'sys',
  3 name => 'hzy_parall_68',
  4 sample_ratio => 50,
  5 method_opt=>'for all columns');

PL/SQL procedure successfully completed.

SQL> 
SQL> select  PARALLEL,FINISHED from DV_STATS_RESOURCE where SQL_TEXT like '%hzy_parall_68%';

PARALLEL     FINISHED    
------------ ------------
4            1           

1 rows fetched.

SQL> 
SQL> alter system set cbo=off;
Succeed.
SQL>  exec  dbe_stats.collect_table_stats(
  2 schema => 'sys',
  3 name => 'hzy_resuo1',
  4 sample_ratio => 50,
  5 method_opt=>'for all columns');

CT-00932, [1:3] PL/SQL(SYS.ANONYMOUS BLOCK) terminated with execute errors
[1:3] PL/SQL(DBE_STATS.COLLECT_TABLE_STATS) terminated with execute errors
CT-00843, The table or view SYS.HZY_RESUO1 does not exist.

SQL> select  PARALLEL,FINISHED from DV_STATS_RESOURCE where SQL_TEXT like '%hzy_resuo1%';

PARALLEL     FINISHED    
------------ ------------
1            0           

1 rows fetched.

SQL> 
SQL> 



