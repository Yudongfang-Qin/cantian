

SQL> --������default group��ѯDV_RSRC_MONITOR����core
SQL> call DBE_RSRC_MGR.create_plan('tnt_plan', 'plan for tenant', 1);

PL/SQL procedure successfully completed.

SQL> alter system set resource_plan = 'tnt_plan';

Succeed.

SQL> SELECT TENANT_NAME, SESSIONS FROM DV_RSRC_MONITOR;

TENANT_NAME                      SESSIONS    
-------------------------------- ------------

0 rows fetched.

SQL> 
SQL> --�⻧������ʱ����������ѯDV_RSRC_MONITOR�������Ǳ����⻧������
SQL> call DBE_RSRC_MGR.CREATE_CONTROL_GROUP('tnt_group1', 'tenant group1 description');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.CREATE_CONTROL_GROUP('tnt_group2', 'tenant group2 description');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt1', 'tnt_group1');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt2', 'tnt_group2');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.CREATE_PLAN_RULE('tnt_plan', 'tnt_group1', 'plan for tnt_group1', 40, 200, 200, 120, 1000, NULL, NULL, NULL);

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.CREATE_PLAN_RULE('tnt_plan', 'tnt_group2', 'plan for tnt_group2', 10, 20, 20, 10, 100, NULL, NULL, NULL);

PL/SQL procedure successfully completed.

SQL> alter system set resource_plan = 'tnt_plan';

Succeed.

SQL> SELECT TENANT_NAME, SESSIONS FROM DV_RSRC_MONITOR;

TENANT_NAME                      SESSIONS    
-------------------------------- ------------
TNT1                             0           
TNT2                             0           

2 rows fetched.

SQL> 
SQL> --�����⻧���⻧�е��û�ֻ�ܲ�ѯ��ǰ�⻧�ļ��
SQL> create tenant tnt1 tablespaces(users);

Succeed.

SQL> alter session set tenant=tnt1;

Succeed.

SQL> create user user1 identified by Hust4400;

Succeed.

SQL> grant dba to user1;

Succeed.

SQL> conn user1/Hust4400@127.0.0.1:1611/tnt1

connected.

SQL> SELECT TENANT_NAME, SESSIONS FROM DV_RSRC_MONITOR;

TENANT_NAME                      SESSIONS    
-------------------------------- ------------
TNT1                             1           

1 rows fetched.

SQL> 
SQL> --������
SQL> conn / as  sysdba 

connected.

SQL> alter system set resource_plan = '';

Succeed.

SQL> call DBE_RSRC_MGR.DELETE_PLAN('tnt_plan');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.DELETE_CONTROL_GROUP('tnt_group1');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.DELETE_CONTROL_GROUP('tnt_group2');

PL/SQL procedure successfully completed.

SQL> SELECT TENANT_NAME, SESSIONS FROM DV_RSRC_MONITOR;

TENANT_NAME                      SESSIONS    
-------------------------------- ------------

0 rows fetched.

SQL> drop tenant if exists tnt1 cascade;

Succeed.

SQL> 
SQL> conn sys/Huawei@123@127.0.0.1:1611/a12345678901234567890123456789012

CT-00748, tenant name length is exceeded. name len = 33, max_len = 32

SQL> conn sys/Huawei@123@127.0.0.1:1611/a1234567890123456789012345678901

CT-00329, Incorrect user or password

SQL> conn / as  sysdba 

connected.

SQL> drop TENANT  if exists TNT058 cascade;

Succeed.

SQL> CREATE TENANT TNT058 TABLESPACES (users);

Succeed.

SQL> ALTER SESSION SET TENANT=TNT058;

Succeed.

SQL> drop user if exists tenant_user_058 cascade;

Succeed.

SQL> create user tenant_user_058 identified by Cantian_234;

Succeed.

SQL> grant dba to tenant_user_058;

Succeed.

SQL> conn tenant_user_058/Cantian_234@127.0.0.1:1611/TNT058

connected.

SQL> select count(*) from GADM_TABLES;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GADM_TABLESPACES;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GADM_TAB_MODIFICATIONS;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GDV_BUFFER_POOLS;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GDV_DATA_FILES;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GDV_GLOBAL_TRANSACTIONS;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GDV_GMA_STATS;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GDV_HA_SYNC_INFO;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GDV_LOG_FILES;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GDV_PARAMETERS;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GDV_SYS_STATS;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GDV_TABLESPACES;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GMY_INDEXES;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GMY_TABLES;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GMY_TAB_MODIFICATIONS;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GSYS_PENDING_DIST_TRANS;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> select count(*) from GSYS_PENDING_TRANS;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> conn / as  sysdba 

connected.

SQL> drop TENANT  if exists TNT058 cascade;

Succeed.

SQL> conn / as sysdba

connected.

SQL> drop tenant if exists tnt1 cascade;

Succeed.

SQL> create tenant tnt1 tablespaces (users);

Succeed.

SQL> alter session set tenant = tnt1;

Succeed.

SQL> create user u1 identified by Changeme_123;

Succeed.

SQL> grant connect,create table to u1;

Succeed.

SQL> create user u2 identified by Changeme_123;

Succeed.

SQL> grant connect,create table to u2;

Succeed.

SQL> conn u1/Changeme_123@127.0.0.1:1611/tnt1

connected.

SQL> create table t1(id int);

Succeed.

SQL> insert into t1 values(1),(2);

2 rows affected.

SQL> commit;

Succeed.

SQL> grant all on t1 to public;

Succeed.

SQL> conn u2/Changeme_123@127.0.0.1:1611/tnt1

connected.

SQL> select * from u1.t1;

ID          
------------
1           
2           

2 rows fetched.

SQL> conn / as sysdba

connected.

SQL> drop tenant if exists tnt1 cascade;

Succeed.

SQL> conn / as sysdba 

connected.

SQL> drop tenant if exists tn1 cascade;

Succeed.

SQL> create role tenatrole1;

Succeed.

SQL> create tenant tn1 tablespaces(users);

Succeed.

SQL> alter session set tenant = tn1;

Succeed.

SQL> create user u1 identified by Cantian_234;

Succeed.

SQL> grant connect, create table to u1;

Succeed.

SQL> conn u1/Cantian_234@127.0.0.1:1611/tn1

connected.

SQL> create table t1(id int);

Succeed.

SQL> grant select on t1 to tenatrole1;

Succeed.

SQL> conn / as sysdba 

connected.

SQL> drop tenant if exists tn1 cascade;

Succeed.

SQL> drop role tenatrole1;

Succeed.

SQL> --0.�����ڵ�tenant
SQL> CONN tnt4_user/Root1234@127.0.0.1:1611/TNTat3456

CT-00329, Incorrect user or password

SQL> 
SQL> --DTS2020060805DCOPP0I00
SQL> CONN / AS SYSDBA

connected.

SQL> SELECT USERNAME,USER_ID FROM MY_USERS;

USERNAME                                                         USER_ID     
---------------------------------------------------------------- ------------
SYS                                                              0           

1 rows fetched.

SQL> 
SQL> --DTS20200609039IHIP0F00 
SQL> CONN u_tnt_sec_tenant_ctsql_1xxxxxxxxx/Changeme_123@127.0.0.1:1611/tnt2tnt2tnt2tnt2tnt2tnt2tnt2tnt2

CT-00329, Incorrect user or password

SQL> CONN / AS SYSDBA

connected.

SQL> 
SQL> --USERS��Ϊ�Ǹ��⻧�Ŀ��ñ�ռ�
SQL> create tenant tnt1 tablespaces (users) default tablespace users;

Succeed.

SQL> alter session set tenant=tnt1;

Succeed.

SQL> create user tnt1_user identified by Root1234;

Succeed.

SQL> grant dba to tnt1_user;

Succeed.

SQL> conn tnt1_user/Root1234@127.0.0.1:1611/tnt1

connected.

SQL> select USER_NAME from dv_me;

USER_NAME                                                       
----------------------------------------------------------------
TNT1$TNT1_USER                                                  

1 rows fetched.

SQL> select USERNAME,DEFAULT_TABLESPACE from my_users;

USERNAME                                                         DEFAULT_TABLESPACE                                              
---------------------------------------------------------------- ----------------------------------------------------------------
TNT1$TNT1_USER                                                   USERS                                                           

1 rows fetched.

SQL> create table t1(c1 int);

Succeed.

SQL> select OWNER,TABLE_NAME,TABLESPACE_NAME from db_tables;

OWNER                                                            TABLE_NAME                                                       TABLESPACE_NAME                                                 
---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
TNT1$TNT1_USER                                                   T1                                                               USERS                                                           

1 rows fetched.

SQL> CONN / AS SYSDBA

connected.

SQL> DROP TENANT tnt1 CASCADE;

Succeed.

SQL> 
SQL> --����tablespace����
SQL> create tablespace tnt_space1 datafile 'tnt_space1.dbf' size 128m;

Succeed.

SQL> create tablespace tnt_space2 datafile 'tnt_space2.dbf' size 128m;

Succeed.

SQL> create tablespace tnt_space3 datafile 'tnt_space3.dbf' size 128m;

Succeed.

SQL> create tablespace tnt_space4 datafile 'tnt_space4.dbf' size 128m;

Succeed.

SQL> 
SQL> --1.�������� ����/��ѯ/�޸�/ɾ�� tenant ��ͼ
SQL> drop tenant if exists tnt1;

Succeed.

SQL> create tenant tnt1 tablespaces (tnt_space1,tnt_space2) default tablespace tnt_space2;

Succeed.

SQL> select TENANT_ID,NAME,SPACE_NUM,OPTIONS from sys_tenants order by tenant_id;

TENANT_ID    NAME                             SPACE_NUM    OPTIONS                                                         
------------ -------------------------------- ------------ ----------------------------------------------------------------
0            TENANT$ROOT                      0                                                                            
1            TNT1                             2                                                                            

2 rows fetched.

SQL> select TENANT_ID,NAME,DEFAULT_TABLESPACE,SPACE_NUM from adm_tenants order by TENANT_ID;

TENANT_ID    NAME                             DEFAULT_TABLESPACE                                               SPACE_NUM   
------------ -------------------------------- ---------------------------------------------------------------- ------------
0            TENANT$ROOT                      USERS                                                            0           
1            TNT1                             TNT_SPACE2                                                       2           

2 rows fetched.

SQL> alter tenant tnt1 add tablespaces (tnt_space3, tnt_space4);

Succeed.

SQL> select TENANT_ID,NAME,SPACE_NUM,OPTIONS from sys_tenants order by tenant_id;

TENANT_ID    NAME                             SPACE_NUM    OPTIONS                                                         
------------ -------------------------------- ------------ ----------------------------------------------------------------
0            TENANT$ROOT                      0                                                                            
1            TNT1                             4                                                                            

2 rows fetched.

SQL> select TENANT_ID,NAME,DEFAULT_TABLESPACE,SPACE_NUM from adm_tenants order by TENANT_ID;

TENANT_ID    NAME                             DEFAULT_TABLESPACE                                               SPACE_NUM   
------------ -------------------------------- ---------------------------------------------------------------- ------------
0            TENANT$ROOT                      USERS                                                            0           
1            TNT1                             TNT_SPACE2                                                       4           

2 rows fetched.

SQL> alter tenant tnt1 default tablespace tnt_space1;

Succeed.

SQL> select TENANT_ID,NAME,SPACE_NUM,OPTIONS from sys_tenants order by tenant_id;

TENANT_ID    NAME                             SPACE_NUM    OPTIONS                                                         
------------ -------------------------------- ------------ ----------------------------------------------------------------
0            TENANT$ROOT                      0                                                                            
1            TNT1                             4                                                                            

2 rows fetched.

SQL> select TENANT_ID,NAME,DEFAULT_TABLESPACE,SPACE_NUM from adm_tenants order by TENANT_ID;

TENANT_ID    NAME                             DEFAULT_TABLESPACE                                               SPACE_NUM   
------------ -------------------------------- ---------------------------------------------------------------- ------------
0            TENANT$ROOT                      USERS                                                            0           
1            TNT1                             TNT_SPACE1                                                       4           

2 rows fetched.

SQL> drop tenant tnt1;

Succeed.

SQL> select TENANT_ID,NAME,SPACE_NUM,OPTIONS from sys_tenants order by tenant_id;

TENANT_ID    NAME                             SPACE_NUM    OPTIONS                                                         
------------ -------------------------------- ------------ ----------------------------------------------------------------
0            TENANT$ROOT                      0                                                                            

1 rows fetched.

SQL> select TENANT_ID,NAME,DEFAULT_TABLESPACE,SPACE_NUM from adm_tenants order by TENANT_ID;

TENANT_ID    NAME                             DEFAULT_TABLESPACE                                               SPACE_NUM   
------------ -------------------------------- ---------------------------------------------------------------- ------------
0            TENANT$ROOT                      USERS                                                            0           

1 rows fetched.

SQL> 
SQL> --2.�߽���� ���֧��255��tenant ����/�޸�tenant������֧��1024��tablespace
SQL> declare
  2   str varchar(100);
  3 begin
  4   for i in 1..255 loop
  5     str := 'create tenant tnt'||to_char(i)||' tablespaces (tnt_space1,tnt_space2) default tablespace tnt_space2';
  6     execute immediate str;
  7   end loop;
  8 end;
  9 /

PL/SQL procedure successfully completed.

SQL> select TENANT_ID,NAME,SPACE_NUM,OPTIONS from sys_tenants order by tenant_id;

TENANT_ID    NAME                             SPACE_NUM    OPTIONS                                                         
------------ -------------------------------- ------------ ----------------------------------------------------------------
0            TENANT$ROOT                      0                                                                            
1            TNT1                             2                                                                            
2            TNT2                             2                                                                            
3            TNT3                             2                                                                            
4            TNT4                             2                                                                            
5            TNT5                             2                                                                            
6            TNT6                             2                                                                            
7            TNT7                             2                                                                            
8            TNT8                             2                                                                            
9            TNT9                             2                                                                            
10           TNT10                            2                                                                            
11           TNT11                            2                                                                            
12           TNT12                            2                                                                            
13           TNT13                            2                                                                            
14           TNT14                            2                                                                            
15           TNT15                            2                                                                            
16           TNT16                            2                                                                            
17           TNT17                            2                                                                            
18           TNT18                            2                                                                            
19           TNT19                            2                                                                            
20           TNT20                            2                                                                            
21           TNT21                            2                                                                            
22           TNT22                            2                                                                            
23           TNT23                            2                                                                            
24           TNT24                            2                                                                            
25           TNT25                            2                                                                            
26           TNT26                            2                                                                            
27           TNT27                            2                                                                            
28           TNT28                            2                                                                            
29           TNT29                            2                                                                            
30           TNT30                            2                                                                            
31           TNT31                            2                                                                            
32           TNT32                            2                                                                            
33           TNT33                            2                                                                            
34           TNT34                            2                                                                            
35           TNT35                            2                                                                            
36           TNT36                            2                                                                            
37           TNT37                            2                                                                            
38           TNT38                            2                                                                            
39           TNT39                            2                                                                            
40           TNT40                            2                                                                            
41           TNT41                            2                                                                            
42           TNT42                            2                                                                            
43           TNT43                            2                                                                            
44           TNT44                            2                                                                            
45           TNT45                            2                                                                            
46           TNT46                            2                                                                            
47           TNT47                            2                                                                            
48           TNT48                            2                                                                            
49           TNT49                            2                                                                            
50           TNT50                            2                                                                            
51           TNT51                            2                                                                            
52           TNT52                            2                                                                            
53           TNT53                            2                                                                            
54           TNT54                            2                                                                            
55           TNT55                            2                                                                            
56           TNT56                            2                                                                            
57           TNT57                            2                                                                            
58           TNT58                            2                                                                            
59           TNT59                            2                                                                            
60           TNT60                            2                                                                            
61           TNT61                            2                                                                            
62           TNT62                            2                                                                            
63           TNT63                            2                                                                            
64           TNT64                            2                                                                            
65           TNT65                            2                                                                            
66           TNT66                            2                                                                            
67           TNT67                            2                                                                            
68           TNT68                            2                                                                            
69           TNT69                            2                                                                            
70           TNT70                            2                                                                            
71           TNT71                            2                                                                            
72           TNT72                            2                                                                            
73           TNT73                            2                                                                            
74           TNT74                            2                                                                            
75           TNT75                            2                                                                            
76           TNT76                            2                                                                            
77           TNT77                            2                                                                            
78           TNT78                            2                                                                            
79           TNT79                            2                                                                            
80           TNT80                            2                                                                            
81           TNT81                            2                                                                            
82           TNT82                            2                                                                            
83           TNT83                            2                                                                            
84           TNT84                            2                                                                            
85           TNT85                            2                                                                            
86           TNT86                            2                                                                            
87           TNT87                            2                                                                            
88           TNT88                            2                                                                            
89           TNT89                            2                                                                            
90           TNT90                            2                                                                            
91           TNT91                            2                                                                            
92           TNT92                            2                                                                            
93           TNT93                            2                                                                            
94           TNT94                            2                                                                            
95           TNT95                            2                                                                            
96           TNT96                            2                                                                            
97           TNT97                            2                                                                            
98           TNT98                            2                                                                            
99           TNT99                            2                                                                            
100          TNT100                           2                                                                            
101          TNT101                           2                                                                            
102          TNT102                           2                                                                            
103          TNT103                           2                                                                            
104          TNT104                           2                                                                            
105          TNT105                           2                                                                            
106          TNT106                           2                                                                            
107          TNT107                           2                                                                            
108          TNT108                           2                                                                            
109          TNT109                           2                                                                            
110          TNT110                           2                                                                            
111          TNT111                           2                                                                            
112          TNT112                           2                                                                            
113          TNT113                           2                                                                            
114          TNT114                           2                                                                            
115          TNT115                           2                                                                            
116          TNT116                           2                                                                            
117          TNT117                           2                                                                            
118          TNT118                           2                                                                            
119          TNT119                           2                                                                            
120          TNT120                           2                                                                            
121          TNT121                           2                                                                            
122          TNT122                           2                                                                            
123          TNT123                           2                                                                            
124          TNT124                           2                                                                            
125          TNT125                           2                                                                            
126          TNT126                           2                                                                            
127          TNT127                           2                                                                            
128          TNT128                           2                                                                            
129          TNT129                           2                                                                            
130          TNT130                           2                                                                            
131          TNT131                           2                                                                            
132          TNT132                           2                                                                            
133          TNT133                           2                                                                            
134          TNT134                           2                                                                            
135          TNT135                           2                                                                            
136          TNT136                           2                                                                            
137          TNT137                           2                                                                            
138          TNT138                           2                                                                            
139          TNT139                           2                                                                            
140          TNT140                           2                                                                            
141          TNT141                           2                                                                            
142          TNT142                           2                                                                            
143          TNT143                           2                                                                            
144          TNT144                           2                                                                            
145          TNT145                           2                                                                            
146          TNT146                           2                                                                            
147          TNT147                           2                                                                            
148          TNT148                           2                                                                            
149          TNT149                           2                                                                            
150          TNT150                           2                                                                            
151          TNT151                           2                                                                            
152          TNT152                           2                                                                            
153          TNT153                           2                                                                            
154          TNT154                           2                                                                            
155          TNT155                           2                                                                            
156          TNT156                           2                                                                            
157          TNT157                           2                                                                            
158          TNT158                           2                                                                            
159          TNT159                           2                                                                            
160          TNT160                           2                                                                            
161          TNT161                           2                                                                            
162          TNT162                           2                                                                            
163          TNT163                           2                                                                            
164          TNT164                           2                                                                            
165          TNT165                           2                                                                            
166          TNT166                           2                                                                            
167          TNT167                           2                                                                            
168          TNT168                           2                                                                            
169          TNT169                           2                                                                            
170          TNT170                           2                                                                            
171          TNT171                           2                                                                            
172          TNT172                           2                                                                            
173          TNT173                           2                                                                            
174          TNT174                           2                                                                            
175          TNT175                           2                                                                            
176          TNT176                           2                                                                            
177          TNT177                           2                                                                            
178          TNT178                           2                                                                            
179          TNT179                           2                                                                            
180          TNT180                           2                                                                            
181          TNT181                           2                                                                            
182          TNT182                           2                                                                            
183          TNT183                           2                                                                            
184          TNT184                           2                                                                            
185          TNT185                           2                                                                            
186          TNT186                           2                                                                            
187          TNT187                           2                                                                            
188          TNT188                           2                                                                            
189          TNT189                           2                                                                            
190          TNT190                           2                                                                            
191          TNT191                           2                                                                            
192          TNT192                           2                                                                            
193          TNT193                           2                                                                            
194          TNT194                           2                                                                            
195          TNT195                           2                                                                            
196          TNT196                           2                                                                            
197          TNT197                           2                                                                            
198          TNT198                           2                                                                            
199          TNT199                           2                                                                            
200          TNT200                           2                                                                            
201          TNT201                           2                                                                            
202          TNT202                           2                                                                            
203          TNT203                           2                                                                            
204          TNT204                           2                                                                            
205          TNT205                           2                                                                            
206          TNT206                           2                                                                            
207          TNT207                           2                                                                            
208          TNT208                           2                                                                            
209          TNT209                           2                                                                            
210          TNT210                           2                                                                            
211          TNT211                           2                                                                            
212          TNT212                           2                                                                            
213          TNT213                           2                                                                            
214          TNT214                           2                                                                            
215          TNT215                           2                                                                            
216          TNT216                           2                                                                            
217          TNT217                           2                                                                            
218          TNT218                           2                                                                            
219          TNT219                           2                                                                            
220          TNT220                           2                                                                            
221          TNT221                           2                                                                            
222          TNT222                           2                                                                            
223          TNT223                           2                                                                            
224          TNT224                           2                                                                            
225          TNT225                           2                                                                            
226          TNT226                           2                                                                            
227          TNT227                           2                                                                            
228          TNT228                           2                                                                            
229          TNT229                           2                                                                            
230          TNT230                           2                                                                            
231          TNT231                           2                                                                            
232          TNT232                           2                                                                            
233          TNT233                           2                                                                            
234          TNT234                           2                                                                            
235          TNT235                           2                                                                            
236          TNT236                           2                                                                            
237          TNT237                           2                                                                            
238          TNT238                           2                                                                            
239          TNT239                           2                                                                            
240          TNT240                           2                                                                            
241          TNT241                           2                                                                            
242          TNT242                           2                                                                            
243          TNT243                           2                                                                            
244          TNT244                           2                                                                            
245          TNT245                           2                                                                            
246          TNT246                           2                                                                            
247          TNT247                           2                                                                            
248          TNT248                           2                                                                            
249          TNT249                           2                                                                            
250          TNT250                           2                                                                            
251          TNT251                           2                                                                            
252          TNT252                           2                                                                            
253          TNT253                           2                                                                            
254          TNT254                           2                                                                            
255          TNT255                           2                                                                            

256 rows fetched.

SQL> create tenant tnt256 tablespaces (tnt_space1,tnt_space2) default tablespace tnt_space2;--CT-00686, Maximum number of tenants (256) exceeded

CT-00686, Maximum number of tenants (256) exceeded
SQL> 
SQL> declare--CT-00601, Sql syntax error: exclude spaces number out of max spaces number
  2   str varchar(20000);
  3 begin
  4 	str := 'create tenant tenant_1024ts tablespaces (tnt_space1';
  5 	for i in 2..1025 loop
  6 	 str := str || ',tnt_space'||to_char(i);
  7 	end loop;
  8 	str := str || ')';
  9 	execute immediate str;
 10 end;
 11 /

CT-00932, [9:2] PL/SQL(SYS.ANONYMOUS BLOCK) terminated with execute errors
[9:2] CT-00601, Sql syntax error: exclude spaces number out of max spaces number

SQL> 
SQL> declare--CT-00601, Sql syntax error: exclude spaces number out of max spaces number
  2   str varchar(20000);
  3 begin
  4 	str := 'alter tenant tnt1 add tablespaces (tnt_space1';
  5 	for i in 2..1025 loop
  6 	 str := str || ',tnt_space'||to_char(i);
  7 	end loop;
  8 	str := str || ')';
  9 	execute immediate str;
 10 end;
 11 /

CT-00932, [9:2] PL/SQL(SYS.ANONYMOUS BLOCK) terminated with execute errors
[9:2] CT-00601, Sql syntax error: exclude spaces number out of max spaces number

SQL> 
SQL> --3.�ظ����� �ظ����/ɾ��
SQL> create or replace procedure tnt_create()
  2 as
  3   str varchar(100);
  4 begin
  5   for i in 1..255 loop
  6     str := 'create tenant tnt'||to_char(i)||' tablespaces (tnt_space1,tnt_space2)';
  7     execute immediate str;
  8   end loop;
  9 end;
 10 /

Succeed.

SQL> 
SQL> create or replace procedure tnt_drop()
  2 as
  3   str varchar(100);
  4 begin
  5   for i in 1..255 loop
  6     str := 'drop tenant tnt'||to_char(i);
  7     execute immediate str;
  8   end loop;
  9 end;
 10 /

Succeed.

SQL> 
SQL> CALL tnt_create();

CT-00932, [1:2] PL/SQL(SYS.ANONYMOUS BLOCK) terminated with execute errors
[7:5] PL/SQL(SYS.TNT_CREATE) terminated with execute errors
[7:5] CT-00753, The object tenant TNT1 already exists.

SQL> select TENANT_ID,NAME,SPACE_NUM,OPTIONS from sys_tenants order by tenant_id;

TENANT_ID    NAME                             SPACE_NUM    OPTIONS                                                         
------------ -------------------------------- ------------ ----------------------------------------------------------------
0            TENANT$ROOT                      0                                                                            
1            TNT1                             2                                                                            
2            TNT2                             2                                                                            
3            TNT3                             2                                                                            
4            TNT4                             2                                                                            
5            TNT5                             2                                                                            
6            TNT6                             2                                                                            
7            TNT7                             2                                                                            
8            TNT8                             2                                                                            
9            TNT9                             2                                                                            
10           TNT10                            2                                                                            
11           TNT11                            2                                                                            
12           TNT12                            2                                                                            
13           TNT13                            2                                                                            
14           TNT14                            2                                                                            
15           TNT15                            2                                                                            
16           TNT16                            2                                                                            
17           TNT17                            2                                                                            
18           TNT18                            2                                                                            
19           TNT19                            2                                                                            
20           TNT20                            2                                                                            
21           TNT21                            2                                                                            
22           TNT22                            2                                                                            
23           TNT23                            2                                                                            
24           TNT24                            2                                                                            
25           TNT25                            2                                                                            
26           TNT26                            2                                                                            
27           TNT27                            2                                                                            
28           TNT28                            2                                                                            
29           TNT29                            2                                                                            
30           TNT30                            2                                                                            
31           TNT31                            2                                                                            
32           TNT32                            2                                                                            
33           TNT33                            2                                                                            
34           TNT34                            2                                                                            
35           TNT35                            2                                                                            
36           TNT36                            2                                                                            
37           TNT37                            2                                                                            
38           TNT38                            2                                                                            
39           TNT39                            2                                                                            
40           TNT40                            2                                                                            
41           TNT41                            2                                                                            
42           TNT42                            2                                                                            
43           TNT43                            2                                                                            
44           TNT44                            2                                                                            
45           TNT45                            2                                                                            
46           TNT46                            2                                                                            
47           TNT47                            2                                                                            
48           TNT48                            2                                                                            
49           TNT49                            2                                                                            
50           TNT50                            2                                                                            
51           TNT51                            2                                                                            
52           TNT52                            2                                                                            
53           TNT53                            2                                                                            
54           TNT54                            2                                                                            
55           TNT55                            2                                                                            
56           TNT56                            2                                                                            
57           TNT57                            2                                                                            
58           TNT58                            2                                                                            
59           TNT59                            2                                                                            
60           TNT60                            2                                                                            
61           TNT61                            2                                                                            
62           TNT62                            2                                                                            
63           TNT63                            2                                                                            
64           TNT64                            2                                                                            
65           TNT65                            2                                                                            
66           TNT66                            2                                                                            
67           TNT67                            2                                                                            
68           TNT68                            2                                                                            
69           TNT69                            2                                                                            
70           TNT70                            2                                                                            
71           TNT71                            2                                                                            
72           TNT72                            2                                                                            
73           TNT73                            2                                                                            
74           TNT74                            2                                                                            
75           TNT75                            2                                                                            
76           TNT76                            2                                                                            
77           TNT77                            2                                                                            
78           TNT78                            2                                                                            
79           TNT79                            2                                                                            
80           TNT80                            2                                                                            
81           TNT81                            2                                                                            
82           TNT82                            2                                                                            
83           TNT83                            2                                                                            
84           TNT84                            2                                                                            
85           TNT85                            2                                                                            
86           TNT86                            2                                                                            
87           TNT87                            2                                                                            
88           TNT88                            2                                                                            
89           TNT89                            2                                                                            
90           TNT90                            2                                                                            
91           TNT91                            2                                                                            
92           TNT92                            2                                                                            
93           TNT93                            2                                                                            
94           TNT94                            2                                                                            
95           TNT95                            2                                                                            
96           TNT96                            2                                                                            
97           TNT97                            2                                                                            
98           TNT98                            2                                                                            
99           TNT99                            2                                                                            
100          TNT100                           2                                                                            
101          TNT101                           2                                                                            
102          TNT102                           2                                                                            
103          TNT103                           2                                                                            
104          TNT104                           2                                                                            
105          TNT105                           2                                                                            
106          TNT106                           2                                                                            
107          TNT107                           2                                                                            
108          TNT108                           2                                                                            
109          TNT109                           2                                                                            
110          TNT110                           2                                                                            
111          TNT111                           2                                                                            
112          TNT112                           2                                                                            
113          TNT113                           2                                                                            
114          TNT114                           2                                                                            
115          TNT115                           2                                                                            
116          TNT116                           2                                                                            
117          TNT117                           2                                                                            
118          TNT118                           2                                                                            
119          TNT119                           2                                                                            
120          TNT120                           2                                                                            
121          TNT121                           2                                                                            
122          TNT122                           2                                                                            
123          TNT123                           2                                                                            
124          TNT124                           2                                                                            
125          TNT125                           2                                                                            
126          TNT126                           2                                                                            
127          TNT127                           2                                                                            
128          TNT128                           2                                                                            
129          TNT129                           2                                                                            
130          TNT130                           2                                                                            
131          TNT131                           2                                                                            
132          TNT132                           2                                                                            
133          TNT133                           2                                                                            
134          TNT134                           2                                                                            
135          TNT135                           2                                                                            
136          TNT136                           2                                                                            
137          TNT137                           2                                                                            
138          TNT138                           2                                                                            
139          TNT139                           2                                                                            
140          TNT140                           2                                                                            
141          TNT141                           2                                                                            
142          TNT142                           2                                                                            
143          TNT143                           2                                                                            
144          TNT144                           2                                                                            
145          TNT145                           2                                                                            
146          TNT146                           2                                                                            
147          TNT147                           2                                                                            
148          TNT148                           2                                                                            
149          TNT149                           2                                                                            
150          TNT150                           2                                                                            
151          TNT151                           2                                                                            
152          TNT152                           2                                                                            
153          TNT153                           2                                                                            
154          TNT154                           2                                                                            
155          TNT155                           2                                                                            
156          TNT156                           2                                                                            
157          TNT157                           2                                                                            
158          TNT158                           2                                                                            
159          TNT159                           2                                                                            
160          TNT160                           2                                                                            
161          TNT161                           2                                                                            
162          TNT162                           2                                                                            
163          TNT163                           2                                                                            
164          TNT164                           2                                                                            
165          TNT165                           2                                                                            
166          TNT166                           2                                                                            
167          TNT167                           2                                                                            
168          TNT168                           2                                                                            
169          TNT169                           2                                                                            
170          TNT170                           2                                                                            
171          TNT171                           2                                                                            
172          TNT172                           2                                                                            
173          TNT173                           2                                                                            
174          TNT174                           2                                                                            
175          TNT175                           2                                                                            
176          TNT176                           2                                                                            
177          TNT177                           2                                                                            
178          TNT178                           2                                                                            
179          TNT179                           2                                                                            
180          TNT180                           2                                                                            
181          TNT181                           2                                                                            
182          TNT182                           2                                                                            
183          TNT183                           2                                                                            
184          TNT184                           2                                                                            
185          TNT185                           2                                                                            
186          TNT186                           2                                                                            
187          TNT187                           2                                                                            
188          TNT188                           2                                                                            
189          TNT189                           2                                                                            
190          TNT190                           2                                                                            
191          TNT191                           2                                                                            
192          TNT192                           2                                                                            
193          TNT193                           2                                                                            
194          TNT194                           2                                                                            
195          TNT195                           2                                                                            
196          TNT196                           2                                                                            
197          TNT197                           2                                                                            
198          TNT198                           2                                                                            
199          TNT199                           2                                                                            
200          TNT200                           2                                                                            
201          TNT201                           2                                                                            
202          TNT202                           2                                                                            
203          TNT203                           2                                                                            
204          TNT204                           2                                                                            
205          TNT205                           2                                                                            
206          TNT206                           2                                                                            
207          TNT207                           2                                                                            
208          TNT208                           2                                                                            
209          TNT209                           2                                                                            
210          TNT210                           2                                                                            
211          TNT211                           2                                                                            
212          TNT212                           2                                                                            
213          TNT213                           2                                                                            
214          TNT214                           2                                                                            
215          TNT215                           2                                                                            
216          TNT216                           2                                                                            
217          TNT217                           2                                                                            
218          TNT218                           2                                                                            
219          TNT219                           2                                                                            
220          TNT220                           2                                                                            
221          TNT221                           2                                                                            
222          TNT222                           2                                                                            
223          TNT223                           2                                                                            
224          TNT224                           2                                                                            
225          TNT225                           2                                                                            
226          TNT226                           2                                                                            
227          TNT227                           2                                                                            
228          TNT228                           2                                                                            
229          TNT229                           2                                                                            
230          TNT230                           2                                                                            
231          TNT231                           2                                                                            
232          TNT232                           2                                                                            
233          TNT233                           2                                                                            
234          TNT234                           2                                                                            
235          TNT235                           2                                                                            
236          TNT236                           2                                                                            
237          TNT237                           2                                                                            
238          TNT238                           2                                                                            
239          TNT239                           2                                                                            
240          TNT240                           2                                                                            
241          TNT241                           2                                                                            
242          TNT242                           2                                                                            
243          TNT243                           2                                                                            
244          TNT244                           2                                                                            
245          TNT245                           2                                                                            
246          TNT246                           2                                                                            
247          TNT247                           2                                                                            
248          TNT248                           2                                                                            
249          TNT249                           2                                                                            
250          TNT250                           2                                                                            
251          TNT251                           2                                                                            
252          TNT252                           2                                                                            
253          TNT253                           2                                                                            
254          TNT254                           2                                                                            
255          TNT255                           2                                                                            

256 rows fetched.

SQL> CALL tnt_drop();

PL/SQL procedure successfully completed.

SQL> select TENANT_ID,NAME,SPACE_NUM,OPTIONS from sys_tenants order by tenant_id;

TENANT_ID    NAME                             SPACE_NUM    OPTIONS                                                         
------------ -------------------------------- ------------ ----------------------------------------------------------------
0            TENANT$ROOT                      0                                                                            

1 rows fetched.

SQL> begin
  2  for i in 1..10 loop
  3   tnt_create();
  4   tnt_drop();
  5  end loop;
  6 end;
  7 /

PL/SQL procedure successfully completed.

SQL> select TENANT_ID,NAME,SPACE_NUM,OPTIONS from sys_tenants order by tenant_id;

TENANT_ID    NAME                             SPACE_NUM    OPTIONS                                                         
------------ -------------------------------- ------------ ----------------------------------------------------------------
0            TENANT$ROOT                      0                                                                            

1 rows fetched.

SQL> drop procedure tnt_create;

Succeed.

SQL> drop procedure tnt_drop;

Succeed.

SQL> 
SQL> --4.������� ����/�޸�ROOT/ts�����ڵȴ������
SQL> drop tenant if exists tnt1;

Succeed.

SQL> drop tenant if exists tnt2;

Succeed.

SQL> --tenant����
SQL> create tenant tnt1 tablespaces (tnt_space1,tnt_space2);

Succeed.

SQL> create tenant tnt1 tablespaces (tnt_space1);--CT-00753, The object tenant TNT1 already exists.

CT-00753, The object tenant TNT1 already exists.
SQL> select TENANT_ID,NAME,SPACE_NUM,OPTIONS from sys_tenants order by tenant_id;

TENANT_ID    NAME                             SPACE_NUM    OPTIONS                                                         
------------ -------------------------------- ------------ ----------------------------------------------------------------
0            TENANT$ROOT                      0                                                                            
1            TNT1                             2                                                                            

2 rows fetched.

SQL> --ts�ظ�
SQL> alter tenant tnt1 add tablespaces (tnt_space1);--CT-01394, Tablespace TNT_SPACE1 is already usable in current tenant

CT-01393, Tablespace TNT_SPACE1 is already usable in current tenant
SQL> create tenant tnt2 tablespaces (tnt_space1,tnt_space1);--CT-00601, Sql syntax error: tablespace tnt_space1 is already exists

CT-00601, Sql syntax error: tablespace TNT_SPACE1 is already exists
SQL> --ts������
SQL> create tenant tnt2 tablespaces (tnt_space5, tnt_space4);--CT-00780, The tablespace TNT_SPACE5 does not exist.

CT-00780, The tablespace TNT_SPACE5 does not exist.
SQL> create tenant tnt2 tablespaces (tnt_space4, tnt_space5);--CT-00780, The tablespace TNT_SPACE5 does not exist.

CT-00780, The tablespace TNT_SPACE5 does not exist.
SQL> alter tenant tnt1 add tablespaces (tnt_space4, tnt_space5);--CT-00780, The tablespace TNT_SPACE5 does not exist.

CT-00780, The tablespace TNT_SPACE5 does not exist.
SQL> alter tenant tnt1 add tablespaces (tnt_space5, tnt_space4);--CT-00780, The tablespace TNT_SPACE5 does not exist.

CT-00780, The tablespace TNT_SPACE5 does not exist.
SQL> alter tenant tnt1 default tablespace tnt_space3;--CT-01391, Tablespace TNT_SPACE3 is disabled in current tenant

CT-01391, Tablespace TNT_SPACE3 is disabled in current tenant
SQL> alter tenant tnt1 default tablespace tnt_space5;--CT-00780, The tablespace TNT_SPACE5 does not exist.

CT-00780, The tablespace TNT_SPACE5 does not exist.
SQL> --�޸�root
SQL> create tenant tenant$root tablespaces (tnt_space1);--CT-00601, [1:15]Sql syntax error: invalid variant/object name was found

CT-00601, [1:15]Sql syntax error: invalid variant/object name was found
SQL> alter tenant tenant$root add tablespaces (tnt_space1);--CT-00601, [1:14]Sql syntax error: invalid variant/object name was found

CT-00601, [1:14]Sql syntax error: invalid variant/object name was found
SQL> alter tenant tenant$root default tablespace tnt_space2;--CT-00601, [1:14]Sql syntax error: invalid variant/object name was found

CT-00601, [1:14]Sql syntax error: invalid variant/object name was found
SQL> select TENANT_ID,NAME,SPACE_NUM,OPTIONS from sys_tenants order by tenant_id;

TENANT_ID    NAME                             SPACE_NUM    OPTIONS                                                         
------------ -------------------------------- ------------ ----------------------------------------------------------------
0            TENANT$ROOT                      0                                                                            
1            TNT1                             2                                                                            

2 rows fetched.

SQL> drop tenant if exists tnt1;

Succeed.

SQL> 
SQL> --5.��Դ��������Դ��ظ���
SQL> drop tenant if exists tnt1;

Succeed.

SQL> drop tenant if exists tnt2;

Succeed.

SQL> drop tenant if exists tnt3;

Succeed.

SQL> drop tenant if exists tnt4;

Succeed.

SQL> --����tenant
SQL> create tenant tnt1 tablespaces (tnt_space1);

Succeed.

SQL> create tenant tnt2 tablespaces (tnt_space2);

Succeed.

SQL> create tenant tnt3 tablespaces (tnt_space3);

Succeed.

SQL> create tenant tnt4 tablespaces (tnt_space4);

Succeed.

SQL> --����user
SQL> alter session set tenant=tnt1;

Succeed.

SQL> create user tnt1_user identified by Root1234;

Succeed.

SQL> grant dba to tnt1_user;

Succeed.

SQL> alter session set tenant=tnt2;

Succeed.

SQL> create user tnt2_user identified by Root1234;

Succeed.

SQL> grant dba to tnt2_user;

Succeed.

SQL> alter session set tenant=tnt3;

Succeed.

SQL> create user tnt3_user identified by Root1234;

Succeed.

SQL> grant dba to tnt3_user;

Succeed.

SQL> alter session set tenant=tnt4;

Succeed.

SQL> create user tnt4_user identified by Root1234;

Succeed.

SQL> grant dba to tnt4_user;

Succeed.

SQL> --������Դ����
SQL> alter session set tenant=tenant$root;

Succeed.

SQL> alter session set current_schema=sys;

Succeed.

SQL> call DBE_RSRC_MGR.CREATE_PLAN('tnt_plan', 'plan for tenant', 1);

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.CREATE_CONTROL_GROUP('tnt_group1', 'tenant group1 description');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.CREATE_CONTROL_GROUP('tnt_group2', 'tenant group2 description');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt1', 'tnt_group1');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt2', 'tnt_group2');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt3', 'tnt_group2');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.CREATE_PLAN_RULE('tnt_plan', 'tnt_group1', 'plan for tnt_group1', 40, 200, 200, 120, 1000, NULL, NULL, NULL);

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.CREATE_PLAN_RULE('tnt_plan', 'tnt_group2', 'plan for tnt_group2', 10, 20, 20, 10, 100, NULL, NULL, NULL);

PL/SQL procedure successfully completed.

SQL> alter system set resource_plan = 'tnt_plan';

Succeed.

SQL> --��ѯ���
SQL> select PLAN,NUM_PLAN_RULES,COMMENTS,TYPE# from ADM_RSRC_PLANS order by PLAN;

PLAN                                                             NUM_PLAN_RULES COMMENTS                                                         TYPE#       
---------------------------------------------------------------- -------------- ---------------------------------------------------------------- ------------
TNT_PLAN                                                         3              plan for tenant                                                  1           

1 rows fetched.

SQL> select CONTROL_GROUP,COMMENTS from ADM_RSRC_CONTROL_GROUPS order by CONTROL_GROUP;

CONTROL_GROUP                                                    COMMENTS                                                        
---------------------------------------------------------------- ----------------------------------------------------------------
DEFAULT_GROUPS                                                   Control group for users or tenants not assigned to any control group
TNT_GROUP1                                                       tenant group1 description                                       
TNT_GROUP2                                                       tenant group2 description                                       

3 rows fetched.

SQL> select * from ADM_RSRC_GROUP_MAPPINGS order by VALUE;

ATTRIBUTE                                                        VALUE                                                            CONTROL_GROUP                                                   
---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
TENANT                                                           TNT1                                                             TNT_GROUP1                                                      
TENANT                                                           TNT2                                                             TNT_GROUP2                                                      
TENANT                                                           TNT3                                                             TNT_GROUP2                                                      

3 rows fetched.

SQL> select TENANT_NAME, SESSIONS, SESSION_LIMIT_HIT, ACTIVE_SESSIONS from DV_RSRC_MONITOR ORDER BY TENANT_NAME;

TENANT_NAME                      SESSIONS     SESSION_LIMIT_HIT    ACTIVE_SESSIONS
-------------------------------- ------------ -------------------- ---------------
TNT1                             0            0                    0              
TNT2                             0            0                    0              
TNT3                             0            0                    0              

3 rows fetched.

SQL> select * from DV_TENANT_TABLESPACES;

TENANT_NAME                      TABLESPACE_NAME                                                 
-------------------------------- ----------------------------------------------------------------
TNT1                             TNT_SPACE1                                                      
TNT2                             TNT_SPACE2                                                      
TNT3                             TNT_SPACE3                                                      
TNT4                             TNT_SPACE4                                                      

4 rows fetched.

SQL> --��¼TNT1��tnt1_user��ѯ���
SQL> CONN tnt1_user/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> select PLAN,NUM_PLAN_RULES,COMMENTS,TYPE# from ADM_RSRC_PLANS order by PLAN;

PLAN                                                             NUM_PLAN_RULES COMMENTS                                                         TYPE#       
---------------------------------------------------------------- -------------- ---------------------------------------------------------------- ------------
TNT_PLAN                                                         3              plan for tenant                                                  1           

1 rows fetched.

SQL> select CONTROL_GROUP,COMMENTS from ADM_RSRC_CONTROL_GROUPS order by CONTROL_GROUP;

CONTROL_GROUP                                                    COMMENTS                                                        
---------------------------------------------------------------- ----------------------------------------------------------------
DEFAULT_GROUPS                                                   Control group for users or tenants not assigned to any control group
TNT_GROUP1                                                       tenant group1 description                                       
TNT_GROUP2                                                       tenant group2 description                                       

3 rows fetched.

SQL> select * from ADM_RSRC_GROUP_MAPPINGS order by VALUE;

ATTRIBUTE                                                        VALUE                                                            CONTROL_GROUP                                                   
---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
TENANT                                                           TNT1                                                             TNT_GROUP1                                                      
TENANT                                                           TNT2                                                             TNT_GROUP2                                                      
TENANT                                                           TNT3                                                             TNT_GROUP2                                                      

3 rows fetched.

SQL> select TENANT_NAME, SESSIONS, SESSION_LIMIT_HIT, ACTIVE_SESSIONS from DV_RSRC_MONITOR ORDER BY TENANT_NAME;

TENANT_NAME                      SESSIONS     SESSION_LIMIT_HIT    ACTIVE_SESSIONS
-------------------------------- ------------ -------------------- ---------------
TNT1                             1            0                    1              

1 rows fetched.

SQL> select * from DV_TENANT_TABLESPACES;

TENANT_NAME                      TABLESPACE_NAME                                                 
-------------------------------- ----------------------------------------------------------------
TNT1                             TNT_SPACE1                                                      

1 rows fetched.

SQL> --��¼TNT2��tnt2_user��ѯ���
SQL> CONN tnt2_user/Root1234@127.0.0.1:1611/TNT2

connected.

SQL> select PLAN,NUM_PLAN_RULES,COMMENTS,TYPE# from ADM_RSRC_PLANS order by PLAN;

PLAN                                                             NUM_PLAN_RULES COMMENTS                                                         TYPE#       
---------------------------------------------------------------- -------------- ---------------------------------------------------------------- ------------
TNT_PLAN                                                         3              plan for tenant                                                  1           

1 rows fetched.

SQL> select CONTROL_GROUP,COMMENTS from ADM_RSRC_CONTROL_GROUPS order by CONTROL_GROUP;

CONTROL_GROUP                                                    COMMENTS                                                        
---------------------------------------------------------------- ----------------------------------------------------------------
DEFAULT_GROUPS                                                   Control group for users or tenants not assigned to any control group
TNT_GROUP1                                                       tenant group1 description                                       
TNT_GROUP2                                                       tenant group2 description                                       

3 rows fetched.

SQL> select * from ADM_RSRC_GROUP_MAPPINGS order by VALUE;

ATTRIBUTE                                                        VALUE                                                            CONTROL_GROUP                                                   
---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
TENANT                                                           TNT1                                                             TNT_GROUP1                                                      
TENANT                                                           TNT2                                                             TNT_GROUP2                                                      
TENANT                                                           TNT3                                                             TNT_GROUP2                                                      

3 rows fetched.

SQL> select TENANT_NAME, SESSIONS, SESSION_LIMIT_HIT, ACTIVE_SESSIONS from DV_RSRC_MONITOR ORDER BY TENANT_NAME;

TENANT_NAME                      SESSIONS     SESSION_LIMIT_HIT    ACTIVE_SESSIONS
-------------------------------- ------------ -------------------- ---------------
TNT2                             1            0                    1              

1 rows fetched.

SQL> select * from DV_TENANT_TABLESPACES;

TENANT_NAME                      TABLESPACE_NAME                                                 
-------------------------------- ----------------------------------------------------------------
TNT2                             TNT_SPACE2                                                      

1 rows fetched.

SQL> --��¼TNT3��tnt3_user��ѯ���
SQL> CONN tnt3_user/Root1234@127.0.0.1:1611/TNT3

connected.

SQL> select PLAN,NUM_PLAN_RULES,COMMENTS,TYPE# from ADM_RSRC_PLANS order by PLAN;

PLAN                                                             NUM_PLAN_RULES COMMENTS                                                         TYPE#       
---------------------------------------------------------------- -------------- ---------------------------------------------------------------- ------------
TNT_PLAN                                                         3              plan for tenant                                                  1           

1 rows fetched.

SQL> select CONTROL_GROUP,COMMENTS from ADM_RSRC_CONTROL_GROUPS order by CONTROL_GROUP;

CONTROL_GROUP                                                    COMMENTS                                                        
---------------------------------------------------------------- ----------------------------------------------------------------
DEFAULT_GROUPS                                                   Control group for users or tenants not assigned to any control group
TNT_GROUP1                                                       tenant group1 description                                       
TNT_GROUP2                                                       tenant group2 description                                       

3 rows fetched.

SQL> select * from ADM_RSRC_GROUP_MAPPINGS order by VALUE;

ATTRIBUTE                                                        VALUE                                                            CONTROL_GROUP                                                   
---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
TENANT                                                           TNT1                                                             TNT_GROUP1                                                      
TENANT                                                           TNT2                                                             TNT_GROUP2                                                      
TENANT                                                           TNT3                                                             TNT_GROUP2                                                      

3 rows fetched.

SQL> select TENANT_NAME, SESSIONS, SESSION_LIMIT_HIT, ACTIVE_SESSIONS from DV_RSRC_MONITOR ORDER BY TENANT_NAME;

TENANT_NAME                      SESSIONS     SESSION_LIMIT_HIT    ACTIVE_SESSIONS
-------------------------------- ------------ -------------------- ---------------
TNT3                             1            0                    1              

1 rows fetched.

SQL> select * from DV_TENANT_TABLESPACES;

TENANT_NAME                      TABLESPACE_NAME                                                 
-------------------------------- ----------------------------------------------------------------
TNT3                             TNT_SPACE3                                                      

1 rows fetched.

SQL> --��¼TNT4��tnt4_user��ѯ���
SQL> CONN tnt4_user/Root1234@127.0.0.1:1611/TNT4

connected.

SQL> select PLAN,NUM_PLAN_RULES,COMMENTS,TYPE# from ADM_RSRC_PLANS order by PLAN;

PLAN                                                             NUM_PLAN_RULES COMMENTS                                                         TYPE#       
---------------------------------------------------------------- -------------- ---------------------------------------------------------------- ------------
TNT_PLAN                                                         3              plan for tenant                                                  1           

1 rows fetched.

SQL> select CONTROL_GROUP,COMMENTS from ADM_RSRC_CONTROL_GROUPS order by CONTROL_GROUP;

CONTROL_GROUP                                                    COMMENTS                                                        
---------------------------------------------------------------- ----------------------------------------------------------------
DEFAULT_GROUPS                                                   Control group for users or tenants not assigned to any control group
TNT_GROUP1                                                       tenant group1 description                                       
TNT_GROUP2                                                       tenant group2 description                                       

3 rows fetched.

SQL> select * from ADM_RSRC_GROUP_MAPPINGS order by VALUE;

ATTRIBUTE                                                        VALUE                                                            CONTROL_GROUP                                                   
---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
TENANT                                                           TNT1                                                             TNT_GROUP1                                                      
TENANT                                                           TNT2                                                             TNT_GROUP2                                                      
TENANT                                                           TNT3                                                             TNT_GROUP2                                                      

3 rows fetched.

SQL> select TENANT_NAME, SESSIONS, SESSION_LIMIT_HIT, ACTIVE_SESSIONS from DV_RSRC_MONITOR ORDER BY TENANT_NAME;

TENANT_NAME                      SESSIONS     SESSION_LIMIT_HIT    ACTIVE_SESSIONS
-------------------------------- ------------ -------------------- ---------------

0 rows fetched.

SQL> select * from DV_TENANT_TABLESPACES;

TENANT_NAME                      TABLESPACE_NAME                                                 
-------------------------------- ----------------------------------------------------------------
TNT4                             TNT_SPACE4                                                      

1 rows fetched.

SQL> --��¼sys��ѯ���
SQL> CONN / AS SYSDBA

connected.

SQL> select PLAN,NUM_PLAN_RULES,COMMENTS,TYPE# from ADM_RSRC_PLANS order by PLAN;

PLAN                                                             NUM_PLAN_RULES COMMENTS                                                         TYPE#       
---------------------------------------------------------------- -------------- ---------------------------------------------------------------- ------------
TNT_PLAN                                                         3              plan for tenant                                                  1           

1 rows fetched.

SQL> select CONTROL_GROUP,COMMENTS from ADM_RSRC_CONTROL_GROUPS order by CONTROL_GROUP;

CONTROL_GROUP                                                    COMMENTS                                                        
---------------------------------------------------------------- ----------------------------------------------------------------
DEFAULT_GROUPS                                                   Control group for users or tenants not assigned to any control group
TNT_GROUP1                                                       tenant group1 description                                       
TNT_GROUP2                                                       tenant group2 description                                       

3 rows fetched.

SQL> select * from ADM_RSRC_GROUP_MAPPINGS order by VALUE;

ATTRIBUTE                                                        VALUE                                                            CONTROL_GROUP                                                   
---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
TENANT                                                           TNT1                                                             TNT_GROUP1                                                      
TENANT                                                           TNT2                                                             TNT_GROUP2                                                      
TENANT                                                           TNT3                                                             TNT_GROUP2                                                      

3 rows fetched.

SQL> select TENANT_NAME, SESSIONS, SESSION_LIMIT_HIT, ACTIVE_SESSIONS from DV_RSRC_MONITOR ORDER BY TENANT_NAME;

TENANT_NAME                      SESSIONS     SESSION_LIMIT_HIT    ACTIVE_SESSIONS
-------------------------------- ------------ -------------------- ---------------
TNT1                             0            0                    0              
TNT2                             0            0                    0              
TNT3                             0            0                    0              

3 rows fetched.

SQL> select * from DV_TENANT_TABLESPACES ORDER BY TENANT_NAME;

TENANT_NAME                      TABLESPACE_NAME                                                 
-------------------------------- ----------------------------------------------------------------
TNT1                             TNT_SPACE1                                                      
TNT2                             TNT_SPACE2                                                      
TNT3                             TNT_SPACE3                                                      
TNT4                             TNT_SPACE4                                                      

4 rows fetched.

SQL> 
SQL> --default group���⻧��ϸ�����
SQL> CONN / AS SYSDBA

connected.

SQL> select CONTROL_GROUP,COMMENTS from ADM_RSRC_CONTROL_GROUPS order by CONTROL_GROUP;

CONTROL_GROUP                                                    COMMENTS                                                        
---------------------------------------------------------------- ----------------------------------------------------------------
DEFAULT_GROUPS                                                   Control group for users or tenants not assigned to any control group
TNT_GROUP1                                                       tenant group1 description                                       
TNT_GROUP2                                                       tenant group2 description                                       

3 rows fetched.

SQL> select TENANT_NAME, SESSIONS, SESSION_LIMIT_HIT, ACTIVE_SESSIONS from DV_RSRC_MONITOR ORDER BY TENANT_NAME;

TENANT_NAME                      SESSIONS     SESSION_LIMIT_HIT    ACTIVE_SESSIONS
-------------------------------- ------------ -------------------- ---------------
TNT1                             0            0                    0              
TNT2                             0            0                    0              
TNT3                             0            0                    0              

3 rows fetched.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tenant$root', 'tnt_group1');

PL/SQL procedure successfully completed.

SQL> alter system set resource_plan = 'tnt_plan';

Succeed.

SQL> CONN / AS SYSDBA

connected.

SQL> select CONTROL_GROUP,COMMENTS from ADM_RSRC_CONTROL_GROUPS order by CONTROL_GROUP;

CONTROL_GROUP                                                    COMMENTS                                                        
---------------------------------------------------------------- ----------------------------------------------------------------
DEFAULT_GROUPS                                                   Control group for users or tenants not assigned to any control group
TNT_GROUP1                                                       tenant group1 description                                       
TNT_GROUP2                                                       tenant group2 description                                       

3 rows fetched.

SQL> select TENANT_NAME, SESSIONS, SESSION_LIMIT_HIT, ACTIVE_SESSIONS from DV_RSRC_MONITOR ORDER BY TENANT_NAME;

TENANT_NAME                      SESSIONS     SESSION_LIMIT_HIT    ACTIVE_SESSIONS
-------------------------------- ------------ -------------------- ---------------
TENANT$ROOT                      1            0                    1              
TNT1                             0            0                    0              
TNT2                             0            0                    0              
TNT3                             0            0                    0              

4 rows fetched.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tenant$root', '');

PL/SQL procedure successfully completed.

SQL> alter system set resource_plan = 'tnt_plan';

Succeed.

SQL> CONN / AS SYSDBA

connected.

SQL> select CONTROL_GROUP,COMMENTS from ADM_RSRC_CONTROL_GROUPS order by CONTROL_GROUP;

CONTROL_GROUP                                                    COMMENTS                                                        
---------------------------------------------------------------- ----------------------------------------------------------------
DEFAULT_GROUPS                                                   Control group for users or tenants not assigned to any control group
TNT_GROUP1                                                       tenant group1 description                                       
TNT_GROUP2                                                       tenant group2 description                                       

3 rows fetched.

SQL> select TENANT_NAME, SESSIONS, SESSION_LIMIT_HIT, ACTIVE_SESSIONS from DV_RSRC_MONITOR ORDER BY TENANT_NAME;

TENANT_NAME                      SESSIONS     SESSION_LIMIT_HIT    ACTIVE_SESSIONS
-------------------------------- ------------ -------------------- ---------------
TNT1                             0            0                    0              
TNT2                             0            0                    0              
TNT3                             0            0                    0              

3 rows fetched.

SQL> 
SQL> 
SQL> --������
SQL> alter system set resource_plan = '';

Succeed.

SQL> call DBE_RSRC_MGR.DELETE_PLAN('tnt_plan');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.DELETE_CONTROL_GROUP('tnt_group1');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.DELETE_CONTROL_GROUP('tnt_group2');

PL/SQL procedure successfully completed.

SQL> select PLAN,NUM_PLAN_RULES,COMMENTS,TYPE# from ADM_RSRC_PLANS order by PLAN;

PLAN                                                             NUM_PLAN_RULES COMMENTS                                                         TYPE#       
---------------------------------------------------------------- -------------- ---------------------------------------------------------------- ------------

0 rows fetched.

SQL> select CONTROL_GROUP,COMMENTS from ADM_RSRC_CONTROL_GROUPS order by CONTROL_GROUP;

CONTROL_GROUP                                                    COMMENTS                                                        
---------------------------------------------------------------- ----------------------------------------------------------------
DEFAULT_GROUPS                                                   Control group for users or tenants not assigned to any control group

1 rows fetched.

SQL> drop tenant if exists tnt1;

CT-01395, The tenant TNT1 is being used, can not drop.
SQL> drop tenant if exists tnt2;

CT-01395, The tenant TNT2 is being used, can not drop.
SQL> drop tenant if exists tnt3;

CT-01395, The tenant TNT3 is being used, can not drop.
SQL> drop tenant if exists tnt4;

CT-01395, The tenant TNT4 is being used, can not drop.
SQL> drop tenant if exists tnt1 cascade;

Succeed.

SQL> drop tenant if exists tnt2 cascade;

Succeed.

SQL> drop tenant if exists tnt3 cascade;

Succeed.

SQL> drop tenant if exists tnt4 cascade;

Succeed.

SQL> 
SQL> --6.���ʸ���
SQL> drop tenant if exists tnt1;

Succeed.

SQL> drop tenant if exists tnt2;

Succeed.

SQL> --����2��tenant
SQL> CONN / AS SYSDBA

connected.

SQL> create tenant tnt1 tablespaces (tnt_space1);

Succeed.

SQL> create tenant tnt2 tablespaces (tnt_space2);

Succeed.

SQL> alter session set tenant=tnt1;

Succeed.

SQL> create user tnt1_user1 identified by Root1234;

Succeed.

SQL> grant dba to tnt1_user1;

Succeed.

SQL> conn tnt1_user1/Root1234@127.0.0.1:1611/tnt1

connected.

SQL> --��tnt1��tnt1_user1�´�������ͬʱ���Է������
SQL> 
SQL> drop SEQUENCE if exists t1u1_seq1;

Succeed.

SQL> create SEQUENCE t1u1_seq1;

Succeed.

SQL> select t1u1_seq1.nextval;

NEXTVAL             
--------------------
1                   

1 rows fetched.

SQL> select tnt1_user1.t1u1_seq1.nextval;

NEXTVAL             
--------------------
2                   

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_seq1.nextval;

NEXTVAL             
--------------------
3                   

1 rows fetched.

SQL> drop SEQUENCE t1u1_seq1;

Succeed.

SQL> create SEQUENCE tnt1_user1.t1u1_seq1;

Succeed.

SQL> select t1u1_seq1.nextval;

NEXTVAL             
--------------------
1                   

1 rows fetched.

SQL> select tnt1_user1.t1u1_seq1.nextval;

NEXTVAL             
--------------------
2                   

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_seq1.nextval;

NEXTVAL             
--------------------
3                   

1 rows fetched.

SQL> drop SEQUENCE t1u1_seq1;

Succeed.

SQL> create SEQUENCE tnt1$tnt1_user1.t1u1_seq1;

Succeed.

SQL> select t1u1_seq1.nextval;

NEXTVAL             
--------------------
1                   

1 rows fetched.

SQL> select tnt1_user1.t1u1_seq1.nextval;

NEXTVAL             
--------------------
2                   

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_seq1.nextval;

NEXTVAL             
--------------------
3                   

1 rows fetched.

SQL> drop table if exists t1u1_table1 cascade CONSTRAINTS;

Succeed.

SQL> create table t1u1_table1(c1 int);

Succeed.

SQL> insert into t1u1_table1 values(1);

1 rows affected.

SQL> insert into tnt1_user1.t1u1_table1 values(2);

1 rows affected.

SQL> insert into tnt1$tnt1_user1.t1u1_table1 values(3);

1 rows affected.

SQL> drop table if exists tnt1_user1.t1u1_table1 cascade CONSTRAINTS;

Succeed.

SQL> create table tnt1_user1.t1u1_table1(c1 int);

Succeed.

SQL> insert into t1u1_table1 values(1);

1 rows affected.

SQL> insert into tnt1_user1.t1u1_table1 values(2);

1 rows affected.

SQL> insert into tnt1$tnt1_user1.t1u1_table1 values(3);

1 rows affected.

SQL> drop table if exists tnt1$tnt1_user1.t1u1_table1 cascade CONSTRAINTS;

Succeed.

SQL> create table tnt1$tnt1_user1.t1u1_table1(c1 int);

Succeed.

SQL> insert into t1u1_table1 values(1);

1 rows affected.

SQL> insert into tnt1_user1.t1u1_table1 values(2);

1 rows affected.

SQL> insert into tnt1$tnt1_user1.t1u1_table1 values(3);

1 rows affected.

SQL> select * from t1u1_table1;

C1          
------------
1           
2           
3           

3 rows fetched.

SQL> select * from tnt1_user1.t1u1_table1;

C1          
------------
1           
2           
3           

3 rows fetched.

SQL> select * from tnt1$tnt1_user1.t1u1_table1;

C1          
------------
1           
2           
3           

3 rows fetched.

SQL> update t1u1_table1 set t1u1_table1.c1=10 where c1=1;

1 rows affected.

SQL> update tnt1_user1.t1u1_table1 set tnt1_user1.t1u1_table1.c1=20 where c1=2;

1 rows affected.

SQL> update tnt1$tnt1_user1.t1u1_table1 set tnt1$tnt1_user1.t1u1_table1.c1=30 where c1=3;

1 rows affected.

SQL> select * from t1u1_table1;

C1          
------------
10          
20          
30          

3 rows fetched.

SQL> select * from tnt1_user1.t1u1_table1;

C1          
------------
10          
20          
30          

3 rows fetched.

SQL> select * from tnt1$tnt1_user1.t1u1_table1;

C1          
------------
10          
20          
30          

3 rows fetched.

SQL> delete from t1u1_table1;

3 rows affected.

SQL> delete from tnt1_user1.t1u1_table1;

0 rows affected.

SQL> delete from tnt1$tnt1_user1.t1u1_table1;

0 rows affected.

SQL> insert into t1u1_table1 values(1);

1 rows affected.

SQL> drop view if exists t1u1_view1 cascade CONSTRAINTS;

Succeed.

SQL> create view t1u1_view1 as select * from t1u1_table1;

Succeed.

SQL> drop view if exists tnt1_user1.t1u1_view1 cascade CONSTRAINTS;

Succeed.

SQL> create view tnt1_user1.t1u1_view1 as select * from t1u1_table1;

Succeed.

SQL> drop view if exists tnt1$tnt1_user1.t1u1_view1 cascade CONSTRAINTS;

Succeed.

SQL> create view tnt1$tnt1_user1.t1u1_view1 as select * from t1u1_table1;

Succeed.

SQL> select * from t1u1_view1;

C1          
------------
1           

1 rows fetched.

SQL> select * from tnt1_user1.t1u1_view1;

C1          
------------
1           

1 rows fetched.

SQL> select * from tnt1$tnt1_user1.t1u1_view1;

C1          
------------
1           

1 rows fetched.

SQL> create or replace synonym t1u1_synonym1 for t1u1_view1;

Succeed.

SQL> create or replace synonym tnt1_user1.t1u1_synonym1 for t1u1_view1;

Succeed.

SQL> create or replace synonym tnt1$tnt1_user1.t1u1_synonym1 for t1u1_view1;

Succeed.

SQL> select * from t1u1_synonym1;

C1          
------------
1           

1 rows fetched.

SQL> select * from tnt1_user1.t1u1_synonym1;

C1          
------------
1           

1 rows fetched.

SQL> select * from tnt1$tnt1_user1.t1u1_synonym1;

C1          
------------
1           

1 rows fetched.

SQL> create or replace public synonym t1u1_synonym2 for t1u1_table1;

Succeed.

SQL> select * from t1u1_synonym2;

C1          
------------
1           

1 rows fetched.

SQL> delete from t1u1_table1;

1 rows affected.

SQL> create or replace procedure t1u1_procedure1()
  2 as
  3  begin
  4   insert into t1u1_table1 values(11);
  5   commit;
  6  end;
  7 /

Succeed.

SQL> call t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> call tnt1_user1.t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> call tnt1$tnt1_user1.t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> select * from t1u1_table1;

C1          
------------
11          
11          
11          

3 rows fetched.

SQL> delete from t1u1_table1;

3 rows affected.

SQL> create or replace procedure tnt1_user1.t1u1_procedure1()
  2 as
  3  begin
  4   insert into t1u1_table1 values(22);
  5   commit;
  6  end;
  7 /

Succeed.

SQL> call t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> call tnt1_user1.t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> call tnt1$tnt1_user1.t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> select * from t1u1_table1;

C1          
------------
22          
22          
22          

3 rows fetched.

SQL> delete from t1u1_table1;

3 rows affected.

SQL> create or replace procedure tnt1$tnt1_user1.t1u1_procedure1()
  2 as
  3  begin
  4   insert into t1u1_table1 values(33);
  5   commit;
  6  end;
  7 /

Succeed.

SQL> call t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> call tnt1_user1.t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> call tnt1$tnt1_user1.t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> select * from t1u1_table1;

C1          
------------
33          
33          
33          

3 rows fetched.

SQL> create or replace function t1u1_function1(val int) return int
  2 as
  3  begin
  4   return val;
  5  end;
  6 /

Succeed.

SQL> select t1u1_function1(147) from SYS_DUMMY;

T1U1_FUNCTION1(147)
-------------------
147                

1 rows fetched.

SQL> select tnt1_user1.t1u1_function1(258) from SYS_DUMMY;

TNT1_USER1.T1U1_FUNCTION1(258)
------------------------------
258                           

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_function1(369) from SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_FUNCTION1(369)
-----------------------------------
369                                

1 rows fetched.

SQL> create or replace function tnt1_user1.t1u1_function1(val int) return int
  2 as
  3  begin
  4   return val + 1;
  5  end;
  6 /

Succeed.

SQL> select t1u1_function1(147) from SYS_DUMMY;

T1U1_FUNCTION1(147)
-------------------
148                

1 rows fetched.

SQL> select tnt1_user1.t1u1_function1(258) from SYS_DUMMY;

TNT1_USER1.T1U1_FUNCTION1(258)
------------------------------
259                           

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_function1(369) from SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_FUNCTION1(369)
-----------------------------------
370                                

1 rows fetched.

SQL> create or replace function tnt1$tnt1_user1.t1u1_function1(val int) return int
  2 as
  3  begin
  4   return val + 2;
  5  end;
  6 /

Succeed.

SQL> select t1u1_function1(147) from SYS_DUMMY;

T1U1_FUNCTION1(147)
-------------------
149                

1 rows fetched.

SQL> select tnt1_user1.t1u1_function1(258) from SYS_DUMMY;

TNT1_USER1.T1U1_FUNCTION1(258)
------------------------------
260                           

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_function1(369) from SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_FUNCTION1(369)
-----------------------------------
371                                

1 rows fetched.

SQL> delete from t1u1_table1;

3 rows affected.

SQL> create or replace trigger t1u1_trigger1 after insert on t1u1_table1
  2  begin
  3  	update t1u1_table1 set c1 = 5555;
  4  end;
  5 /

Succeed.

SQL> call t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> select * from t1u1_table1;

C1          
------------
5555        

1 rows fetched.

SQL> delete from t1u1_table1;

1 rows affected.

SQL> create or replace trigger tnt1_user1.t1u1_trigger1 after insert on tnt1_user1.t1u1_table1
  2  begin
  3  	update tnt1_user1.t1u1_table1 set c1 = 6666;
  4  end;
  5 /

Succeed.

SQL> call t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> select * from t1u1_table1;

C1          
------------
6666        

1 rows fetched.

SQL> delete from t1u1_table1;

1 rows affected.

SQL> create or replace trigger tnt1$tnt1_user1.t1u1_trigger1 after insert on tnt1$tnt1_user1.t1u1_table1
  2  begin
  3  	update tnt1$tnt1_user1.t1u1_table1 set c1 = 7777;
  4  end;
  5 /

Succeed.

SQL> call t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> select * from t1u1_table1;

C1          
------------
7777        

1 rows fetched.

SQL> create or replace package t1u1_package1 
  2 as
  3  FUNCTION f1 return int;
  4 end;
  5 /

Succeed.

SQL> create or replace package body t1u1_package1
  2 as
  3  FUNCTION f1 return int
  4  as
  5   v1 int := 88888;
  6   begin
  7    return v1;
  8   end;
  9  end;
 10 /

Succeed.

SQL> select t1u1_package1.f1() FROM SYS_DUMMY;

T1U1_PACKAGE1.F1()
------------------
88888             

1 rows fetched.

SQL> select tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;

TNT1_USER1.T1U1_PACKAGE1.F1()
-----------------------------
88888                        

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_PACKAGE1.F1()
----------------------------------
88888                             

1 rows fetched.

SQL> create or replace package tnt1_user1.t1u1_package1 
  2 as
  3  FUNCTION f1 return int;
  4 end;
  5 /

Succeed.

SQL> create or replace package body tnt1_user1.t1u1_package1
  2 as
  3  FUNCTION f1 return int
  4  as
  5   v1 int := 99999;
  6   begin
  7    return v1;
  8   end;
  9  end;
 10 /

Succeed.

SQL> select t1u1_package1.f1() FROM SYS_DUMMY;

T1U1_PACKAGE1.F1()
------------------
99999             

1 rows fetched.

SQL> select tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;

TNT1_USER1.T1U1_PACKAGE1.F1()
-----------------------------
99999                        

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_PACKAGE1.F1()
----------------------------------
99999                             

1 rows fetched.

SQL> create or replace package tnt1$tnt1_user1.t1u1_package1 
  2 as
  3  FUNCTION f1 return int;
  4 end;
  5 /

Succeed.

SQL> create or replace package body tnt1$tnt1_user1.t1u1_package1
  2 as
  3  FUNCTION f1 return int
  4  as
  5   v1 int := 10101010;
  6   begin
  7    return v1;
  8   end;
  9  end;
 10 /

Succeed.

SQL> select t1u1_package1.f1() FROM SYS_DUMMY;

T1U1_PACKAGE1.F1()
------------------
10101010          

1 rows fetched.

SQL> select tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;

TNT1_USER1.T1U1_PACKAGE1.F1()
-----------------------------
10101010                     

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_PACKAGE1.F1()
----------------------------------
10101010                          

1 rows fetched.

SQL> --��root����һ���û�sys_user1�����Է��ʸ���
SQL> conn / as sysdba

connected.

SQL> create user sys_user1 identified by Root1234;

Succeed.

SQL> grant dba to sys_user1;

Succeed.

SQL> --��¼sys_user1
SQL> conn sys_user1/Root1234@127.0.0.1:1611

connected.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TENANT$ROOT                                                     

1 rows fetched.

SQL> select t1u1_seq1.nextval;

CT-00848, [1:8]The sequence SYS_USER1.T1U1_SEQ1 does not exist.
SQL> select tnt1_user1.t1u1_seq1.nextval;

CT-00848, [1:8]The sequence TNT1_USER1.T1U1_SEQ1 does not exist.
SQL> select tnt1$tnt1_user1.t1u1_seq1.nextval;

NEXTVAL             
--------------------
4                   

1 rows fetched.

SQL> delete from t1u1_table1;--CT-00843, [1:13]The table or view SYS_USER1.T1U1_TABLE1 does not exist.

CT-00843, [1:13]The table or view SYS_USER1.T1U1_TABLE1 does not exist.
SQL> delete from tnt1_user1.t1u1_table1;--CT-00781, [1:13]The user TNT1_USER1 does not exist.

CT-00843, [1:13]The table or view TNT1_USER1.T1U1_TABLE1 does not exist.
SQL> delete from tnt1$tnt1_user1.t1u1_table1;

1 rows affected.

SQL> insert into t1u1_table1 values(1);--CT-00843, [1:13]The table or view SYS_USER1.T1U1_TABLE1 does not exist.

CT-00843, [1:13]The table or view SYS_USER1.T1U1_TABLE1 does not exist.
SQL> insert into tnt1_user1.t1u1_table1 values(2);--CT-00781, [1:13]The user TNT1_USER1 does not exist.

CT-00843, [1:13]The table or view TNT1_USER1.T1U1_TABLE1 does not exist.
SQL> insert into tnt1$tnt1_user1.t1u1_table1 values(3);

1 rows affected.

SQL> select * from t1u1_table1;--CT-00843, [1:15]The table or view SYS_USER1.T1U1_TABLE1 does not exist.

CT-00843, [1:15]The table or view SYS_USER1.T1U1_TABLE1 does not exist.
SQL> select * from tnt1_user1.t1u1_table1;--CT-00781, [1:15]The user TNT1_USER1 does not exist.

CT-00843, [1:15]The table or view TNT1_USER1.T1U1_TABLE1 does not exist.
SQL> select * from tnt1$tnt1_user1.t1u1_table1;

C1          
------------
7777        

1 rows fetched.

SQL> select * from t1u1_view1;--CT-00843, [1:15]The table or view SYS_USER1.T1U1_VIEW1 does not exist.

CT-00843, [1:15]The table or view SYS_USER1.T1U1_VIEW1 does not exist.
SQL> select * from tnt1_user1.t1u1_view1;--CT-00781, [1:15]The user TNT1_USER1 does not exist.

CT-00843, [1:15]The table or view TNT1_USER1.T1U1_VIEW1 does not exist.
SQL> select * from tnt1$tnt1_user1.t1u1_view1;

C1          
------------
7777        

1 rows fetched.

SQL> select * from t1u1_synonym1;--CT-00843, [1:15]The table or view SYS_USER1.T1U1_SYNONYM1 does not exist.

CT-00843, [1:15]The table or view SYS_USER1.T1U1_SYNONYM1 does not exist.
SQL> select * from tnt1_user1.t1u1_synonym1;--CT-00781, [1:15]The user TNT1_USER1 does not exist.

CT-00843, [1:15]The table or view TNT1_USER1.T1U1_SYNONYM1 does not exist.
SQL> select * from tnt1$tnt1_user1.t1u1_synonym1;

C1          
------------
7777        

1 rows fetched.

SQL> select * from t1u1_synonym2;

C1          
------------
7777        

1 rows fetched.

SQL> call t1u1_procedure1();--[1:2] PLC-00828 procedure SYS_USER1.T1U1_PROCEDURE1 does not exist

CT-00944, PL/SQL(SYS_USER1.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00828 procedure SYS_USER1.T1U1_PROCEDURE1 does not exist

SQL> call tnt1_user1.t1u1_procedure1();--[1:2] PLC-00828 procedure TNT1_USER1.T1U1_PROCEDURE1 does not exist

CT-00944, PL/SQL(SYS_USER1.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00828 procedure TNT1_USER1.T1U1_PROCEDURE1 does not exist

SQL> call tnt1$tnt1_user1.t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> select t1u1_function1(147) from SYS_DUMMY;--CT-00828, [1:8]function SYS_USER1.T1U1_FUNCTION1 does not exist

CT-00828, [1:8]function SYS_USER1.T1U1_FUNCTION1 does not exist
SQL> select tnt1_user1.t1u1_function1(258) from SYS_DUMMY;--CT-00828, [1:8]function TNT1_USER1.T1U1_FUNCTION1 does not exist

CT-00828, [1:8]function TNT1_USER1.T1U1_FUNCTION1 does not exist
SQL> select tnt1$tnt1_user1.t1u1_function1(369) from SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_FUNCTION1(369)
-----------------------------------
371                                

1 rows fetched.

SQL> select t1u1_package1.f1() FROM SYS_DUMMY;--CT-00828, [1:8]function T1U1_PACKAGE1.F1 does not exist

CT-00828, [1:8]function T1U1_PACKAGE1.F1 does not exist
SQL> select tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;--CT-00828, [1:8]function TNT1_USER1.T1U1_PACKAGE1.F1 does not exist

CT-00828, [1:8]function TNT1_USER1.T1U1_PACKAGE1.F1 does not exist
SQL> select tnt1$tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_PACKAGE1.F1()
----------------------------------
10101010                          

1 rows fetched.

SQL> --tenant�л���tnt1��schema�л���tnt1_user2
SQL> alter session set tenant=tnt1;

Succeed.

SQL> create user tnt1_user2 identified by Root1234;

Succeed.

SQL> grant dba to tnt1_user2;

Succeed.

SQL> alter session set current_schema=tnt1_user2;

Succeed.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TNT1                                                            

1 rows fetched.

SQL> select sys_context('USERENV', 'CURRENT_SCHEMA');

SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')                        
----------------------------------------------------------------
TNT1$TNT1_USER2                                                 

1 rows fetched.

SQL> select t1u1_seq1.nextval;

CT-00848, [1:8]The sequence TNT1$TNT1_USER2.T1U1_SEQ1 does not exist.
SQL> select tnt1_user1.t1u1_seq1.nextval;

NEXTVAL             
--------------------
5                   

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_seq1.nextval;

NEXTVAL             
--------------------
6                   

1 rows fetched.

SQL> delete from t1u1_table1;--CT-00843, [1:13]The table or view TNT1$TNT1_USER2.T1U1_TABLE1 does not exist.

CT-00843, [1:13]The table or view TNT1$TNT1_USER2.T1U1_TABLE1 does not exist.
SQL> delete from tnt1_user1.t1u1_table1;

2 rows affected.

SQL> delete from tnt1$tnt1_user1.t1u1_table1;

0 rows affected.

SQL> insert into t1u1_table1 values(1);--CT-00843, [1:13]The table or view TNT1$TNT1_USER2.T1U1_TABLE1 does not exist.

CT-00843, [1:13]The table or view TNT1$TNT1_USER2.T1U1_TABLE1 does not exist.
SQL> insert into tnt1_user1.t1u1_table1 values(2);

1 rows affected.

SQL> insert into tnt1$tnt1_user1.t1u1_table1 values(3);

1 rows affected.

SQL> select * from t1u1_table1;--CT-00843, [1:15]The table or view TNT1$TNT1_USER2.T1U1_TABLE1 does not exist.

CT-00843, [1:15]The table or view TNT1$TNT1_USER2.T1U1_TABLE1 does not exist.
SQL> select * from tnt1_user1.t1u1_table1;

C1          
------------
7777        
7777        

2 rows fetched.

SQL> select * from tnt1$tnt1_user1.t1u1_table1;

C1          
------------
7777        
7777        

2 rows fetched.

SQL> select * from t1u1_view1;--CT-00843, [1:15]The table or view TNT1$TNT1_USER2.T1U1_VIEW1 does not exist.

CT-00843, [1:15]The table or view TNT1$TNT1_USER2.T1U1_VIEW1 does not exist.
SQL> select * from tnt1_user1.t1u1_view1;

C1          
------------
7777        
7777        

2 rows fetched.

SQL> select * from tnt1$tnt1_user1.t1u1_view1;

C1          
------------
7777        
7777        

2 rows fetched.

SQL> select * from t1u1_synonym1;--CT-00843, [1:15]The table or view TNT1$TNT1_USER2.T1U1_SYNONYM1 does not exist.

CT-00843, [1:15]The table or view TNT1$TNT1_USER2.T1U1_SYNONYM1 does not exist.
SQL> select * from tnt1_user1.t1u1_synonym1;

C1          
------------
7777        
7777        

2 rows fetched.

SQL> select * from tnt1$tnt1_user1.t1u1_synonym1;

C1          
------------
7777        
7777        

2 rows fetched.

SQL> select * from t1u1_synonym2;

C1          
------------
7777        
7777        

2 rows fetched.

SQL> call t1u1_procedure1();--[1:2] PLC-00828 procedure TNT1$TNT1_USER2.T1U1_PROCEDURE1 does not exist

CT-00944, PL/SQL(TNT1$TNT1_USER2.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00828 procedure TNT1$TNT1_USER2.T1U1_PROCEDURE1 does not exist

SQL> call tnt1_user1.t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> call tnt1$tnt1_user1.t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> select t1u1_function1(147) from SYS_DUMMY;--CT-00828, [1:8]function TNT1$TNT1_USER2.T1U1_FUNCTION1 does not exist

CT-00828, [1:8]function TNT1$TNT1_USER2.T1U1_FUNCTION1 does not exist
SQL> select tnt1_user1.t1u1_function1(258) from SYS_DUMMY;

TNT1_USER1.T1U1_FUNCTION1(258)
------------------------------
260                           

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_function1(369) from SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_FUNCTION1(369)
-----------------------------------
371                                

1 rows fetched.

SQL> select t1u1_package1.f1() FROM SYS_DUMMY;--CT-00828, [1:8]function TNT1$T1U1_PACKAGE1.F1 does not exist

CT-00828, [1:8]function TNT1$T1U1_PACKAGE1.F1 does not exist
SQL> select tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;

TNT1_USER1.T1U1_PACKAGE1.F1()
-----------------------------
10101010                     

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_PACKAGE1.F1()
----------------------------------
10101010                          

1 rows fetched.

SQL> --schema�л���tnt1_user1
SQL> alter session set current_schema=tnt1_user1;

Succeed.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TNT1                                                            

1 rows fetched.

SQL> select sys_context('USERENV', 'CURRENT_SCHEMA');

SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')                        
----------------------------------------------------------------
TNT1$TNT1_USER1                                                 

1 rows fetched.

SQL> select t1u1_seq1.nextval;

NEXTVAL             
--------------------
7                   

1 rows fetched.

SQL> select tnt1_user1.t1u1_seq1.nextval;

NEXTVAL             
--------------------
8                   

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_seq1.nextval;

NEXTVAL             
--------------------
9                   

1 rows fetched.

SQL> delete from t1u1_table1;

4 rows affected.

SQL> delete from tnt1_user1.t1u1_table1;

0 rows affected.

SQL> delete from tnt1$tnt1_user1.t1u1_table1;

0 rows affected.

SQL> insert into t1u1_table1 values(1);

1 rows affected.

SQL> insert into tnt1_user1.t1u1_table1 values(2);

1 rows affected.

SQL> insert into tnt1$tnt1_user1.t1u1_table1 values(3);

1 rows affected.

SQL> select * from t1u1_table1;

C1          
------------
7777        
7777        
7777        

3 rows fetched.

SQL> select * from tnt1_user1.t1u1_table1;

C1          
------------
7777        
7777        
7777        

3 rows fetched.

SQL> select * from tnt1$tnt1_user1.t1u1_table1;

C1          
------------
7777        
7777        
7777        

3 rows fetched.

SQL> select * from t1u1_view1;

C1          
------------
7777        
7777        
7777        

3 rows fetched.

SQL> select * from tnt1_user1.t1u1_view1;

C1          
------------
7777        
7777        
7777        

3 rows fetched.

SQL> select * from tnt1$tnt1_user1.t1u1_view1;

C1          
------------
7777        
7777        
7777        

3 rows fetched.

SQL> select * from t1u1_synonym1;

C1          
------------
7777        
7777        
7777        

3 rows fetched.

SQL> select * from tnt1_user1.t1u1_synonym1;

C1          
------------
7777        
7777        
7777        

3 rows fetched.

SQL> select * from tnt1$tnt1_user1.t1u1_synonym1;

C1          
------------
7777        
7777        
7777        

3 rows fetched.

SQL> select * from t1u1_synonym2;

C1          
------------
7777        
7777        
7777        

3 rows fetched.

SQL> call t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> call tnt1_user1.t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> call tnt1$tnt1_user1.t1u1_procedure1();

PL/SQL procedure successfully completed.

SQL> select t1u1_function1(147) from SYS_DUMMY;

T1U1_FUNCTION1(147)
-------------------
149                

1 rows fetched.

SQL> select tnt1_user1.t1u1_function1(258) from SYS_DUMMY;

TNT1_USER1.T1U1_FUNCTION1(258)
------------------------------
260                           

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_function1(369) from SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_FUNCTION1(369)
-----------------------------------
371                                

1 rows fetched.

SQL> select t1u1_package1.f1() FROM SYS_DUMMY;

T1U1_PACKAGE1.F1()
------------------
10101010          

1 rows fetched.

SQL> select tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;

TNT1_USER1.T1U1_PACKAGE1.F1()
-----------------------------
10101010                     

1 rows fetched.

SQL> select tnt1$tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;

TNT1$TNT1_USER1.T1U1_PACKAGE1.F1()
----------------------------------
10101010                          

1 rows fetched.

SQL> --��tnt2�����û�tnt2_user1
SQL> conn / as sysdba

connected.

SQL> alter session set tenant=tnt2;

Succeed.

SQL> create user tnt2_user1 identified by Root1234;

Succeed.

SQL> grant dba to tnt2_user1;

Succeed.

SQL> --��¼tnt2��tnt2_user1�����Է���tnt1_user1�µĶ���
SQL> conn tnt2_user1/Root1234@127.0.0.1:1611/tnt2

connected.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TNT2                                                            

1 rows fetched.

SQL> select sys_context('USERENV', 'CURRENT_SCHEMA');

SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')                        
----------------------------------------------------------------
TNT2$TNT2_USER1                                                 

1 rows fetched.

SQL> select t1u1_seq1.nextval;

CT-00848, [1:8]The sequence TNT2$TNT2_USER1.T1U1_SEQ1 does not exist.
SQL> select tnt1_user1.t1u1_seq1.nextval;

CT-00848, [1:8]The sequence TNT2$TNT1_USER1.T1U1_SEQ1 does not exist.
SQL> select tnt1$tnt1_user1.t1u1_seq1.nextval;

CT-00613, Invalid operation, can not cross tenant in non-root tenant
SQL> delete from t1u1_table1;--CT-00843, [1:13]The table or view TNT2$TNT2_USER1.T1U1_TABLE1 does not exist.

CT-00843, [1:13]The table or view TNT2$TNT2_USER1.T1U1_TABLE1 does not exist.
SQL> delete from tnt1_user1.t1u1_table1;--CT-00781, [1:13]The user TNT2$TNT1_USER1 does not exist.

CT-00843, [1:13]The table or view TNT2$TNT1_USER1.T1U1_TABLE1 does not exist.

SQL> delete from tnt1$tnt1_user1.t1u1_table1;--CT-01001, Permissions were insufficient

CT-00613, Invalid operation, can not cross tenant in non-root tenant
SQL> insert into t1u1_table1 values(1);--CT-00843, [1:13]The table or view TNT2$TNT2_USER1.T1U1_TABLE1 does not exist.

CT-00843, [1:13]The table or view TNT2$TNT2_USER1.T1U1_TABLE1 does not exist.
SQL> insert into tnt1_user1.t1u1_table1 values(2);--CT-00781, [1:13]The user TNT2$TNT1_USER1 does not exist.

CT-00843, [1:13]The table or view TNT2$TNT1_USER1.T1U1_TABLE1 does not exist.
SQL> insert into tnt1$tnt1_user1.t1u1_table1 values(3);--CT-01001, [1:13]Permissions were insufficient

CT-00613, [1:13]Invalid operation, can not cross tenant in non-root tenant
SQL> select * from t1u1_table1;--CT-00843, [1:15]The table or view TNT2$TNT2_USER1.T1U1_TABLE1 does not exist.

CT-00843, [1:15]The table or view TNT2$TNT2_USER1.T1U1_TABLE1 does not exist.
SQL> select * from tnt1_user1.t1u1_table1;--CT-00781, [1:15]The user TNT2$TNT1_USER1 does not exist.

CT-00843, [1:15]The table or view TNT2$TNT1_USER1.T1U1_TABLE1 does not exist.
SQL> select * from tnt1$tnt1_user1.t1u1_table1;--CT-01001, [1:15]Permissions were insufficient

CT-00613, [1:15]Invalid operation, can not cross tenant in non-root tenant
SQL> select * from t1u1_view1;--CT-00843, [1:15]The table or view TNT2$TNT2_USER1.T1U1_VIEW1 does not exist.

CT-00843, [1:15]The table or view TNT2$TNT2_USER1.T1U1_VIEW1 does not exist.
SQL> select * from tnt1_user1.t1u1_view1;--CT-00781, [1:15]The user TNT2$TNT1_USER1 does not exist.

CT-00843, [1:15]The table or view TNT2$TNT1_USER1.T1U1_VIEW1 does not exist.
SQL> select * from tnt1$tnt1_user1.t1u1_view1;--CT-01001, [1:15]Permissions were insufficient

CT-00613, [1:15]Invalid operation, can not cross tenant in non-root tenant
SQL> select * from t1u1_synonym1;--CT-00843, [1:15]The table or view TNT2$TNT2_USER1.T1U1_SYNONYM1 does not exist.

CT-00843, [1:15]The table or view TNT2$TNT2_USER1.T1U1_SYNONYM1 does not exist.
SQL> select * from tnt1_user1.t1u1_synonym1;--CT-00781, [1:15]The user TNT2$TNT1_USER1 does not exist.

CT-00843, [1:15]The table or view TNT2$TNT1_USER1.T1U1_SYNONYM1 does not exist.
SQL> select * from tnt1$tnt1_user1.t1u1_synonym1;--CT-01001, [1:15]Permissions were insufficient

CT-00613, [1:15]Invalid operation, can not cross tenant in non-root tenant
SQL> delete from t1u1_synonym2;

6 rows affected.

SQL> insert into t1u1_synonym2 values(11);

1 rows affected.

SQL> select * from t1u1_synonym2;

C1          
------------
7777        

1 rows fetched.

SQL> update t1u1_synonym2 set c1=66666;

1 rows affected.

SQL> select * from t1u1_synonym2;

C1          
------------
66666       

1 rows fetched.

SQL> call t1u1_procedure1();--[1:2] PLC-00828 procedure TNT2$TNT2_USER1.T1U1_PROCEDURE1 does not exist

CT-00944, PL/SQL(TNT2$TNT2_USER1.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00828 procedure TNT2$TNT2_USER1.T1U1_PROCEDURE1 does not exist

SQL> call tnt1_user1.t1u1_procedure1();--[1:2] PLC-00828 procedure TNT2$TNT1_USER1.T1U1_PROCEDURE1 does not exist

CT-00944, PL/SQL(TNT2$TNT2_USER1.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00828 procedure TNT2$TNT1_USER1.T1U1_PROCEDURE1 does not exist

SQL> call tnt1$tnt1_user1.t1u1_procedure1();--CT-01001, Permissions were insufficient

CT-00613, Invalid operation, can not cross tenant in non-root tenant
SQL> select t1u1_function1(147) from SYS_DUMMY;--CT-00828, [1:8]function TNT2$TNT2_USER1.T1U1_FUNCTION1 does not exist

CT-00828, [1:8]function TNT2$TNT2_USER1.T1U1_FUNCTION1 does not exist
SQL> select tnt1_user1.t1u1_function1(258) from SYS_DUMMY;--CT-00828, [1:8]function TNT2$TNT1_USER1.T1U1_FUNCTION1 does not exist

CT-00828, [1:8]function TNT2$TNT1_USER1.T1U1_FUNCTION1 does not exist
SQL> select tnt1$tnt1_user1.t1u1_function1(369) from SYS_DUMMY;--CT-01001, Permissions were insufficient

CT-00613, Invalid operation, can not cross tenant in non-root tenant
SQL> select t1u1_package1.f1() FROM SYS_DUMMY;--CT-00828, [1:8]function TNT2$T1U1_PACKAGE1.F1 does not exist

CT-00828, [1:8]function TNT2$T1U1_PACKAGE1.F1 does not exist
SQL> select tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;--CT-00828, [1:8]function TNT2$TNT1_USER1.T1U1_PACKAGE1.F1 does not exist

CT-00828, [1:8]function TNT2$TNT1_USER1.T1U1_PACKAGE1.F1 does not exist
SQL> select tnt1$tnt1_user1.t1u1_package1.f1() FROM SYS_DUMMY;--CT-01001, Permissions were insufficient

CT-00613, Invalid operation, can not cross tenant in non-root tenant
SQL> 
SQL> --��ϵͳ��ͼ�ķ��ʸ���
SQL> conn / as sysdba

connected.

SQL> --tenant�л���tnt1��schema�л���tnt1_user1
SQL> alter session set tenant=tnt1;

Succeed.

SQL> alter session set current_schema=tnt1_user1;

Succeed.

SQL> select USERNAME,DEFAULT_TABLESPACE,TEMPORARY_TABLESPACE,INITIAL_RSRC_CONSUMER_GROUP from adm_users where USERNAME like 'TNT%' order by USERNAME;

USERNAME                                                         DEFAULT_TABLESPACE                                               TEMPORARY_TABLESPACE                                             INITIAL_RSRC_CONSUMER_GROUP
---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------
TNT1$TNT1_USER1                                                  TNT_SPACE1                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     
TNT1$TNT1_USER2                                                  TNT_SPACE1                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     

2 rows fetched.

SQL> --tenant�л���tnt2��schema�л���tnt2_user1
SQL> alter session set tenant=tnt2;

Succeed.

SQL> alter session set current_schema=tnt2_user1;

Succeed.

SQL> select USERNAME,DEFAULT_TABLESPACE,TEMPORARY_TABLESPACE,INITIAL_RSRC_CONSUMER_GROUP from adm_users where USERNAME like 'TNT%' order by USERNAME;

USERNAME                                                         DEFAULT_TABLESPACE                                               TEMPORARY_TABLESPACE                                             INITIAL_RSRC_CONSUMER_GROUP
---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------
TNT2$TNT2_USER1                                                  TNT_SPACE2                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     

1 rows fetched.

SQL> --tenant�л���tenant$root��schema�л���sys
SQL> alter session set tenant=tenant$root;

Succeed.

SQL> alter session set current_schema=sys;

Succeed.

SQL> select USERNAME,DEFAULT_TABLESPACE,TEMPORARY_TABLESPACE,INITIAL_RSRC_CONSUMER_GROUP from adm_users where USERNAME like 'TNT%' order by USERNAME;

USERNAME                                                         DEFAULT_TABLESPACE                                               TEMPORARY_TABLESPACE                                             INITIAL_RSRC_CONSUMER_GROUP
---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------
TNT1$TNT1_USER1                                                  TNT_SPACE1                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     
TNT1$TNT1_USER2                                                  TNT_SPACE1                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     
TNT2$TNT2_USER1                                                  TNT_SPACE2                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     

3 rows fetched.

SQL> 
SQL> conn / as sysdba

connected.

SQL> select USERNAME,DEFAULT_TABLESPACE,TEMPORARY_TABLESPACE,INITIAL_RSRC_CONSUMER_GROUP from adm_users where USERNAME like 'TNT%' order by USERNAME;

USERNAME                                                         DEFAULT_TABLESPACE                                               TEMPORARY_TABLESPACE                                             INITIAL_RSRC_CONSUMER_GROUP
---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------
TNT1$TNT1_USER1                                                  TNT_SPACE1                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     
TNT1$TNT1_USER2                                                  TNT_SPACE1                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     
TNT2$TNT2_USER1                                                  TNT_SPACE2                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     

3 rows fetched.

SQL> conn tnt1_user1/Root1234@127.0.0.1:1611/tnt1

connected.

SQL> select USERNAME,DEFAULT_TABLESPACE,TEMPORARY_TABLESPACE,INITIAL_RSRC_CONSUMER_GROUP from adm_users where USERNAME like 'TNT%' order by USERNAME;

USERNAME                                                         DEFAULT_TABLESPACE                                               TEMPORARY_TABLESPACE                                             INITIAL_RSRC_CONSUMER_GROUP
---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------
TNT1$TNT1_USER1                                                  TNT_SPACE1                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     
TNT1$TNT1_USER2                                                  TNT_SPACE1                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     

2 rows fetched.

SQL> conn tnt2_user1/Root1234@127.0.0.1:1611/tnt2

connected.

SQL> select USERNAME,DEFAULT_TABLESPACE,TEMPORARY_TABLESPACE,INITIAL_RSRC_CONSUMER_GROUP from adm_users where USERNAME like 'TNT%' order by USERNAME;

USERNAME                                                         DEFAULT_TABLESPACE                                               TEMPORARY_TABLESPACE                                             INITIAL_RSRC_CONSUMER_GROUP
---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------
TNT2$TNT2_USER1                                                  TNT_SPACE2                                                       SWAP_00                                                             DEFAULT_CONSUMER_GROUP     

1 rows fetched.

SQL> 
SQL> --7.Ȩ��
SQL> --alter session
SQL> conn tnt1_user1/Root1234@127.0.0.1:1611/tnt1

connected.

SQL> alter session set tenant=tnt1;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> alter session set tenant=tnt2;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> alter session set tenant=tenant$root;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> conn / as sysdba

connected.

SQL> alter session set tenant=tnt1;

Succeed.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TNT1                                                            

1 rows fetched.

SQL> select sys_context('USERENV', 'CURRENT_SCHEMA');

SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')                        
----------------------------------------------------------------
SYS                                                             

1 rows fetched.

SQL> alter session set current_schema=tnt1_user1;

Succeed.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TNT1                                                            

1 rows fetched.

SQL> select sys_context('USERENV', 'CURRENT_SCHEMA');

SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')                        
----------------------------------------------------------------
TNT1$TNT1_USER1                                                 

1 rows fetched.

SQL> alter session set current_schema=tnt1_user2;

Succeed.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TNT1                                                            

1 rows fetched.

SQL> select sys_context('USERENV', 'CURRENT_SCHEMA');

SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')                        
----------------------------------------------------------------
TNT1$TNT1_USER2                                                 

1 rows fetched.

SQL> alter session set tenant=tnt2;

Succeed.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TNT2                                                            

1 rows fetched.

SQL> select sys_context('USERENV', 'CURRENT_SCHEMA');

SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')                        
----------------------------------------------------------------
TNT1$TNT1_USER2                                                 

1 rows fetched.

SQL> alter session set tenant=tenant$root;

Succeed.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TENANT$ROOT                                                     

1 rows fetched.

SQL> select sys_context('USERENV', 'CURRENT_SCHEMA');

SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')                        
----------------------------------------------------------------
TNT1$TNT1_USER2                                                 

1 rows fetched.

SQL> --ALTER CURRENT_SCHEMA
SQL> conn tnt1_user1/Root1234@127.0.0.1:1611/tnt1

connected.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TNT1                                                            

1 rows fetched.

SQL> select sys_context('USERENV', 'CURRENT_SCHEMA');

SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')                        
----------------------------------------------------------------
TNT1$TNT1_USER1                                                 

1 rows fetched.

SQL> alter session set current_schema=tnt1_user1;

Succeed.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TNT1                                                            

1 rows fetched.

SQL> select sys_context('USERENV', 'CURRENT_SCHEMA');

SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')                        
----------------------------------------------------------------
TNT1$TNT1_USER1                                                 

1 rows fetched.

SQL> alter session set current_schema=tnt1_user2;

Succeed.

SQL> select sys_context('USERENV', 'TENANT_NAME');

SYS_CONTEXT('USERENV', 'TENANT_NAME')                           
----------------------------------------------------------------
TNT1                                                            

1 rows fetched.

SQL> select sys_context('USERENV', 'CURRENT_SCHEMA');

SYS_CONTEXT('USERENV', 'CURRENT_SCHEMA')                        
----------------------------------------------------------------
TNT1$TNT1_USER2                                                 

1 rows fetched.

SQL> 
SQL> --create/alter/drop tenant
SQL> conn tnt1_user1/Root1234@127.0.0.1:1611/tnt1

connected.

SQL> create tenant tnt3 tablespaces (tnt_space1);--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> alter tenant tnt1 add tablespaces (tnt_space2);--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> alter tenant tnt2 add tablespaces (tnt_space3);--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> alter tenant tnt3 add tablespaces (tnt_space4);--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> alter tenant tnt1 default tablespace tnt_space1;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> alter tenant tnt2 default tablespace tnt_space2;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> alter tenant tnt3 default tablespace tnt_space3;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> drop tenant tnt1;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> drop tenant tnt2;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> drop tenant tnt3;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> drop tenant tnt1 cascade;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> drop tenant tnt2 cascade;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> drop tenant tnt3 cascade;--CT-01001, Permissions were insufficient

CT-01001, Permissions were insufficient
SQL> --CREATE/ALTER/DROPֻ�ܶԵ�ǰtenant�е�USER���в���
SQL> alter user tnt1_user1 default tablespace tnt_space2;

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> alter user tnt1_user2 default tablespace tnt_space1;

Succeed.

SQL> alter user sys_user1 default tablespace tnt_space2;

CT-00781, The user TNT1$SYS_USER1 does not exist.
SQL> alter user tnt2$tnt2_user1 default tablespace tnt_space1;

CT-00601, [1:12]Sql syntax error: invalid variant/object name was found
SQL> drop user sys_user1 cascade;

CT-00781, The user TNT1$SYS_USER1 does not exist.
SQL> drop user tnt1_user2 cascade;

Succeed.

SQL> drop user tnt2$tnt2_user1 cascade;

CT-00601, [1:11]Sql syntax error: invalid variant/object name was found
SQL> conn / as sysdba

connected.

SQL> drop user sys_user1 cascade;

Succeed.

SQL> drop user tnt2$tnt2_user1 cascade;

CT-00601, [1:11]Sql syntax error: invalid variant/object name was found
SQL> alter session set tenant=tnt1;

Succeed.

SQL> drop user tnt1_user1 cascade;

Succeed.

SQL> alter session set tenant=tnt2;

Succeed.

SQL> drop user tnt2_user1 cascade;

Succeed.

SQL> 
SQL> --8.SPACE����
SQL> conn / as sysdba

connected.

SQL> drop user if exists sys_user1;

Succeed.

SQL> drop tenant if exists tnt1 cascade;

Succeed.

SQL> drop tenant if exists tnt2 cascade;

Succeed.

SQL> CREATE TENANT TNT1 TABLESPACES (tnt_space1,tnt_space3);

Succeed.

SQL> CREATE TENANT TNT2 TABLESPACES (tnt_space2);

Succeed.

SQL> --��ͼDV_TABLESPACES/DV_TENANT_TABLESPACES
SQL> SELECT NAME FROM DV_TABLESPACES WHERE ID <=6 OR NAME LIKE 'TNT%' ORDER BY NAME;

NAME                                                            
----------------------------------------------------------------
SWAP_00
SYSAUX                                                          
SYSTEM                                                                                                                    
TEMP2                                                           
TEMP2_UNDO                                                      
TNT_SPACE1                                                      
TNT_SPACE2                                                      
TNT_SPACE3                                                      
TNT_SPACE4                                                      
UNDO_00                                                            
USERS                                                           

11 rows fetched.

SQL> SELECT * FROM DV_TENANT_TABLESPACES ORDER BY TABLESPACE_NAME;

TENANT_NAME                      TABLESPACE_NAME                                                 
-------------------------------- ----------------------------------------------------------------
TNT1                             TNT_SPACE1                                                      
TNT2                             TNT_SPACE2                                                      
TNT1                             TNT_SPACE3                                                      

3 rows fetched.

SQL> ALTER SESSION SET TENANT=TNT1;

Succeed.

SQL> CREATE USER TNT1_USER1 IDENTIFIED BY Root1234;

Succeed.

SQL> GRANT DBA TO TNT1_USER1;

Succeed.

SQL> CONN TNT1_USER1/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> --��ͼDV_TABLESPACES/DV_TENANT_TABLESPACES
SQL> SELECT NAME FROM DV_TABLESPACES WHERE ID <=6 OR NAME LIKE 'TNT%' ORDER BY NAME;

NAME                                                            
----------------------------------------------------------------
SWAP_00
SYSAUX                                                          
SYSTEM                                                                                                                      
TEMP2                                                           
TEMP2_UNDO                                                      
TNT_SPACE1                                                      
TNT_SPACE3                                                      
UNDO_00                                                            

8 rows fetched.

SQL> SELECT * FROM DV_TENANT_TABLESPACES ORDER BY TABLESPACE_NAME;

TENANT_NAME                      TABLESPACE_NAME                                                 
-------------------------------- ----------------------------------------------------------------
TNT1                             TNT_SPACE1                                                      
TNT1                             TNT_SPACE3                                                      

2 rows fetched.

SQL> --��ͨ��
SQL> CREATE TABLE T01(C1 INT, C2 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C2) STORE AS (TABLESPACE tnt_space1);

Succeed.

SQL> CREATE TABLE T02(C1 INT, C2 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space2) TABLESPACE tnt_space1 LOB(C2) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T03(C1 INT, C2 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) TABLESPACE tnt_space2 LOB(C2) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T04(C1 INT, C2 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C2) STORE AS (TABLESPACE tnt_space2);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> --RANGE������
SQL> CREATE TABLE T11(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY RANGE(C2) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

Succeed.

SQL> CREATE TABLE T12(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space2) PARTITION BY RANGE(C2) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T13(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY RANGE(C2) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space2, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T14(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY RANGE(C2) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space2) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T15(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY RANGE(C2) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space2) TABLESPACE tnt_space2 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T16(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY RANGE(C2) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space2) TABLESPACE tnt_space2 LOB(C3) STORE AS (TABLESPACE tnt_space2);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> --RANGE������using index LOCAL
SQL> CREATE TABLE T21(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY RANGE(C1) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

Succeed.

SQL> CREATE TABLE T22(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space2, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY RANGE(C1) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T23(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space2)) PARTITION BY RANGE(C1) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T24(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY RANGE(C1) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space2, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T25(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY RANGE(C1) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space2) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T26(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY RANGE(C1) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space2 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T27(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY RANGE(C1) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space2);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> --LIST������
SQL> CREATE TABLE T31(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY LIST(C2) (PARTITION P1 VALUES (100) TABLESPACE tnt_space1, PARTITION P2 VALUES (200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

Succeed.

SQL> CREATE TABLE T32(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space2) PARTITION BY LIST(C2) (PARTITION P1 VALUES (100) TABLESPACE tnt_space1, PARTITION P2 VALUES (200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T33(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY LIST(C2) (PARTITION P1 VALUES (100) TABLESPACE tnt_space2, PARTITION P2 VALUES (200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T34(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY LIST(C2) (PARTITION P1 VALUES (100) TABLESPACE tnt_space1, PARTITION P2 VALUES (200) TABLESPACE tnt_space2) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T35(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY LIST(C2) (PARTITION P1 VALUES (100) TABLESPACE tnt_space1, PARTITION P2 VALUES (200) TABLESPACE tnt_space1) TABLESPACE tnt_space2 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T36(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY LIST(C2) (PARTITION P1 VALUES (100) TABLESPACE tnt_space1, PARTITION P2 VALUES (200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space2);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> --LIST������using index LOCAL
SQL> CREATE TABLE T41(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY LIST(C1) (PARTITION P1 VALUES (100) TABLESPACE tnt_space1, PARTITION P2 VALUES (200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

Succeed.

SQL> CREATE TABLE T42(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space2, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY LIST(C1) (PARTITION P1 VALUES (100) TABLESPACE tnt_space1, PARTITION P2 VALUES (200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T43(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space2)) PARTITION BY LIST(C1) (PARTITION P1 VALUES (100) TABLESPACE tnt_space1, PARTITION P2 VALUES (200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T44(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY LIST(C1) (PARTITION P1 VALUES (100) TABLESPACE tnt_space2, PARTITION P2 VALUES (200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T45(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY LIST(C1) (PARTITION P1 VALUES (100) TABLESPACE tnt_space1, PARTITION P2 VALUES (200) TABLESPACE tnt_space2) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T46(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY LIST(C1) (PARTITION P1 VALUES (100) TABLESPACE tnt_space1, PARTITION P2 VALUES (200) TABLESPACE tnt_space1) TABLESPACE tnt_space2 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T47(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1)) PARTITION BY LIST(C1) (PARTITION P1 VALUES (100) TABLESPACE tnt_space1, PARTITION P2 VALUES (200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space2);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> --HASH������
SQL> CREATE TABLE T51(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY HASH(C2) (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

Succeed.

SQL> CREATE TABLE T52(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space2) PARTITION BY HASH(C2) (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T53(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY HASH(C2) (PARTITION P1 TABLESPACE tnt_space2, PARTITION P2 TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T54(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY HASH(C2) (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space2) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T55(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY HASH(C2) (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1) TABLESPACE tnt_space2 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T56(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY HASH(C2) (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space2);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> --HASH������PARTITIONS
SQL> CREATE TABLE T61(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY HASH(C2) PARTITIONS 10 STORE IN (tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

Succeed.

SQL> CREATE TABLE T62(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space2) PARTITION BY HASH(C2) PARTITIONS 10 STORE IN (tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T63(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY HASH(C2) PARTITIONS 10 STORE IN (tnt_space2) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T64(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY HASH(C2) PARTITIONS 10 STORE IN (tnt_space1) TABLESPACE tnt_space2 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T65(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY HASH(C2) PARTITIONS 10 STORE IN (tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space2);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> --RANGE������INTERVAL
SQL> CREATE TABLE T71(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY RANGE(C2) INTERVAL(100) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

Succeed.

SQL> CREATE TABLE T72(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space2) PARTITION BY RANGE(C2) INTERVAL(100) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T73(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY RANGE(C2) INTERVAL(100) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space2, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T74(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY RANGE(C2) INTERVAL(100) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space2) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T75(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY RANGE(C2) INTERVAL(100) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space2 LOB(C3) STORE AS (TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE TABLE T76(C1 INT, C2 INT, C3 CLOB, PRIMARY KEY (C1) using index TABLESPACE tnt_space1) PARTITION BY RANGE(C2) INTERVAL(100) (PARTITION P1 VALUES LESS THAN(100) TABLESPACE tnt_space1, PARTITION P2 VALUES LESS THAN(200) TABLESPACE tnt_space1) TABLESPACE tnt_space1 LOB(C3) STORE AS (TABLESPACE tnt_space2);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> --CREATE/ALTER USER
SQL> CREATE USER TNT1_USER2 IDENTIFIED BY Root1234 DEFAULT TABLESPACE tnt_space2;

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE USER TNT1_USER3 IDENTIFIED BY Root1234 DEFAULT TABLESPACE tnt_space1;

Succeed.

SQL> ALTER USER TNT1_USER3 DEFAULT TABLESPACE tnt_space2;

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> ALTER USER TNT1_USER3 DEFAULT TABLESPACE tnt_space3;

Succeed.

SQL> --NORMAL TABLE INDEX/ALTER TABLE ADD CONSTRAINT
SQL> CREATE TABLE T81(C1 INT, C2 INT);

Succeed.

SQL> CREATE INDEX I81 ON T81(C1) TABLESPACE tnt_space1;

Succeed.

SQL> CREATE INDEX I82 ON T81(C2) TABLESPACE tnt_space2;

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> ALTER TABLE T81 ADD CONSTRAINT CONS UNIQUE(C2) USING INDEX TABLESPACE tnt_space2;

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> ALTER TABLE T81 ADD CONSTRAINT CONS UNIQUE(C2) USING INDEX TABLESPACE tnt_space1;

Succeed.

SQL> --PARTITION TABLE INDEX/ALTER TABLE ADD PARTITION
SQL> CREATE TABLE T91(C1 INT, C2 INT, C3 INT, C4 INT) PARTITION BY RANGE(C1) (PARTITION P1 VALUES LESS THAN(100), PARTITION P2 VALUES LESS THAN(200));

Succeed.

SQL> CREATE INDEX I91 ON T91(C1) TABLESPACE tnt_space1 LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1);

Succeed.

SQL> CREATE INDEX I92 ON T91(C2) TABLESPACE tnt_space2 LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE INDEX I93 ON T91(C3) TABLESPACE tnt_space1 LOCAL (PARTITION P1 TABLESPACE tnt_space2, PARTITION P2 TABLESPACE tnt_space1);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> CREATE INDEX I94 ON T91(C4) TABLESPACE tnt_space1 LOCAL (PARTITION P1 TABLESPACE tnt_space1, PARTITION P2 TABLESPACE tnt_space2);

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> ALTER TABLE T91 ADD PARTITION P3 VALUES LESS THAN(300) TABLESPACE tnt_space2;

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> ALTER TABLE T91 ADD PARTITION P3 VALUES LESS THAN(300) TABLESPACE tnt_space1;

Succeed.

SQL> --PUEGE TABLESPACE
SQL> PURGE TABLESPACE tnt_space1;

Succeed.

SQL> PURGE TABLESPACE tnt_space2;

CT-01391, Tablespace TNT_SPACE2 is disabled in current tenant
SQL> 
SQL> --������
SQL> conn / as sysdba

connected.

SQL> DROP TENANT IF EXISTS TNT1 CASCADE;

Succeed.

SQL> DROP TENANT IF EXISTS TNT2 CASCADE;

Succeed.

SQL> DROP TABLESPACE TNT_SPACE1;

Succeed.

SQL> DROP TABLESPACE TNT_SPACE2;

Succeed.

SQL> DROP TABLESPACE TNT_SPACE3;

Succeed.

SQL> DROP TABLESPACE TNT_SPACE4;

Succeed.

SQL> 
SQL> --DTS202006090RCU19P0J00 �ڸ��⻧�п��������л�schema���ڷǸ��⻧���л��������⻧schema������Ч�Ĳ���
SQL> conn / AS SYSDBA

connected.

SQL> create tenant tnt1 tablespaces (users);

Succeed.

SQL> alter session set tenant=tnt1;

Succeed.

SQL> create user tnt1_user identified by Root1234;

Succeed.

SQL> grant dba to tnt1_user;

Succeed.

SQL> 
SQL> conn / AS SYSDBA

connected.

SQL> create tenant tnt2 tablespaces (users);

Succeed.

SQL> alter session set tenant=tnt2;

Succeed.

SQL> create user tnt2_user identified by Root1234;

Succeed.

SQL> grant dba to tnt2_user;

Succeed.

SQL> 
SQL> 
SQL> conn tnt1_user/Root1234@127.0.0.1:1611/tnt1

connected.

SQL> alter session set tenant=tnt1;

CT-01001, Permissions were insufficient
SQL> alter session set current_schema=tnt1$tnt1_user;

Succeed.

SQL> alter session set current_schema=tnt1_user;

Succeed.

SQL> alter session set current_schema=sys;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> alter session set current_schema=tnt2$tnt2_user;

CT-00613, Invalid operation, can not cross tenant in non-root tenant
SQL> 
SQL> conn / as sysdba

connected.

SQL> alter session set tenant=tnt1;

Succeed.

SQL> alter session set current_schema=tnt1$tnt1_user;

Succeed.

SQL> alter session set current_schema=tnt1_user;

Succeed.

SQL> alter session set current_schema=sys;

Succeed.

SQL> alter session set current_schema=tnt2$tnt2_user;

CT-00613, Invalid operation, can not cross tenant in non-root tenant
SQL> alter session set tenant=TENANT$ROOT;

Succeed.

SQL> alter session set current_schema=sys;

Succeed.

SQL> DROP TENANT tnt1 CASCADE;

Succeed.

SQL> DROP TENANT tnt2 CASCADE;

Succeed.

SQL> 
SQL> --DTS20200611032MWWP0H00 
SQL> CONN / AS SYSDBA

connected.

SQL> DROP TENANT IF EXISTS TNT1 CASCADE;

Succeed.

SQL> create tenant tnt1 tablespaces (USERS);

Succeed.

SQL> alter session set tenant=tnt1;

Succeed.

SQL> create user tnt1_user identified by Root1234;

Succeed.

SQL> grant dba to tnt1_user;

Succeed.

SQL> CONN tnt1_user/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> CREATE TABLE T1(C1 INT);

Succeed.

SQL> exec dbe_stats.collect_table_stats('tnt1_user', 'T1',null, 100, true,null);

PL/SQL procedure successfully completed.

SQL> exec dbe_stats.collect_table_stats('TNT1$tnt1_user', 'T1',null, 100, true,null);

PL/SQL procedure successfully completed.

SQL> exec dbe_stats.collect_table_stats('tnt2_user', 'T1',null, 100, true,null);

CT-00932, [1:2] PL/SQL(TNT1$TNT1_USER.ANONYMOUS BLOCK) terminated with execute errors
[1:2] PL/SQL(TNT1$DBE_STATS.COLLECT_TABLE_STATS) terminated with execute errors
CT-00843, The table or view TNT1$TNT2_USER.T1 does not exist.

SQL> CONN / AS SYSDBA

connected.

SQL> DROP TENANT TNT1 CASCADE;

Succeed.

SQL> 
SQL> --DTS202006150G9T5AP1400
SQL> CONN / AS SYSDBA

connected.

SQL> call DBE_RSRC_MGR.CREATE_PLAN('tnt_plan', 'plan for tenant', 1);

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.CREATE_CONTROL_GROUP('tnt_group1', 'tenant group1 description');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.CREATE_CONTROL_GROUP('tnt_group2', 'tenant group2 description');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt1', 'tnt_group1');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt2', 'tnt_group2');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_user_to_control_group('user1', 'tnt_group1');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_user_to_control_group('user2', 'tnt_group2');

PL/SQL procedure successfully completed.

SQL> select *from sys_rsrc_group_mappings order by VALUE;

ATTRIBUTE                                                        VALUE                                                            CONTROL_GROUP                                                   
---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
TENANT                                                           TNT1                                                             TNT_GROUP1                                                      
TENANT                                                           TNT2                                                             TNT_GROUP2                                                      
DB_USER                                                          USER1                                                            TNT_GROUP1                                                      
DB_USER                                                          USER2                                                            TNT_GROUP2                                                      

4 rows fetched.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt1', 'tnt_group2');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt2', 'tnt_group1');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_user_to_control_group('user1', 'tnt_group2');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_user_to_control_group('user2', 'tnt_group1');

PL/SQL procedure successfully completed.

SQL> select *from sys_rsrc_group_mappings order by VALUE;

ATTRIBUTE                                                        VALUE                                                            CONTROL_GROUP                                                   
---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------
TENANT                                                           TNT1                                                             TNT_GROUP2                                                      
TENANT                                                           TNT2                                                             TNT_GROUP1                                                      
DB_USER                                                          USER1                                                            TNT_GROUP2                                                      
DB_USER                                                          USER2                                                            TNT_GROUP1                                                      

4 rows fetched.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt1', '');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt2', null);

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_user_to_control_group('user1', '');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_user_to_control_group('user2', null);

PL/SQL procedure successfully completed.

SQL> select *from sys_rsrc_group_mappings order by VALUE;

ATTRIBUTE                                                        VALUE                                                            CONTROL_GROUP                                                   
---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------

0 rows fetched.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt1', '');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt2', null);

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_user_to_control_group('user1', '');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.add_user_to_control_group('user2', null);

PL/SQL procedure successfully completed.

SQL> select *from sys_rsrc_group_mappings order by VALUE;

ATTRIBUTE                                                        VALUE                                                            CONTROL_GROUP                                                   
---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------------------------------------------------

0 rows fetched.

SQL> call DBE_RSRC_MGR.DELETE_PLAN('tnt_plan');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.DELETE_CONTROL_GROUP('tnt_group1');

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.DELETE_CONTROL_GROUP('tnt_group2');

PL/SQL procedure successfully completed.

SQL> 
SQL> --DTS202006160HTXSNP1400
SQL> CONN / AS SYSDBA

connected.

SQL> DROP TENANT IF EXISTS TNT1 CASCADE;

Succeed.

SQL> DROP TENANT IF EXISTS TNT2 CASCADE;

Succeed.

SQL> create tenant tnt1 tablespaces (USERS);

Succeed.

SQL> create tenant tnt2 tablespaces (USERS);

Succeed.

SQL> alter session set tenant=tnt1;

Succeed.

SQL> create user tnt1_user1 identified by Root1234;

Succeed.

SQL> grant dba to tnt1_user1;

Succeed.

SQL> create user tnt1_user2 identified by Root1234;

Succeed.

SQL> grant dba to tnt1_user2;

Succeed.

SQL> alter session set tenant=tnt2;

Succeed.

SQL> create user tnt2_user1 identified by Root1234;

Succeed.

SQL> grant dba to tnt2_user1;

Succeed.

SQL> CONN tnt1_user1/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> CREATE TABLE T1U1_T1(C1 INT);

Succeed.

SQL> CREATE VIEW T1U1_V1 AS SELECT * FROM T1U1_T1;

Succeed.

SQL> CREATE VIEW T1U1_V2 AS SELECT * FROM T1U1_V1;

Succeed.

SQL> SELECT * FROM DB_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             TYPE         REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_TYPE
---------------------------------------------------------------- ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------
TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_T1                                                          TABLE          
TNT1$TNT1_USER1                                                  T1U1_V2                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW           

2 rows fetched.

SQL> SELECT * FROM ADM_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             TYPE         REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_TYPE
---------------------------------------------------------------- ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------
TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_T1                                                          TABLE          
TNT1$TNT1_USER1                                                  T1U1_V2                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW           

2 rows fetched.

SQL> SELECT * FROM DB_VIEW_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_LEVEL
---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------
TNT1$TNT1_USER1                                                  T1U1_V2                                                          TNT1$TNT1_USER1                                                  T1U1_V1                                                          1               

1 rows fetched.

SQL> CONN tnt1_user2/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> CREATE TABLE T1U2_T1(C1 INT);

Succeed.

SQL> CREATE VIEW T1U2_V1 AS SELECT * FROM T1U2_T1;

Succeed.

SQL> CREATE VIEW T1U2_V2 AS SELECT * FROM T1U2_V1;

Succeed.

SQL> SELECT * FROM DB_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             TYPE         REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_TYPE
---------------------------------------------------------------- ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------
TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_T1                                                          TABLE          
TNT1$TNT1_USER1                                                  T1U1_V2                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW           
TNT1$TNT1_USER2                                                  T1U2_V1                                                          VIEW         TNT1$TNT1_USER2                                                  T1U2_T1                                                          TABLE          
TNT1$TNT1_USER2                                                  T1U2_V2                                                          VIEW         TNT1$TNT1_USER2                                                  T1U2_V1                                                          VIEW           

4 rows fetched.

SQL> SELECT * FROM ADM_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             TYPE         REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_TYPE
---------------------------------------------------------------- ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------
TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_T1                                                          TABLE          
TNT1$TNT1_USER1                                                  T1U1_V2                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW           
TNT1$TNT1_USER2                                                  T1U2_V1                                                          VIEW         TNT1$TNT1_USER2                                                  T1U2_T1                                                          TABLE          
TNT1$TNT1_USER2                                                  T1U2_V2                                                          VIEW         TNT1$TNT1_USER2                                                  T1U2_V1                                                          VIEW           

4 rows fetched.

SQL> SELECT * FROM DB_VIEW_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_LEVEL
---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------
TNT1$TNT1_USER1                                                  T1U1_V2                                                          TNT1$TNT1_USER1                                                  T1U1_V1                                                          1               
TNT1$TNT1_USER2                                                  T1U2_V2                                                          TNT1$TNT1_USER2                                                  T1U2_V1                                                          1               

2 rows fetched.

SQL> CONN tnt2_user1/Root1234@127.0.0.1:1611/TNT2

connected.

SQL> CREATE TABLE T2U1_T1(C1 INT);

Succeed.

SQL> CREATE VIEW T2U1_V1 AS SELECT * FROM T2U1_T1;

Succeed.

SQL> CREATE VIEW T2U1_V2 AS SELECT * FROM T2U1_V1;

Succeed.

SQL> SELECT * FROM DB_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             TYPE         REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_TYPE
---------------------------------------------------------------- ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------
TNT2$TNT2_USER1                                                  T2U1_V1                                                          VIEW         TNT2$TNT2_USER1                                                  T2U1_T1                                                          TABLE          
TNT2$TNT2_USER1                                                  T2U1_V2                                                          VIEW         TNT2$TNT2_USER1                                                  T2U1_V1                                                          VIEW           

2 rows fetched.

SQL> SELECT * FROM ADM_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             TYPE         REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_TYPE
---------------------------------------------------------------- ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------
TNT2$TNT2_USER1                                                  T2U1_V1                                                          VIEW         TNT2$TNT2_USER1                                                  T2U1_T1                                                          TABLE          
TNT2$TNT2_USER1                                                  T2U1_V2                                                          VIEW         TNT2$TNT2_USER1                                                  T2U1_V1                                                          VIEW           

2 rows fetched.

SQL> SELECT * FROM DB_VIEW_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_LEVEL
---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------
TNT2$TNT2_USER1                                                  T2U1_V2                                                          TNT2$TNT2_USER1                                                  T2U1_V1                                                          1               

1 rows fetched.

SQL> CONN / AS SYSDBA

connected.

SQL> alter session set tenant=tnt1;

Succeed.

SQL> alter session set current_schema=tnt1_user1;

Succeed.

SQL> SELECT * FROM DB_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             TYPE         REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_TYPE
---------------------------------------------------------------- ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------
TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_T1                                                          TABLE          
TNT1$TNT1_USER1                                                  T1U1_V2                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW           
TNT1$TNT1_USER2                                                  T1U2_V1                                                          VIEW         TNT1$TNT1_USER2                                                  T1U2_T1                                                          TABLE          
TNT1$TNT1_USER2                                                  T1U2_V2                                                          VIEW         TNT1$TNT1_USER2                                                  T1U2_V1                                                          VIEW           

4 rows fetched.

SQL> SELECT * FROM ADM_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             TYPE         REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_TYPE
---------------------------------------------------------------- ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------
TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_T1                                                          TABLE          
TNT1$TNT1_USER1                                                  T1U1_V2                                                          VIEW         TNT1$TNT1_USER1                                                  T1U1_V1                                                          VIEW           
TNT1$TNT1_USER2                                                  T1U2_V1                                                          VIEW         TNT1$TNT1_USER2                                                  T1U2_T1                                                          TABLE          
TNT1$TNT1_USER2                                                  T1U2_V2                                                          VIEW         TNT1$TNT1_USER2                                                  T1U2_V1                                                          VIEW           

4 rows fetched.

SQL> SELECT * FROM DB_VIEW_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_LEVEL
---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------
TNT1$TNT1_USER1                                                  T1U1_V2                                                          TNT1$TNT1_USER1                                                  T1U1_V1                                                          1               
TNT1$TNT1_USER2                                                  T1U2_V2                                                          TNT1$TNT1_USER2                                                  T1U2_V1                                                          1               

2 rows fetched.

SQL> alter session set tenant=tnt2;

Succeed.

SQL> alter session set current_schema=tnt2_user1;

Succeed.

SQL> SELECT * FROM DB_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             TYPE         REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_TYPE
---------------------------------------------------------------- ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------
TNT2$TNT2_USER1                                                  T2U1_V1                                                          VIEW         TNT2$TNT2_USER1                                                  T2U1_T1                                                          TABLE          
TNT2$TNT2_USER1                                                  T2U1_V2                                                          VIEW         TNT2$TNT2_USER1                                                  T2U1_V1                                                          VIEW           

2 rows fetched.

SQL> SELECT * FROM ADM_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             TYPE         REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_TYPE
---------------------------------------------------------------- ---------------------------------------------------------------- ------------ ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------
TNT2$TNT2_USER1                                                  T2U1_V1                                                          VIEW         TNT2$TNT2_USER1                                                  T2U1_T1                                                          TABLE          
TNT2$TNT2_USER1                                                  T2U1_V2                                                          VIEW         TNT2$TNT2_USER1                                                  T2U1_V1                                                          VIEW           

2 rows fetched.

SQL> SELECT * FROM DB_VIEW_DEPENDENCIES ORDER BY NAME;

OWNER                                                            NAME                                                             REFERENCED_OWNER                                                 REFERENCED_NAME                                                  REFERENCED_LEVEL
---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------
TNT2$TNT2_USER1                                                  T2U1_V2                                                          TNT2$TNT2_USER1                                                  T2U1_V1                                                          1               

1 rows fetched.

SQL> DROP TENANT IF EXISTS TNT1 CASCADE;

Succeed.

SQL> DROP TENANT IF EXISTS TNT2 CASCADE;

Succeed.

SQL> 
SQL> --DBE_MASK_DATA
SQL> conn / as sysdba

connected.

SQL> drop TENANT if exists tenant_management_018_01 cascade;

Succeed.

SQL> CREATE TENANT tenant_management_018_01 TABLESPACES (users) DEFAULT TABLESPACE users;

Succeed.

SQL> ALTER SESSION SET TENANT=tenant_management_018_01;

Succeed.

SQL> drop user if exists tenant_management_dba cascade;

Succeed.

SQL> create user tenant_management_dba identified by Cantian_234;

Succeed.

SQL> grant dba to tenant_management_dba;

Succeed.

SQL> ALTER SESSION SET current_schema='tenant_management_dba';

Succeed.

SQL> create table tenant_management_dba_table(name varchar(1024));

Succeed.

SQL> BEGIN DBE_MASK_DATA.ADD_POLICY(
  2 object_schema => 'tenant_management_dba',
  3 object_name => 'tenant_management_dba_table',
  4 column_name => 'name',
  5 policy_name => 'RULE1',
  6 policy_type => 'FULL',
  7 mask_value=> '7');
  8 END;
  9 /

PL/SQL procedure successfully completed.

SQL> BEGIN DBE_MASK_DATA.DROP_POLICY(
  2 object_schema => 'tenant_management_dba',
  3 object_name => 'tenant_management_dba_table',
  4 policy_name => 'RULE1');
  5 END;
  6 /

PL/SQL procedure successfully completed.

SQL> drop TENANT if exists tenant_management_018_01 cascade;

Succeed.

SQL> 
SQL> --exp show create table
SQL> CONN / AS SYSDBA

connected.

SQL> drop table if exists root_t1;

Succeed.

SQL> create table root_t1(c1 int) TABLESPACE USERS INITRANS 2 MAXTRANS 255 PCTFREE 8;

Succeed.

SQL> show create table root_t1;

CREATE TABLE "ROOT_T1"
(
  "C1" BINARY_INTEGER
)
TABLESPACE "USERS"
INITRANS 2
MAXTRANS 255
PCTFREE 8
FORMAT ASF;



SQL> drop tenant if exists tnt1 cascade;

Succeed.

SQL> create tenant tnt1 tablespaces (USERS);

Succeed.

SQL> alter session set tenant=tnt1;

Succeed.

SQL> create user tnt1_user1 identified by Root1234;

Succeed.

SQL> grant dba to tnt1_user1;

Succeed.

SQL> CONN tnt1_user1/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> create table tnt1_t1(c1 int) TABLESPACE USERS INITRANS 2 MAXTRANS 255 PCTFREE 8;

Succeed.

SQL> show create table tnt1_t1;

CREATE TABLE "TNT1_T1"
(
  "C1" BINARY_INTEGER
)
TABLESPACE "USERS"
INITRANS 2
MAXTRANS 255
PCTFREE 8;



SQL> CONN / AS SYSDBA

connected.

SQL> drop tenant if exists tnt1 cascade;

Succeed.

SQL> drop table if exists root_t1;

Succeed.

SQL> 
SQL> --TENANT TABLESPACE PRIV
SQL> CONN / AS SYSDBA

connected.

SQL> DROP USER IF EXISTS TNT_USER1 CASCADE;

Succeed.

SQL> CREATE TABLESPACE TNT_TS1 DATAFILE 'TNT_TS1.DBF' SIZE 32M;

Succeed.

SQL> create user TNT_USER1 identified by Root1234;

Succeed.

SQL> GRANT CONNECT TO TNT_USER1;

Succeed.

SQL> DROP TENANT IF EXISTS TNT1 CASCADE;

Succeed.

SQL> CREATE TENANT TNT1 TABLESPACES(USERS);

Succeed.

SQL> alter session set tenant=TNT1;

Succeed.

SQL> create user TNT1_USER1 identified by Root1234;

Succeed.

SQL> grant CONNECT to TNT1_USER1;

Succeed.

SQL> CONN TNT1_USER1/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> CREATE TENANT TNT2 TABLESPACES(USERS);

CT-01001, Permissions were insufficient
SQL> ALTER TENANT TNT2 ADD TABLESPACES(TNT_TS1);

CT-01001, Permissions were insufficient
SQL> DROP TENANT TNT2 CASCADE;

CT-01001, Permissions were insufficient
SQL> CREATE TABLESPACE TNT_TS2 DATAFILE 'TNT_TS2.DBF' SIZE 32M;

CT-01001, Permissions were insufficient
SQL> ALTER TABLESPACE TNT_TS2 ADD DATAFILE 'TNT_TS2_1.DBF' SIZE 32M;

CT-01001, Permissions were insufficient
SQL> DROP TABLESPACE TNT_TS2;

CT-01001, Permissions were insufficient
SQL> CREATE OR REPLACE PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 10;

CT-01001, Permissions were insufficient
SQL> ALTER PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 11;

CT-01001, Permissions were insufficient
SQL> DROP PROFILE TNT_PRO;

CT-01001, Permissions were insufficient
SQL> CONN TNT_USER1/Root1234@127.0.0.1:1611

connected.

SQL> CREATE TENANT TNT2 TABLESPACES(USERS);

CT-01001, Permissions were insufficient
SQL> ALTER TENANT TNT2 ADD TABLESPACES(TNT_TS1);

CT-01001, Permissions were insufficient
SQL> DROP TENANT TNT2 CASCADE;

CT-01001, Permissions were insufficient
SQL> CREATE TABLESPACE TNT_TS2 DATAFILE 'TNT_TS2.DBF' SIZE 32M;

CT-01001, Permissions were insufficient
SQL> ALTER TABLESPACE TNT_TS2 ADD DATAFILE 'TNT_TS2_1.DBF' SIZE 32M;

CT-01001, Permissions were insufficient
SQL> DROP TABLESPACE TNT_TS2;

CT-01001, Permissions were insufficient
SQL> CREATE OR REPLACE PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 10;

CT-01001, Permissions were insufficient
SQL> ALTER PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 11;

CT-01001, Permissions were insufficient
SQL> DROP PROFILE TNT_PRO;

CT-01001, Permissions were insufficient
SQL> CONN / AS SYSDBA

connected.

SQL> GRANT CREATE TENANT,ALTER TENANT,DROP TENANT,CREATE TABLESPACE,ALTER TABLESPACE,DROP TABLESPACE,CREATE PROFILE,ALTER PROFILE,DROP PROFILE TO TNT_USER1,TNT1$TNT1_USER1;

Succeed.

SQL> CONN TNT1_USER1/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> CREATE TENANT TNT2 TABLESPACES(USERS);

CT-01001, Permissions were insufficient
SQL> ALTER TENANT TNT2 ADD TABLESPACES(TNT_TS1);

CT-01001, Permissions were insufficient
SQL> DROP TENANT TNT2 CASCADE;

CT-01001, Permissions were insufficient
SQL> CREATE TABLESPACE TNT_TS2 DATAFILE 'TNT_TS2.DBF' SIZE 32M;

CT-01001, Permissions were insufficient
SQL> ALTER TABLESPACE TNT_TS2 ADD DATAFILE 'TNT_TS2_1.DBF' SIZE 32M;

CT-01001, Permissions were insufficient
SQL> DROP TABLESPACE TNT_TS2;

CT-01001, Permissions were insufficient
SQL> CREATE OR REPLACE PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 10;

CT-01001, Permissions were insufficient
SQL> ALTER PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 11;

CT-01001, Permissions were insufficient
SQL> DROP PROFILE TNT_PRO;

CT-01001, Permissions were insufficient
SQL> CONN TNT_USER1/Root1234@127.0.0.1:1611

connected.

SQL> CREATE TENANT TNT2 TABLESPACES(USERS);

Succeed.

SQL> ALTER TENANT TNT2 ADD TABLESPACES(TNT_TS1);

Succeed.

SQL> DROP TENANT TNT2 CASCADE;

Succeed.

SQL> CREATE TABLESPACE TNT_TS2 DATAFILE 'TNT_TS2.DBF' SIZE 32M;

Succeed.

SQL> ALTER TABLESPACE TNT_TS2 ADD DATAFILE 'TNT_TS2_1.DBF' SIZE 32M;

Succeed.

SQL> DROP TABLESPACE TNT_TS2;

Succeed.

SQL> CREATE OR REPLACE PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 10;

Succeed.

SQL> ALTER PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 11;

Succeed.

SQL> DROP PROFILE TNT_PRO;

Succeed.

SQL> CONN / AS SYSDBA

connected.

SQL> REVOKE CREATE TENANT,ALTER TENANT,DROP TENANT,CREATE TABLESPACE,ALTER TABLESPACE,DROP TABLESPACE,CREATE PROFILE,ALTER PROFILE,DROP PROFILE FROM TNT_USER1,TNT1$TNT1_USER1;

Succeed.

SQL> CONN TNT1_USER1/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> CREATE TENANT TNT2 TABLESPACES(USERS);

CT-01001, Permissions were insufficient
SQL> ALTER TENANT TNT2 ADD TABLESPACES(TNT_TS1);

CT-01001, Permissions were insufficient
SQL> DROP TENANT TNT2 CASCADE;

CT-01001, Permissions were insufficient
SQL> CREATE TABLESPACE TNT_TS2 DATAFILE 'TNT_TS2.DBF' SIZE 32M;

CT-01001, Permissions were insufficient
SQL> ALTER TABLESPACE TNT_TS2 ADD DATAFILE 'TNT_TS2_1.DBF' SIZE 32M;

CT-01001, Permissions were insufficient
SQL> DROP TABLESPACE TNT_TS2;

CT-01001, Permissions were insufficient
SQL> CREATE OR REPLACE PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 10;

CT-01001, Permissions were insufficient
SQL> ALTER PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 11;

CT-01001, Permissions were insufficient
SQL> DROP PROFILE TNT_PRO;

CT-01001, Permissions were insufficient
SQL> CONN TNT_USER1/Root1234@127.0.0.1:1611

connected.

SQL> CREATE TENANT TNT2 TABLESPACES(USERS);

CT-01001, Permissions were insufficient
SQL> ALTER TENANT TNT2 ADD TABLESPACES(TNT_TS1);

CT-01001, Permissions were insufficient
SQL> DROP TENANT TNT2 CASCADE;

CT-01001, Permissions were insufficient
SQL> CREATE TABLESPACE TNT_TS2 DATAFILE 'TNT_TS2.DBF' SIZE 32M;

CT-01001, Permissions were insufficient
SQL> ALTER TABLESPACE TNT_TS2 ADD DATAFILE 'TNT_TS2_1.DBF' SIZE 32M;

CT-01001, Permissions were insufficient
SQL> DROP TABLESPACE TNT_TS2;

CT-01001, Permissions were insufficient
SQL> CREATE OR REPLACE PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 10;

CT-01001, Permissions were insufficient
SQL> ALTER PROFILE TNT_PRO LIMIT PASSWORD_GRACE_TIME 11;

CT-01001, Permissions were insufficient
SQL> DROP PROFILE TNT_PRO;

CT-01001, Permissions were insufficient
SQL> CONN / AS SYSDBA

connected.

SQL> DROP USER IF EXISTS TNT_USER1 CASCADE;

Succeed.

SQL> DROP TENANT IF EXISTS TNT1 CASCADE;

Succeed.

SQL> DROP TABLESPACE TNT_TS1;

Succeed.

SQL> 
SQL> --test DBE_RSRC_MGR/ALTER SYSTEM/��ʽָ��SYS
SQL> CONN / AS SYSDBA

connected.

SQL> DROP TENANT IF EXISTS TNT1 CASCADE;

Succeed.

SQL> CREATE TENANT TNT1 TABLESPACES(USERS);

Succeed.

SQL> alter session set tenant=TNT1;

Succeed.

SQL> create user TNT1_USER1 identified by Root1234;

Succeed.

SQL> grant dba to TNT1_USER1;

Succeed.

SQL> CONN TNT1_USER1/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> call DBE_RSRC_MGR.CREATE_PLAN('tnt_plan', 'plan for tenant', 1);

CT-00944, PL/SQL(TNT1$TNT1_USER1.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00613 Invalid operation, only support for users in TENANT$ROOT

SQL> call DBE_RSRC_MGR.CREATE_CONTROL_GROUP('tnt_group1', 'tenant group1 description');

CT-00944, PL/SQL(TNT1$TNT1_USER1.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00613 Invalid operation, only support for users in TENANT$ROOT

SQL> call DBE_RSRC_MGR.add_tenant_to_control_group('tnt1', 'tnt_group1');

CT-00944, PL/SQL(TNT1$TNT1_USER1.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00613 Invalid operation, only support for users in TENANT$ROOT

SQL> call DBE_RSRC_MGR.add_user_to_control_group('tnt1', 'tnt_group1');

CT-00944, PL/SQL(TNT1$TNT1_USER1.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00613 Invalid operation, only support for users in TENANT$ROOT

SQL> call DBE_RSRC_MGR.CREATE_PLAN_RULE('tnt_plan', 'tnt_group1', 'plan for tnt_group1', 40, 200, 200, 120, 1000, NULL, NULL, NULL);

CT-00944, PL/SQL(TNT1$TNT1_USER1.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00613 Invalid operation, only support for users in TENANT$ROOT

SQL> alter system set resource_plan = 'tnt_plan';

CT-01001, Permissions were insufficient
SQL> SELECT ID,NAME FROM SYS.SYS_USERS WHERE NAME='SYS' ORDER BY NAME;

CT-00613, [1:21]Invalid operation, only support for users in TENANT$ROOT
SQL> ALTER SESSION SET CURRENT_SCHEMA=SYS;

CT-00613, Invalid operation, only support for users in TENANT$ROOT
SQL> SHUTDOWN;

CT-01001, Permissions were insufficient
SQL> CONN / AS SYSDBA

connected.

SQL> alter session set tenant=TNT1;

Succeed.

SQL> call DBE_RSRC_MGR.CREATE_PLAN('tnt_plan', 'plan for tenant', 1);

PL/SQL procedure successfully completed.

SQL> call DBE_RSRC_MGR.DELETE_PLAN('tnt_plan');

PL/SQL procedure successfully completed.

SQL> alter system set resource_plan = '';

Succeed.

SQL> SELECT ID,NAME FROM SYS.SYS_USERS WHERE NAME='SYS' ORDER BY NAME;

ID           NAME                                                            
------------ ----------------------------------------------------------------
0            SYS                                                             

1 rows fetched.

SQL> ALTER SESSION SET CURRENT_SCHEMA=SYS;

Succeed.

SQL> SELECT ID,NAME FROM SYS_USERS WHERE NAME='SYS' ORDER BY NAME;

ID           NAME                                                            
------------ ----------------------------------------------------------------
0            SYS                                                             

1 rows fetched.

SQL> DROP TENANT IF EXISTS TNT1 CASCADE;

Succeed.

SQL> 
SQL> --DTS2020081305MSADP1400 ��̬������ͼ��¼���⻧ID���룬��ȡdc_userʧ��ʱ����Ӱ�������߼�
SQL> CONN / AS SYSDBA

connected.

SQL> DROP USER IF EXISTS ROOT_USER1 CASCADE;

Succeed.

SQL> DROP USER IF EXISTS ROOT_USER2 CASCADE;

Succeed.

SQL> DROP TENANT IF EXISTS TNT1 CASCADE;

Succeed.

SQL> create user ROOT_USER1 identified by Root1234;

Succeed.

SQL> create user ROOT_USER2 identified by Root1234;

Succeed.

SQL> grant dba to ROOT_USER1, ROOT_USER2;

Succeed.

SQL> CREATE TENANT TNT1 TABLESPACES(USERS);

Succeed.

SQL> alter session set tenant=TNT1;

Succeed.

SQL> create user TNT1_USER1 identified by Root1234;

Succeed.

SQL> grant dba to TNT1_USER1;

Succeed.

SQL> create user TNT1_USER2 identified by Root1234;

Succeed.

SQL> grant dba to TNT1_USER2;

Succeed.

SQL> CONN ROOT_USER1/Root1234@127.0.0.1:1611

connected.

SQL> CREATE TABLE T1(C1 INT);

Succeed.

SQL> INSERT INTO T1 VALUES(1);

1 rows affected.

SQL> COMMIT;

Succeed.

SQL> CONN ROOT_USER2/Root1234@127.0.0.1:1611

connected.

SQL> CREATE TABLE T1(C1 INT);

Succeed.

SQL> INSERT INTO T1 VALUES(1);

1 rows affected.

SQL> COMMIT;

Succeed.

SQL> CONN TNT1_USER1/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> CREATE TABLE T1(C1 INT);

Succeed.

SQL> INSERT INTO T1 VALUES(1);

1 rows affected.

SQL> COMMIT;

Succeed.

SQL> CONN TNT1_USER2/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> CREATE TABLE T1(C1 INT);

Succeed.

SQL> INSERT INTO T1 VALUES(1);

1 rows affected.

SQL> COMMIT;

Succeed.

SQL> CONN / AS SYSDBA

connected.

SQL> SELECT U.USERNAME, D.SQL_ID, D.SQL_TYPE, D.REF_COUNT, D.VALID FROM DV_SQL_POOL D LEFT JOIN ADM_USERS U ON D.UID=U.USER_ID WHERE SQL_ID=2005423363 ORDER BY U.USERNAME;

USERNAME                                                         SQL_ID     SQL_TYPE     REF_COUNT    VALID 
---------------------------------------------------------------- ---------- ------------ ------------ ------
ROOT_USER1                                                       2005423363 3            0            TRUE  
ROOT_USER2                                                       2005423363 3            0            TRUE  
TNT1$TNT1_USER1                                                  2005423363 3            0            TRUE  
TNT1$TNT1_USER2                                                  2005423363 3            0            TRUE  

4 rows fetched.

SQL> DROP USER IF EXISTS ROOT_USER1 CASCADE;

Succeed.

SQL> alter session set tenant=TNT1;

Succeed.

SQL> DROP USER IF EXISTS TNT1_USER1 CASCADE;

Succeed.

SQL> CONN / AS SYSDBA

connected.

SQL> SELECT U.USERNAME, D.SQL_ID, D.SQL_TYPE, D.REF_COUNT, D.VALID FROM DV_SQL_POOL D LEFT JOIN ADM_USERS U ON D.UID=U.USER_ID WHERE SQL_ID=2005423363 ORDER BY U.USERNAME;

USERNAME                                                         SQL_ID     SQL_TYPE     REF_COUNT    VALID 
---------------------------------------------------------------- ---------- ------------ ------------ ------
ROOT_USER2                                                       2005423363 3            0            TRUE  
TNT1$TNT1_USER2                                                  2005423363 3            0            TRUE  
                                                                 2005423363 3            0            TRUE  
                                                                 2005423363 3            0            TRUE  

4 rows fetched.

SQL> CONN TNT1_USER2/Root1234@127.0.0.1:1611/TNT1

connected.

SQL> SELECT U.USERNAME, D.SQL_ID, D.SQL_TYPE, D.REF_COUNT, D.VALID FROM DV_SQL_POOL D LEFT JOIN ADM_USERS U ON D.UID=U.USER_ID WHERE SQL_ID=2005423363 ORDER BY U.USERNAME;

USERNAME                                                         SQL_ID     SQL_TYPE     REF_COUNT    VALID 
---------------------------------------------------------------- ---------- ------------ ------------ ------
TNT1$TNT1_USER2                                                  2005423363 3            0            TRUE  

1 rows fetched.

SQL> CONN / AS SYSDBA

connected.

SQL> DROP USER IF EXISTS ROOT_USER1 CASCADE;

Succeed.

SQL> DROP USER IF EXISTS ROOT_USER2 CASCADE;

Succeed.

SQL> DROP TENANT IF EXISTS TNT1 CASCADE;
Succeed.




