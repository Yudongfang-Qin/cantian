
SQL> set serveroutput on

ON
SQL> --Add some testcases in order to test bind param
SQL> --test bind param in SQL clause
SQL> drop table if exists plsql_param_tr1;

Succeed.

SQL> create table plsql_param_tr1(f1 int, f2 int);

Succeed.

SQL> 
SQL> declare
  2    a int := 1;
  3    p int;
  4 begin
  5    insert into plsql_param_tr1 values(a,?);
  6    select f2 into p from plsql_param_tr1;
  7    dbe_output.print_line(p);
  8 end;
  9 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
7

PL/SQL procedure successfully completed.

SQL> 
SQL> --cann't use bind param after using
SQL> DECLARE
  2 a INT;
  3 b CHAR(16);
  4 c VARCHAR(16);
  5 BEGIN
  6 a := 10;
  7 b := 'abc';
  8 c := 'efc';
  9 EXECUTE IMMEDIATE 'BEGIN 
 10 :x := 11; :y := ''aaa''; :z := ''bbb'';
 11 dbe_output.print_line(''a=''||:x);dbe_output.print_line(''b=''||:y);dbe_output.print_line(''c=''||:z);
 12 END;'
 13 --USING OUT a, OUT b,OUT c;
 14 USING :x,:y,:z;
 15 dbe_output.print_line('a='||a);
 16 dbe_output.print_line('b='||b);
 17 dbe_output.print_line('c='||c);
 18 END;
 19 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: The 2th param:
Direction : DataType : BindValue: The 3th param:
Direction : DataType : BindValue: Bind params successfully.
CT-00932, [9:1] PL/SQL(SYS.ANONYMOUS BLOCK) terminated with execute errors
[9:1] CT-00944, PL/SQL(SYS.ANONYMOUS BLOCK) terminated with compiling errors
[2:1] PLC-00950 The expression  was used as the assignment target (left operand of the assignment statement).
[2:11] PLC-00950 The expression  was used as the assignment target (left operand of the assignment statement).
[2:24] PLC-00950 The expression  was used as the assignment target (left operand of the assignment statement).


SQL> 
SQL> --test bind param in left value
SQL> declare
  2    a int := 1;
  3    p int;
  4 begin
  5    :1 := a + 1;
  6    p := :1 + a;
  7    dbe_output.print_line(p || ' null');
  8 end;
  9 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: The 2th param:
Direction : DataType : BindValue: Bind params successfully.
 null

PL/SQL procedure successfully completed.

SQL> 
SQL> declare
  2    a int := 1;
  3    p int;
  4 begin
  5    :1 := a + 1;
  6    p := :2 + a;
  7    dbe_output.print_line(p || ' null');
  8 end;
  9 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: The 2th param:
Direction : DataType : BindValue: Bind params successfully.
2001 null

PL/SQL procedure successfully completed.

SQL> 
SQL> declare
  2    a int := 1;
  3    p int;
  4 begin
  5    :1 := a + 1;
  6    p := :1 + a;
  7    dbe_output.print_line(p || ' null');
  8 end;
  9 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: The 2th param:
Direction : DataType : BindValue: Bind params successfully.
2 null

PL/SQL procedure successfully completed.

SQL> 
SQL> --test bind param in cond expr
SQL> declare
  2    a int := 1;
  3 begin
  4     a := :1 + 1;
  5     if (:1 > 2) then
  6          a := :1 + 2;
  7     end if;
  8  dbe_output.print_line('a = ' || a);
  9 end;
 10 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: The 2th param:
Direction : DataType : BindValue: The 3th param:
Direction : DataType : BindValue: Bind params successfully.
a = 9

PL/SQL procedure successfully completed.

SQL> 
SQL> --test bind param in select into clause
SQL> declare
  2    a int := 1;
  3 begin
  4     select 1 into a from dual;
  5     select 1 into :1 from dual;
  6 end;
  7 /

CT-00944, PL/SQL(SYS.ANONYMOUS BLOCK) terminated with compiling errors
[5:19] PLC-00922 PL/SQL: illegal line(into clause cannot use param decl until in dynamic sql)

SQL> --error
SQL> 
SQL> --test bind param in proc real param
SQL> create or replace procedure proc_tt(a int, b int) is
  2   p int := a;
  3   q int := b;
  4 begin
  5   dbe_output.print_line('p = ' || p);
  6   dbe_output.print_line('q = ' || q);
  7 end;
  8 /

Succeed.

SQL> 
SQL> declare
  2  a int := 1;
  3 begin
  4  proc_tt(:1, a+2);
  5 end;
  6 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
p = 7
q = 3

PL/SQL procedure successfully completed.

SQL> 
SQL> --test bind param in cursor clause
SQL> declare
  2    a sys_refcursor;
  3    b int := 1;
  4    c int;
  5 begin
  6    open a for select b from dual;
  7    open a for select b + :1 from dual;
  8    fetch a into c;
  9    dbe_output.print_line('c = ' || c);
 10 end;
 11 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
c = 8

PL/SQL procedure successfully completed.

SQL> 
SQL> declare
  2    a sys_refcursor;
  3    b int := 1;
  4    c int;
  5 begin
  6    open a for select b from dual;
  7    open a for select b + :1 from dual;
  8    dbe_sql.return_cursor(a);
  9 end;
 10 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
PL/SQL procedure successfully completed.

ResultSet #1

:1 +:2              
--------------------
8                   

1 rows fetched.


SQL> 
SQL> --test bind param in fetch into clause
SQL> declare
  2    a sys_refcursor;
  3    b int := 1;
  4    c int;
  5 begin
  6    open a for select b from dual;
  7    fetch a into :1;
  8    c := :1;
  9    dbe_output.print_line('c = ' || c);
 10 end;
 11 /

CT-00944, PL/SQL(SYS.ANONYMOUS BLOCK) terminated with compiling errors
[7:17] PLC-00922 PL/SQL: illegal line(into clause cannot use param decl until in dynamic sql)

SQL> --error
SQL> 
SQL> --test bind param in dynamic sql 
SQL> declare
  2    a int := 1;
  3 begin
  4 	 execute immediate 'delete from plsql_param_tr1';
  5    execute immediate 'insert into plsql_param_tr1 values(:1,:2)' using a, :1;
  6 end;
  7 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
PL/SQL procedure successfully completed.

SQL> 
SQL> select * from plsql_param_tr1;

F1           F2          
------------ ------------
1            7           

1 rows fetched.

SQL> 
SQL> declare
  2    a int := 1;
  3    p int;
  4 begin
  5 	execute immediate 'delete from plsql_param_tr1';
  6   execute immediate 'begin insert into plsql_param_tr1 values(:1,:2); end;' using a, :1;
  7   select f1 into p from plsql_param_tr1;
  8   dbe_output.print_line('p = ' || p);
  9 end;
 10 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
p = 1

PL/SQL procedure successfully completed.

SQL> 
SQL> create or replace procedure proc_pp(a out number, b in number) 
  2 is
  3 begin
  4 	dbe_output.print_line('test in');
  5 end;
  6 /

Succeed.

SQL> declare
  2   a int := 1;
  3 begin
  4    proc_pp(:1,a+2);
  5 end;
  6 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
CT-00932, [4:4] PL/SQL(SYS.ANONYMOUS BLOCK) terminated with execute errors
[4:4] CT-00949, The 1th argument of PROC_PP is out parameter and cannot be assigned to in parameter

SQL> 
SQL> create or replace procedure proc_pp(a out number, b in number) 
  2 is
  3 begin
  4 	a := 1.2;
  5 end;
  6 /

Succeed.

SQL> declare
  2   a int := 1;
  3 begin
  4   proc_pp(:1,a+2);
  5 end;
  6 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
PL/SQL procedure successfully completed.

SQL> 
SQL> create or replace procedure proc_pp(a out number, b in number) 
  2 is
  3 begin
  4 	a := 1.2 * b;
  5 end;
  6 /

Succeed.

SQL> declare
  2   a int := 1;
  3 begin
  4    proc_pp(:1,a);
  5 end;
  6 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
PL/SQL procedure successfully completed.

SQL> 
SQL> -- DTS2019062812368 start
SQL> BEGIN
  2 EXECUTE IMMEDIATE 'declare a int; b int; c int; BEGIN 
  3  a := :x; b := :y; c := :x;
  4 dbe_output.print_line(a);dbe_output.print_line(b);dbe_output.print_line(c);
  5 END;'
  6 USING 1,2;
  7 END;
  8 /

1
2
1

PL/SQL procedure successfully completed.

SQL> 
SQL> declare 
  2 a int; 
  3 b int; 
  4 c int; 
  5 BEGIN 
  6  a := :x; 
  7  b := :x;
  8  c := :y; 
  9 dbe_output.print_line(a);
 10 dbe_output.print_line(b);
 11 dbe_output.print_line(c);
 12 END;
 13 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: The 2th param:
Direction : DataType : BindValue: The 3th param:
Direction : DataType : BindValue: Bind params successfully.
1
1
3

PL/SQL procedure successfully completed.

SQL> 
SQL> declare 
  2 a int; 
  3 b int; 
  4 c int; 
  5 BEGIN 
  6  select :x into a from dual;
  7  select :x into b from dual;
  8  select :y into c from dual;
  9 dbe_output.print_line(a);
 10 dbe_output.print_line(b);
 11 dbe_output.print_line(c);
 12 END;
 13 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: The 2th param:
Direction : DataType : BindValue: The 3th param:
Direction : DataType : BindValue: Bind params successfully.
1
1
3

PL/SQL procedure successfully completed.

SQL> 
SQL> BEGIN
  2 EXECUTE IMMEDIATE 'declare 
  3 a int; 
  4 b int; 
  5 c int; 
  6 BEGIN 
  7  select :x into a from dual;
  8  select :x into b from dual;
  9  select :y into c from dual;
 10 dbe_output.print_line(a);
 11 dbe_output.print_line(b);
 12 dbe_output.print_line(c);
 13 END;'
 14 USING 1,2;
 15 END;
 16 /

1
1
2

PL/SQL procedure successfully completed.

SQL> -- DTS2019062812368 end
SQL> 
SQL> -- DTS2019092705246
SQL> declare
  2 b varchar(100) := 'abc';
  3 begin
  4   for lll in (select :1 as b from dual) loop
  5     b := lll.b;
  6   end loop;
  7   dbe_output.print_line(b);
  8 end;
  9 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
abcdefg

PL/SQL procedure successfully completed.

SQL> -- DTS2019092705246 end
SQL> 
SQL> drop table if exists t_table;

Succeed.

SQL> create table t_table(a clob default 'qq', b int);

Succeed.

SQL> insert into t_table(b) values(1);

1 rows affected.

SQL> insert into t_table(b) values(2);

1 rows affected.

SQL> commit;

Succeed.

SQL> select * from t_table order by b;

A                                                                B           
---------------------------------------------------------------- ------------
qq                                                               1           
qq                                                               2           

2 rows fetched.

SQL> DECLARE
  2   TYPE aaaa IS table of clob;
  3   target aaaa;
  4 BEGIN
  5 select ? bulk collect into target from t_table;
  6   dbe_output.print_line ('2: ' || target(1));
  7 END;
  8 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
2: ahhdfvbkbvfbviufhvhrohvhvhfhvsohvhs

PL/SQL procedure successfully completed.

SQL> drop table if exists t_table;

Succeed.

SQL> 
SQL> --DTS2020061105T5A7P0G00
SQL> declare
  2 cursor1 sys_refcursor;
  3 type  XX is record
  4 (
  5 Rec_1  int,
  6 Rec_2  bigint,
  7 Rec_3  number(10,2),
  8 Rec_4  decimal(10,2),
  9 Rec_5  float,
 10 Rec_6  double,
 11 Rec_7  real,
 12 Rec_8  char(10),
 13 Rec_9  varchar(100),
 14 Rec_10  varchar2(100),
 15 Rec_11  bool,
 16 Rec_12  boolean,
 17 Rec_13  date,
 18 Rec_14  timestamp,
 19 Rec_15  binary(10),
 20 Rec_16  varbinary(20),
 21 Rec_17  clob,
 22 Rec_18  blob,
 23 Rec_19  DATETIME, 
 24 Rec_20  NVARCHAR(100)
 25 );
 26 v_rec XX;
 27 begin
 28 v_rec.Rec_1     :=:p1    ;
 29 v_rec.Rec_2     :=:p2    ;
 30 v_rec.Rec_3     :=:p3    ;
 31 v_rec.Rec_4     :=:p4    ;
 32 v_rec.Rec_5     :=:p5    ;
 33 v_rec.Rec_6     :=:p6    ;
 34 v_rec.Rec_7     :=:p7    ;
 35 v_rec.Rec_8     :=:p8    ;
 36 v_rec.Rec_9     :=:p9    ;
 37 v_rec.Rec_10    :=:p10   ;
 38 v_rec.Rec_11    :=:p11   ;
 39 v_rec.Rec_12    :=:p12   ;
 40 v_rec.Rec_13    :=:p13   ;
 41 v_rec.Rec_14    :=:p14   ;
 42 v_rec.Rec_15    :=:p15   ;
 43 v_rec.Rec_16    :=:p16   ;
 44 v_rec.Rec_17    :=:p17   ;
 45 v_rec.Rec_18    :=:p18   ;
 46 v_rec.Rec_19    :=:p19   ;
 47 v_rec.Rec_20    :=:p20   ;
 48 open  cursor1 for select
 49 v_rec.Rec_1      ,
 50 v_rec.Rec_2      ,
 51 v_rec.Rec_3      ,
 52 v_rec.Rec_4      ,
 53 v_rec.Rec_5      ,
 54 v_rec.Rec_6      ,
 55 v_rec.Rec_7      ,
 56 v_rec.Rec_8      ,
 57 v_rec.Rec_9      ,
 58 v_rec.Rec_10     ,
 59 v_rec.Rec_11     ,
 60 v_rec.Rec_12     ,
 61 v_rec.Rec_13     ,
 62 v_rec.Rec_14     ,
 63 v_rec.Rec_15     ,
 64 v_rec.Rec_16     ,
 65 v_rec.Rec_17     ,
 66 v_rec.Rec_18     ,
 67 v_rec.Rec_19     ,
 68 v_rec.Rec_20
 69  from  sys_dummy   ;
 70 dbe_sql.return_cursor(cursor1);
 71 dbe_output.print_line(v_rec.Rec_1);
 72 dbe_output.print_line(v_rec.Rec_2 );
 73 dbe_output.print_line(v_rec.Rec_3 );
 74 dbe_output.print_line(v_rec.Rec_4 );
 75 dbe_output.print_line(v_rec.Rec_5 );
 76 dbe_output.print_line(v_rec.Rec_6 );
 77 dbe_output.print_line(v_rec.Rec_7 );
 78 dbe_output.print_line(v_rec.Rec_8 );
 79 dbe_output.print_line(v_rec.Rec_9 );
 80 dbe_output.print_line(v_rec.Rec_10);
 81 dbe_output.print_line(v_rec.Rec_11);
 82 dbe_output.print_line(v_rec.Rec_12);
 83 dbe_output.print_line(v_rec.Rec_13);
 84 dbe_output.print_line(v_rec.Rec_14);
 85 dbe_output.print_line(v_rec.Rec_15);
 86 dbe_output.print_line(v_rec.Rec_16);
 87 dbe_output.print_line(v_rec.Rec_17);
 88 dbe_output.print_line(v_rec.Rec_18);
 89 dbe_output.print_line(v_rec.Rec_19);
 90 dbe_output.print_line(v_rec.Rec_20);
 91 end;
 92 /

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: The 2th param:
Direction : DataType : BindValue: The 3th param:
Direction : DataType : BindValue: The 4th param:
Direction : DataType : BindValue: The 5th param:
Direction : DataType : BindValue: The 6th param:
Direction : DataType : BindValue: The 7th param:
Direction : DataType : BindValue: The 8th param:
Direction : DataType : BindValue: The 9th param:
Direction : DataType : BindValue: The 10th param:
Direction : DataType : BindValue: The 11th param:
Direction : DataType : BindValue: The 12th param:
Direction : DataType : BindValue: The 13th param:
Direction : DataType : BindValue: The 14th param:
Direction : DataType : BindValue: The 15th param:
Direction : DataType : BindValue: The 16th param:
Direction : DataType : BindValue: The 17th param:
Direction : DataType : BindValue: The 18th param:
Direction : DataType : BindValue: The 19th param:
Direction : DataType : BindValue: The 20th param:
Direction : DataType : BindValue: Bind params successfully.
1334
8301034833292722247
3.14
16777215.52
4.61512051684126
2.07944154167984
65.8201500331442
gsdb1234
123456,7this is a test str
414243likeFF
TRUE
FALSE
2019-07-02 12:04:21
2019-06-10 00:00:00.000000
C8
AAAB0181fG
clobtest%QWERASGSDTRERE
30313233343536373839616263646566682332333132232524234024
2018-06-28 13:14:15
ABFDSF#$@

PL/SQL procedure successfully completed.

ResultSet #1

:1           :2                   :3                                       :4                                       :5                   :6                   :7                   :8         :9                         :10          :11    :12    :13                    :14                              :15                                                              :16                                                              :17                     :18                                                              :19                    :20      
------------ -------------------- ---------------------------------------- ---------------------------------------- -------------------- -------------------- -------------------- ---------- -------------------------- ------------ ------ ------ ---------------------- -------------------------------- ---------------------------------------------------------------- ---------------------------------------------------------------- ----------------------- ---------------------------------------------------------------- ---------------------- ---------
1334         8301034833292722247  3.14                                     16777215.52                              4.61512051684126     2.07944154167984     65.8201500331442     gsdb1234 123456,7this is a test str 414243likeFF TRUE   FALSE  2019-07-02 12:04:21    2019-06-10 00:00:00.000000       C8                                                               AAAB0181fG                                                       clobtest%QWERASGSDTRERE 30313233343536373839616263646566682332333132232524234024         2018-06-28 13:14:15    ABFDSF#$@

1 rows fetched.


SQL> DROP TABLE IF EXISTS T_TRIG_1;

Succeed.

SQL> DROP TABLE IF EXISTS T_TRIG_2;

Succeed.

SQL> CREATE TABLE T_TRIG_1 (F_INT1 INT, F_INT2 INT, F_CHAR1 CHAR(16), F_DATE DATE);

Succeed.

SQL> CREATE TABLE T_TRIG_2 (F_INT1 INT, F_INT2 INT, F_CHAR1 CHAR(16), F_DATE DATE);

Succeed.

SQL> 
SQL> INSERT INTO T_TRIG_1 VALUES(1,2,'A','2017-12-11 14:08:00');

1 rows affected.

SQL> INSERT INTO T_TRIG_1 VALUES(3,4,'C','2017-12-12 16:08:00');

1 rows affected.

SQL> INSERT INTO T_TRIG_1 VALUES(1,3,'A','2017-12-11 14:18:00');

1 rows affected.

SQL> INSERT INTO T_TRIG_1 VALUES(2,3,'B','2017-12-11 16:08:00');

1 rows affected.

SQL> commit;

Succeed.

SQL> 
SQL> 
SQL> CREATE OR REPLACE TRIGGER TRIG_BEFORE_EACH_ROW BEFORE INSERT OR UPDATE OF F_INT1 OR DELETE ON T_TRIG_1
  2 FOR EACH ROW
  3 BEGIN
  4   INSERT INTO T_TRIG_2 VALUES(:OLD.F_INT2, :NEW.f_int1, :OLD."F_CHAR1", :NEW.`F_DATE`);
  5   INSERT INTO T_TRIG_2 select :NEW.f_int2, :NEW.f_int1, :NEW."F_CHAR1", :NEW.`F_DATE` from sys_dummy 
  6   where not exists(select 1 from T_TRIG_1 where T_TRIG_1.f_int1 = :NEW.F_INT1);
  7 END;
  8 /

Succeed.

SQL> 
SQL> CREATE OR REPLACE TRIGGER TRIG_BEFORE_EACH_ROW_UPDATE BEFORE UPDATE OF F_INT2 OR DELETE ON T_TRIG_1
  2 FOR EACH ROW
  3 BEGIN
  4   UPDATE T_TRIG_2 SET F_CHAR1= 'B'
  5   where not exists(select 1 from T_TRIG_1 where T_TRIG_1.F_CHAR1 = :NEW.F_CHAR1);
  6 END;
  7 /

Succeed.

SQL> 
SQL> analyze table T_TRIG_1 compute statistics;

Succeed.

SQL> 
SQL> INSERT INTO T_TRIG_1 VALUES(2,:p1,'C','2017-12-11 16:08:00');

+-------------------------------------------------+
|                CTSQL Bind Param                  |
+-------------------------------------------------+
The 1th param:
Direction : DataType : BindValue: Bind params successfully.
1 rows affected.

SQL> 
SQL> spool off
