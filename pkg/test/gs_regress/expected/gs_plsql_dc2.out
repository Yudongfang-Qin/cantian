

SQL> CONN / AS SYSDBA

connected.

SQL> DROP USER IF EXISTS PL_DC2 CASCADE;

Succeed.

SQL> CREATE USER PL_DC2 IDENTIFIED BY Cantian_123456;

Succeed.

SQL> GRANT DBA TO PL_DC2;

Succeed.

SQL> GRANT EXECUTE ON DBE_DIAGNOSE TO PL_DC2;

Succeed.

SQL> conn PL_DC2/Cantian_123456@127.0.0.1:1611

connected.

SQL> 
SQL> --一、基本查找
SQL> --1.递归
SQL> CREATE OR REPLACE FUNCTION F1(C1 INT) RETURN INT IS
  2 BEGIN
  3  IF C1 > 0 THEN
  4   RETURN PL_DC2.F1(C1 - 1) * C1;
  5  ELSE
  6   RETURN 1;
  7  END IF;
  8 END;
  9 /

Succeed.

SQL> SELECT F1(5);

F1(5)       
------------
120         

1 rows fetched.

SQL> SELECT F1(5,10);--找到但出错

CT-00916, [1:8]PL/SQL:syntax error(unexpected more arguments for current procedure/function)
SQL> CALL F1(5);--找到但出错

CT-00944, PL/SQL(PL_DC2.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00828 procedure PL_DC2.F1 does not exist

SQL> 
SQL> CREATE OR REPLACE FUNCTION PL_DC2.F1_2(C1 INT) RETURN INT IS
  2 BEGIN
  3  IF C1 > 0 THEN
  4   RETURN PL_DC2.F1_2(C1 - 1) + C1;
  5  ELSE
  6   RETURN 0;
  7  END IF;
  8 END;
  9 /

Succeed.

SQL> SELECT F1_2(5);

F1_2(5)     
------------
15          

1 rows fetched.

SQL> SELECT F1_2(5,9);--找到但出错

CT-00916, [1:8]PL/SQL:syntax error(unexpected more arguments for current procedure/function)
SQL> 
SQL> CREATE TABLE T1(C1 INT);

Succeed.

SQL> CREATE OR REPLACE PROCEDURE P1(C1 INT) IS
  2 BEGIN
  3  IF C1 > 0 THEN
  4   INSERT INTO T1 VALUES(C1);
  5   PL_DC2.P1(C1 - 1);
  6  ELSE
  7   INSERT INTO T1 VALUES(0);
  8  END IF;
  9  COMMIT;
 10 END;
 11 /

Succeed.

SQL> 
SQL> CREATE OR REPLACE PROCEDURE PL_DC2.P1_2(C1 INT) IS
  2 BEGIN
  3  IF C1 > 0 THEN
  4   INSERT INTO T1 VALUES(C1);
  5   PL_DC2.P1_2(C1 - 1);
  6  ELSE
  7   INSERT INTO T1 VALUES(0);
  8  END IF;
  9  COMMIT;
 10 END;
 11 /

Succeed.

SQL> CALL P1(1);

PL/SQL procedure successfully completed.

SQL> SELECT MAX(C1) FROM T1 ORDER BY C1;

MAX(C1)     
------------
1           

1 rows fetched.

SQL> CALL PL_DC2.P1_2(2);

PL/SQL procedure successfully completed.

SQL> CALL PL_DC2.P1_2('5th4');--找到但出错

CT-00932, [1:2] PL/SQL(PL_DC2.ANONYMOUS BLOCK) terminated with execute errors
[1:14] CT-00636, Invalid number -- unexpected character

SQL> SELECT MAX(C1) FROM T1 ORDER BY C1;

MAX(C1)     
------------
2           

1 rows fetched.

SQL> 
SQL> CREATE OR REPLACE SYNONYM L_SYN_F1 FOR PL_DC2.F1;

Succeed.

SQL> CREATE OR REPLACE SYNONYM L_SYN_F1_2 FOR PL_DC2.F1_2;

Succeed.

SQL> CREATE OR REPLACE PUBLIC SYNONYM P_SYN_F1 FOR PL_DC2.F1;

Succeed.

SQL> CREATE OR REPLACE PUBLIC SYNONYM P_SYN_F1_2 FOR PL_DC2.F1_2;

Succeed.

SQL> SELECT L_SYN_F1(3);

L_SYN_F1(3) 
------------
6           

1 rows fetched.

SQL> SELECT L_SYN_F1_2(3);

L_SYN_F1_2(3)
-------------
6            

1 rows fetched.

SQL> SELECT P_SYN_F1(3);

P_SYN_F1(3) 
------------
6           

1 rows fetched.

SQL> SELECT P_SYN_F1_2(3);

P_SYN_F1_2(3)
-------------
6            

1 rows fetched.

SQL> 
SQL> CREATE OR REPLACE SYNONYM L_SYN_P1 FOR PL_DC2.P1;

Succeed.

SQL> CREATE OR REPLACE SYNONYM L_SYN_P1_2 FOR PL_DC2.P1_2;

Succeed.

SQL> CREATE OR REPLACE PUBLIC SYNONYM P_SYN_P1 FOR PL_DC2.P1;

Succeed.

SQL> CREATE OR REPLACE PUBLIC SYNONYM P_SYN_P1_2 FOR PL_DC2.P1_2;

Succeed.

SQL> CALL L_SYN_P1(3);

PL/SQL procedure successfully completed.

SQL> SELECT MAX(C1) FROM T1 ORDER BY C1;

MAX(C1)     
------------
3           

1 rows fetched.

SQL> CALL L_SYN_P1_2(4);

PL/SQL procedure successfully completed.

SQL> SELECT MAX(C1) FROM T1 ORDER BY C1;

MAX(C1)     
------------
4           

1 rows fetched.

SQL> CALL P_SYN_P1(5);

PL/SQL procedure successfully completed.

SQL> SELECT MAX(C1) FROM T1 ORDER BY C1;

MAX(C1)     
------------
5           

1 rows fetched.

SQL> CALL P_SYN_P1_2(6);

PL/SQL procedure successfully completed.

SQL> SELECT MAX(C1) FROM T1 ORDER BY C1;

MAX(C1)     
------------
6           

1 rows fetched.

SQL> 
SQL> 
SQL> --2. 内置高级包或者用户自定义包
SQL> CREATE OR REPLACE PACKAGE PKG1 IS
  2  FUNCTION F1(C1 INT, C2 INT) RETURN INT;
  3  FUNCTION F2(C1 INT, C2 INT) RETURN INT;
  4 END;
  5 /

Succeed.

SQL> 
SQL> CREATE OR REPLACE PACKAGE BODY PKG1 IS
  2  FUNCTION F1(C1 INT, C2 INT) RETURN INT IS
  3  BEGIN
  4   RETURN C1 + C2;
  5  END;
  6  FUNCTION F2(C1 INT, C2 INT) RETURN INT IS
  7  BEGIN
  8   RETURN C1 * C2;
  9  END;
 10 END;
 11 /

Succeed.

SQL> 
SQL> SELECT PKG1.F1(1,2);

PKG1.F1(1,2)
------------
3           

1 rows fetched.

SQL> SELECT PKG1.F3(1,2);--找到但出错

CT-00828, [1:8]function PKG1.F3 does not exist
SQL> SELECT DBE_DIAGNOSE.DBA_USER_NAME(0);

DBE_DIAGNOSE.DBA_USER_NAME(0)                                   
----------------------------------------------------------------
SYS                                                             

1 rows fetched.

SQL> SELECT DBE_DIAGNOSE.DBA_USER_NAME(0,'34534sddf');--找到但出错

CT-00615, [1:8]Invalid argument number for DBA_USER_NAME, min=1, max=1
SQL> 
SQL> CREATE OR REPLACE SYNONYM L_SYN_PKG1 FOR PKG1;

Succeed.

SQL> CREATE OR REPLACE PUBLIC SYNONYM P_SYN_PKG1 FOR PKG1;

Succeed.

SQL> CREATE OR REPLACE SYNONYM L_SYN_DIAGNOSE FOR SYS.DBE_DIAGNOSE;

Succeed.

SQL> CREATE OR REPLACE PUBLIC SYNONYM P_SYN_DIAGNOSE FOR SYS.DBE_DIAGNOSE;

Succeed.

SQL> 
SQL> SELECT L_SYN_PKG1.F1(1,2);

L_SYN_PKG1.F1(1,2)
------------------
3                 

1 rows fetched.

SQL> SELECT P_SYN_PKG1.F2(1,2);

P_SYN_PKG1.F2(1,2)
------------------
2                 

1 rows fetched.

SQL> SELECT L_SYN_DIAGNOSE.DBA_USER_NAME(0);

L_SYN_DIAGNOSE.DBA_USER_NAME(0)                                 
----------------------------------------------------------------
SYS                                                             

1 rows fetched.

SQL> SELECT P_SYN_DIAGNOSE.DBA_USER_NAME(0);

P_SYN_DIAGNOSE.DBA_USER_NAME(0)                                 
----------------------------------------------------------------
SYS                                                             

1 rows fetched.

SQL> 
SQL> --3.USER.NAME
SQL> CREATE OR REPLACE FUNCTION PL_DC2.F3(C1 INT) RETURN INT IS
  2 BEGIN
  3  RETURN C1 * 10;
  4 END;
  5 /

Succeed.

SQL> 
SQL> SELECT PL_DC2.F3(1);

PL_DC2.F3(1)
------------
10          

1 rows fetched.

SQL> SELECT PL_DC2.F3('43r43rrr');--找到但出错

CT-00636, [1:18]Invalid number -- unexpected character
SQL> 
SQL> CREATE OR REPLACE SYNONYM L_SYN_F3 FOR PL_DC2.F3;

Succeed.

SQL> CREATE OR REPLACE PUBLIC SYNONYM P_SYN_F3 FOR PL_DC2.F3;

Succeed.

SQL> CREATE OR REPLACE SYNONYM L_SYN_F4 FOR PL_DC1.F1;

CT-00781, The user PL_DC1 does not exist.
SQL> CREATE OR REPLACE PUBLIC SYNONYM P_SYN_F4 FOR PL_DC1.F1;

CT-00781, The user PL_DC1 does not exist.
SQL> SELECT L_SYN_F3(10);

L_SYN_F3(10)
------------
100         

1 rows fetched.

SQL> SELECT P_SYN_F3(11);

P_SYN_F3(11)
------------
110         

1 rows fetched.

SQL> SELECT L_SYN_F4(10);

CT-00828, [1:8]function PL_DC2.L_SYN_F4 does not exist
SQL> SELECT P_SYN_F4(11);

CT-00828, [1:8]function PL_DC2.P_SYN_F4 does not exist
SQL> 
SQL> --4.AS PUBLIC OBJECT
SQL> CREATE OR REPLACE PACKAGE "PUBLIC".PKG4 IS
  2  FUNCTION F1(C1 INT, C2 INT) RETURN INT;
  3 END;
  4 /

Succeed.

SQL> CREATE OR REPLACE PACKAGE BODY "PUBLIC".PKG4 IS
  2  FUNCTION F1(C1 INT, C2 INT) RETURN INT IS
  3  BEGIN
  4   RETURN C1 * C2;
  5  END;
  6 END;
  7 /

Succeed.

SQL> SELECT PKG4.F1(11,23);

PKG4.F1(11,23)
--------------
253           

1 rows fetched.

SQL> SELECT PKG4.F2(11,23);--找到但出错

CT-00828, [1:8]function PKG4.F2 does not exist
SQL> 
SQL> CREATE OR REPLACE SYNONYM L_SYN_PKG4 FOR "PUBLIC".PKG4;

Succeed.

SQL> CREATE OR REPLACE PUBLIC SYNONYM P_SYN_PKG4 FOR "PUBLIC".PKG4;

Succeed.

SQL> SELECT L_SYN_PKG4.F1(11,23);

L_SYN_PKG4.F1(11,23)
--------------------
253                 

1 rows fetched.

SQL> SELECT P_SYN_PKG4.F1(11,23);

P_SYN_PKG4.F1(11,23)
--------------------
253                 

1 rows fetched.

SQL> 
SQL> --6.RETURN ERROR package user.name1 not exist
SQL> SELECT PL_DC4.F1(1);

CT-00828, [1:8]function PL_DC4.F1 does not exist
SQL> CALL PL_DC4.P1(1);

CT-00944, PL/SQL(PL_DC2.ANONYMOUS BLOCK) terminated with compiling errors
[1:2] PLC-00828 procedure PL_DC4.P1 does not exist

SQL> 
SQL> --二、优先级测试
SQL> --递归
SQL> --用户自定义包
SQL> --系统包
SQL> --user.name
SQL> --public的包
SQL> 
SQL> --递归>自定义包
SQL> CREATE OR REPLACE PACKAGE PKG1 IS
  2  FUNCTION F1(C1 INT) RETURN INT;
  3 END;
  4 /

Succeed.

SQL> 
SQL> CREATE OR REPLACE PACKAGE BODY PKG1 IS
  2  FUNCTION F1(C1 INT) RETURN INT IS
  3  BEGIN
  4   RETURN C1 * 100 + 11;
  5  END;
  6 END;
  7 /

Succeed.

SQL> SELECT PKG1.F1(1);

PKG1.F1(1)  
------------
111         

1 rows fetched.

SQL> 
SQL> DROP USER IF EXISTS PKG1;

Succeed.

SQL> CREATE USER PKG1 IDENTIFIED BY Cantian_123456;

Succeed.

SQL> GRANT DBA TO PKG1;

Succeed.

SQL> CREATE OR REPLACE FUNCTION PKG1.F1(C1 INT) RETURN INT IS
  2 BEGIN
  3  IF C1 > 0 THEN
  4   RETURN PKG1.F1(C1 - 1) + C1;
  5  ELSE
  6   RETURN 0;
  7  END IF;
  8 END;
  9 /

Succeed.

SQL> 
SQL> CONN PKG1/Cantian_123456@127.0.0.1:1611

connected.

SQL> SELECT PKG1.F1(10);

PKG1.F1(10) 
------------
55          

1 rows fetched.

SQL> 
SQL> CONN PL_DC2/Cantian_123456@127.0.0.1:1611

connected.

SQL> --用户自定义包>系统包
SQL> CREATE OR REPLACE PACKAGE DBE_DIAGNOSE IS
  2  FUNCTION DBA_USER_NAME(C1 INT) RETURN INT;
  3 END;
  4 /

Succeed.

SQL> 
SQL> CREATE OR REPLACE PACKAGE BODY DBE_DIAGNOSE IS
  2  FUNCTION DBA_USER_NAME(C1 INT) RETURN INT IS
  3  BEGIN
  4   RETURN C1 * 10 + 1;
  5  END;
  6 END;
  7 /

Succeed.

SQL> SELECT DBE_DIAGNOSE.DBA_USER_NAME(1);

DBE_DIAGNOSE.DBA_USER_NAME(1)
-----------------------------
11                           

1 rows fetched.

SQL> 
SQL> DROP PACKAGE DBE_DIAGNOSE;

Succeed.

SQL> SELECT DBE_DIAGNOSE.DBA_USER_NAME(1);

DBE_DIAGNOSE.DBA_USER_NAME(1)                                   
----------------------------------------------------------------
PUBLIC                                                          

1 rows fetched.

SQL> 
SQL> --系统包>USER.NAME
SQL> DROP USER IF EXISTS DBE_DIAGNOSE CASCADE;

Succeed.

SQL> CREATE USER DBE_DIAGNOSE IDENTIFIED BY Cantian_123456;

Succeed.

SQL> CREATE OR REPLACE FUNCTION DBE_DIAGNOSE.DBA_USER_NAME(C1 INT) RETURN INT IS
  2 BEGIN
  3  RETURN C1 * 10 + 2;
  4 END;
  5 /

Succeed.

SQL> SELECT DBE_DIAGNOSE.DBA_USER_NAME(1);

DBE_DIAGNOSE.DBA_USER_NAME(1)                                   
----------------------------------------------------------------
PUBLIC                                                          

1 rows fetched.

SQL> DROP USER IF EXISTS DBE_DIAGNOSE CASCADE;

Succeed.

SQL> 
SQL> --USER.NAME>PUBLIC OBJECT
SQL> DROP USER IF EXISTS PKG8 CASCADE;

Succeed.

SQL> CREATE USER PKG8 IDENTIFIED BY Cantian_123456;

Succeed.

SQL> CREATE OR REPLACE FUNCTION PKG8.F1(C1 INT) RETURN INT IS
  2 BEGIN
  3  RETURN C1 * 10 + 8;
  4 END;
  5 /

Succeed.

SQL> 
SQL> CREATE OR REPLACE PACKAGE "PUBLIC".PKG8 IS
  2  FUNCTION F1(C1 INT) RETURN INT;
  3 END;
  4 /

Succeed.

SQL> 
SQL> CREATE OR REPLACE PACKAGE BODY "PUBLIC".PKG8 IS
  2  FUNCTION F1(C1 INT) RETURN INT IS
  3  BEGIN
  4   RETURN C1 + 9;
  5  END;
  6 END;
  7 /

Succeed.

SQL> 
SQL> SELECT PKG8.F1(1);

PKG8.F1(1)  
------------
18          

1 rows fetched.

SQL> DROP FUNCTION PKG8.F1;

Succeed.

SQL> SELECT PKG8.F1(1);

PKG8.F1(1)  
------------
10          

1 rows fetched.

SQL> 
SQL> --报错 package current.name1 does not exist
SQL> SELECT PKG9.F1(1);

CT-00828, [1:8]function PKG9.F1 does not exist
SQL> 
SQL> CONN / AS SYSDBA

connected.

SQL> DROP USER IF EXISTS PL_DC2 CASCADE;

Succeed.

SQL> DROP USER IF EXISTS PKG1 CASCADE;
Succeed.




