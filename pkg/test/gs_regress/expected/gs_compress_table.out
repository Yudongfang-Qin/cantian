

SQL> --test case1:create compress table on normal/encrypt tablespace
SQL> 
SQL> --expect:CT-00130, Operation create compress table is not supported on encrypt tablespace
SQL> create tablespace ct_encrypt_space datafile 'encrypt_space' size 500M compress encryption extent autoallocate;

CT-00130, Operation create compress datafile is not supported on encrypt tablespace
SQL> 
SQL> --expect:CT-00130, Operation create compress table is not supported on normal tablespace
SQL> create tablespace ct_normal_space datafile 'ct_ns_normal_file' size 128M compress autoextend on next 32M;

CT-00130, Operation create compress datafile is not supported on normal tablespace
SQL> create tablespace ct_normal_space datafile 'ct_ns_normal_file' size 128M autoextend on next 32M;

Succeed.

SQL> create user ct_normal_user identified by Cantian_234 default tablespace ct_normal_space;

Succeed.

SQL> grant dba to ct_normal_user;

Succeed.

SQL> 
SQL> --expect:CT-00130, Operation create compress table is not supported on normal tablespace
SQL> drop table if exists ct_normal_user.ct_normal_table;

Succeed.

SQL> create table ct_normal_user.ct_normal_table(i int) compress;

CT-00130, Operation create compress table is not supported on non heap table and non user bitmap tablespace
SQL> drop user ct_normal_user cascade;

Succeed.

SQL> drop tablespace ct_normal_space including contents and datafiles;

Succeed.

SQL> 
SQL> --test case2:base function test
SQL> 
SQL> create tablespace ct_compress_space datafile 'ct_cs_compress_file' size 128M compress autoextend on next 32M extent autoallocate;

Succeed.

SQL> alter tablespace ct_compress_space add datafile 'ct_cs_normal_file' size 128M autoextend on next 32M;

Succeed.

SQL> create user ct_compress_user identified by Cantian_234 default tablespace ct_compress_space;

Succeed.

SQL> grant dba to ct_compress_user;

Succeed.

SQL> 
SQL> --DTS202104160HFHQAP1300:interval part inherit table's compression mode
SQL> drop table if exists ct_compress_user.compress_part_inter_001;

Succeed.

SQL> create table ct_compress_user.compress_part_inter_001(num int,c_id int) compress PARTITION BY RANGE(C_ID) interval(100)
  2 (PARTITION P1 VALUES LESS THAN(201),
  3 PARTITION P2 VALUES LESS THAN(401),
  4 PARTITION P3 VALUES LESS THAN(601),
  5 PARTITION P4 VALUES LESS THAN(701)) TABLESPACE ct_compress_space;

Succeed.

SQL> insert into ct_compress_user.compress_part_inter_001 values(1,800);

1 rows affected.

SQL> select count(*) from adm_tab_partitions where table_name=upper('compress_part_inter_001') and compress_algo='ZSTD';

COUNT(*)            
--------------------
5                   

1 rows fetched.

SQL> 
SQL> --loop insert test
SQL> drop table if exists ct_compress_user.ct_compress_table1;

Succeed.

SQL> create table ct_compress_user.ct_compress_table1
  2 (
  3 sm_ID INTEGER,
  4 OrgAddr VARCHAR(21),
  5 DestAddr VARCHAR(21),
  6 ScAddr VARCHAR(21),
  7 MTMscAddr VARCHAR(21),
  8 esm_class char(1),
  9 PRI char(1),
 10 MMS char(1),
 11 RP char(1),
 12 UDHI char(1),
 13 SRR char(1),
 14 PID char(1),
 15 DCS char(1),
 16 TimeStamp VARCHAR(20),
 17 UDL NUMBER(4,0),
 18 ServiceType VARCHAR(6),
 19 STATUSREPORT CHAR(1),
 20 SubmitTime CHAR(20),
 21 ucSMStatus CHAR(1),
 22 MOMscAddrType CHAR(1),
 23 MOMscAddr CHAR(21),
 24 MOMscTON CHAR(1),
 25 MOMscNPI CHAR(1),
 26 MTMscAddrType CHAR(1),
 27 MTMscTON CHAR(1),
 28 MTMscNPI CHAR(1),
 29 OrgTON CHAR(1),
 30 OrgNPI CHAR(1),
 31 DestTON CHAR(1),
 32 DestNPI CHAR(1),
 33 MR CHAR(1),
 34 RN CHAR(2),
 35 MN CHAR(1),
 36 SN CHAR(1),
 37 ErrCode CHAR(1),
 38 OrigShortNum VARCHAR(20),
 39 DestShortNum VARCHAR(20),
 40 SMLogType CHAR(1),
 41 OrgAccount VARCHAR(21),
 42 DestAccount VARCHAR(21)
 43 ) partition by range(sm_ID) 
 44 (
 45 partition p1 VALUES LESS THAN (2000) format csf compress,
 46 partition p2 VALUES LESS THAN (3000) format csf compress,
 47 partition p3 VALUES LESS THAN (4000),
 48 partition p4 VALUES LESS THAN (10000) format csf compress
 49 );

Succeed.

SQL> 
SQL> --expect:CT-00601, [1:104]Sql syntax error: unexpected text compress
SQL> create index ct_compress_user.ORGADDRs_INDEXS on ct_compress_user.ct_compress_table1 (OrgAddr,DestAddr) compress;

CT-00601, [1:105]Sql syntax error: unexpected text compress
SQL> create index ct_compress_user.DESTADDRs_INDEXS on ct_compress_user.ct_compress_table1 (DestAddr) compress;

CT-00601, [1:98]Sql syntax error: unexpected text compress
SQL> 
SQL> create index ct_compress_user.ORGADDRs_INDEXS on ct_compress_user.ct_compress_table1 (OrgAddr,DestAddr);

Succeed.

SQL> create index ct_compress_user.DESTADDRs_INDEXS on ct_compress_user.ct_compress_table1 (DestAddr);

Succeed.

SQL> 
SQL> DECLARE
  2 BEGIN
  3     FOR I IN 1..10000 LOOP
  4     insert into ct_compress_user.ct_compress_table1(sm_ID,OrgAddr,DestAddr,ScAddr,MTMscAddr,esm_class,PRI,MMS,RP,UDHI,SRR,PID,DCS,TimeStamp,UDL,ServiceType,STATUSREPORT,SubmitTime,ucSMStatus,MOMscAddrType,MOMscAddr,MOMscTON,MOMscNPI,MTMscAddrType,MTMscTON,MTMscNPI,OrgTON,OrgNPI,DestTON,DestNPI,MR,RN,MN,SN,ErrCode,OrigShortNum,DestShortNum,SMLogType,OrgAccount,DestAccount)
  5        values(round(DBE_RANDOM.GET_VALUE(1000,9999)),round(DBE_RANDOM.GET_VALUE(1000000000000000000, 9000000000000000000)),round(DBE_RANDOM.GET_VALUE(1000000000000000000, 9000000000000000000)),round(DBE_RANDOM.GET_VALUE(1000000000000000000, 9000000000000000000)),round(DBE_RANDOM.GET_VALUE(1000000000000000000, 9000000000000000000)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(19999999999999999999, 99999999999999999999)),round(DBE_RANDOM.GET_VALUE(1000, 9999)),round(DBE_RANDOM.GET_VALUE(100000, 999999)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1999999999999999999, 9999999999999999999)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(19999999999999999999, 99999999999999999999)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(2, 99)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1000000000000000000, 9000000000000000000)),round(DBE_RANDOM.GET_VALUE(1000000000000000000, 9000000000000000000)),round(DBE_RANDOM.GET_VALUE(1, 9)),round(DBE_RANDOM.GET_VALUE(1000000000000000000, 9000000000000000000)),round(DBE_RANDOM.GET_VALUE(1000000000000000000, 9000000000000000000)));
  6     END LOOP;
  7 END;
  8 /

PL/SQL procedure successfully completed.

SQL> commit;

Succeed.

SQL> alter system checkpoint;

Succeed.

SQL> select count(*) from ct_compress_user.ct_compress_table1;

COUNT(*)            
--------------------
10000               

1 rows fetched.

SQL> 
SQL> --test case3:
SQL> 
SQL> --single part compress test
SQL> drop table if exists ct_compress_user.ct_compress_table2;

Succeed.

SQL> create table ct_compress_user.ct_compress_table2(id int, name varchar2(100)) PARTITION BY list(id)
  2 (
  3 partition p11 values (1),
  4 partition p21 values (2),
  5 partition p31 values (3) format csf compress
  6 );

Succeed.

SQL> select count(*) from adm_tab_partitions where table_name=upper('ct_compress_table2') and compress_algo='ZSTD';

COUNT(*)            
--------------------
1                   

1 rows fetched.

SQL> --split part test
SQL> --coalesce part test
SQL> --part inherit table's compression mode
SQL> drop table if exists ct_compress_user.ct_compress_table3;

Succeed.

SQL> create table ct_compress_user.ct_compress_table3(id int, name varchar2(100)) PARTITION BY list(id)
  2 (
  3 partition p11 values (1),
  4 partition p21 values (2),
  5 partition p31 values (3) 
  6 ) format csf compress;

Succeed.

SQL> select count(*) from adm_tab_partitions where table_name=upper('ct_compress_table3') and compress_algo='ZSTD';

COUNT(*)            
--------------------
3                   

1 rows fetched.

SQL> 
SQL> --test case4: sql syntax test
SQL> 
SQL> --expect:CT-00601, [13:3]Sql syntax error: unexpected text compress, table doesn't support compress if exists subpartitons
SQL> drop table if exists ct_compress_user.ct_compress_table4;

Succeed.

SQL> create table ct_compress_user.ct_compress_table4(id int, c_id int, name varchar(20)) partition by range(id) subpartition by range(c_id)
  2 (
  3 partition p1 values less than(50)
  4 (
  5 subpartition p11 values less than(50),
  6 subpartition p12 values less than(100)
  7 ),
  8 partition p2 values less than(100)
  9 (
 10 subpartition p21 values less than(50),
 11 subpartition p22 values less than(100)
 12 )
 13 ) compress;

CT-00130, Operation create compress table is not supported on subpart table
SQL> select count(*) from adm_tab_partitions where table_name=upper('ct_compress_table4') and compress_algo='ZSTD';

COUNT(*)            
--------------------
0                   

1 rows fetched.

SQL> 
SQL> --expect:CT-00601, [13:3]Sql syntax error: unexpected text compress, table part doesn't support compress if exists subpartitons
SQL> drop table if exists ct_compress_user.ct_compress_table5;

Succeed.

SQL> create table ct_compress_user.ct_compress_table5(id int, c_id int, name varchar(20)) partition by range(id) subpartition by range(c_id)
  2 (
  3 partition p1 values less than(50) compress
  4 (
  5 subpartition p11 values less than(50),
  6 subpartition p12 values less than(100)
  7 ),
  8 partition p2 values less than(100)
  9 (
 10 subpartition p21 values less than(50),
 11 subpartition p22 values less than(100)
 12 )
 13 );

CT-00601, [3:35]Sql syntax error: unexpected text compress, table part doesn't support compress if exists subpartitons
SQL> select count(*) from adm_tab_partitions where table_name=upper('ct_compress_table5') and compress_algo='ZSTD';

COUNT(*)            
--------------------
0                   

1 rows fetched.

SQL> 
SQL> --add part test
SQL> drop table if exists ct_compress_user.ct_compress_table6;

Succeed.

SQL> create table ct_compress_user.ct_compress_table6(id int, name varchar2(100)) PARTITION BY list(id) 
  2 (
  3 partition p1 values (1) format csf compress,
  4 partition p2 values (2),
  5 partition p3 values (3) format csf compress
  6 );

Succeed.

SQL> alter table ct_compress_user.ct_compress_table6 add partition p6 values(4) format csf compress;

Succeed.

SQL> alter table ct_compress_user.ct_compress_table6 add partition p7 values(5);

Succeed.

SQL> select count(*) from adm_tab_partitions where table_name=upper('ct_compress_table6') and compress_algo='ZSTD';

COUNT(*)            
--------------------
3                   

1 rows fetched.

SQL> 
SQL> --split part test
SQL> drop table if exists ct_compress_user.ct_compress_table7;

Succeed.

SQL> create table ct_compress_user.ct_compress_table7(id int,c_number number)partition by range(c_number)(partition part_1 values less than(40), partition part_2 values less than(100) compress);

Succeed.

SQL> alter table ct_compress_user.ct_compress_table7 split partition part_2 at (70) into (partition part_2_1 compress, partition part_2_2);

Succeed.

SQL> alter table ct_compress_user.ct_compress_table7 split partition part_1 at (20) into (partition part_1_1 compress, partition part_1_2);

Succeed.

SQL> select count(*) from adm_tab_partitions where table_name=upper('ct_compress_table7') and compress_algo='ZSTD';

COUNT(*)            
--------------------
2                   

1 rows fetched.

SQL> 
SQL> -- set compress of hash part which implicit created
SQL> drop table if exists ct_compress_user.ct_compress_table8;

Succeed.

SQL> create table ct_compress_user.ct_compress_table8(id int) partition by hash(id)partitions 8 compress;

Succeed.

SQL> select count(*) from adm_tab_partitions where table_name=upper('ct_compress_table8') and compress_algo='ZSTD';

COUNT(*)            
--------------------
8                   

1 rows fetched.

SQL> 
SQL> -- don't support compress if exits subpartitions
SQL> drop table if exists ct_compress_user.ct_compress_table9;

Succeed.

SQL> create table ct_compress_user.ct_compress_table9(id int, c_id int, name varchar(20)) partition by range(id) subpartition by range(c_id)
  2 (
  3 partition p1 values less than(50) compress
  4 (
  5 subpartition p11 values less than(50),
  6 subpartition p12 values less than(100)
  7 ));

CT-00601, [3:35]Sql syntax error: unexpected text compress, table part doesn't support compress if exists subpartitons
SQL> drop table if exists ct_compress_user.ct_compress_table9;

Succeed.

SQL> create table ct_compress_user.ct_compress_table9(id int, c_id int, name varchar(20)) partition by range(id) subpartition by range(c_id)
  2 (
  3 partition p1 values less than(50)
  4 (
  5 subpartition p11 values less than(50),
  6 subpartition p12 values less than(100)
  7 )) compress;

CT-00130, Operation create compress table is not supported on subpart table
SQL> drop table if exists ct_compress_user.ct_compress_table9;

Succeed.

SQL> create table ct_compress_user.ct_compress_table9(id int) PARTITION BY RANGE(ID) INTERVAL(50) SUBPARTITION BY RANGE(id)
  2 (
  3 PARTITION P1 VALUES LESS THAN(50)
  4 (
  5 SUBPARTITION p11 VALUES LESS THAN (2)
  6 ));

Succeed.

SQL> alter table ct_compress_user.ct_compress_table9 modify partition p1 add subpartition p12 values less than(8) compress;

CT-00601, [1:110]Sql syntax error: , expected but compress found
SQL> select count(*) from adm_tab_partitions where table_name=upper('ct_compress_table9') and compress_algo='ZSTD';

COUNT(*)            
--------------------
0                   

1 rows fetched.

SQL> 
SQL> --expect:CT-00601, [1:98]Sql syntax error: unexpected text compress, table compress only supported on (part)table
SQL> drop table if exists ct_compress_user.ct_temp_table;

Succeed.

SQL> create global temporary table ct_compress_user.ct_temp_table(id int, c_id int, name varchar(20)) compress;

CT-00601, [1:98]Sql syntax error: unexpected text compress, table compress only supported on (part)table
SQL> --expect:CT-00601, [1:98]Sql syntax error: unexpected text compress, table compress only supported on (part)table
SQL> drop table if exists ct_compress_user.ct_temp_table;

Succeed.

SQL> create global temporary table ct_compress_user.ct_temp_table(id int, c_id int, name varchar(20)) on Commit Preserve Rows compress;

CT-00601, [1:122]Sql syntax error: unexpected text compress, table compress only supported on (part)table
SQL> --expect:CT-00601, [1:98]Sql syntax error: unexpected text compress, table compress only supported on (part)table
SQL> drop table if exists ct_compress_user.ct_temp_table;

Succeed.

SQL> create table ct_compress_user.ct_temp_table(id int, c_id int, name varchar(20)) nologging compress;

CT-00601, [1:91]Sql syntax error: unexpected text compress, table compress only supported on (part)table
SQL> --expect:CT-00601, [1:98]Sql syntax error: unexpected text nologging, table compress only supported on (part)table
SQL> drop table if exists ct_compress_user.ct_temp_table;

Succeed.

SQL> create table ct_compress_user.ct_temp_table(id int, c_id int, name varchar(20)) compress nologging;

CT-00601, [1:90]Sql syntax error: unexpected text nologging, table compress only supported on (part)table
SQL> 
SQL> --DTS202104170IBUTKP1300
SQL> create table ct_compress_user.tc_compress_csf_001(num int,c_id int,c_last varchar(16) NOT NULL) compress partition by hash(c_id,c_last) partitions 8 compress tablespace ct_compress_space compress compress;

CT-00601, Sql syntax error: duplicate compress specification
SQL> 
SQL> --DTS202104160JISCHP1300
SQL> create tablespace nebula_tablespace datafile 'nebula_tablespace' size 500M compress autoextend on next 1G encryption extent autoallocate;

CT-00130, Operation create compress datafile is not supported on encrypt tablespace
SQL> 
SQL> --DTS202104150KWMAYP0F00
SQL> alter tablespace temp add datafile 'test_temp' size 128M compress autoextend on next 32M;

CT-00130, Operation create compress datafile is not supported on non user tablespace
SQL> 
SQL> --DTS202104150KWMAYP0F00
SQL> drop table if exists ct_compress_user.tc_compress_tbl_001_06;

Succeed.

SQL> create table ct_compress_user.tc_compress_tbl_001_06 (num int,c_id int,c_d_id bigint NOT NULL) partition by hash(c_id) subpartition by hash(c_d_id) (partition p1(subpartition p11,subpartition p12)) compress;

CT-00130, Operation create compress table is not supported on subpart table
SQL> drop table if exists ct_compress_user.tc_compress_tbl_001_06;

Succeed.

SQL> create table ct_compress_user.tc_compress_tbl_001_06 (num int,c_id int,c_d_id bigint NOT NULL) compress partition by hash(c_id) subpartition by hash(c_d_id) (partition p1(subpartition p11,subpartition p12));

CT-00130, Operation create compress table is not supported on subpart table
SQL> 
SQL> drop user ct_compress_user cascade;

Succeed.

SQL> drop tablespace ct_compress_space including contents and datafiles;

Succeed.

SQL> 
SQL> --DTS2021042007LUUOP0G00
SQL> CREATE TABLESPACE TABLESPACE_PARTITION_range_2 DATAFILE 'PARTITION_range_2' SIZE 8M compress AUTOEXTEND ON NEXT 8M extent autoallocate;

Succeed.

SQL> drop table if exists strg_tablespace_split_range_tbl_001;

Succeed.

SQL> create table strg_tablespace_split_range_tbl_001(id int,c_number number)partition by range(c_number)(partition part_1 values less than(40) TABLESPACE sysaux,partition part_2 values less than(100) format csf compress) tablespace TABLESPACE_PARTITION_range_2 format csf;

Succeed.

SQL> insert into strg_tablespace_split_range_tbl_001 values(10,10),(20 ,20),(30,30),(40,40),(50,50),(60,60),(70,70),(80,80),(90,90);

9 rows affected.

SQL> alter table strg_tablespace_split_range_tbl_001 split partition part_2 at (70) into (partition part_2_1 tablespace sysaux, partition part_2_2);

CT-00130, Operation split part table is not supported on non user bitmap tablespace
SQL> drop tablespace TABLESPACE_PARTITION_range_2 including contents and datafiles;

Succeed.

SQL> 


